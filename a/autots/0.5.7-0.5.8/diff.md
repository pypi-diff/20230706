# Comparing `tmp/autots-0.5.7.tar.gz` & `tmp/autots-0.5.8.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "autots-0.5.7.tar", last modified: Tue May 23 03:24:56 2023, max compression
+gzip compressed data, was "autots-0.5.8.tar", last modified: Thu Jul  6 20:15:28 2023, max compression
```

## Comparing `autots-0.5.7.tar` & `autots-0.5.8.tar`

### file list

```diff
@@ -1,89 +1,89 @@
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.441638 autots-0.5.7/
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.123592 autots-0.5.7/AutoTS.egg-info/
--rw-rw-rw-   0        0        0     8896 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     2148 2023-05-23 03:24:56.000000 autots-0.5.7/AutoTS.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0      224 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/requires.txt
--rw-rw-rw-   0        0        0       33 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/top_level.txt
--rw-rw-rw-   0        0        0     1090 2022-11-23 22:39:41.000000 autots-0.5.7/LICENSE
--rw-rw-rw-   0        0        0       61 2023-04-03 03:08:26.000000 autots-0.5.7/MANIFEST.in
--rw-rw-rw-   0        0        0     8896 2023-05-23 03:24:56.441638 autots-0.5.7/PKG-INFO
--rw-rw-rw-   0        0        0     8251 2023-04-10 03:35:49.000000 autots-0.5.7/README.md
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.123592 autots-0.5.7/autots/
--rw-rw-rw-   0        0        0     1384 2023-04-03 14:59:13.000000 autots-0.5.7/autots/__init__.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.140069 autots-0.5.7/autots/datasets/
--rw-rw-rw-   0        0        0      535 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/__init__.py
--rw-rw-rw-   0        0        0    32463 2023-04-08 14:56:53.000000 autots-0.5.7/autots/datasets/_base.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.220747 autots-0.5.7/autots/datasets/data/
--rw-rw-rw-   0        0        0     4527 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/covid_daily.zip
--rw-rw-rw-   0        0        0    81380 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/eia_weekly.zip
--rw-rw-rw-   0        0        0    27440 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/fred_monthly.zip
--rw-rw-rw-   0        0        0     5553 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/fred_yearly.zip
--rw-rw-rw-   0        0        0   107751 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/holidays.zip
--rw-rw-rw-   0        0        0   158529 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/traffic_hourly.zip
--rw-rw-rw-   0        0        0     3377 2023-04-10 03:29:38.000000 autots-0.5.7/autots/datasets/fred.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.252378 autots-0.5.7/autots/evaluator/
--rw-rw-rw-   0        0        0       28 2022-11-23 22:39:41.000000 autots-0.5.7/autots/evaluator/__init__.py
--rw-rw-rw-   0        0        0    16533 2023-04-10 03:29:38.000000 autots-0.5.7/autots/evaluator/anomaly_detector.py
--rw-rw-rw-   0        0        0   108732 2023-05-23 03:16:40.000000 autots-0.5.7/autots/evaluator/auto_model.py
--rw-rw-rw-   0        0        0   140077 2023-05-23 03:16:41.000000 autots-0.5.7/autots/evaluator/auto_ts.py
--rw-rw-rw-   0        0        0    24446 2022-11-23 22:39:41.000000 autots-0.5.7/autots/evaluator/benchmark.py
--rw-rw-rw-   0        0        0    32646 2023-02-01 17:49:09.000000 autots-0.5.7/autots/evaluator/event_forecasting.py
--rw-rw-rw-   0        0        0    21871 2023-05-13 12:57:26.000000 autots-0.5.7/autots/evaluator/metrics.py
--rw-rw-rw-   0        0        0     6490 2023-02-01 17:49:09.000000 autots-0.5.7/autots/evaluator/validation.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.274942 autots-0.5.7/autots/models/
--rw-rw-rw-   0        0        0       24 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/__init__.py
--rw-rw-rw-   0        0        0    14112 2023-01-16 02:41:20.000000 autots-0.5.7/autots/models/arch.py
--rw-rw-rw-   0        0        0    23395 2023-05-23 03:16:38.000000 autots-0.5.7/autots/models/base.py
--rw-rw-rw-   0        0        0   112063 2023-04-10 03:29:40.000000 autots-0.5.7/autots/models/basics.py
--rw-rw-rw-   0        0        0   115339 2023-05-23 03:16:41.000000 autots-0.5.7/autots/models/cassandra.py
--rw-rw-rw-   0        0        0    16461 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/dnn.py
--rw-rw-rw-   0        0        0    63476 2023-05-23 03:16:40.000000 autots-0.5.7/autots/models/ensemble.py
--rw-rw-rw-   0        0        0    28446 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/gluonts.py
--rw-rw-rw-   0        0        0    10745 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/greykite.py
--rw-rw-rw-   0        0        0    33909 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/matrix_var.py
--rw-rw-rw-   0        0        0    19900 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/mlensemble.py
--rw-rw-rw-   0        0        0     8280 2023-05-23 03:16:38.000000 autots-0.5.7/autots/models/model_list.py
--rw-rw-rw-   0        0        0    33743 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/prophet.py
--rw-rw-rw-   0        0        0    19975 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/pytorch.py
--rw-rw-rw-   0        0        0   119274 2023-05-09 17:46:20.000000 autots-0.5.7/autots/models/sklearn.py
--rw-rw-rw-   0        0        0    93302 2023-02-01 17:49:10.000000 autots-0.5.7/autots/models/statsmodels.py
--rw-rw-rw-   0        0        0    21794 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/tfp.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.274942 autots-0.5.7/autots/templates/
--rw-rw-rw-   0        0        0       27 2022-11-23 22:39:41.000000 autots-0.5.7/autots/templates/__init__.py
--rw-rw-rw-   0        0        0    42365 2023-01-21 02:30:16.000000 autots-0.5.7/autots/templates/general.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.301397 autots-0.5.7/autots/tools/
--rw-rw-rw-   0        0        0       96 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/__init__.py
--rw-rw-rw-   0        0        0    42765 2023-04-10 03:29:39.000000 autots-0.5.7/autots/tools/anomaly_utils.py
--rw-rw-rw-   0        0        0     9168 2023-04-08 14:59:14.000000 autots-0.5.7/autots/tools/calendar.py
--rw-rw-rw-   0        0        0     7163 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/cointegration.py
--rw-rw-rw-   0        0        0     1709 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/cpu_count.py
--rw-rw-rw-   0        0        0    40373 2023-03-11 22:20:32.000000 autots-0.5.7/autots/tools/fast_kalman.py
--rw-rw-rw-   0        0        0     5872 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/hierarchial.py
--rw-rw-rw-   0        0        0     5983 2023-05-23 03:16:38.000000 autots-0.5.7/autots/tools/holiday.py
--rw-rw-rw-   0        0        0     9153 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/impute.py
--rw-rw-rw-   0        0        0     5188 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/lunar.py
--rw-rw-rw-   0        0        0     4362 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/percentile.py
--rw-rw-rw-   0        0        0     7786 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/probabilistic.py
--rw-rw-rw-   0        0        0     1001 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/profile.py
--rw-rw-rw-   0        0        0    15361 2023-04-09 14:46:49.000000 autots-0.5.7/autots/tools/regressor.py
--rw-rw-rw-   0        0        0    20206 2023-05-23 03:16:39.000000 autots-0.5.7/autots/tools/seasonal.py
--rw-rw-rw-   0        0        0    18046 2023-04-08 14:58:25.000000 autots-0.5.7/autots/tools/shaping.py
--rw-rw-rw-   0        0        0    19147 2023-04-08 14:59:28.000000 autots-0.5.7/autots/tools/thresholding.py
--rw-rw-rw-   0        0        0   158744 2023-05-23 03:16:42.000000 autots-0.5.7/autots/tools/transform.py
--rw-rw-rw-   0        0        0    18154 2023-04-10 03:29:39.000000 autots-0.5.7/autots/tools/window_functions.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.301397 autots-0.5.7/docs/
--rw-rw-rw-   0        0        0     2748 2023-05-18 20:02:15.000000 autots-0.5.7/docs/conf.py
--rw-rw-rw-   0        0        0     1176 2023-05-18 20:02:32.000000 autots-0.5.7/pyproject.toml
--rw-rw-rw-   0        0        0       42 2023-05-23 03:24:56.441638 autots-0.5.7/setup.cfg
--rw-rw-rw-   0        0        0     1273 2023-05-18 20:02:24.000000 autots-0.5.7/setup.py
-drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.441638 autots-0.5.7/tests/
--rw-rw-rw-   0        0        0     4677 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_anomalies.py
--rw-rw-rw-   0        0        0    29348 2023-05-05 03:21:32.000000 autots-0.5.7/tests/test_autots.py
--rw-rw-rw-   0        0        0     6882 2023-05-17 21:08:23.000000 autots-0.5.7/tests/test_calendar_holiday.py
--rw-rw-rw-   0        0        0    10554 2023-04-02 03:12:25.000000 autots-0.5.7/tests/test_cassandra.py
--rw-rw-rw-   0        0        0     3654 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_event_forecasting.py
--rw-rw-rw-   0        0        0     1512 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_impute.py
--rw-rw-rw-   0        0        0     5118 2023-05-17 20:57:36.000000 autots-0.5.7/tests/test_metrics.py
--rw-rw-rw-   0        0        0     1514 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_percentile.py
--rw-rw-rw-   0        0        0     1836 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_regressor.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.503508 autots-0.5.8/
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.075806 autots-0.5.8/AutoTS.egg-info/
+-rw-rw-rw-   0        0        0     8896 2023-07-06 20:15:28.000000 autots-0.5.8/AutoTS.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     2148 2023-07-06 20:15:28.000000 autots-0.5.8/AutoTS.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-06 20:15:28.000000 autots-0.5.8/AutoTS.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0      224 2023-07-06 20:15:28.000000 autots-0.5.8/AutoTS.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       33 2023-07-06 20:15:28.000000 autots-0.5.8/AutoTS.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0     1090 2022-11-23 22:39:41.000000 autots-0.5.8/LICENSE
+-rw-rw-rw-   0        0        0       61 2023-04-03 03:08:26.000000 autots-0.5.8/MANIFEST.in
+-rw-rw-rw-   0        0        0     8896 2023-07-06 20:15:28.503508 autots-0.5.8/PKG-INFO
+-rw-rw-rw-   0        0        0     8251 2023-04-10 03:35:49.000000 autots-0.5.8/README.md
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.086353 autots-0.5.8/autots/
+-rw-rw-rw-   0        0        0     1384 2023-05-25 15:11:24.000000 autots-0.5.8/autots/__init__.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.106112 autots-0.5.8/autots/datasets/
+-rw-rw-rw-   0        0        0      535 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/__init__.py
+-rw-rw-rw-   0        0        0    32463 2023-04-08 14:56:53.000000 autots-0.5.8/autots/datasets/_base.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.122224 autots-0.5.8/autots/datasets/data/
+-rw-rw-rw-   0        0        0     4527 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/covid_daily.zip
+-rw-rw-rw-   0        0        0    81380 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/eia_weekly.zip
+-rw-rw-rw-   0        0        0    27440 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/fred_monthly.zip
+-rw-rw-rw-   0        0        0     5553 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/fred_yearly.zip
+-rw-rw-rw-   0        0        0   107751 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/holidays.zip
+-rw-rw-rw-   0        0        0   158529 2022-11-23 22:39:41.000000 autots-0.5.8/autots/datasets/data/traffic_hourly.zip
+-rw-rw-rw-   0        0        0     3377 2023-04-10 03:29:38.000000 autots-0.5.8/autots/datasets/fred.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.170556 autots-0.5.8/autots/evaluator/
+-rw-rw-rw-   0        0        0       28 2022-11-23 22:39:41.000000 autots-0.5.8/autots/evaluator/__init__.py
+-rw-rw-rw-   0        0        0    16533 2023-04-10 03:29:38.000000 autots-0.5.8/autots/evaluator/anomaly_detector.py
+-rw-rw-rw-   0        0        0   109554 2023-07-06 14:38:15.000000 autots-0.5.8/autots/evaluator/auto_model.py
+-rw-rw-rw-   0        0        0   148602 2023-07-06 14:38:15.000000 autots-0.5.8/autots/evaluator/auto_ts.py
+-rw-rw-rw-   0        0        0    24446 2022-11-23 22:39:41.000000 autots-0.5.8/autots/evaluator/benchmark.py
+-rw-rw-rw-   0        0        0    32646 2023-02-01 17:49:09.000000 autots-0.5.8/autots/evaluator/event_forecasting.py
+-rw-rw-rw-   0        0        0    21871 2023-05-13 12:57:26.000000 autots-0.5.8/autots/evaluator/metrics.py
+-rw-rw-rw-   0        0        0     6490 2023-02-01 17:49:09.000000 autots-0.5.8/autots/evaluator/validation.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.273507 autots-0.5.8/autots/models/
+-rw-rw-rw-   0        0        0       24 2022-11-23 22:39:41.000000 autots-0.5.8/autots/models/__init__.py
+-rw-rw-rw-   0        0        0    14112 2023-01-16 02:41:20.000000 autots-0.5.8/autots/models/arch.py
+-rw-rw-rw-   0        0        0    26079 2023-07-06 14:38:14.000000 autots-0.5.8/autots/models/base.py
+-rw-rw-rw-   0        0        0   113966 2023-07-06 14:38:15.000000 autots-0.5.8/autots/models/basics.py
+-rw-rw-rw-   0        0        0   116382 2023-07-06 14:38:15.000000 autots-0.5.8/autots/models/cassandra.py
+-rw-rw-rw-   0        0        0    16461 2022-11-23 22:39:41.000000 autots-0.5.8/autots/models/dnn.py
+-rw-rw-rw-   0        0        0    63476 2023-05-23 03:16:40.000000 autots-0.5.8/autots/models/ensemble.py
+-rw-rw-rw-   0        0        0    28473 2023-06-30 22:19:55.000000 autots-0.5.8/autots/models/gluonts.py
+-rw-rw-rw-   0        0        0    10745 2023-04-10 03:29:38.000000 autots-0.5.8/autots/models/greykite.py
+-rw-rw-rw-   0        0        0    33909 2022-11-23 22:39:41.000000 autots-0.5.8/autots/models/matrix_var.py
+-rw-rw-rw-   0        0        0    19900 2023-04-10 03:29:38.000000 autots-0.5.8/autots/models/mlensemble.py
+-rw-rw-rw-   0        0        0     8627 2023-07-06 14:38:14.000000 autots-0.5.8/autots/models/model_list.py
+-rw-rw-rw-   0        0        0    33743 2022-11-23 22:39:41.000000 autots-0.5.8/autots/models/prophet.py
+-rw-rw-rw-   0        0        0    21856 2023-07-06 14:38:14.000000 autots-0.5.8/autots/models/pytorch.py
+-rw-rw-rw-   0        0        0   119772 2023-07-06 14:38:15.000000 autots-0.5.8/autots/models/sklearn.py
+-rw-rw-rw-   0        0        0    93302 2023-02-01 17:49:10.000000 autots-0.5.8/autots/models/statsmodels.py
+-rw-rw-rw-   0        0        0    21794 2022-11-23 22:39:41.000000 autots-0.5.8/autots/models/tfp.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.296902 autots-0.5.8/autots/templates/
+-rw-rw-rw-   0        0        0       27 2022-11-23 22:39:41.000000 autots-0.5.8/autots/templates/__init__.py
+-rw-rw-rw-   0        0        0    42365 2023-01-21 02:30:16.000000 autots-0.5.8/autots/templates/general.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.431448 autots-0.5.8/autots/tools/
+-rw-rw-rw-   0        0        0       96 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/__init__.py
+-rw-rw-rw-   0        0        0    42765 2023-04-10 03:29:39.000000 autots-0.5.8/autots/tools/anomaly_utils.py
+-rw-rw-rw-   0        0        0     9168 2023-04-08 14:59:14.000000 autots-0.5.8/autots/tools/calendar.py
+-rw-rw-rw-   0        0        0     7163 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/cointegration.py
+-rw-rw-rw-   0        0        0     1709 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/cpu_count.py
+-rw-rw-rw-   0        0        0    40565 2023-07-06 14:38:14.000000 autots-0.5.8/autots/tools/fast_kalman.py
+-rw-rw-rw-   0        0        0     5872 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/hierarchial.py
+-rw-rw-rw-   0        0        0     5983 2023-05-23 03:16:38.000000 autots-0.5.8/autots/tools/holiday.py
+-rw-rw-rw-   0        0        0     9153 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/impute.py
+-rw-rw-rw-   0        0        0     5188 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/lunar.py
+-rw-rw-rw-   0        0        0     4362 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/percentile.py
+-rw-rw-rw-   0        0        0     7786 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/probabilistic.py
+-rw-rw-rw-   0        0        0     1001 2022-11-23 22:39:41.000000 autots-0.5.8/autots/tools/profile.py
+-rw-rw-rw-   0        0        0    15361 2023-04-09 14:46:49.000000 autots-0.5.8/autots/tools/regressor.py
+-rw-rw-rw-   0        0        0    20206 2023-05-23 03:16:39.000000 autots-0.5.8/autots/tools/seasonal.py
+-rw-rw-rw-   0        0        0    18159 2023-06-08 16:48:13.000000 autots-0.5.8/autots/tools/shaping.py
+-rw-rw-rw-   0        0        0    19147 2023-04-08 14:59:28.000000 autots-0.5.8/autots/tools/thresholding.py
+-rw-rw-rw-   0        0        0   160900 2023-07-06 14:38:15.000000 autots-0.5.8/autots/tools/transform.py
+-rw-rw-rw-   0        0        0    18154 2023-04-10 03:29:39.000000 autots-0.5.8/autots/tools/window_functions.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.441067 autots-0.5.8/docs/
+-rw-rw-rw-   0        0        0     2748 2023-05-25 15:11:28.000000 autots-0.5.8/docs/conf.py
+-rw-rw-rw-   0        0        0     1176 2023-05-25 15:11:36.000000 autots-0.5.8/pyproject.toml
+-rw-rw-rw-   0        0        0       42 2023-07-06 20:15:28.503508 autots-0.5.8/setup.cfg
+-rw-rw-rw-   0        0        0     1273 2023-05-25 15:11:31.000000 autots-0.5.8/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-06 20:15:28.503508 autots-0.5.8/tests/
+-rw-rw-rw-   0        0        0     4677 2022-11-23 22:39:41.000000 autots-0.5.8/tests/test_anomalies.py
+-rw-rw-rw-   0        0        0    29648 2023-07-06 18:15:46.000000 autots-0.5.8/tests/test_autots.py
+-rw-rw-rw-   0        0        0     6882 2023-05-17 21:08:23.000000 autots-0.5.8/tests/test_calendar_holiday.py
+-rw-rw-rw-   0        0        0    10554 2023-04-02 03:12:25.000000 autots-0.5.8/tests/test_cassandra.py
+-rw-rw-rw-   0        0        0     3654 2022-11-23 22:39:41.000000 autots-0.5.8/tests/test_event_forecasting.py
+-rw-rw-rw-   0        0        0     1512 2022-11-23 22:39:41.000000 autots-0.5.8/tests/test_impute.py
+-rw-rw-rw-   0        0        0     5118 2023-05-17 20:57:36.000000 autots-0.5.8/tests/test_metrics.py
+-rw-rw-rw-   0        0        0     1514 2022-11-23 22:39:41.000000 autots-0.5.8/tests/test_percentile.py
+-rw-rw-rw-   0        0        0     1836 2022-11-23 22:39:41.000000 autots-0.5.8/tests/test_regressor.py
```

### Comparing `autots-0.5.7/AutoTS.egg-info/PKG-INFO` & `autots-0.5.8/AutoTS.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: autots
-Version: 0.5.7
+Version: 0.5.8
 Summary: Automated Time Series Forecasting
 Home-page: https://github.com/winedarksea/AutoTS
 Author: Colin Catlin
 Author-email: Colin Catlin <colin.catlin@gmail.com>
 License: MIT License
 Project-URL: Homepage, https://github.com/winedarksea/AutoTS
 Project-URL: Bug Tracker, https://github.com/winedarksea/AutoTS/issues
```

### Comparing `autots-0.5.7/AutoTS.egg-info/SOURCES.txt` & `autots-0.5.8/AutoTS.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/LICENSE` & `autots-0.5.8/LICENSE`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/PKG-INFO` & `autots-0.5.8/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: autots
-Version: 0.5.7
+Version: 0.5.8
 Summary: Automated Time Series Forecasting
 Home-page: https://github.com/winedarksea/AutoTS
 Author: Colin Catlin
 Author-email: Colin Catlin <colin.catlin@gmail.com>
 License: MIT License
 Project-URL: Homepage, https://github.com/winedarksea/AutoTS
 Project-URL: Bug Tracker, https://github.com/winedarksea/AutoTS/issues
```

### Comparing `autots-0.5.7/README.md` & `autots-0.5.8/README.md`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/__init__.py` & `autots-0.5.8/autots/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -22,15 +22,15 @@
 from autots.tools.shaping import long_to_wide
 from autots.tools.regressor import create_lagged_regressor, create_regressor
 from autots.evaluator.auto_model import model_forecast
 from autots.evaluator.anomaly_detector import AnomalyDetector, HolidayDetector
 from autots.models.cassandra import Cassandra
 
 
-__version__ = '0.5.6'
+__version__ = '0.5.8'
 
 TransformTS = GeneralTransformer
 
 __all__ = [
     'load_daily',
     'load_monthly',
     'load_yearly',
```

### Comparing `autots-0.5.7/autots/datasets/__init__.py` & `autots-0.5.8/autots/datasets/__init__.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/_base.py` & `autots-0.5.8/autots/datasets/_base.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/covid_daily.zip` & `autots-0.5.8/autots/datasets/data/covid_daily.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/eia_weekly.zip` & `autots-0.5.8/autots/datasets/data/eia_weekly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/fred_monthly.zip` & `autots-0.5.8/autots/datasets/data/fred_monthly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/fred_yearly.zip` & `autots-0.5.8/autots/datasets/data/fred_yearly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/holidays.zip` & `autots-0.5.8/autots/datasets/data/holidays.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/data/traffic_hourly.zip` & `autots-0.5.8/autots/datasets/data/traffic_hourly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/datasets/fred.py` & `autots-0.5.8/autots/datasets/fred.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/evaluator/anomaly_detector.py` & `autots-0.5.8/autots/evaluator/anomaly_detector.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/evaluator/auto_model.py` & `autots-0.5.8/autots/evaluator/auto_model.py`

 * *Files 0% similar despite different names*

```diff
@@ -18,15 +18,16 @@
 )
 from autots.tools.shaping import infer_frequency
 from autots.models.model_list import (
     no_params,
     recombination_approved,
     no_shared,
     superfast,
-    model_lists,
+    # model_lists,
+    model_list_to_dict,
 )
 from itertools import zip_longest
 from autots.models.basics import (
     MotifSimulation,
     LastValueNaive,
     AverageValueNaive,
     SeasonalNaive,
@@ -56,17 +57,23 @@
 from autots.models.matrix_var import RRVAR, MAR, TMF, LATC
 
 
 def create_model_id(
     model_str: str, parameter_dict: dict = {}, transformation_dict: dict = {}
 ):
     """Create a hash ID which should be unique to the model parameters."""
-    str_repr = (
-        str(model_str) + json.dumps(parameter_dict) + json.dumps(transformation_dict)
-    )
+    if isinstance(parameter_dict, dict):
+        str_params = json.dumps(parameter_dict)
+    else:
+        str_params = str(parameter_dict)
+    if isinstance(transformation_dict, dict):
+        str_trans = json.dumps(transformation_dict)
+    else:
+        str_trans = str(transformation_dict)
+    str_repr = str(model_str) + str_params + str_trans
     str_repr = ''.join(str_repr.split())
     hashed = md5(str_repr.encode('utf-8')).hexdigest()
     return hashed
 
 
 def horizontal_template_to_model_list(template):
     """helper function to take template dataframe of ensembles to a single list of models."""
@@ -1692,30 +1699,14 @@
         template_result.per_series_uwmse = pd.DataFrame()
         template_result.per_series_smoothness = pd.DataFrame()
         if verbose > 0 and not template.empty:
             print(f"Generation {current_generation} had all new models fail")
     return template_result
 
 
-def model_list_to_dict(model_list):
-    """Convert various possibilities to dict."""
-    if model_list in list(model_lists.keys()):
-        model_list = model_lists[model_list]
-
-    if isinstance(model_list, dict):
-        model_prob = list(model_list.values())
-        model_list = [*model_list]
-    elif isinstance(model_list, list):
-        trs_len = len(model_list)
-        model_prob = [1 / trs_len] * trs_len
-    else:
-        raise ValueError("model_list type not recognized.")
-    return model_list, model_prob
-
-
 def random_model(
     model_list,
     model_prob,
     transformer_list='fast',
     transformer_max_depth=2,
     models_mode='random',
     counter=15,
@@ -1923,14 +1914,16 @@
         'TransformationParameters',
         'Ensemble',
     ],
     transformer_list: dict = {},
     transformer_max_depth: int = 8,
     models_mode: str = "default",
     score_per_series=None,
+    recursive_count=0,
+    # UPDATE RECURSIVE section if adding or removing params
 ):
     """
     Return new template given old template with model accuracies.
 
     "No mating!" - Pattern, Sanderson
 
     Args:
@@ -2115,16 +2108,38 @@
     # remove generated models which have already been tried
     sorted_results = pd.concat(
         [submitted_parameters, sorted_results], axis=0, ignore_index=True, sort=False
     ).reset_index(drop=True)
     new_template = UniqueTemplates(
         sorted_results, new_template, selection_cols=template_cols
     )
+    # use recursion to avoid empty returns
+    if new_template.empty:
+        recursive_count += 1
+        if recursive_count > 20:
+            print("NewGeneticTemplate max recursion reached")
+            return new_template
+        else:
+            return NewGeneticTemplate(
+                model_results=model_results,
+                submitted_parameters=submitted_parameters,
+                sort_column=sort_column,
+                sort_ascending=sort_ascending,
+                max_results=max_results,
+                max_per_model_class=max_per_model_class,
+                top_n=top_n,
+                template_cols=template_cols,
+                transformer_list=transformer_list,
+                transformer_max_depth=transformer_max_depth,
+                models_mode=models_mode,
+                score_per_series=score_per_series,
+                recursive_count=recursive_count,
+            )
     # enjoy the privilege
-    if new_template.shape[0] < max_results:
+    elif new_template.shape[0] < max_results:
         return new_template
     else:
         if max_results < 1:
             return new_template.sample(
                 frac=max_results,
                 weights=np.log(np.arange(new_template.shape[0]) + 2)[::-1] + 1,
             )
@@ -2540,25 +2555,28 @@
         # handle nan
         if oda_score.isna().all().all():
             print("NaN in Contour in generate_score_per_series")
             if overall_score.sum().sum() == 0:
                 overall_score = mae_score
         else:
             overall_score = overall_score + (oda_score * oda_weighting)
-    # remove basic duplicates
-    local_results = results_object.model_results.copy()
-    local_results = local_results[local_results['Exceptions'].isna()]
-    local_results = local_results.sort_values(by="TotalRuntimeSeconds", ascending=True)
-    local_results.drop_duplicates(
-        subset=['ValidationRound', 'smape', 'mae', 'spl'], keep="first", inplace=True
-    )
     # select only models run through all validations
     # run_count = temp.groupby(level=0).count().mean(axis=1)
     # models_to_use = run_count[run_count >= total_validations].index.tolist()
     if models_to_use is None:
+        # remove basic duplicates
+        local_results = results_object.model_results.copy()
+        local_results = local_results[local_results['Exceptions'].isna()]
+        local_results = local_results.sort_values(
+            by="TotalRuntimeSeconds", ascending=True
+        )
+        local_results = local_results.drop_duplicates(
+            subset=['ValidationRound', 'smape', 'mae', 'spl'],
+            keep="first",
+        )
         run_count = local_results[['Model', 'ID']].groupby("ID").count()
         models_to_use = run_count[
             run_count['Model'] >= total_validations
         ].index.tolist()
     overall_score = overall_score[overall_score.index.isin(models_to_use)]
     # remove duplicates for each model, as can occasionally happen
     unique_id_name = "IDxxxx6777y9"  # want it unlikely to be a time series name
```

### Comparing `autots-0.5.7/autots/evaluator/auto_ts.py` & `autots-0.5.8/autots/evaluator/auto_ts.py`

 * *Files 3% similar despite different names*

```diff
@@ -27,14 +27,15 @@
     generate_score,
     generate_score_per_series,
     model_forecast,
     validation_aggregation,
     back_forecast,
     remove_leading_zeros,
     horizontal_template_to_model_list,
+    create_model_id,
 )
 from autots.models.ensemble import (
     EnsembleTemplateGenerator,
     HorizontalTemplateGenerator,
     generate_mosaic_template,
     generate_crosshair_score,
 )
@@ -272,14 +273,16 @@
                 'mosaic-window',
                 "subsample",
                 'mlensemble',
             ]
         elif ensemble == 'auto':
             if model_list in ['superfast']:
                 ensemble = ['horizontal-max']
+            elif any([x for x in model_list if x in ['PytorchForecasting', 'GluonTS']]):
+                ensemble = None
             else:
                 ensemble = ['simple', "distance", "horizontal-max"]
         if isinstance(ensemble, str):
             self.ensemble = ensemble.split(",")
         elif isinstance(ensemble, list):
             self.ensemble = ensemble
         elif ensemble is None or not ensemble:
@@ -434,14 +437,17 @@
         self.best_model_transformation_params = ""
         self.traceback = True if verbose > 1 else False
         self.future_regressor_train = None
         self.validation_train_indexes = []
         self.validation_test_indexes = []
         self.preclean_transformer = None
         self.score_per_series = None
+        self.best_model_non_horizontal = None
+        self.validation_forecasts_template = None
+        self.validation_forecasts = {}
         # this is temporary until proper validation param passing is sorted out
         stride_size = round(self.forecast_length / 2)
         stride_size = stride_size if stride_size > 0 else 1
         self.similarity_validation_params = {
             "stride_size": stride_size,
             "distance_metric": "nan_euclidean",
             "include_differenced": True,
@@ -496,15 +502,15 @@
                         'mosaic-crosshair',
                         "subsample",
                         "mlensemble",
                     ],
                 ],
                 [0.3, 0.1, 0.2, 0.2],
             )[0]
-        if method == "full":
+        if method in ["full", "fast"]:
             metric_weighting = {
                 'smape_weighting': random.choices([0, 1, 5, 10], [0.3, 0.2, 0.3, 0.1])[
                     0
                 ],
                 'mae_weighting': random.choices([0, 1, 3, 5], [0.1, 0.3, 0.3, 0.3])[0],
                 'rmse_weighting': random.choices([0, 1, 3, 5], [0.1, 0.3, 0.3, 0.3])[0],
                 'made_weighting': random.choices([0, 1, 3, 5], [0.7, 0.3, 0.1, 0.05])[
@@ -647,27 +653,42 @@
                     0.05,
                     0.05,
                     0.05,
                     0.05,
                     0.05,
                 ],
             )[0]
+        elif method == 'fast':
+            model_list = random.choices(
+                [
+                    'fast',
+                    'superfast',
+                    'motifs',
+                    'no_shared_fast',
+                ],
+                [
+                    0.2,
+                    0.2,
+                    0.2,
+                    0.2,
+                ],
+            )[0]
         else:
             model_list = random.choices(
                 [
                     'fast',
                     'superfast',
                     'default',
                     'fast_parallel',
                     'motifs',
                     'no_shared_fast',
                 ],
                 [0.2, 0.2, 0.2, 0.2, 0.05, 0.1],
             )[0]
-        if method == 'full':
+        if method in ['full', 'fast']:
             validation_method = random.choices(
                 ['backwards', 'even', 'similarity', 'seasonal 364', 'seasonal'],
                 [0.4, 0.1, 0.3, 0.3, 0.2],
             )[0]
         else:
             validation_method = random.choices(
                 ['backwards', 'even', 'similarity', 'seasonal 364'],
@@ -1573,14 +1594,30 @@
             # rerun validation_results aggregation with new models added
             self.validation_results = copy.copy(self.initial_results)
             self.validation_results = validation_aggregation(
                 self.validation_results, df_train=self.df_wide_numeric
             )
 
             # use the best of these ensembles if any ran successfully
+            # horizontal ensembles are only run on one eval, if that eval is harder it won't compare to full validation results
+            # however they are chosen based off of validation results of all validation runs
+            eligible_models = self.validation_results.model_results[
+                self.validation_results.model_results['Runs']
+                >= (self.num_validations + 1)
+            ]
+            try:
+                self.best_model_non_horizontal = (
+                    eligible_models.sort_values(
+                        by="Score", ascending=True, na_position='last'
+                    )
+                    .drop_duplicates(subset=self.template_cols)
+                    .head(1)[self.template_cols_id]
+                )
+            except IndexError:
+                raise ValueError(error_msg_template)
             try:
                 horz_flag = hens_model_results['Exceptions'].isna().any()
             except Exception:
                 horz_flag = False
             if not hens_model_results.empty and horz_flag:
                 hens_model_results['Score'] = generate_score(
                     hens_model_results,
@@ -1592,30 +1629,18 @@
                 ).head(1)[self.template_cols_id]
                 self.ensemble_check = 1
             # else use the best of the previous
             else:
                 if self.verbose >= 0:
                     print("Horizontal ensemble failed. Using best non-horizontal.")
                     time.sleep(3)
-                eligible_models = self.validation_results.model_results[
-                    self.validation_results.model_results['Runs']
-                    >= (self.num_validations + 1)
-                ]
-                try:
-                    self.best_model = (
-                        eligible_models.sort_values(
-                            by="Score", ascending=True, na_position='last'
-                        )
-                        .drop_duplicates(subset=self.template_cols)
-                        .head(1)[self.template_cols_id]
-                    )
-                except IndexError:
-                    raise ValueError(error_msg_template)
+                self.best_model = self.best_model_non_horizontal
+
         else:
-            # choose best model
+            # choose best model, when no horizontal ensembling is done
             eligible_models = self.validation_results.model_results[
                 self.validation_results.model_results['Runs']
                 >= (self.num_validations + 1)
             ]
             try:
                 self.best_model = (
                     eligible_models.sort_values(
@@ -1715,17 +1740,23 @@
             current_generation=current_generation,
         )
         if model_count == 0:
             self.model_count += template_result.model_count
         else:
             self.model_count = template_result.model_count
         # capture results from lower-level template run
-        template_result.model_results['TotalRuntime'].fillna(
-            pd.Timedelta(seconds=60), inplace=True
-        )
+        if "TotalRuntime" in template_result.model_results.columns:
+            template_result.model_results['TotalRuntime'].fillna(
+                pd.Timedelta(seconds=60), inplace=True
+            )
+        else:
+            # trying to catch a rare and sneaky bug (perhaps some variety of beetle?)
+            print(f"TotalRuntime missing in {current_generation}!")
+            self.template_result_error = template_result.model_results.copy()
+            self.template_error = template.copy()
         # gather results of template run
         self.initial_results = self.initial_results.concat(template_result)
         self.initial_results.model_results['Score'] = generate_score(
             self.initial_results.model_results,
             metric_weighting=self.metric_weighting,
             prediction_interval=self.prediction_interval,
         )
@@ -1735,21 +1766,23 @@
     def _run_validations(
         self,
         df_wide_numeric,
         num_validations,
         validation_template,
         future_regressor,
         first_validation=True,
+        skip_first_index=True,
     ):
         """Loop through a template for n validation segments."""
         for y in range(num_validations):
+            cslc = y + 1 if skip_first_index else y
             if self.verbose > 0:
-                print("Validation Round: {}".format(str(y + 1)))
+                print("Validation Round: {}".format(str(cslc)))
             # slice the validation data into current validation slice
-            current_slice = df_wide_numeric.reindex(self.validation_indexes[(y + 1)])
+            current_slice = df_wide_numeric.reindex(self.validation_indexes[cslc])
 
             # subset series (if used) and take a new train/test split
             if self.subset_flag:
                 # mosaic can't handle different cols in each validation
                 if any([x in self.mosaic_list for x in self.ensemble]):
                     rand_st = self.random_seed
                 else:
@@ -1757,15 +1790,15 @@
                 df_subset = subset_series(
                     current_slice,
                     list((self.weights.get(i)) for i in current_slice.columns),
                     n=self.subset,
                     random_state=rand_st,
                 )
                 if self.verbose > 1:
-                    print(f'{y + 1} subset is of: {df_subset.columns}')
+                    print(f'Val {cslc} subset is of: {df_subset.columns}')
             else:
                 df_subset = current_slice
             # subset weighting info
             if not self.weighted:
                 current_weights = {x: 1 for x in df_subset.columns}
             else:
                 current_weights = {x: self.weights[x] for x in df_subset.columns}
@@ -1823,14 +1856,77 @@
 
         self.validation_results = copy.copy(self.initial_results)
         # aggregate validation results
         self.validation_results = validation_aggregation(
             self.validation_results, df_train=self.df_wide_numeric
         )
 
+    def _predict(
+        self,
+        forecast_length: int = "self",
+        prediction_interval: float = 'self',
+        future_regressor=None,
+        fail_on_forecast_nan: bool = True,
+        verbose: int = 'self',
+        model_name=None,
+        model_params=None,
+        model_transformation_params=None,
+        df_wide_numeric=None,
+        future_regressor_train=None,
+    ):
+        df_forecast = model_forecast(
+            model_name=self.best_model_name if model_name is None else model_name,
+            model_param_dict=self.best_model_params.copy()
+            if model_params is None
+            else model_params,
+            model_transform_dict=self.best_model_transformation_params
+            if model_transformation_params is None
+            else model_transformation_params,
+            df_train=self.df_wide_numeric
+            if df_wide_numeric is None
+            else df_wide_numeric,
+            forecast_length=forecast_length,
+            frequency=self.frequency,
+            prediction_interval=prediction_interval,
+            no_negatives=self.no_negatives,
+            constraint=self.constraint,
+            future_regressor_train=self.future_regressor_train
+            if future_regressor_train is None
+            else future_regressor_train,
+            future_regressor_forecast=future_regressor,
+            holiday_country=self.holiday_country,
+            startTimeStamps=self.startTimeStamps,
+            grouping_ids=self.grouping_ids,
+            fail_on_forecast_nan=fail_on_forecast_nan,
+            random_seed=self.random_seed,
+            verbose=verbose,
+            n_jobs=self.n_jobs,
+            template_cols=self.template_cols,
+            current_model_file=self.current_model_file,
+            return_model=True,
+        )
+        # convert categorical back to numeric
+        trans = self.categorical_transformer
+        df_forecast.forecast = trans.inverse_transform(df_forecast.forecast)
+        df_forecast.lower_forecast = trans.inverse_transform(df_forecast.lower_forecast)
+        df_forecast.upper_forecast = trans.inverse_transform(df_forecast.upper_forecast)
+        # undo preclean transformations if necessary
+        if self.preclean is not None:
+            df_forecast.forecast = self.preclean_transformer.inverse_transform(
+                df_forecast.forecast
+            )
+            df_forecast.lower_forecast = self.preclean_transformer.inverse_transform(
+                df_forecast.lower_forecast
+            )
+            df_forecast.upper_forecast = self.preclean_transformer.inverse_transform(
+                df_forecast.upper_forecast
+            )
+        sys.stdout.flush()
+        return df_forecast
+
     def predict(
         self,
         forecast_length: int = "self",
         prediction_interval: float = 'self',
         future_regressor=None,
         hierarchy=None,
         just_point_forecast: bool = False,
@@ -1875,112 +1971,31 @@
                 index=self.df_wide_numeric.index
             )
 
         # allow multiple prediction intervals
         if isinstance(prediction_interval, list):
             forecast_objects = {}
             for interval in prediction_interval:
-                df_forecast = model_forecast(
-                    model_name=self.best_model_name,
-                    model_param_dict=self.best_model_params.copy(),
-                    model_transform_dict=self.best_model_transformation_params,
-                    df_train=self.df_wide_numeric,
+                df_forecast = self._predict(
                     forecast_length=forecast_length,
-                    frequency=self.frequency,
-                    prediction_interval=interval,
-                    no_negatives=self.no_negatives,
-                    constraint=self.constraint,
-                    future_regressor_train=self.future_regressor_train,
-                    future_regressor_forecast=future_regressor,
-                    holiday_country=self.holiday_country,
-                    startTimeStamps=self.startTimeStamps,
-                    grouping_ids=self.grouping_ids,
+                    prediction_interval=prediction_interval,
+                    future_regressor=future_regressor,
                     fail_on_forecast_nan=fail_on_forecast_nan,
-                    random_seed=self.random_seed,
                     verbose=verbose,
-                    n_jobs=self.n_jobs,
-                    template_cols=self.template_cols,
-                    current_model_file=self.current_model_file,
-                    return_model=True,
                 )
-                # convert categorical back to numeric
-                trans = self.categorical_transformer
-                df_forecast.forecast = trans.inverse_transform(df_forecast.forecast)
-                df_forecast.lower_forecast = trans.inverse_transform(
-                    df_forecast.lower_forecast
-                )
-                df_forecast.upper_forecast = trans.inverse_transform(
-                    df_forecast.upper_forecast
-                )
-                # undo preclean transformations if necessary
-                if self.preclean is not None:
-                    df_forecast.forecast = self.preclean_transformer.inverse_transform(
-                        df_forecast.forecast
-                    )
-                    df_forecast.lower_forecast = (
-                        self.preclean_transformer.inverse_transform(
-                            df_forecast.lower_forecast
-                        )
-                    )
-                    df_forecast.upper_forecast = (
-                        self.preclean_transformer.inverse_transform(
-                            df_forecast.upper_forecast
-                        )
-                    )
                 forecast_objects[str(interval)] = df_forecast
             return forecast_objects
         else:
-            df_forecast = model_forecast(
-                model_name=self.best_model_name,
-                model_param_dict=self.best_model_params.copy(),
-                model_transform_dict=self.best_model_transformation_params,
-                df_train=self.df_wide_numeric,
+            df_forecast = self._predict(
                 forecast_length=forecast_length,
-                frequency=self.frequency,
                 prediction_interval=prediction_interval,
-                no_negatives=self.no_negatives,
-                constraint=self.constraint,
-                future_regressor_train=self.future_regressor_train,
-                future_regressor_forecast=future_regressor,
-                holiday_country=self.holiday_country,
-                startTimeStamps=self.startTimeStamps,
-                grouping_ids=self.grouping_ids,
+                future_regressor=future_regressor,
                 fail_on_forecast_nan=fail_on_forecast_nan,
-                random_seed=self.random_seed,
                 verbose=verbose,
-                n_jobs=self.n_jobs,
-                template_cols=self.template_cols,
-                current_model_file=self.current_model_file,
-                return_model=True,
-            )
-            # convert categorical back to numeric
-            trans = self.categorical_transformer
-            df_forecast.forecast = trans.inverse_transform(df_forecast.forecast)
-            df_forecast.lower_forecast = trans.inverse_transform(
-                df_forecast.lower_forecast
-            )
-            df_forecast.upper_forecast = trans.inverse_transform(
-                df_forecast.upper_forecast
             )
-            # undo preclean transformations if necessary
-            if self.preclean is not None:
-                df_forecast.forecast = self.preclean_transformer.inverse_transform(
-                    df_forecast.forecast
-                )
-                df_forecast.lower_forecast = (
-                    self.preclean_transformer.inverse_transform(
-                        df_forecast.lower_forecast
-                    )
-                )
-                df_forecast.upper_forecast = (
-                    self.preclean_transformer.inverse_transform(
-                        df_forecast.upper_forecast
-                    )
-                )
-            sys.stdout.flush()
             if just_point_forecast:
                 return df_forecast.forecast
             else:
                 return df_forecast
 
     def results(self, result_set: str = 'initial'):
         """Convenience function to return tested models table.
@@ -2308,15 +2323,15 @@
             and str(self.best_model_params.get('model_name', "Mosaic")).lower()
             != "mosaic"
         ):
             self.horizontal_per_generation().model_results['Score'].plot(
                 ylabel="Lowest Score", xlabel="Generation", title=title, **kwargs
             )
         else:
-            print("not a valid horizontal model")
+            print("not a valid horizontal model for plot_horizontal_per_generation")
 
     def back_forecast(
         self, series=None, n_splits: int = "auto", tail: int = "auto", verbose: int = 0
     ):
         """Create forecasts for the historical training data, ie. backcast or back forecast. OUT OF SAMPLE
 
         This actually forecasts on historical data, these are not fit model values as are often returned by other packages.
@@ -2566,26 +2581,219 @@
             return ax
         except Exception:
             plot_df.plot(title=title, **kwargs)
 
     def plot_back_forecast(self, **kwargs):
         return self.plot_backforecast(**kwargs)
 
+    def plot_validations(
+        self,
+        models=None,
+        series=None,
+        title=None,
+        start_date="auto",
+        end_date=None,
+        subset=None,
+        compare_horizontal=False,
+        colors=None,
+        include_bounds=True,
+        alpha=0.35,
+        **kwargs,
+    ):
+        """Similar to plot_backforecast but using the model's validation segments specifically. Must reforecast.
+        Saves results to self.validation_forecasts and caches. Set that to None to force rerun otherwise it uses stored (when models is the same).
+        'chosen' refers to best_model_id, the model chosen to run for predict
+
+        Args:
+            models (list): list, str, df or None, models to compare (IDs unless df of model params)
+            series (str): time series to graph
+            title (str): graph title
+            start_date (str): or datetime, place to begin graph, None for full
+            end_date (str): or datetime, end of graph x axis
+            subset (str): overrides series, shows either 'best' or 'worst'
+            compare_horizontal (bool): if True, plot horizontal ensemble versus best non-horizontal model, when available
+            include_bounds (bool): if True (default) include the upper/lower forecast bounds
+        """
+        if series is None:
+            if str(subset).lower() == "best":
+                series = self.best_model_per_series_mape().tail(1).index.tolist()[0]
+            elif str(subset).lower() == "best score":
+                series = self.best_model_per_series_score().tail(1).index.tolist()[0]
+            elif str(subset).lower() == "worst":
+                series = self.best_model_per_series_mape().head(1).index.tolist()[0]
+            elif str(subset).lower() == "worst score":
+                series = self.best_model_per_series_score().head(1).index.tolist()[0]
+            elif subset is None:
+                series = random.choice(self.df_wide_numeric.columns)
+            else:
+                raise ValueError(
+                    "plot_validations arg subset must be None, 'best' or 'worst'"
+                )
+        if title is None:
+            if subset is not None:
+                if "score" in str(subset).lower():
+                    title = f"Validation Forecasts for {subset} Tested Series {series}"
+                else:
+                    title = (
+                        f"Validation Forecasts for {subset} Tested MAPE Series {series}"
+                    )
+            else:
+                title = f"Validation Forecasts for {series}"
+        if models is None:
+            if self.best_model_non_horizontal is not None and compare_horizontal:
+                validation_template = pd.concat(
+                    [self.best_model, self.best_model_non_horizontal], axis=0
+                )
+            else:
+                validation_template = self.best_model
+                colors = {
+                    'actuals': '#AFDBF5',
+                    'chosen': '#4D4DFF',
+                    'chosen_lower': '#A7AFB2',
+                    'chosen_upper': '#A7AFB2',
+                }
+        elif isinstance(models, str):
+            val_results = self.results()
+            validation_template = val_results[val_results['ID'].isin([models])][
+                self.template_cols
+            ].drop_duplicates()
+        elif isinstance(models, list):
+            validation_template = val_results[val_results['ID'].isin(models)][
+                self.template_cols
+            ].drop_duplicates()
+        elif isinstance(models, pd.DataFrame):
+            validation_template = models
+        duplicated = False
+        if self.validation_forecasts_template is not None:
+            if self.validation_forecasts_template.equals(validation_template):
+                duplicated = True
+        if not duplicated:
+            self.validation_forecast_cuts = []
+            # self.validation_forecasts = {}
+            for val in range(len(self.validation_train_indexes)):
+                test_idx = self.validation_train_indexes[val]
+                train_reg = self.future_regressor_train.reindex(test_idx)
+                sec_idx = self.validation_test_indexes[val]
+                self.validation_forecast_cuts.append(sec_idx[0])
+                fut_reg = self.future_regressor_train.reindex(sec_idx)
+                for index, row in validation_template.iterrows():
+                    df_forecast = self._predict(
+                        forecast_length=self.forecast_length,
+                        prediction_interval=self.prediction_interval,
+                        future_regressor=fut_reg,
+                        fail_on_forecast_nan=False,
+                        verbose=self.verbose,
+                        model_name=row["Model"],
+                        model_params=row["ModelParameters"],
+                        model_transformation_params=row["TransformationParameters"],
+                        df_wide_numeric=self.df_wide_numeric.reindex(test_idx),
+                        future_regressor_train=train_reg,
+                    )
+                    idz = create_model_id(
+                        row["Model"],
+                        row["ModelParameters"],
+                        row["TransformationParameters"],
+                    )
+                    if idz == self.best_model_id:
+                        idz = "chosen_model"
+                    self.validation_forecasts[str(val) + "_" + str(idz)] = df_forecast
+        else:
+            if self.verbose > 0:
+                print("using stored results for plot_validations")
+        self.validation_forecasts_template = validation_template
+        needed_mods = self.validation_forecasts_template['ID'].tolist()
+        df_list = []
+        for x in self.validation_forecasts.keys():
+            mname = x.split("_")[1]
+            if mname == "chosen" or mname in needed_mods:
+                new_df = pd.DataFrame(index=self.df_wide_numeric.index)
+                new_df[mname] = self.validation_forecasts[x].forecast[series]
+                new_df[mname + "_" + "upper"] = self.validation_forecasts[
+                    x
+                ].upper_forecast[series]
+                new_df[mname + "_" + "lower"] = self.validation_forecasts[
+                    x
+                ].lower_forecast[series]
+                df_list.append(new_df)
+        plot_df = pd.concat(df_list, sort=True, axis=0)
+        plot_df = plot_df.groupby(level=0).last()
+        plot_df = (
+            self.df_wide_numeric[series]
+            .rename("actuals")
+            .to_frame()
+            .merge(plot_df, left_index=True, right_index=True, how="left")
+        )
+        if not include_bounds:
+            colb = [
+                x for x in plot_df.columns if "_lower" not in x and "_upper" not in x
+            ]
+            plot_df = plot_df[colb]
+        if start_date == "auto":
+            start_date = plot_df[plot_df.columns.difference(['actuals'])].dropna(
+                how='all', axis=0
+            ).index.min() - pd.Timedelta(days=7)
+        if start_date is not None:
+            plot_df = plot_df[plot_df.index >= start_date]
+        if end_date is not None:
+            plot_df = plot_df[plot_df.index <= end_date]
+        # actual plotting section
+        if colors is not None:
+            # this will need to change is users are allowed to input colors
+            ax = plot_df[['actuals', 'chosen']].plot(
+                title=title, color=colors, **kwargs
+            )
+            ax.fill_between(
+                plot_df.index,
+                plot_df['chosen_upper'],
+                plot_df['chosen_lower'],
+                alpha=alpha,
+                color="#A5ADAF",
+            )
+        else:
+            ax = plot_df.plot(title=title, **kwargs)
+        ax.vlines(
+            x=self.validation_forecast_cuts,
+            ls='--',
+            lw=1,
+            colors='darkred',
+            ymin=plot_df.min().min(),
+            ymax=plot_df.max().max(),
+        )
+        return ax
+
     def list_failed_model_types(self):
         """Return a list of model types (ie ETS, LastValueNaive) that failed.
         If all had at least one success, then return an empty list.
         """
         if self.best_model.empty:
             raise ValueError("No best_model. AutoTS .fit() needs to be run.")
         temp = self.initial_results.model_results[['Model', 'Exceptions']].copy()
         temp['Exceptions'] = temp['Exceptions'].isnull().astype(int)
         temp = temp.groupby("Model")['Exceptions'].sum()
         return temp[temp <= 0].index.to_list()
 
-    def plot_per_series_smape(
+    def best_model_per_series_mape(self):
+        best_model_per_series_mae = self.initial_results.per_series_mae[
+            self.initial_results.per_series_mae.index == self.best_model_id
+        ].mean(axis=0)
+        # obsess over avoiding division by zero
+        scaler = self.df_wide_numeric.mean(axis=0)
+        scaler[scaler == 0] == np.nan
+        scaler = scaler.fillna(self.df_wide_numeric.max(axis=0))
+        scaler[scaler == 0] == 1
+        temp = (
+            ((best_model_per_series_mae / scaler) * 100)
+            .round(2)
+            .sort_values(ascending=False)
+        )
+        temp.name = 'MAPE'
+        temp.index.name = 'Series'
+        return temp
+
+    def plot_per_series_mape(
         self,
         title: str = None,
         max_series: int = 10,
         max_name_chars: int = 25,
         color: str = "#ff9912",
         figsize=(12, 4),
         kind: str = "bar",
@@ -2601,58 +2809,58 @@
             figsize (tuple): passed through to plot axis
             kind (str): bar or pie
             **kwargs passed to pandas.plot()
         """
         if self.best_model.empty:
             raise ValueError("No best_model. AutoTS .fit() needs to be run.")
         if title is None:
-            title = f"Top {max_series} Series Contributing SMAPE Error"
-        best_model_per_series_mae = self.initial_results.per_series_mae[
-            self.initial_results.per_series_mae.index == self.best_model_id
-        ].mean(axis=0)
-        # obsess over avoiding division by zero
-        scaler = self.df_wide_numeric.mean(axis=0)
-        scaler[scaler == 0] == np.nan
-        scaler = scaler.fillna(self.df_wide_numeric.max(axis=0))
-        scaler[scaler == 0] == 1
-        temp = (
-            ((best_model_per_series_mae / scaler) * 100)
-            .round(2)
-            .sort_values(ascending=False)
-            .head(max_series)
-        )
-        temp = temp.reset_index()
-        temp.columns = ["Series", "SMAPE"]
+            title = f"Top {max_series} Series Contributing MAPE Error"
+
+        temp = self.best_model_per_series_mape().reset_index().head(max_series)
+
         if self.best_model_ensemble == 2:
             series = self.horizontal_to_df()
             temp = temp.merge(series, on='Series')
             temp['Series'] = (
                 temp['Series'].str.slice(0, max_name_chars) + " (" + temp["Model"] + ")"
             )
 
         if kind == "pie":
             return temp.set_index("Series").plot(
-                y="SMAPE",
+                y="MAPE",
                 kind="pie",
                 title=title,
                 figsize=figsize,
                 legend=False,
                 **kwargs,
             )
         else:
             return temp.plot(
                 x="Series",
-                y="SMAPE",
+                y="MAPE",
                 kind=kind,
                 title=title,
                 color=color,
                 figsize=figsize,
                 **kwargs,
             )
 
+    def best_model_per_series_score(self):
+        return (
+            generate_score_per_series(
+                self.initial_results,
+                metric_weighting=self.metric_weighting,
+                total_validations=(self.num_validations + 1),
+                models_to_use=[self.best_model_id],
+            )
+            .mean(axis=0)
+            .sort_values(ascending=False)
+            .round(3)
+        )
+
     def plot_per_series_error(
         self,
         title: str = "Top Series Contributing Score Error",
         max_series: int = 10,
         max_name_chars: int = 25,
         color: str = "#ff9912",
         figsize=(12, 4),
@@ -2668,29 +2876,16 @@
             color (str): hex or name of color of plot
             figsize (tuple): passed through to plot axis
             kind (str): bar or pie
             **kwargs passed to pandas.plot()
         """
         if self.best_model.empty:
             raise ValueError("No best_model. AutoTS .fit() needs to be run.")
-        best_model_per = self.initial_results.per_series_mae[
-            self.initial_results.per_series_mae.index == self.best_model_id
-        ]
-        best_model_per = (
-            generate_score_per_series(
-                self.initial_results,
-                metric_weighting=self.metric_weighting,
-                total_validations=(self.num_validations + 1),
-                models_to_use=[self.best_model_id],
-            )
-            .mean(axis=0)
-            .sort_values(ascending=False)
-            .head(max_series)
-            .round(2)
-        )
+        # best_model_per = self.initial_results.per_series_mae[self.initial_results.per_series_mae.index == self.best_model_id]
+        best_model_per = self.best_model_per_series_score().head(max_series)
         temp = best_model_per.reset_index()
         temp.columns = ["Series", "Error"]
         if self.best_model["Ensemble"].iloc[0] == 2:
             series = self.horizontal_to_df()
             temp = temp.merge(series, on='Series')
             temp['Series'] = (
                 temp['Series'].str.slice(0, max_name_chars) + " (" + temp["Model"] + ")"
```

### Comparing `autots-0.5.7/autots/evaluator/benchmark.py` & `autots-0.5.8/autots/evaluator/benchmark.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/evaluator/event_forecasting.py` & `autots-0.5.8/autots/evaluator/event_forecasting.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/evaluator/metrics.py` & `autots-0.5.8/autots/evaluator/metrics.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/evaluator/validation.py` & `autots-0.5.8/autots/evaluator/validation.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/arch.py` & `autots-0.5.8/autots/models/arch.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/base.py` & `autots-0.5.8/autots/models/base.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,21 +1,36 @@
 # -*- coding: utf-8 -*-
 """
 Base model information
 
 @author: Colin
 """
+import random
 import warnings
 import datetime
 import numpy as np
 import pandas as pd
 from autots.tools.shaping import infer_frequency, clean_weights
 from autots.evaluator.metrics import full_metric_evaluation
 
 
+def create_forecast_index(frequency, forecast_length, train_last_date, last_date=None):
+    if frequency == 'infer':
+        raise ValueError(
+            "create_forecast_index run without specific frequency, run basic_profile first or pass proper frequency to model init"
+        )
+    return pd.date_range(
+        freq=frequency,
+        start=train_last_date if last_date is None else last_date,
+        periods=forecast_length + 1,
+    )[
+        1:
+    ]  # note the disposal of the first (already extant) date
+
+
 class ModelObject(object):
     """Generic class for holding forecasting models.
 
     Models should all have methods:
         .fit(df, future_regressor = []) (taking a DataFrame with DatetimeIndex and n columns of n timeseries)
         .predict(forecast_length = int, future_regressor = [], just_point_forecast = False)
         .get_new_params() - return a dictionary of weighted random selected parameters
@@ -69,26 +84,18 @@
 
     def create_forecast_index(self, forecast_length: int, last_date=None):
         """Generate a pd.DatetimeIndex appropriate for a new forecast.
 
         Warnings:
             Requires ModelObject.basic_profile() being called as part of .fit()
         """
-        if self.frequency == 'infer':
-            raise ValueError(
-                "create_forecast_index run without specific frequency, run basic_profile first or pass proper frequency to model init"
-            )
-        self.forecast_index = pd.date_range(
-            freq=self.frequency,
-            start=self.train_last_date if last_date is None else last_date,
-            periods=forecast_length + 1,
-        )[
-            1:
-        ]  # note the disposal of the first (already extant) date
-        return self.forecast_index
+
+        return create_forecast_index(
+            self.frequency, forecast_length, self.train_last_date, last_date
+        )
 
     def get_params(self):
         """Return dict of current parameters."""
         return {}
 
     def get_new_params(self, method: str = 'random'):
         """Return dict of new parameters for parameter tuning."""
@@ -354,16 +361,14 @@
         df_wide=None,
         series: str = None,
         remove_zeroes: bool = False,
         interpolate: str = None,
         start_date: str = None,
     ):
         if series is None:
-            import random
-
             series = random.choice(self.forecast.columns)
 
         model_name = self.model_name
         if model_name == "Ensemble":
             if 'series' in self.model_parameters.keys():
                 h_params = self.model_parameters['series'][series]
                 if isinstance(h_params, str):
@@ -405,65 +410,145 @@
 
     def plot(
         self,
         df_wide=None,
         series: str = None,
         remove_zeroes: bool = False,
         interpolate: str = None,
-        start_date: str = None,
+        start_date: str = "auto",
         alpha=0.25,
         facecolor="black",
         loc="upper left",
         title=None,
         vline=None,
+        colors=None,
         **kwargs,
     ):
         """Generate an example plot of one series. Does not handle non-numeric forecasts.
 
         Args:
             df_wide (str): historic data for plotting actuals
             series (str): column name of series to plot. Random if None.
             ax: matplotlib axes to pass through to pd.plot()
             remove_zeroes (bool): if True, don't plot any zeroes
             interpolate (str): if not None, a method to pass to pandas interpolate
             start_date (str): Y-m-d string or Timestamp to remove all data before
             vline (datetime): datetime of dashed vertical line to plot
+            colors (dict): colors mapping dictionary col: color
+            alpha (float): intensity of bound interval shading
             **kwargs passed to pd.DataFrame.plot()
         """
+        if start_date == "auto":
+            if df_wide is not None:
+                slx = -self.forecast_length * 3
+                if slx > df_wide.shape[0]:
+                    slx = 0
+                start_date = df_wide.index[slx]
+            else:
+                start_date = self.forecast.index[0]
         plot_df = self.plot_df(
             df_wide=df_wide,
             series=series,
             remove_zeroes=remove_zeroes,
             interpolate=interpolate,
             start_date=start_date,
         )
+        if colors is None:
+            colors = {
+                'low_forecast': '#A5ADAF',
+                'up_forecast': '#A5ADAF',
+                'forecast': '#003399',  # '#4D4DFF',
+                'actuals': '#AFDBF5',
+            }
         if title is None:
             title_prelim = str(self.model_name)[0:80]
             if title_prelim == "Ensemble":
                 ensemble_type = self.model_parameters.get('model_name', "unknown")
                 if ensemble_type == "Horizontal":
                     title_prelim = self.model_parameters['series'].get(
                         series, "Horizontal"
                     )
+                    title_prelim = (
+                        self.model_parameters.get("models", {})
+                        .get(title_prelim)
+                        .get('Model')
+                    )
                 else:
                     title_prelim = ensemble_type
             title = f"{series} with model {title_prelim}"
-        if vline is None:
-            return plot_df.plot(title=title, **kwargs)
-        else:
-            ax = plot_df.plot(title=title, **kwargs)
+
+        ax = plot_df[['actuals', 'forecast']].plot(title=title, color=colors, **kwargs)
+        ax.fill_between(
+            plot_df.index,
+            plot_df['up_forecast'],
+            plot_df['low_forecast'],
+            alpha=alpha,
+            color="#A5ADAF",
+        )
+        if vline is not None:
             ax.vlines(
                 x=vline,
                 ls='--',
                 lw=1,
                 colors='darkred',
                 ymin=plot_df.min().min(),
                 ymax=plot_df.max().max(),
             )
-            return ax
+        return ax
+
+    def plot_grid(
+        self,
+        df_wide=None,
+        start_date='auto',
+        interpolate=None,
+        remove_zeroes=False,
+        figsize=(24, 18),
+        title="AutoTS Forecasts",
+        cols=None,
+        colors=None,
+    ):
+        """Plots multiple series in a grid, if present."""
+        import matplotlib.pyplot as plt
+
+        if cols is None:
+            cols = self.forecast_columns
+        num_cols = len(cols)
+        if num_cols > 4:
+            nrow = 2
+            ncol = 3
+        elif num_cols > 2:
+            nrow = 2
+            ncol = 2
+        else:
+            nrow = 1
+            ncol = 2
+        fig, axes = plt.subplots(nrow, ncol, figsize=figsize)
+        fig.suptitle(title)
+        count = 0
+        for r in range(nrow):
+            for c in range(ncol):
+                if nrow > 1:
+                    ax = axes[r, c]
+                else:
+                    ax = axes[c]
+                if count + 1 > num_cols:
+                    pass
+                else:
+                    col = cols[count]
+                    self.plot(
+                        df_wide=df_wide,
+                        series=col,
+                        remove_zeroes=remove_zeroes,
+                        interpolate=interpolate,
+                        start_date=start_date,
+                        colors=colors,
+                        ax=ax,
+                    )
+                    count += 1
+        return fig
 
     def evaluate(
         self,
         actual,
         series_weights: dict = None,
         df_train=None,
         per_timestamp_errors: bool = False,
```

### Comparing `autots-0.5.7/autots/models/basics.py` & `autots-0.5.8/autots/models/basics.py`

 * *Files 2% similar despite different names*

```diff
@@ -2127,21 +2127,15 @@
             )[0]
         else:
             em_iter = random.choices([None, 10, 30], [0.3, 0.7, 0.1])[0]
         params = random.choices(
             # the same model can sometimes be defined in various matrix forms
             [
                 # floats are phi
-                {
-                    'model_name': 'local linear trend',
-                    'state_transition': [[1, 1], [0, 1]],
-                    'process_noise': [[0.1, 0.0], [0.0, 0.01]],
-                    'observation_model': [[1, 0]],
-                    'observation_noise': random.choice([0.25, 0.5, 1.0, 0.05]),
-                },
+                'ets_aan',
                 {
                     'model_name': 'local linear stochastic seasonal dummy',
                     'state_transition': [
                         [1, 0, 0, 0],
                         [0, -1, -1, -1],
                         [0, 1, 0, 0],
                         [0, 0, 1, 0],
@@ -2201,14 +2195,15 @@
                         [0.1, 0.0, 0.0],
                         [0.0, 0.01, 0.0],
                         [0.0, 0.0, 0.1],
                     ],
                     'observation_model': [[1, 1, 1]],
                     'observation_noise': 1.0,
                 },
+                # I believe this is a seasonal ETS model but I would like confirmation on that
                 {
                     'model_name': "local linear hidden state with seasonal 7",
                     'state_transition': [
                         [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                         [0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 0.0],
                         [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                         [0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
@@ -2257,36 +2252,104 @@
                 {
                     'model_name': 'spline',
                     'state_transition': [[2, -1], [1, 0]],
                     'process_noise': [[1, 0], [0, 0]],
                     'observation_model': [[1, 0]],
                     'observation_noise': 0.1,
                 },
+                "dynamic_linear",
             ],
-            [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1],
+            [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.1],
         )[0]
         if params in [364] and method not in ['deep']:
             params = 7
         if params == "random":
             st, procnois, obsmod, obsnois = random_state_space()
             params = {
                 'model_name': 'randomly generated',
                 'state_transition': st.tolist(),
                 'process_noise': procnois.tolist(),
                 'observation_model': obsmod.tolist(),
                 'observation_noise': obsnois,
             }
+        elif params == "dynamic_linear":
+            choices = [
+                0.0,
+                0.1,
+                0.2,
+                0.3,
+                0.4,
+                0.5,
+                0.6,
+                0.7,
+                0.8,
+                0.9,
+                1.0,
+                1.1,
+                1.2,
+                1.3,
+                1.4,
+                1.5,
+            ]
+            params = {
+                'model_name': 'dynamic linear',
+                'state_transition': [
+                    [1, 1, 0, 0],
+                    [0, 1, 0, 0],
+                    [0, 0, random.choice(choices), 1],
+                    [0, 0, random.choice(choices), 0],
+                ],
+                'process_noise': [
+                    [random.choice(choices), 0, 0, 0],
+                    [0, random.choice(choices), 0, 0],
+                    [0, 0, random.choice(choices), 0],
+                    [0, 0, 0, 0],
+                ],
+                'observation_model': [[1, 0, 1, 0]],
+                'observation_noise': 0.25,
+                'em_iter': 10,
+            }
+        elif params == "ets_aan":
+            choices = [
+                0.0,
+                0.01,
+                0.1,
+                0.2,
+                0.3,
+                0.4,
+                0.5,
+                0.6,
+                0.7,
+                0.8,
+                0.9,
+                1.0,
+                1.1,
+                1.2,
+                1.3,
+                1.4,
+                1.5,
+            ]
+            params = {
+                'model_name': 'local_linear_trend_ets_aan',
+                'state_transition': [[1, 1], [0, 1]],
+                'process_noise': [
+                    [random.choice(choices), 0.0],
+                    [0.0, random.choice(choices)],
+                ],
+                'observation_model': [[1, 0]],
+                'observation_noise': random.choice([0.25, 0.5, 1.0, 0.05]),
+            }
         elif isinstance(params, int):
             state_transition = np.zeros((params + 1, params + 1))
             state_transition[0, 0] = 1
             state_transition[1, 1:-1] = [-1.0] * (params - 1)
             state_transition[2:, 1:-1] = np.eye(params - 1)
             observation_model = [[1, 1] + [0] * (params - 1)]
-            level_noise = 0.2 / random.choice([1, 5, 10])
-            season_noise = 1e-3
+            level_noise = 0.2 / random.choice([0.2, 0.5, 1, 5, 10, 200])
+            season_noise = random.choice([1e-4, 1e-3, 1e-2, 1e-1])
             process_noise_cov = (
                 np.diag([level_noise, season_noise] + [0] * (params - 1)) ** 2
             )
             params = {
                 'model_name': f'local linear hidden state with seasonal {params}',
                 'state_transition': state_transition.tolist(),
                 'process_noise': process_noise_cov.tolist(),
```

### Comparing `autots-0.5.7/autots/models/cassandra.py` & `autots-0.5.8/autots/models/cassandra.py`

 * *Files 0% similar despite different names*

```diff
@@ -61,7149 +61,7214 @@
 000003c0: 696e 646f 775f 6c69 6e5f 7265 675f 6d65  indow_lin_reg_me
 000003d0: 616e 2020 2320 736c 6964 696e 675f 7769  an  # sliding_wi
 000003e0: 6e64 6f77 5f76 6965 770d 0a66 726f 6d20  ndow_view..from 
 000003f0: 6175 746f 7473 2e65 7661 6c75 6174 6f72  autots.evaluator
 00000400: 2e61 7574 6f5f 6d6f 6465 6c20 696d 706f  .auto_model impo
 00000410: 7274 204d 6f64 656c 4d6f 6e73 7465 722c  rt ModelMonster,
 00000420: 206d 6f64 656c 5f66 6f72 6563 6173 740d   model_forecast.
-00000430: 0a0d 0a23 2073 6369 7079 2069 7320 7465  ...# scipy is te
-00000440: 6368 6e69 6361 6c6c 7920 6f70 7469 6f6e  chnically option
-00000450: 616c 2062 7574 206d 6f73 7420 6c69 6b65  al but most like
-00000460: 6c79 2069 7320 7072 6573 656e 740d 0a74  ly is present..t
-00000470: 7279 3a0d 0a20 2020 2066 726f 6d20 7363  ry:..    from sc
-00000480: 6970 792e 6f70 7469 6d69 7a65 2069 6d70  ipy.optimize imp
-00000490: 6f72 7420 6d69 6e69 6d69 7a65 0d0a 2020  ort minimize..  
-000004a0: 2020 6672 6f6d 2073 6369 7079 2e73 7461    from scipy.sta
-000004b0: 7473 2069 6d70 6f72 7420 6e6f 726d 0d0a  ts import norm..
-000004c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000004d0: 3a0d 0a0d 0a20 2020 2063 6c61 7373 206e  :....    class n
-000004e0: 6f72 6d28 6f62 6a65 6374 293a 0d0a 2020  orm(object):..  
-000004f0: 2020 2020 2020 4073 7461 7469 636d 6574        @staticmet
-00000500: 686f 640d 0a20 2020 2020 2020 2064 6566  hod..        def
-00000510: 2070 7066 2878 293a 0d0a 2020 2020 2020   ppf(x):..      
-00000520: 2020 2020 2020 7265 7475 726e 2031 2e36        return 1.6
-00000530: 3434 3835 3336 3236 3935 3134 3732 320d  448536269514722.
-00000540: 0a0d 0a0d 0a63 6c61 7373 2043 6173 7361  .....class Cassa
-00000550: 6e64 7261 284d 6f64 656c 4f62 6a65 6374  ndra(ModelObject
-00000560: 293a 0d0a 2020 2020 2222 2245 7870 6c61  ):..    """Expla
-00000570: 696e 6162 6c65 2064 6563 6f6d 706f 7369  inable decomposi
-00000580: 7469 6f6e 2d62 6173 6564 2066 6f72 6563  tion-based forec
-00000590: 6173 7469 6e67 2077 6974 6820 6164 7661  asting with adva
-000005a0: 6e63 6564 2074 7265 6e64 206d 6f64 656c  nced trend model
-000005b0: 696e 6720 616e 6420 7072 6570 726f 6365  ing and preproce
-000005c0: 7373 696e 672e 0d0a 0d0a 2020 2020 5475  ssing.....    Tu
-000005d0: 6e63 2065 7469 616d 2066 6174 6973 2061  nc etiam fatis a
-000005e0: 7065 7269 7420 4361 7373 616e 6472 6120  perit Cassandra 
-000005f0: 6675 7475 7269 730d 0a20 2020 206f 7261  futuris..    ora
-00000600: 2c20 6465 6920 6975 7373 7520 6e6f 6e20  , dei iussu non 
-00000610: 756d 7175 616d 2063 7265 6469 7461 2054  umquam credita T
-00000620: 6575 6372 6973 2e0d 0a20 2020 204e 6f73  eucris...    Nos
-00000630: 2064 656c 7562 7261 2064 6575 6d20 6d69   delubra deum mi
-00000640: 7365 7269 2c20 7175 6962 7573 2075 6c74  seri, quibus ult
-00000650: 696d 7573 2065 7373 6574 0d0a 2020 2020  imus esset..    
-00000660: 696c 6c65 2064 6965 732c 2066 6573 7461  ille dies, festa
-00000670: 2076 656c 616d 7573 2066 726f 6e64 6520   velamus fronde 
-00000680: 7065 7220 7572 6265 6d2e 0d0a 2020 2020  per urbem...    
-00000690: 2d41 656e 6569 6420 322e 3234 362d 322e  -Aeneid 2.246-2.
-000006a0: 3234 390d 0a0d 0a20 2020 2049 6e20 6765  249....    In ge
-000006b0: 6e65 7261 6c2c 2061 6c6c 2074 696d 6520  neral, all time 
-000006c0: 7365 7269 6573 2064 6174 6120 696e 7075  series data inpu
-000006d0: 7473 2028 6466 2c20 7265 6772 6573 736f  ts (df, regresso
-000006e0: 7273 2c20 696d 7061 6374 7329 2073 686f  rs, impacts) sho
-000006f0: 756c 6420 6265 2077 6964 6520 7374 796c  uld be wide styl
-00000700: 6520 6461 7461 2069 6e20 6120 7064 2e44  e data in a pd.D
-00000710: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
-00000720: 2020 616e 2069 6e64 6578 2074 6861 7420    an index that 
-00000730: 6973 2061 2070 642e 4461 7465 7469 6d65  is a pd.Datetime
-00000740: 496e 6465 780d 0a20 2020 2020 2020 206f  Index..        o
-00000750: 6e65 2063 6f6c 756d 6e20 7065 7220 7469  ne column per ti
-00000760: 6d65 2073 6572 6965 732c 2077 6974 6820  me series, with 
-00000770: 6120 756e 6971 7565 6c79 2069 6465 6e74  a uniquely ident
-00000780: 6966 6961 626c 6520 636f 6c75 6d6e 206e  ifiable column n
-00000790: 616d 650d 0a0d 0a20 2020 2049 6d70 6163  ame....    Impac
-000007a0: 7473 2067 6574 2063 6f6e 6675 7369 6e67  ts get confusing
-000007b0: 2e0d 0a20 2020 2041 2070 6173 7420 696d  ...    A past im
-000007c0: 7061 6374 206f 6620 302e 3035 2077 6f75  pact of 0.05 wou
-000007d0: 6c64 206d 6561 6e20 616e 206f 7574 7369  ld mean an outsi
-000007e0: 6465 2c20 756e 666f 7265 6361 7374 6162  de, unforecastab
-000007f0: 6c65 2066 6f72 6365 2063 6175 7365 642f  le force caused/
-00000800: 6164 6465 6420 3525 206f 6620 7468 6520  added 5% of the 
-00000810: 7661 6c75 6520 6174 2074 6869 7320 7469  value at this ti
-00000820: 6d65 2e0d 0a20 2020 2041 6363 6f72 6469  me...    Accordi
-00000830: 6e67 6c79 2c20 7468 6174 2035 2520 7769  ngly, that 5% wi
-00000840: 6c6c 2062 6520 7265 6d6f 7665 6420 6265  ll be removed be
-00000850: 666f 7265 2066 6f72 6563 6173 7469 6e67  fore forecasting
-00000860: 2c20 7468 656e 2061 6464 6564 2062 6163  , then added bac
-00000870: 6b20 6f6e 2061 6674 6572 2e0d 0a20 2020  k on after...   
-00000880: 2049 6d70 6163 7473 2063 616e 2061 6c73   Impacts can als
-00000890: 6f20 6265 206e 6567 6174 6976 6520 7661  o be negative va
-000008a0: 6c75 6573 2e0d 0a20 2020 2041 2066 7574  lues...    A fut
-000008b0: 7572 6520 696d 7061 6374 206f 6620 3525  ure impact of 5%
-000008c0: 2077 6f75 6c64 206d 6561 6e20 616e 206f   would mean an o
-000008d0: 7574 7369 6465 2066 6f72 6365 2061 6464  utside force add
-000008e0: 7320 3525 2061 626f 7665 2074 6865 206f  s 5% above the o
-000008f0: 7269 6769 6e61 6c20 666f 7265 6361 7374  riginal forecast
-00000900: 2e0d 0a20 2020 2046 7574 7572 6520 696d  ...    Future im
-00000910: 7061 6374 7320 6361 6e20 6265 2075 7365  pacts can be use
-00000920: 6420 746f 206d 6f64 656c 2070 726f 6475  d to model produ
-00000930: 6374 2067 6f61 6c73 206f 7220 7465 6d70  ct goals or temp
-00000940: 6f72 6172 7920 616e 6f6d 616c 6965 7320  orary anomalies 
-00000950: 7768 6963 6820 6361 6e27 7420 6f72 2073  which can't or s
-00000960: 686f 756c 6427 7420 6265 206d 6f64 656c  hould't be model
-00000970: 6564 2062 7920 666f 7265 6361 7374 696e  ed by forecastin
-00000980: 6720 616e 6420 7768 6f73 6520 7265 6c61  g and whose rela
-00000990: 7469 7665 2065 6666 6563 7420 6973 206b  tive effect is k
-000009a0: 6e6f 776e 0d0a 2020 2020 436f 6d70 6172  nown..    Compar
-000009b0: 6520 7468 6973 2077 6974 6820 7265 6772  e this with regr
-000009c0: 6573 736f 7273 2c20 7768 6963 6820 6172  essors, which ar
-000009d0: 6520 6573 7365 6e74 6961 6c6c 7920 7468  e essentially th
-000009e0: 6520 6d6f 6465 6c20 6573 7469 6d61 7469  e model estimati
-000009f0: 6e67 2074 6865 2072 656c 6174 6976 6520  ng the relative 
-00000a00: 696d 7061 6374 2067 6976 656e 2074 6865  impact given the
-00000a10: 2072 6177 2073 697a 6520 6f72 2070 7265   raw size or pre
-00000a20: 7365 6e63 6520 6f66 2061 6e20 6f75 7473  sence of an outs
-00000a30: 6964 6520 6566 6665 6374 0d0a 0d0a 2020  ide effect....  
-00000a40: 2020 5761 726e 2061 626f 7574 2072 656d    Warn about rem
-00000a50: 6f76 655f 6578 6365 7373 5f61 6e6f 6d61  ove_excess_anoma
-00000a60: 6c69 6573 2066 726f 6d20 686f 6c69 6461  lies from holida
-00000a70: 7920 6465 7465 6374 6f72 2069 6620 7265  y detector if re
-00000a80: 6c79 696e 6720 6f6e 2061 6e6f 6d61 6c79  lying on anomaly
-00000a90: 2070 7265 6469 6374 696f 6e0d 0a20 2020   prediction..   
-00000aa0: 204c 696e 6561 7220 636f 6d70 6f6e 656e   Linear componen
-00000ab0: 7473 2061 7265 2061 6c77 6179 7320 6d6f  ts are always mo
-00000ac0: 6465 6c20 656c 656d 656e 7473 2c20 6275  del elements, bu
-00000ad0: 7420 7472 656e 6420 6973 2061 6374 7561  t trend is actua
-00000ae0: 6c73 2028 6869 7374 6f72 7929 2061 6e64  ls (history) and
-00000af0: 206d 6f64 656c 2028 6675 7475 7265 290d   model (future).
-00000b00: 0a20 2020 2052 756e 6e69 6e67 2070 7265  .    Running pre
-00000b10: 6469 6374 2075 7064 6174 6573 2073 6f6d  dict updates som
-00000b20: 6520 696e 7465 726e 616c 2061 7474 7269  e internal attri
-00000b30: 6275 7465 7320 7573 6564 2069 6e20 706c  butes used in pl
-00000b40: 6f74 7469 6e67 2061 6e64 206f 7468 6572  otting and other
-00000b50: 2066 6967 7572 6573 2c20 6765 6e65 7261   figures, genera
-00000b60: 6c6c 7920 6578 7065 6374 2074 6f20 7573  lly expect to us
-00000b70: 6520 6675 6e63 7469 6f6e 7320 746f 206c  e functions to l
-00000b80: 6174 6573 7420 7072 6564 6963 740d 0a20  atest predict.. 
-00000b90: 2020 2053 6561 736f 6e61 6c69 7469 6573     Seasonalities
-00000ba0: 2061 7265 2068 6172 642d 636f 6465 6420   are hard-coded 
-00000bb0: 746f 2062 6520 6173 2064 6179 7320 736f  to be as days so
-00000bc0: 2037 2077 696c 6c20 616c 7761 7973 203d   7 will always =
-00000bd0: 2077 6565 6b6c 7920 6576 656e 2069 6620   weekly even if 
-00000be0: 6461 7461 2069 736e 2774 2064 6169 6c79  data isn't daily
-00000bf0: 0d0a 2020 2020 466f 7220 736c 6f70 6520  ..    For slope 
-00000c00: 616e 616c 7973 6973 2061 6e64 207a 6572  analysis and zer
-00000c10: 6f20 6372 6f73 7369 6e67 732c 2061 2073  o crossings, a s
-00000c20: 6c6f 7065 206f 6620 3020 6576 616c 7561  lope of 0 evalua
-00000c30: 7465 7320 6173 2061 2070 6f73 6974 6976  tes as a positiv
-00000c40: 6520 7369 676e 2028 3d3e 3029 2e20 4578  e sign (=>0). Ex
-00000c50: 6163 746c 7920 3020 736c 6f70 6520 6973  actly 0 slope is
-00000c60: 2072 6172 6520 7265 616c 2077 6f72 6c64   rare real world
-00000c70: 2064 6174 610d 0a20 2020 2044 6f65 7320   data..    Does 
-00000c80: 6e6f 7420 6375 7272 656e 746c 7920 666f  not currently fo
-00000c90: 6c6c 6f77 2074 6865 2072 6567 7265 7373  llow the regress
-00000ca0: 696f 6e5f 7479 7065 3d27 5573 6572 2720  ion_type='User' 
-00000cb0: 616e 6420 6661 696c 7320 6966 206e 6f20  and fails if no 
-00000cc0: 7265 6772 6573 736f 7220 7061 7474 6572  regressor patter
-00000cd0: 6e20 6f66 206f 7468 6572 206d 6f64 656c  n of other model
-00000ce0: 730d 0a20 2020 2046 6f72 2063 6f6d 706f  s..    For compo
-00000cf0: 6e65 6e74 2064 6563 6f6d 706f 7369 7469  nent decompositi
-00000d00: 6f6e 2c20 7363 616c 6520 7769 6c6c 2062  on, scale will b
-00000d10: 6520 696e 6163 6375 7261 7465 2075 6e6c  e inaccurate unl
-00000d20: 6573 7320 2742 6173 6553 6361 6c65 7227  ess 'BaseScaler'
-00000d30: 2069 7320 7573 6564 2c20 6275 7420 7265   is used, but re
-00000d40: 6761 7264 6c65 7373 2074 6869 7320 776f  gardless this wo
-00000d50: 6e27 7420 6166 6665 6374 2066 696e 616c  n't affect final
-00000d60: 2066 6f72 6563 6173 740d 0a0d 0a20 2020   forecast....   
-00000d70: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
-00000d80: 7061 7373 0d0a 0d0a 2020 2020 4d65 7468  pass....    Meth
-00000d90: 6f64 733a 0d0a 2020 2020 2020 2020 2066  ods:..         f
-00000da0: 6974 0d0a 2020 2020 2020 2020 2070 7265  it..         pre
-00000db0: 6469 6374 0d0a 2020 2020 2020 2020 2068  dict..         h
-00000dc0: 6f6c 6964 6179 5f64 6574 6563 746f 722e  oliday_detector.
-00000dd0: 6461 7465 735f 746f 5f68 6f6c 6964 6179  dates_to_holiday
-00000de0: 730d 0a20 2020 2020 2020 2020 6372 6561  s..         crea
-00000df0: 7465 5f66 6f72 6563 6173 745f 696e 6465  te_forecast_inde
-00000e00: 783a 2061 6674 6572 202e 6669 742c 2063  x: after .fit, c
-00000e10: 616e 2062 6520 7573 6564 2074 6f20 6372  an be used to cr
-00000e20: 6561 7465 2069 6e64 6578 206f 6620 7072  eate index of pr
-00000e30: 6564 6963 7469 6f6e 0d0a 2020 2020 2020  ediction..      
-00000e40: 2020 2070 6c6f 745f 666f 7265 6361 7374     plot_forecast
-00000e50: 0d0a 2020 2020 2020 2020 2070 6c6f 745f  ..         plot_
-00000e60: 636f 6d70 6f6e 656e 7473 0d0a 2020 2020  components..    
-00000e70: 2020 2020 2070 6c6f 745f 7472 656e 640d       plot_trend.
-00000e80: 0a20 2020 2020 2020 2020 6765 745f 6e65  .         get_ne
-00000e90: 775f 7061 7261 6d73 0d0a 2020 2020 2020  w_params..      
-00000ea0: 2020 2072 6574 7572 6e5f 636f 6d70 6f6e     return_compon
-00000eb0: 656e 7473 0d0a 0d0a 2020 2020 4174 7472  ents....    Attr
-00000ec0: 6962 7574 6573 3a0d 0a20 2020 2020 2020  ibutes:..       
-00000ed0: 202e 616e 6f6d 616c 795f 6465 7465 6374   .anomaly_detect
-00000ee0: 6f72 2e61 6e6f 6d61 6c69 6573 0d0a 2020  or.anomalies..  
-00000ef0: 2020 2020 2020 2e61 6e6f 6d61 6c79 5f64        .anomaly_d
-00000f00: 6574 6563 746f 722e 7363 6f72 6573 0d0a  etector.scores..
-00000f10: 2020 2020 2020 2020 2e68 6f6c 6964 6179          .holiday
-00000f20: 5f63 6f75 6e74 0d0a 2020 2020 2020 2020  _count..        
-00000f30: 2e68 6f6c 6964 6179 7320 2873 6572 6965  .holidays (serie
-00000f40: 7320 666c 6167 732c 2068 6f6c 6964 6179  s flags, holiday
-00000f50: 2064 6574 6563 746f 7220 6f6e 6c79 290d   detector only).
-00000f60: 0a20 2020 2020 2020 202e 7061 7261 6d73  .        .params
-00000f70: 0d0a 2020 2020 2020 2020 2e6b 6565 705f  ..        .keep_
-00000f80: 636f 6c73 2c20 2e6b 6565 705f 636f 6c73  cols, .keep_cols
-00000f90: 5f69 6478 0d0a 2020 2020 2020 2020 2e78  _idx..        .x
-00000fa0: 5f61 7272 6179 0d0a 2020 2020 2020 2020  _array..        
-00000fb0: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
-00000fc0: 0d0a 2020 2020 2020 2020 2e74 7265 6e64  ..        .trend
-00000fd0: 5f74 7261 696e 0d0a 2020 2020 2020 2020  _train..        
-00000fe0: 2e70 7265 6469 6374 6564 5f74 7265 6e64  .predicted_trend
-00000ff0: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
-00001000: 2064 6566 205f 5f69 6e69 745f 5f28 0d0a   def __init__(..
-00001010: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-00001020: 2020 2020 2020 2070 7265 7072 6f63 6573         preproces
-00001030: 7369 6e67 5f74 7261 6e73 666f 726d 6174  sing_transformat
-00001040: 696f 6e3a 2064 6963 7420 3d20 4e6f 6e65  ion: dict = None
-00001050: 2c20 2023 2066 696c 7465 7273 2062 7920  ,  # filters by 
-00001060: 6465 6661 756c 7420 6f6e 6c79 0d0a 2020  default only..  
-00001070: 2020 2020 2020 7363 616c 696e 673a 2073        scaling: s
-00001080: 7472 203d 2022 4261 7365 5363 616c 6572  tr = "BaseScaler
-00001090: 222c 2020 2320 7075 6c6c 6564 206f 7574  ",  # pulled out
-000010a0: 2066 726f 6d20 7472 616e 7366 6f72 6d61   from transforma
-000010b0: 7469 6f6e 2061 7320 6120 7363 616c 6572  tion as a scaler
-000010c0: 2069 7320 6e6f 7420 6f70 7469 6f6e 616c   is not optional
-000010d0: 2c20 6d61 7962 6520 616c 6c6f 7720 6120  , maybe allow a 
-000010e0: 6c69 7374 0d0a 2020 2020 2020 2020 7061  list..        pa
-000010f0: 7374 5f69 6d70 6163 7473 5f69 6e74 6572  st_impacts_inter
-00001100: 7665 6e74 696f 6e3a 2073 7472 203d 204e  vention: str = N
-00001110: 6f6e 652c 2020 2320 2772 656d 6f76 6527  one,  # 'remove'
-00001120: 2c20 2770 6c6f 745f 6f6e 6c79 272c 2027  , 'plot_only', '
-00001130: 7265 6772 6573 736f 7227 0d0a 2020 2020  regressor'..    
-00001140: 2020 2020 7365 6173 6f6e 616c 6974 6965      seasonalitie
-00001150: 733a 2064 6963 7420 3d20 5b0d 0a20 2020  s: dict = [..   
-00001160: 2020 2020 2020 2020 2027 636f 6d6d 6f6e           'common
-00001170: 5f66 6f75 7269 6572 270d 0a20 2020 2020  _fourier'..     
-00001180: 2020 205d 2c20 2023 2069 6e74 6572 6163     ],  # interac
-00001190: 7469 6f6e 7320 6164 6465 6420 6966 2066  tions added if f
-000011a0: 6f75 7269 6572 2061 6e64 206f 7264 6572  ourier and order
-000011b0: 206d 6174 6368 6573 0d0a 2020 2020 2020   matches..      
-000011c0: 2020 6172 5f6c 6167 733a 206c 6973 7420    ar_lags: list 
-000011d0: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
-000011e0: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
-000011f0: 7365 6173 6f6e 616c 6974 793a 2064 6963  seasonality: dic
-00001200: 7420 3d20 4e6f 6e65 2c20 2023 2065 7175  t = None,  # equ
-00001210: 616c 206f 7220 6c65 7373 2074 6861 6e20  al or less than 
-00001220: 6e75 6d62 6572 206f 6620 6172 206c 6167  number of ar lag
-00001230: 730d 0a20 2020 2020 2020 2061 6e6f 6d61  s..        anoma
-00001240: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00001250: 6d73 3a20 6469 6374 203d 204e 6f6e 652c  ms: dict = None,
-00001260: 2020 2320 6170 706c 7920 6265 666f 7265    # apply before
-00001270: 2061 6e79 2070 7265 7072 6f63 6573 7369   any preprocessi
-00001280: 6e67 2028 6173 2068 6173 206f 776e 290d  ng (as has own).
-00001290: 0a20 2020 2020 2020 2061 6e6f 6d61 6c79  .        anomaly
-000012a0: 5f69 6e74 6572 7665 6e74 696f 6e3a 2073  _intervention: s
-000012b0: 7472 203d 204e 6f6e 652c 2020 2320 7265  tr = None,  # re
-000012c0: 6d6f 7665 2c20 6372 6561 7465 2066 6561  move, create fea
-000012d0: 7475 7265 2c20 6d6f 6465 6c0d 0a20 2020  ture, model..   
-000012e0: 2020 2020 2068 6f6c 6964 6179 5f64 6574       holiday_det
-000012f0: 6563 746f 725f 7061 7261 6d73 3a20 6469  ector_params: di
-00001300: 6374 203d 204e 6f6e 652c 0d0a 2020 2020  ct = None,..    
-00001310: 2020 2020 686f 6c69 6461 795f 636f 756e      holiday_coun
-00001320: 7472 6965 733a 2064 6963 7420 3d20 4e6f  tries: dict = No
-00001330: 6e65 2c20 2023 206c 6973 7420 6f72 2064  ne,  # list or d
-00001340: 6963 740d 0a20 2020 2020 2020 2068 6f6c  ict..        hol
-00001350: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
-00001360: 7365 643a 2062 6f6f 6c20 3d20 5472 7565  sed: bool = True
-00001370: 2c0d 0a20 2020 2020 2020 206d 756c 7469  ,..        multi
-00001380: 7661 7269 6174 655f 6665 6174 7572 653a  variate_feature:
-00001390: 2073 7472 203d 204e 6f6e 652c 2020 2320   str = None,  # 
-000013a0: 6279 2067 726f 7570 2c20 6966 2067 6976  by group, if giv
-000013b0: 656e 0d0a 2020 2020 2020 2020 6d75 6c74  en..        mult
-000013c0: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
-000013d0: 726d 6174 696f 6e3a 2073 7472 203d 204e  rmation: str = N
-000013e0: 6f6e 652c 2020 2320 6170 706c 6965 6420  one,  # applied 
-000013f0: 6265 666f 7265 2063 7265 6174 696e 6720  before creating 
-00001400: 6665 6174 7572 650d 0a20 2020 2020 2020  feature..       
-00001410: 2072 6567 7265 7373 6f72 5f74 7261 6e73   regressor_trans
-00001420: 666f 726d 6174 696f 6e3a 2064 6963 7420  formation: dict 
-00001430: 3d20 4e6f 6e65 2c20 2023 2061 7070 6c69  = None,  # appli
-00001440: 6564 2074 6f20 6675 7475 7265 5f72 6567  ed to future_reg
-00001450: 7265 7373 6f72 2061 6e64 2072 6567 7265  ressor and regre
-00001460: 7373 6f72 5f70 6572 5f73 6572 6965 730d  ssor_per_series.
-00001470: 0a20 2020 2020 2020 2072 6567 7265 7373  .        regress
-00001480: 6f72 735f 7573 6564 3a20 626f 6f6c 203d  ors_used: bool =
-00001490: 2054 7275 652c 2020 2320 6f6e 2f6f 6666   True,  # on/off
-000014a0: 206f 6620 6164 6469 7469 6f6e 616c 2075   of additional u
-000014b0: 7365 7220 696e 7075 7473 0d0a 2020 2020  ser inputs..    
-000014c0: 2020 2020 6c69 6e65 6172 5f6d 6f64 656c      linear_model
-000014d0: 3a20 6469 6374 203d 204e 6f6e 652c 2020  : dict = None,  
-000014e0: 2320 6c73 7473 7120 5745 4947 4854 4544  # lstsq WEIGHTED
-000014f0: 2052 6964 6765 2c20 6261 7965 7369 616e   Ridge, bayesian
-00001500: 2c20 6261 7965 7369 616e 2068 6965 7261  , bayesian hiera
-00001510: 7263 6869 616c 2c20 6c31 206e 6f72 6d65  rchial, l1 norme
-00001520: 6420 6f72 206f 7468 6572 206c 6f73 7320  d or other loss 
-00001530: 286e 756d 6261 292c 0d0a 2020 2020 2020  (numba),..      
-00001540: 2020 7261 6e64 6f6d 7761 6c6b 5f6e 3a20    randomwalk_n: 
-00001550: 696e 7420 3d20 4e6f 6e65 2c20 2023 2075  int = None,  # u
-00001560: 7365 2073 7461 7473 206f 6620 736f 7572  se stats of sour
-00001570: 6365 2064 660d 0a20 2020 2020 2020 2074  ce df..        t
-00001580: 7265 6e64 5f77 696e 646f 773a 2069 6e74  rend_window: int
-00001590: 203d 2033 302c 2020 2320 7365 7420 746f   = 30,  # set to
-000015a0: 204e 6f6e 6520 746f 2075 7365 2072 6177   None to use raw
-000015b0: 2072 6573 6964 7561 6c73 0d0a 2020 2020   residuals..    
-000015c0: 2020 2020 7472 656e 645f 7374 616e 6469      trend_standi
-000015d0: 6e3a 2073 7472 203d 204e 6f6e 652c 2020  n: str = None,  
-000015e0: 2320 726f 6c6c 696e 6720 6669 742c 2069  # rolling fit, i
-000015f0: 6e74 6572 6365 7074 2d6f 6e6c 792c 2072  ntercept-only, r
-00001600: 616e 646f 6d2e 6e6f 726d 616c 2066 6561  andom.normal fea
-00001610: 7475 7265 730d 0a20 2020 2020 2020 2074  tures..        t
-00001620: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
-00001630: 6563 746f 725f 7061 7261 6d73 3a20 6469  ector_params: di
-00001640: 6374 203d 204e 6f6e 652c 2020 2320 6469  ct = None,  # di
-00001650: 6666 6572 656e 6365 2066 6972 7374 2c20  fference first, 
-00001660: 7275 6e20 6f6e 2073 6c6f 7065 206f 6e6c  run on slope onl
-00001670: 792c 2075 7365 2057 696e 646f 7720 6e2f  y, use Window n/
-00001680: 3220 6469 6666 2074 6f20 7275 6c65 206f  2 diff to rule o
-00001690: 7574 2072 6574 7572 6e20 746f 0d0a 2020  ut return to..  
-000016a0: 2020 2020 2020 2320 7472 656e 645f 616e        # trend_an
-000016b0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-000016c0: 6f6e 3a20 7374 7220 3d20 4e6f 6e65 2c0d  on: str = None,.
-000016d0: 0a20 2020 2020 2020 2074 7265 6e64 5f74  .        trend_t
-000016e0: 7261 6e73 666f 726d 6174 696f 6e3a 2064  ransformation: d
-000016f0: 6963 7420 3d20 7b7d 2c0d 0a20 2020 2020  ict = {},..     
-00001700: 2020 2074 7265 6e64 5f6d 6f64 656c 3a20     trend_model: 
-00001710: 6469 6374 203d 207b 0d0a 2020 2020 2020  dict = {..      
-00001720: 2020 2020 2020 274d 6f64 656c 273a 2027        'Model': '
-00001730: 4c61 7374 5661 6c75 654e 6169 7665 272c  LastValueNaive',
-00001740: 0d0a 2020 2020 2020 2020 2020 2020 274d  ..            'M
-00001750: 6f64 656c 5061 7261 6d65 7465 7273 273a  odelParameters':
-00001760: 207b 7d2c 0d0a 2020 2020 2020 2020 7d2c   {},..        },
-00001770: 2020 2320 6861 7665 206f 6e65 206f 7220    # have one or 
-00001780: 7477 6f20 696e 2062 7569 6c74 2c20 7468  two in built, th
-00001790: 656e 2072 6564 6972 6563 7420 746f 2061  en redirect to a
-000017a0: 6e79 2041 7574 6f54 5320 6d6f 6465 6c20  ny AutoTS model 
-000017b0: 666f 7220 6f74 6865 7220 6368 6f69 6365  for other choice
-000017c0: 730d 0a20 2020 2020 2020 2074 7265 6e64  s..        trend
-000017d0: 5f70 6869 3a20 666c 6f61 7420 3d20 4e6f  _phi: float = No
-000017e0: 6e65 2c0d 0a20 2020 2020 2020 2063 6f6e  ne,..        con
-000017f0: 7374 7261 696e 743a 2064 6963 7420 3d20  straint: dict = 
-00001800: 4e6f 6e65 2c0d 0a20 2020 2020 2020 206d  None,..        m
-00001810: 6178 5f63 6f6c 696e 6561 7269 7479 3a20  ax_colinearity: 
-00001820: 666c 6f61 7420 3d20 302e 3939 382c 0d0a  float = 0.998,..
-00001830: 2020 2020 2020 2020 6d61 785f 6d75 6c74          max_mult
-00001840: 6963 6f6c 696e 6561 7269 7479 3a20 666c  icolinearity: fl
-00001850: 6f61 7420 3d20 302e 3030 312c 0d0a 2020  oat = 0.001,..  
-00001860: 2020 2020 2020 2320 6e6f 7420 6d6f 6465        # not mode
-00001870: 6c69 6e67 2072 656c 6174 6564 3a0d 0a20  ling related:.. 
-00001880: 2020 2020 2020 2066 7265 7175 656e 6379         frequency
-00001890: 3a20 7374 7220 3d20 2769 6e66 6572 272c  : str = 'infer',
-000018a0: 0d0a 2020 2020 2020 2020 7072 6564 6963  ..        predic
-000018b0: 7469 6f6e 5f69 6e74 6572 7661 6c3a 2066  tion_interval: f
-000018c0: 6c6f 6174 203d 2030 2e39 2c0d 0a20 2020  loat = 0.9,..   
-000018d0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
-000018e0: 3a20 696e 7420 3d20 3230 3232 2c0d 0a20  : int = 2022,.. 
-000018f0: 2020 2020 2020 2076 6572 626f 7365 3a20         verbose: 
-00001900: 696e 7420 3d20 302c 0d0a 2020 2020 2020  int = 0,..      
-00001910: 2020 6e5f 6a6f 6273 3a20 696e 7420 3d20    n_jobs: int = 
-00001920: 2261 7574 6f22 2c0d 0a20 2020 2020 2020  "auto",..       
-00001930: 202a 2a6b 7761 7267 732c 0d0a 2020 2020   **kwargs,..    
-00001940: 293a 0d0a 2020 2020 2020 2020 6966 2070  ):..        if p
-00001950: 7265 7072 6f63 6573 7369 6e67 5f74 7261  reprocessing_tra
-00001960: 6e73 666f 726d 6174 696f 6e20 6973 204e  nsformation is N
-00001970: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00001980: 2020 7072 6570 726f 6365 7373 696e 675f    preprocessing_
-00001990: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
-000019a0: 207b 7d0d 0a20 2020 2020 2020 2073 656c   {}..        sel
-000019b0: 662e 7072 6570 726f 6365 7373 696e 675f  f.preprocessing_
-000019c0: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
-000019d0: 2070 7265 7072 6f63 6573 7369 6e67 5f74   preprocessing_t
-000019e0: 7261 6e73 666f 726d 6174 696f 6e0d 0a20  ransformation.. 
-000019f0: 2020 2020 2020 2073 656c 662e 7363 616c         self.scal
-00001a00: 696e 6720 3d20 7363 616c 696e 670d 0a20  ing = scaling.. 
-00001a10: 2020 2020 2020 2073 656c 662e 7061 7374         self.past
-00001a20: 5f69 6d70 6163 7473 5f69 6e74 6572 7665  _impacts_interve
-00001a30: 6e74 696f 6e20 3d20 7061 7374 5f69 6d70  ntion = past_imp
-00001a40: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
-00001a50: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
-00001a60: 7365 6173 6f6e 616c 6974 6965 7320 3d20  seasonalities = 
-00001a70: 7365 6173 6f6e 616c 6974 6965 730d 0a20  seasonalities.. 
-00001a80: 2020 2020 2020 2073 656c 662e 6172 5f6c         self.ar_l
-00001a90: 6167 7320 3d20 6172 5f6c 6167 730d 0a20  ags = ar_lags.. 
-00001aa0: 2020 2020 2020 2073 656c 662e 6172 5f69         self.ar_i
-00001ab0: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
-00001ac0: 6e61 6c69 7479 203d 2061 725f 696e 7465  nality = ar_inte
-00001ad0: 7261 6374 696f 6e5f 7365 6173 6f6e 616c  raction_seasonal
-00001ae0: 6974 790d 0a20 2020 2020 2020 2073 656c  ity..        sel
-00001af0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
-00001b00: 6f72 5f70 6172 616d 7320 3d20 616e 6f6d  or_params = anom
-00001b10: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
-00001b20: 616d 730d 0a20 2020 2020 2020 2073 656c  ams..        sel
-00001b30: 662e 616e 6f6d 616c 795f 696e 7465 7276  f.anomaly_interv
-00001b40: 656e 7469 6f6e 203d 2061 6e6f 6d61 6c79  ention = anomaly
-00001b50: 5f69 6e74 6572 7665 6e74 696f 6e0d 0a20  _intervention.. 
-00001b60: 2020 2020 2020 2073 656c 662e 686f 6c69         self.holi
-00001b70: 6461 795f 6465 7465 6374 6f72 5f70 6172  day_detector_par
-00001b80: 616d 7320 3d20 686f 6c69 6461 795f 6465  ams = holiday_de
-00001b90: 7465 6374 6f72 5f70 6172 616d 730d 0a20  tector_params.. 
-00001ba0: 2020 2020 2020 2073 656c 662e 686f 6c69         self.holi
-00001bb0: 6461 795f 636f 756e 7472 6965 7320 3d20  day_countries = 
-00001bc0: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
-00001bd0: 730d 0a20 2020 2020 2020 2069 6620 6973  s..        if is
-00001be0: 696e 7374 616e 6365 2873 656c 662e 686f  instance(self.ho
-00001bf0: 6c69 6461 795f 636f 756e 7472 6965 732c  liday_countries,
-00001c00: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
-00001c10: 2020 2020 7365 6c66 2e68 6f6c 6964 6179      self.holiday
-00001c20: 5f63 6f75 6e74 7269 6573 203d 2073 656c  _countries = sel
-00001c30: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
-00001c40: 6965 732e 7370 6c69 7428 222c 2229 0d0a  ies.split(",")..
-00001c50: 2020 2020 2020 2020 7365 6c66 2e68 6f6c          self.hol
-00001c60: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
-00001c70: 7365 6420 3d20 686f 6c69 6461 795f 636f  sed = holiday_co
-00001c80: 756e 7472 6965 735f 7573 6564 0d0a 2020  untries_used..  
-00001c90: 2020 2020 2020 7365 6c66 2e6d 756c 7469        self.multi
-00001ca0: 7661 7269 6174 655f 6665 6174 7572 6520  variate_feature 
-00001cb0: 3d20 6d75 6c74 6976 6172 6961 7465 5f66  = multivariate_f
-00001cc0: 6561 7475 7265 0d0a 2020 2020 2020 2020  eature..        
-00001cd0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
-00001ce0: 655f 7472 616e 7366 6f72 6d61 7469 6f6e  e_transformation
-00001cf0: 203d 206d 756c 7469 7661 7269 6174 655f   = multivariate_
-00001d00: 7472 616e 7366 6f72 6d61 7469 6f6e 0d0a  transformation..
-00001d10: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
-00001d20: 7265 7373 6f72 5f74 7261 6e73 666f 726d  ressor_transform
-00001d30: 6174 696f 6e20 3d20 7265 6772 6573 736f  ation = regresso
-00001d40: 725f 7472 616e 7366 6f72 6d61 7469 6f6e  r_transformation
-00001d50: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
-00001d60: 6567 7265 7373 6f72 735f 7573 6564 203d  egressors_used =
-00001d70: 2072 6567 7265 7373 6f72 735f 7573 6564   regressors_used
-00001d80: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00001d90: 696e 6561 725f 6d6f 6465 6c20 3d20 6c69  inear_model = li
-00001da0: 6e65 6172 5f6d 6f64 656c 2069 6620 6c69  near_model if li
-00001db0: 6e65 6172 5f6d 6f64 656c 2069 7320 6e6f  near_model is no
-00001dc0: 7420 4e6f 6e65 2065 6c73 6520 7b7d 0d0a  t None else {}..
-00001dd0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
-00001de0: 646f 6d77 616c 6b5f 6e20 3d20 7261 6e64  domwalk_n = rand
-00001df0: 6f6d 7761 6c6b 5f6e 0d0a 2020 2020 2020  omwalk_n..      
-00001e00: 2020 7365 6c66 2e74 7265 6e64 5f77 696e    self.trend_win
-00001e10: 646f 7720 3d20 7472 656e 645f 7769 6e64  dow = trend_wind
-00001e20: 6f77 0d0a 2020 2020 2020 2020 7365 6c66  ow..        self
-00001e30: 2e74 7265 6e64 5f73 7461 6e64 696e 203d  .trend_standin =
-00001e40: 2074 7265 6e64 5f73 7461 6e64 696e 0d0a   trend_standin..
-00001e50: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
-00001e60: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-00001e70: 746f 725f 7061 7261 6d73 203d 2074 7265  tor_params = tre
-00001e80: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-00001e90: 746f 725f 7061 7261 6d73 0d0a 2020 2020  tor_params..    
-00001ea0: 2020 2020 2320 7365 6c66 2e74 7265 6e64      # self.trend
-00001eb0: 5f61 6e6f 6d61 6c79 5f69 6e74 6572 7665  _anomaly_interve
-00001ec0: 6e74 696f 6e20 3d20 7472 656e 645f 616e  ntion = trend_an
-00001ed0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-00001ee0: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
-00001ef0: 2e74 7265 6e64 5f74 7261 6e73 666f 726d  .trend_transform
-00001f00: 6174 696f 6e20 3d20 7472 656e 645f 7472  ation = trend_tr
-00001f10: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
-00001f20: 2020 2020 2020 7365 6c66 2e74 7265 6e64        self.trend
-00001f30: 5f6d 6f64 656c 203d 2074 7265 6e64 5f6d  _model = trend_m
-00001f40: 6f64 656c 0d0a 2020 2020 2020 2020 7365  odel..        se
-00001f50: 6c66 2e74 7265 6e64 5f70 6869 203d 2074  lf.trend_phi = t
-00001f60: 7265 6e64 5f70 6869 0d0a 2020 2020 2020  rend_phi..      
-00001f70: 2020 7365 6c66 2e63 6f6e 7374 7261 696e    self.constrain
-00001f80: 7420 3d20 636f 6e73 7472 6169 6e74 0d0a  t = constraint..
-00001f90: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
-00001fa0: 5f63 6f6c 696e 6561 7269 7479 203d 206d  _colinearity = m
-00001fb0: 6178 5f63 6f6c 696e 6561 7269 7479 0d0a  ax_colinearity..
-00001fc0: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
-00001fd0: 5f6d 756c 7469 636f 6c69 6e65 6172 6974  _multicolinearit
-00001fe0: 7920 3d20 6d61 785f 6d75 6c74 6963 6f6c  y = max_multicol
-00001ff0: 696e 6561 7269 7479 0d0a 2020 2020 2020  inearity..      
-00002000: 2020 2320 6f74 6865 7220 7061 7261 6d65    # other parame
-00002010: 7465 7273 0d0a 2020 2020 2020 2020 7365  ters..        se
-00002020: 6c66 2e66 7265 7175 656e 6379 203d 2066  lf.frequency = f
-00002030: 7265 7175 656e 6379 0d0a 2020 2020 2020  requency..      
-00002040: 2020 7365 6c66 2e70 7265 6469 6374 696f    self.predictio
-00002050: 6e5f 696e 7465 7276 616c 203d 2070 7265  n_interval = pre
-00002060: 6469 6374 696f 6e5f 696e 7465 7276 616c  diction_interval
-00002070: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-00002080: 6e74 5f73 7464 5f64 6576 203d 206e 6f72  nt_std_dev = nor
-00002090: 6d2e 7070 6628 0d0a 2020 2020 2020 2020  m.ppf(..        
-000020a0: 2020 2020 302e 3520 2b20 302e 3520 2a20      0.5 + 0.5 * 
-000020b0: 7365 6c66 2e70 7265 6469 6374 696f 6e5f  self.prediction_
-000020c0: 696e 7465 7276 616c 0d0a 2020 2020 2020  interval..      
-000020d0: 2020 2920 2023 2032 2074 6f20 3120 7369    )  # 2 to 1 si
-000020e0: 6465 6420 696e 7465 7276 616c 0d0a 2020  ded interval..  
-000020f0: 2020 2020 2020 7365 6c66 2e72 616e 646f        self.rando
-00002100: 6d5f 7365 6564 203d 2072 616e 646f 6d5f  m_seed = random_
-00002110: 7365 6564 0d0a 2020 2020 2020 2020 7365  seed..        se
-00002120: 6c66 2e76 6572 626f 7365 203d 2076 6572  lf.verbose = ver
-00002130: 626f 7365 0d0a 2020 2020 2020 2020 7365  bose..        se
-00002140: 6c66 2e6e 5f6a 6f62 7320 3d20 6e5f 6a6f  lf.n_jobs = n_jo
-00002150: 6273 0d0a 2020 2020 2020 2020 6966 2073  bs..        if s
-00002160: 656c 662e 6e5f 6a6f 6273 203d 3d20 2761  elf.n_jobs == 'a
-00002170: 7574 6f27 3a0d 0a20 2020 2020 2020 2020  uto':..         
-00002180: 2020 2073 656c 662e 6e5f 6a6f 6273 203d     self.n_jobs =
-00002190: 2063 7075 5f63 6f75 6e74 286d 6f64 6966   cpu_count(modif
-000021a0: 6965 723d 302e 3735 290d 0a20 2020 2020  ier=0.75)..     
-000021b0: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-000021c0: 6520 3e20 303a 0d0a 2020 2020 2020 2020  e > 0:..        
-000021d0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-000021e0: 5573 696e 6720 7b73 656c 662e 6e5f 6a6f  Using {self.n_jo
-000021f0: 6273 7d20 6370 7573 2066 6f72 206e 5f6a  bs} cpus for n_j
-00002200: 6f62 732e 2229 0d0a 2020 2020 2020 2020  obs.")..        
-00002210: 7365 6c66 2e73 7461 7274 696e 675f 7061  self.starting_pa
-00002220: 7261 6d73 203d 2073 656c 662e 6765 745f  rams = self.get_
-00002230: 7061 7261 6d73 2829 0d0a 2020 2020 2020  params()..      
-00002240: 2020 7365 6c66 2e73 6361 6c65 7220 3d20    self.scaler = 
-00002250: 456d 7074 7954 7261 6e73 666f 726d 6572  EmptyTransformer
-00002260: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00002270: 2e70 7265 7072 6f63 6573 7365 7220 3d20  .preprocesser = 
-00002280: 456d 7074 7954 7261 6e73 666f 726d 6572  EmptyTransformer
-00002290: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-000022a0: 2e64 735f 6d69 6e20 3d20 7064 2e54 696d  .ds_min = pd.Tim
-000022b0: 6573 7461 6d70 2822 3230 3030 2d30 312d  estamp("2000-01-
-000022c0: 3031 2229 0d0a 2020 2020 2020 2020 7365  01")..        se
-000022d0: 6c66 2e64 735f 6d61 7820 3d20 7064 2e54  lf.ds_max = pd.T
-000022e0: 696d 6573 7461 6d70 2822 3230 3235 2d30  imestamp("2025-0
-000022f0: 312d 3031 2229 0d0a 2020 2020 2020 2020  1-01")..        
-00002300: 7365 6c66 2e6e 616d 6520 3d20 2243 6173  self.name = "Cas
-00002310: 7361 6e64 7261 220d 0a20 2020 2020 2020  sandra"..       
-00002320: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
-00002330: 7265 7373 6f72 5f74 7261 696e 203d 204e  ressor_train = N
-00002340: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
-00002350: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
-00002360: 5f74 7261 696e 203d 204e 6f6e 650d 0a20  _train = None.. 
-00002370: 2020 2020 2020 2073 656c 662e 7265 6772         self.regr
-00002380: 5f70 6572 5f73 6572 6965 735f 7472 203d  _per_series_tr =
-00002390: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
-000023a0: 656c 662e 7472 656e 645f 7472 6169 6e20  elf.trend_train 
-000023b0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-000023c0: 7365 6c66 2e63 6f6d 706f 6e65 6e74 7320  self.components 
-000023d0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-000023e0: 7365 6c66 2e61 6e6f 6d61 6c79 5f64 6574  self.anomaly_det
-000023f0: 6563 746f 7220 3d20 4e6f 6e65 0d0a 2020  ector = None..  
-00002400: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
-00002410: 6179 5f64 6574 6563 746f 7220 3d20 4e6f  ay_detector = No
-00002420: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
-00002430: 2e69 6d70 6163 7473 203d 204e 6f6e 650d  .impacts = None.
-00002440: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00002450: 2e74 7265 6e64 5f61 6e6f 6d61 6c79 5f64  .trend_anomaly_d
-00002460: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
-00002470: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00002480: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
-00002490: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
-000024a0: 6374 6f72 203d 2041 6e6f 6d61 6c79 5265  ctor = AnomalyRe
-000024b0: 6d6f 7661 6c28 0d0a 2020 2020 2020 2020  moval(..        
-000024c0: 2020 2020 2020 2020 2a2a 7365 6c66 2e74          **self.t
-000024d0: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
-000024e0: 6563 746f 725f 7061 7261 6d73 0d0a 2020  ector_params..  
-000024f0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00002500: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00002510: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
-00002520: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-00002530: 746f 7220 3d20 4e6f 6e65 0d0a 0d0a 2020  tor = None....  
-00002540: 2020 6465 6620 6261 7365 5f73 6361 6c65    def base_scale
-00002550: 7228 7365 6c66 2c20 6466 293a 0d0a 2020  r(self, df):..  
-00002560: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
-00002570: 725f 6d65 616e 203d 206e 702e 6d65 616e  r_mean = np.mean
-00002580: 2864 662c 2061 7869 733d 3029 0d0a 2020  (df, axis=0)..  
-00002590: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
-000025a0: 725f 7374 6420 3d20 6e70 2e73 7464 2864  r_std = np.std(d
-000025b0: 662c 2061 7869 733d 3029 0d0a 2020 2020  f, axis=0)..    
-000025c0: 2020 2020 7265 7475 726e 2028 6466 202d      return (df -
-000025d0: 2073 656c 662e 7363 616c 6572 5f6d 6561   self.scaler_mea
-000025e0: 6e29 202f 2073 656c 662e 7363 616c 6572  n) / self.scaler
-000025f0: 5f73 7464 0d0a 0d0a 2020 2020 6465 6620  _std....    def 
-00002600: 7363 616c 655f 6461 7461 2873 656c 662c  scale_data(self,
-00002610: 2064 6629 3a0d 0a20 2020 2020 2020 2069   df):..        i
-00002620: 6620 7365 6c66 2e70 7265 7072 6f63 6573  f self.preproces
-00002630: 7369 6e67 5f74 7261 6e73 666f 726d 6174  sing_transformat
-00002640: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-00002650: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00002660: 203d 2073 656c 662e 7072 6570 726f 6365   = self.preproce
-00002670: 7373 6572 2e74 7261 6e73 666f 726d 2864  sser.transform(d
-00002680: 662e 636f 7079 2829 290d 0a20 2020 2020  f.copy())..     
-00002690: 2020 2069 6620 7365 6c66 2e73 6361 6c69     if self.scali
-000026a0: 6e67 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ng is not None:.
-000026b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000026c0: 7365 6c66 2e73 6361 6c69 6e67 203d 3d20  self.scaling == 
-000026d0: 2242 6173 6553 6361 6c65 7222 3a0d 0a20  "BaseScaler":.. 
-000026e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000026f0: 6620 3d20 7365 6c66 2e62 6173 655f 7363  f = self.base_sc
-00002700: 616c 6572 2864 6629 0d0a 2020 2020 2020  aler(df)..      
-00002710: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00002720: 2020 2020 2020 2020 2020 2020 2064 6620               df 
-00002730: 3d20 7365 6c66 2e73 6361 6c65 722e 7472  = self.scaler.tr
-00002740: 616e 7366 6f72 6d28 6466 290d 0a20 2020  ansform(df)..   
-00002750: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00002760: 7374 616e 6365 2864 662c 2070 642e 4461  stance(df, pd.Da
-00002770: 7461 4672 616d 6529 3a0d 0a20 2020 2020  taFrame):..     
-00002780: 2020 2020 2020 2072 6574 7572 6e20 7064         return pd
-00002790: 2e44 6174 6146 7261 6d65 2864 662c 2063  .DataFrame(df, c
-000027a0: 6f6c 756d 6e73 3d64 662e 636f 6c75 6d6e  olumns=df.column
-000027b0: 732c 2069 6e64 6578 3d64 662e 696e 6465  s, index=df.inde
-000027c0: 7829 0d0a 2020 2020 2020 2020 656c 7365  x)..        else
-000027d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000027e0: 6574 7572 6e20 6466 0d0a 0d0a 2020 2020  eturn df....    
-000027f0: 6465 6620 746f 5f6f 7269 6769 6e5f 7370  def to_origin_sp
-00002800: 6163 6528 0d0a 2020 2020 2020 2020 7365  ace(..        se
-00002810: 6c66 2c20 6466 2c20 7472 616e 735f 6d65  lf, df, trans_me
-00002820: 7468 6f64 3d27 666f 7265 6361 7374 272c  thod='forecast',
-00002830: 2063 6f6d 706f 6e65 6e74 733d 4661 6c73   components=Fals
-00002840: 652c 2062 6f75 6e64 733d 4661 6c73 650d  e, bounds=False.
-00002850: 0a20 2020 2029 3a0d 0a20 2020 2020 2020  .    ):..       
-00002860: 2022 2222 5461 6b65 2074 7261 6e73 666f   """Take transfo
-00002870: 726d 6564 206f 7574 7075 7473 2062 6163  rmed outputs bac
-00002880: 6b20 746f 206f 7269 6769 6e61 6c20 6665  k to original fe
-00002890: 6174 7572 6520 7370 6163 652e 2222 220d  ature space.""".
-000028a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000028b0: 2e73 6361 6c69 6e67 203d 3d20 2242 6173  .scaling == "Bas
-000028c0: 6553 6361 6c65 7222 3a0d 0a20 2020 2020  eScaler":..     
-000028d0: 2020 2020 2020 2023 2072 6574 7572 6e20         # return 
-000028e0: 7365 6c66 2e70 7265 7072 6f63 6573 7365  self.preprocesse
-000028f0: 722e 696e 7665 7273 655f 7472 616e 7366  r.inverse_transf
-00002900: 6f72 6d28 6466 2c20 7472 616e 735f 6d65  orm(df, trans_me
-00002910: 7468 6f64 3d74 7261 6e73 5f6d 6574 686f  thod=trans_metho
-00002920: 6429 202a 2073 656c 662e 7363 616c 6572  d) * self.scaler
-00002930: 5f73 7464 202b 2073 656c 662e 7363 616c  _std + self.scal
-00002940: 6572 5f6d 6561 6e0d 0a20 2020 2020 2020  er_mean..       
-00002950: 2020 2020 2069 6620 636f 6d70 6f6e 656e       if componen
-00002960: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00002970: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00002980: 2e70 7265 7072 6f63 6573 7365 722e 696e  .preprocesser.in
-00002990: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
-000029a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000029b0: 2020 2020 2020 6466 202a 2073 656c 662e        df * self.
-000029c0: 7363 616c 6572 5f73 7464 2c20 7472 616e  scaler_std, tran
-000029d0: 735f 6d65 7468 6f64 3d74 7261 6e73 5f6d  s_method=trans_m
-000029e0: 6574 686f 642c 2062 6f75 6e64 733d 626f  ethod, bounds=bo
-000029f0: 756e 6473 0d0a 2020 2020 2020 2020 2020  unds..          
-00002a00: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00002a10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00002a20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002a30: 726e 2073 656c 662e 7072 6570 726f 6365  rn self.preproce
-00002a40: 7373 6572 2e69 6e76 6572 7365 5f74 7261  sser.inverse_tra
-00002a50: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
-00002a60: 2020 2020 2020 2020 2020 2020 2064 6620               df 
-00002a70: 2a20 7365 6c66 2e73 6361 6c65 725f 7374  * self.scaler_st
-00002a80: 6420 2b20 7365 6c66 2e73 6361 6c65 725f  d + self.scaler_
-00002a90: 6d65 616e 2c0d 0a20 2020 2020 2020 2020  mean,..         
-00002aa0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00002ab0: 5f6d 6574 686f 643d 7472 616e 735f 6d65  _method=trans_me
-00002ac0: 7468 6f64 2c0d 0a20 2020 2020 2020 2020  thod,..         
-00002ad0: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
-00002ae0: 733d 626f 756e 6473 2c0d 0a20 2020 2020  s=bounds,..     
-00002af0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00002b00: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00002b10: 2020 2020 2020 2020 2023 2072 6574 7572           # retur
-00002b20: 6e20 7365 6c66 2e73 6361 6c65 722e 696e  n self.scaler.in
-00002b30: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
-00002b40: 7365 6c66 2e70 7265 7072 6f63 6573 7365  self.preprocesse
-00002b50: 722e 696e 7665 7273 655f 7472 616e 7366  r.inverse_transf
-00002b60: 6f72 6d28 6466 2c20 7472 616e 735f 6d65  orm(df, trans_me
-00002b70: 7468 6f64 3d74 7261 6e73 5f6d 6574 686f  thod=trans_metho
-00002b80: 6429 2c20 7472 616e 735f 6d65 7468 6f64  d), trans_method
-00002b90: 3d74 7261 6e73 5f6d 6574 686f 6429 0d0a  =trans_method)..
-00002ba0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002bb0: 726e 2073 656c 662e 7072 6570 726f 6365  rn self.preproce
-00002bc0: 7373 6572 2e69 6e76 6572 7365 5f74 7261  sser.inverse_tra
-00002bd0: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
-00002be0: 2020 2020 2020 2020 2073 656c 662e 7363           self.sc
-00002bf0: 616c 6572 2e69 6e76 6572 7365 5f74 7261  aler.inverse_tra
-00002c00: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
-00002c10: 2020 2020 2020 2020 2020 2020 2064 662c               df,
-00002c20: 2074 7261 6e73 5f6d 6574 686f 643d 7472   trans_method=tr
-00002c30: 616e 735f 6d65 7468 6f64 2c20 626f 756e  ans_method, boun
-00002c40: 6473 3d62 6f75 6e64 730d 0a20 2020 2020  ds=bounds..     
-00002c50: 2020 2020 2020 2020 2020 2029 2c0d 0a20             ),.. 
-00002c60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00002c70: 7261 6e73 5f6d 6574 686f 643d 7472 616e  rans_method=tran
-00002c80: 735f 6d65 7468 6f64 2c0d 0a20 2020 2020  s_method,..     
-00002c90: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
-00002ca0: 733d 626f 756e 6473 2c0d 0a20 2020 2020  s=bounds,..     
-00002cb0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-00002cc0: 6465 6620 6372 6561 7465 5f74 2873 656c  def create_t(sel
-00002cd0: 662c 2044 5469 6e64 6578 293a 0d0a 2020  f, DTindex):..  
-00002ce0: 2020 2020 2020 7265 7475 726e 2028 4454        return (DT
-00002cf0: 696e 6465 7820 2d20 7365 6c66 2e64 735f  index - self.ds_
-00002d00: 6d69 6e29 202f 2028 7365 6c66 2e64 735f  min) / (self.ds_
-00002d10: 6d61 7820 2d20 7365 6c66 2e64 735f 6d69  max - self.ds_mi
-00002d20: 6e29 0d0a 0d0a 2020 2020 6465 6620 6669  n)....    def fi
-00002d30: 7428 0d0a 2020 2020 2020 2020 7365 6c66  t(..        self
-00002d40: 2c0d 0a20 2020 2020 2020 2064 662c 0d0a  ,..        df,..
-00002d50: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-00002d60: 6567 7265 7373 6f72 3d4e 6f6e 652c 0d0a  egressor=None,..
-00002d70: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
-00002d80: 725f 7065 725f 7365 7269 6573 3d4e 6f6e  r_per_series=Non
-00002d90: 652c 0d0a 2020 2020 2020 2020 666c 6167  e,..        flag
-00002da0: 5f72 6567 7265 7373 6f72 733d 4e6f 6e65  _regressors=None
-00002db0: 2c0d 0a20 2020 2020 2020 2063 6174 6567  ,..        categ
-00002dc0: 6f72 6963 616c 5f67 726f 7570 733d 4e6f  orical_groups=No
-00002dd0: 6e65 2c0d 0a20 2020 2020 2020 2070 6173  ne,..        pas
-00002de0: 745f 696d 7061 6374 733d 4e6f 6e65 2c0d  t_impacts=None,.
-00002df0: 0a20 2020 2029 3a0d 0a20 2020 2020 2020  .    ):..       
-00002e00: 2023 2066 6c61 6720 7265 6772 6573 736f   # flag regresso
-00002e10: 7273 2062 7970 6173 7320 7072 6570 726f  rs bypass prepro
-00002e20: 6365 7373 696e 670d 0a20 2020 2020 2020  cessing..       
-00002e30: 2023 2069 6465 616c 6c79 2061 6c6c 6f77   # ideally allow
-00002e40: 2062 6f74 6820 7064 2e44 6174 6146 7261   both pd.DataFra
-00002e50: 6d65 2061 6e64 206e 702e 6172 7261 7920  me and np.array 
-00002e60: 696e 7075 7473 2028 696e 6465 7820 666f  inputs (index fo
-00002e70: 7220 6172 7261 793f 0d0a 2020 2020 2020  r array?..      
-00002e80: 2020 6966 2073 656c 662e 636f 6e73 7472    if self.constr
-00002e90: 6169 6e74 2069 7320 6e6f 7420 4e6f 6e65  aint is not None
-00002ea0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00002eb0: 656c 662e 6466 5f6f 7269 6769 6e61 6c20  elf.df_original 
-00002ec0: 3d20 6466 0d0a 2020 2020 2020 2020 7365  = df..        se
-00002ed0: 6c66 2e64 6620 3d20 6466 2e63 6f70 7928  lf.df = df.copy(
-00002ee0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00002ef0: 6261 7369 635f 7072 6f66 696c 6528 7365  basic_profile(se
-00002f00: 6c66 2e64 6629 0d0a 2020 2020 2020 2020  lf.df)..        
-00002f10: 2320 7374 616e 6461 7264 697a 6520 6772  # standardize gr
-00002f20: 6f75 7069 6e67 7320 2865 7874 7261 2f6d  oupings (extra/m
-00002f30: 6973 7369 6e67 2064 6561 6c74 2077 6974  issing dealt wit
-00002f40: 6829 0d0a 2020 2020 2020 2020 6966 2063  h)..        if c
-00002f50: 6174 6567 6f72 6963 616c 5f67 726f 7570  ategorical_group
-00002f60: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-00002f70: 2020 2020 2020 2020 6361 7465 676f 7269          categori
-00002f80: 6361 6c5f 6772 6f75 7073 203d 207b 7d0d  cal_groups = {}.
-00002f90: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-00002fa0: 7465 676f 7269 6361 6c5f 6772 6f75 7073  tegorical_groups
-00002fb0: 203d 207b 0d0a 2020 2020 2020 2020 2020   = {..          
-00002fc0: 2020 636f 6c3a 2028 0d0a 2020 2020 2020    col: (..      
-00002fd0: 2020 2020 2020 2020 2020 6361 7465 676f            catego
-00002fe0: 7269 6361 6c5f 6772 6f75 7073 5b63 6f6c  rical_groups[col
-00002ff0: 5d20 6966 2063 6f6c 2069 6e20 6361 7465  ] if col in cate
-00003000: 676f 7269 6361 6c5f 6772 6f75 7073 2e6b  gorical_groups.k
-00003010: 6579 7328 2920 656c 7365 2022 6f74 6865  eys() else "othe
-00003020: 7222 0d0a 2020 2020 2020 2020 2020 2020  r"..            
-00003030: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00003040: 6f72 2063 6f6c 2069 6e20 6466 2e63 6f6c  or col in df.col
-00003050: 756d 6e73 0d0a 2020 2020 2020 2020 7d0d  umns..        }.
-00003060: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00003070: 7374 5f69 6d70 6163 7473 203d 2070 6173  st_impacts = pas
-00003080: 745f 696d 7061 6374 730d 0a20 2020 2020  t_impacts..     
-00003090: 2020 2023 2069 6620 7061 7374 2069 6d70     # if past imp
-000030a0: 6163 7473 2067 6976 656e 2c20 6173 7375  acts given, assu
-000030b0: 6d65 2072 656d 6f76 616c 2075 6e6c 6573  me removal unles
-000030c0: 7320 6f74 6865 7277 6973 6520 7370 6563  s otherwise spec
-000030d0: 6966 6965 640d 0a20 2020 2020 2020 2069  ified..        i
-000030e0: 6620 7365 6c66 2e70 6173 745f 696d 7061  f self.past_impa
-000030f0: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
-00003100: 2069 7320 4e6f 6e65 2061 6e64 2070 6173   is None and pas
-00003110: 745f 696d 7061 6374 7320 6973 206e 6f74  t_impacts is not
-00003120: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00003130: 2020 2020 7365 6c66 2e70 6173 745f 696d      self.past_im
-00003140: 7061 6374 735f 696e 7465 7276 656e 7469  pacts_interventi
-00003150: 6f6e 203d 2022 7265 6d6f 7665 220d 0a20  on = "remove".. 
-00003160: 2020 2020 2020 2065 6c69 6620 7061 7374         elif past
-00003170: 5f69 6d70 6163 7473 2069 7320 4e6f 6e65  _impacts is None
-00003180: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00003190: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
-000031a0: 5f69 6e74 6572 7665 6e74 696f 6e20 3d20  _intervention = 
-000031b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
-000031c0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
-000031d0: 6572 6965 7320 6973 206e 6f74 204e 6f6e  eries is not Non
-000031e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000031f0: 7365 6c66 2e72 6567 725f 7065 725f 7365  self.regr_per_se
-00003200: 7269 6573 5f74 7220 3d20 7265 6772 6573  ries_tr = regres
-00003210: 736f 725f 7065 725f 7365 7269 6573 0d0a  sor_per_series..
-00003220: 0d0a 2020 2020 2020 2020 2320 7768 6174  ..        # what
-00003230: 2066 6561 7475 7265 7320 7769 6c6c 2072   features will r
-00003240: 6571 7569 7265 2073 6570 6172 6174 6520  equire separate 
-00003250: 6d6f 6465 6c73 2074 6f20 6265 2066 6974  models to be fit
-00003260: 2061 7320 5820 7769 6c6c 206e 6f74 2062   as X will not b
-00003270: 6520 636f 6e73 6973 7465 6e74 2066 6f72  e consistent for
-00003280: 2061 6c6c 0d0a 2020 2020 2020 2020 2320   all..        # 
-00003290: 5768 6174 2074 7269 6767 6572 7320 6c6f  What triggers lo
-000032a0: 6f70 3a0d 0a20 2020 2020 2020 2023 2041  op:..        # A
-000032b0: 5220 4c61 6773 0d0a 2020 2020 2020 2020  R Lags..        
-000032c0: 2320 486f 6c69 6461 7920 636f 756e 7472  # Holiday countr
-000032d0: 6965 7320 6173 2064 6963 7420 286e 6f74  ies as dict (not
-000032e0: 206c 6973 7429 0d0a 2020 2020 2020 2020   list)..        
-000032f0: 2320 7265 6772 6573 736f 725f 7065 725f  # regressor_per_
-00003300: 7365 7269 6573 2028 6f6e 6c79 2069 6620  series (only if 
-00003310: 7265 6772 6573 736f 7220 7573 6564 290d  regressor used).
-00003320: 0a20 2020 2020 2020 2023 204d 756c 7469  .        # Multi
-00003330: 7661 7269 6174 6520 486f 6c69 6461 7920  variate Holiday 
-00003340: 4465 7465 6374 6f72 2c20 6f6e 6c79 2069  Detector, only i
-00003350: 6620 6372 6561 7465 2066 6561 7475 7265  f create feature
-00003360: 2c20 6e6f 7420 7265 6d6f 7661 6c20 2870  , not removal (p
-00003370: 6c6f 7420 696e 2074 6869 7320 6361 7365  lot in this case
-00003380: 290d 0a20 2020 2020 2020 2023 204d 756c  )..        # Mul
-00003390: 7469 7661 7269 6174 6520 416e 6f6d 616c  tivariate Anomal
-000033a0: 7920 4465 7465 6374 6f72 2c20 6f6e 6c79  y Detector, only
-000033b0: 2069 6620 6372 6561 7465 2066 6561 7475   if create featu
-000033c0: 7265 2c20 6e6f 7420 7265 6d6f 7661 6c0d  re, not removal.
-000033d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000033e0: 7374 616e 6365 2873 656c 662e 616e 6f6d  stance(self.anom
-000033f0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
-00003400: 616d 732c 2064 6963 7429 3a0d 0a20 2020  ams, dict):..   
-00003410: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
-00003420: 6f6d 616c 795f 6e6f 745f 756e 6920 3d20  omaly_not_uni = 
-00003430: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00003440: 2020 2073 656c 662e 616e 6f6d 616c 795f     self.anomaly_
-00003450: 6465 7465 6374 6f72 5f70 6172 616d 732e  detector_params.
-00003460: 6765 7428 276f 7574 7075 7427 2c20 4e6f  get('output', No
-00003470: 6e65 2920 213d 2027 756e 6976 6172 6961  ne) != 'univaria
-00003480: 7465 270d 0a20 2020 2020 2020 2020 2020  te'..           
-00003490: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
-000034a0: 2e61 6e6f 6d61 6c79 5f6e 6f74 5f75 6e69  .anomaly_not_uni
-000034b0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-000034c0: 2020 7365 6c66 2e6c 6f6f 705f 7265 7175    self.loop_requ
-000034d0: 6972 6564 203d 2028 0d0a 2020 2020 2020  ired = (..      
-000034e0: 2020 2020 2020 2873 656c 662e 6172 5f6c        (self.ar_l
-000034f0: 6167 7320 6973 206e 6f74 204e 6f6e 6529  ags is not None)
-00003500: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-00003510: 2028 290d 0a20 2020 2020 2020 2020 2020   ()..           
-00003520: 206f 7220 280d 0a20 2020 2020 2020 2020   or (..         
-00003530: 2020 2020 2020 2069 7369 6e73 7461 6e63         isinstanc
-00003540: 6528 7365 6c66 2e68 6f6c 6964 6179 5f63  e(self.holiday_c
-00003550: 6f75 6e74 7269 6573 2c20 6469 6374 2920  ountries, dict) 
-00003560: 616e 6420 7365 6c66 2e68 6f6c 6964 6179  and self.holiday
-00003570: 5f63 6f75 6e74 7269 6573 5f75 7365 640d  _countries_used.
-00003580: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-00003590: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-000035a0: 2872 6567 7265 7373 6f72 5f70 6572 5f73  (regressor_per_s
-000035b0: 6572 6965 7320 6973 206e 6f74 204e 6f6e  eries is not Non
-000035c0: 6529 2061 6e64 2073 656c 662e 7265 6772  e) and self.regr
-000035d0: 6573 736f 7273 5f75 7365 6429 0d0a 2020  essors_used)..  
-000035e0: 2020 2020 2020 2020 2020 6f72 2028 6973            or (is
-000035f0: 696e 7374 616e 6365 2873 656c 662e 616e  instance(self.an
-00003600: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-00003610: 6f6e 2c20 6469 6374 2920 616e 6420 7365  on, dict) and se
-00003620: 6c66 2e61 6e6f 6d61 6c79 5f6e 6f74 5f75  lf.anomaly_not_u
-00003630: 6e69 290d 0a20 2020 2020 2020 2020 2020  ni)..           
-00003640: 206f 7220 280d 0a20 2020 2020 2020 2020   or (..         
-00003650: 2020 2020 2020 2073 656c 662e 7061 7374         self.past
-00003660: 5f69 6d70 6163 7473 5f69 6e74 6572 7665  _impacts_interve
-00003670: 6e74 696f 6e20 3d3d 2022 7265 6772 6573  ntion == "regres
-00003680: 736f 7222 0d0a 2020 2020 2020 2020 2020  sor"..          
-00003690: 2020 2020 2020 616e 6420 7061 7374 5f69        and past_i
-000036a0: 6d70 6163 7473 2069 7320 6e6f 7420 4e6f  mpacts is not No
-000036b0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-000036c0: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
-000036d0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-000036e0: 2072 6f6c 6c69 6e67 2070 7265 6469 6374   rolling predict
-000036f0: 696f 6e20 6973 2072 6571 7569 7265 640d  ion is required.
-00003700: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00003710: 6564 6963 745f 6c6f 6f70 5f72 6571 203d  edict_loop_req =
-00003720: 2028 7365 6c66 2e61 725f 6c61 6773 2069   (self.ar_lags i
-00003730: 7320 6e6f 7420 4e6f 6e65 2920 6f72 2028  s not None) or (
-00003740: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00003750: 6c66 2e6d 756c 7469 7661 7269 6174 655f  lf.multivariate_
-00003760: 6665 6174 7572 6520 6973 206e 6f74 204e  feature is not N
-00003770: 6f6e 650d 0a20 2020 2020 2020 2029 0d0a  one..        )..
-00003780: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00003790: 6966 2063 6f6d 706f 6e65 6e74 2070 726f  if component pro
-000037a0: 6365 7373 696e 6720 6d75 7374 206c 6f6f  cessing must loo
-000037b0: 700d 0a20 2020 2020 2020 2023 2073 656c  p..        # sel
-000037c0: 662e 636f 6d70 6f6e 656e 745f 6c6f 6f70  f.component_loop
-000037d0: 5f72 6571 203d 2028 6973 696e 7374 616e  _req = (isinstan
-000037e0: 6365 2872 6567 7265 7373 6f72 5f70 6572  ce(regressor_per
-000037f0: 5f73 6572 6965 732c 2064 6963 7429 2061  _series, dict) a
-00003800: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
-00003810: 7273 5f75 7365 6429 206f 7220 2869 7369  rs_used) or (isi
-00003820: 6e73 7461 6e63 6528 7365 6c66 2e68 6f6c  nstance(self.hol
-00003830: 6964 6179 5f63 6f75 6e74 7269 6573 2c20  iday_countries, 
-00003840: 6469 6374 2920 616e 6420 7365 6c66 2e68  dict) and self.h
-00003850: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
-00003860: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
-00003870: 2020 2320 5245 4d4f 5645 204e 614e 2062    # REMOVE NaN b
-00003880: 7574 206f 6e6c 7920 7468 6973 2073 6f20  ut only this so 
-00003890: 6661 722c 2066 6f72 2068 6f6c 6964 6179  far, for holiday
-000038a0: 2061 6e64 2061 6e6f 6d61 6c79 2064 6574   and anomaly det
-000038b0: 6563 7469 6f6e 0d0a 2020 2020 2020 2020  ection..        
-000038c0: 6966 2073 656c 662e 7072 6570 726f 6365  if self.preproce
-000038d0: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
-000038e0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
-000038f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00003900: 656c 662e 7072 6570 726f 6365 7373 6572  elf.preprocesser
-00003910: 203d 2047 656e 6572 616c 5472 616e 7366   = GeneralTransf
-00003920: 6f72 6d65 7228 0d0a 2020 2020 2020 2020  ormer(..        
-00003930: 2020 2020 2020 2020 2a2a 7b27 6669 6c6c          **{'fill
-00003940: 6e61 273a 2073 656c 662e 7072 6570 726f  na': self.prepro
-00003950: 6365 7373 696e 675f 7472 616e 7366 6f72  cessing_transfor
-00003960: 6d61 7469 6f6e 2e67 6574 2827 6669 6c6c  mation.get('fill
-00003970: 6e61 272c 2022 6666 696c 6c22 297d 0d0a  na', "ffill")}..
-00003980: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00003990: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000039a0: 6466 203d 2073 656c 662e 7072 6570 726f  df = self.prepro
-000039b0: 6365 7373 6572 2e66 6974 5f74 7261 6e73  cesser.fit_trans
-000039c0: 666f 726d 2873 656c 662e 6466 290d 0a0d  form(self.df)...
-000039d0: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
-000039e0: 6520 7061 7374 2069 6d70 6163 7473 2074  e past impacts t
-000039f0: 6f20 6669 6e64 2022 6f72 6761 6e69 6322  o find "organic"
-00003a00: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00003a10: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
-00003a20: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
-00003a30: 7265 6d6f 7665 223a 0d0a 2020 2020 2020  remove":..      
-00003a40: 2020 2020 2020 7365 6c66 2e64 6620 3d20        self.df = 
-00003a50: 7365 6c66 2e64 6620 2f20 2831 202b 2070  self.df / (1 + p
-00003a60: 6173 745f 696d 7061 6374 7329 2020 2320  ast_impacts)  # 
-00003a70: 776f 756c 6420 4d49 4e55 5320 6265 2062  would MINUS be b
-00003a80: 6574 7465 723f 0d0a 2020 2020 2020 2020  etter?..        
-00003a90: 2320 686f 6c69 6461 7920 6465 7465 6374  # holiday detect
-00003aa0: 696f 6e20 6669 7273 742c 2064 6f6e 2774  ion first, don't
-00003ab0: 2077 616e 7420 616e 7920 616e 6f6d 616c   want any anomal
-00003ac0: 6965 7320 7265 6d6f 7665 6420 7965 742c  ies removed yet,
-00003ad0: 2061 6e64 2068 6173 206f 776e 2070 7265   and has own pre
-00003ae0: 7072 6f63 6573 7369 6e67 0d0a 2020 2020  processing..    
-00003af0: 2020 2020 6966 2073 656c 662e 686f 6c69      if self.holi
-00003b00: 6461 795f 6465 7465 6374 6f72 5f70 6172  day_detector_par
-00003b10: 616d 7320 6973 206e 6f74 204e 6f6e 653a  ams is not None:
-00003b20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00003b30: 6c66 2e68 6f6c 6964 6179 5f64 6574 6563  lf.holiday_detec
-00003b40: 746f 7220 3d20 486f 6c69 6461 7954 7261  tor = HolidayTra
-00003b50: 6e73 666f 726d 6572 282a 2a73 656c 662e  nsformer(**self.
-00003b60: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
-00003b70: 5f70 6172 616d 7329 0d0a 2020 2020 2020  _params)..      
-00003b80: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
-00003b90: 6179 5f64 6574 6563 746f 722e 6669 7428  ay_detector.fit(
-00003ba0: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
-00003bb0: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
-00003bc0: 6179 7320 3d20 7365 6c66 2e68 6f6c 6964  ays = self.holid
-00003bd0: 6179 5f64 6574 6563 746f 722e 6461 7465  ay_detector.date
-00003be0: 735f 746f 5f68 6f6c 6964 6179 7328 0d0a  s_to_holidays(..
-00003bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c00: 7365 6c66 2e64 662e 696e 6465 782c 2073  self.df.index, s
-00003c10: 7479 6c65 3d27 7365 7269 6573 5f66 6c61  tyle='series_fla
-00003c20: 6727 0d0a 2020 2020 2020 2020 2020 2020  g'..            
-00003c30: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00003c40: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-00003c50: 7420 3d20 6e70 2e63 6f75 6e74 5f6e 6f6e  t = np.count_non
-00003c60: 7a65 726f 2873 656c 662e 686f 6c69 6461  zero(self.holida
-00003c70: 7973 290d 0a20 2020 2020 2020 2020 2020  ys)..           
-00003c80: 2069 6620 7365 6c66 2e68 6f6c 6964 6179   if self.holiday
-00003c90: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00003ca0: 5b22 7265 6d6f 7665 5f65 7863 6573 735f  ["remove_excess_
-00003cb0: 616e 6f6d 616c 6965 7322 5d3a 0d0a 2020  anomalies"]:..  
-00003cc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003cd0: 6c66 2e64 6620 3d20 7365 6c66 2e64 665b  lf.df = self.df[
-00003ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003cf0: 2020 2020 2020 7e28 0d0a 2020 2020 2020        ~(..      
-00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d10: 2020 2873 656c 662e 686f 6c69 6461 795f    (self.holiday_
-00003d20: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c79  detector.anomaly
-00003d30: 5f6d 6f64 656c 2e61 6e6f 6d61 6c69 6573  _model.anomalies
-00003d40: 203d 3d20 2d31 290d 0a20 2020 2020 2020   == -1)..       
-00003d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d60: 2026 2028 7365 6c66 2e68 6f6c 6964 6179   & (self.holiday
-00003d70: 7320 213d 2031 290d 0a20 2020 2020 2020  s != 1)..       
-00003d80: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003da0: 5d0d 0a20 2020 2020 2020 2023 2066 696e  ]..        # fin
-00003db0: 6420 616e 6f6d 616c 6965 732c 2061 6e64  d anomalies, and
-00003dc0: 2065 6974 6865 7220 7265 6d6f 7665 206f   either remove o
-00003dd0: 7220 7365 7475 7020 666f 7220 6d6f 6465  r setup for mode
-00003de0: 6c69 6e67 2074 6865 2061 6e6f 6d61 6c79  ling the anomaly
-00003df0: 2073 636f 7265 730d 0a20 2020 2020 2020   scores..       
-00003e00: 2069 6620 7365 6c66 2e61 6e6f 6d61 6c79   if self.anomaly
-00003e10: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00003e20: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00003e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003e40: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00003e50: 203d 2041 6e6f 6d61 6c79 5265 6d6f 7661   = AnomalyRemova
-00003e60: 6c28 2a2a 7365 6c66 2e61 6e6f 6d61 6c79  l(**self.anomaly
-00003e70: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00003e80: 292e 6669 7428 0d0a 2020 2020 2020 2020  ).fit(..        
-00003e90: 2020 2020 2020 2020 7365 6c66 2e64 660d          self.df.
-00003ea0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-00003eb0: 2020 2020 2020 2020 2020 2020 2320 5245              # RE
-00003ec0: 4d4f 5645 2048 4f4c 4944 4159 5320 6672  MOVE HOLIDAYS fr
-00003ed0: 6f6d 2061 6e6f 6d61 6c69 6573 2c20 6173  om anomalies, as
-00003ee0: 2074 6865 7920 6d61 7920 6c6f 6f6b 206c   they may look l
-00003ef0: 696b 6520 616e 6f6d 616c 6965 7320 6275  ike anomalies bu
-00003f00: 7420 6172 6520 6465 616c 7420 7769 7468  t are dealt with
-00003f10: 2062 7920 686f 6c69 6461 7973 0d0a 2020   by holidays..  
-00003f20: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-00003f30: 2c20 686f 7765 7665 722c 2064 6f65 7320  , however, does 
-00003f40: 6e6f 7468 696e 6720 746f 2070 7265 7365  nothing to prese
-00003f50: 7276 6520 636f 756e 7472 7920 686f 6c69  rve country holi
-00003f60: 6461 7973 0d0a 2020 2020 2020 2020 2020  days..          
-00003f70: 2020 6966 2073 656c 662e 686f 6c69 6461    if self.holida
-00003f80: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
-00003f90: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
-00003fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fb0: 686f 6c5f 6669 6c74 203d 2028 7365 6c66  hol_filt = (self
-00003fc0: 2e68 6f6c 6964 6179 7320 3d3d 2031 2920  .holidays == 1) 
-00003fd0: 2620 280d 0a20 2020 2020 2020 2020 2020  & (..           
-00003fe0: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
-00003ff0: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
-00004000: 6e6f 6d61 6c69 6573 203d 3d20 2d31 0d0a  nomalies == -1..
+00000430: 0a66 726f 6d20 6175 746f 7473 2e6d 6f64  .from autots.mod
+00000440: 656c 732e 6d6f 6465 6c5f 6c69 7374 2069  els.model_list i
+00000450: 6d70 6f72 7420 6d6f 6465 6c5f 6c69 7374  mport model_list
+00000460: 5f74 6f5f 6469 6374 0d0a 0d0a 2320 7363  _to_dict....# sc
+00000470: 6970 7920 6973 2074 6563 686e 6963 616c  ipy is technical
+00000480: 6c79 206f 7074 696f 6e61 6c20 6275 7420  ly optional but 
+00000490: 6d6f 7374 206c 696b 656c 7920 6973 2070  most likely is p
+000004a0: 7265 7365 6e74 0d0a 7472 793a 0d0a 2020  resent..try:..  
+000004b0: 2020 6672 6f6d 2073 6369 7079 2e6f 7074    from scipy.opt
+000004c0: 696d 697a 6520 696d 706f 7274 206d 696e  imize import min
+000004d0: 696d 697a 650d 0a20 2020 2066 726f 6d20  imize..    from 
+000004e0: 7363 6970 792e 7374 6174 7320 696d 706f  scipy.stats impo
+000004f0: 7274 206e 6f72 6d0d 0a65 7863 6570 7420  rt norm..except 
+00000500: 4578 6365 7074 696f 6e3a 0d0a 0d0a 2020  Exception:....  
+00000510: 2020 636c 6173 7320 6e6f 726d 286f 626a    class norm(obj
+00000520: 6563 7429 3a0d 0a20 2020 2020 2020 2040  ect):..        @
+00000530: 7374 6174 6963 6d65 7468 6f64 0d0a 2020  staticmethod..  
+00000540: 2020 2020 2020 6465 6620 7070 6628 7829        def ppf(x)
+00000550: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00000560: 6574 7572 6e20 312e 3634 3438 3533 3632  eturn 1.64485362
+00000570: 3639 3531 3437 3232 0d0a 0d0a 0d0a 636c  69514722......cl
+00000580: 6173 7320 4361 7373 616e 6472 6128 4d6f  ass Cassandra(Mo
+00000590: 6465 6c4f 626a 6563 7429 3a0d 0a20 2020  delObject):..   
+000005a0: 2022 2222 4578 706c 6169 6e61 626c 6520   """Explainable 
+000005b0: 6465 636f 6d70 6f73 6974 696f 6e2d 6261  decomposition-ba
+000005c0: 7365 6420 666f 7265 6361 7374 696e 6720  sed forecasting 
+000005d0: 7769 7468 2061 6476 616e 6365 6420 7472  with advanced tr
+000005e0: 656e 6420 6d6f 6465 6c69 6e67 2061 6e64  end modeling and
+000005f0: 2070 7265 7072 6f63 6573 7369 6e67 2e0d   preprocessing..
+00000600: 0a0d 0a20 2020 2054 756e 6320 6574 6961  ...    Tunc etia
+00000610: 6d20 6661 7469 7320 6170 6572 6974 2043  m fatis aperit C
+00000620: 6173 7361 6e64 7261 2066 7574 7572 6973  assandra futuris
+00000630: 0d0a 2020 2020 6f72 612c 2064 6569 2069  ..    ora, dei i
+00000640: 7573 7375 206e 6f6e 2075 6d71 7561 6d20  ussu non umquam 
+00000650: 6372 6564 6974 6120 5465 7563 7269 732e  credita Teucris.
+00000660: 0d0a 2020 2020 4e6f 7320 6465 6c75 6272  ..    Nos delubr
+00000670: 6120 6465 756d 206d 6973 6572 692c 2071  a deum miseri, q
+00000680: 7569 6275 7320 756c 7469 6d75 7320 6573  uibus ultimus es
+00000690: 7365 740d 0a20 2020 2069 6c6c 6520 6469  set..    ille di
+000006a0: 6573 2c20 6665 7374 6120 7665 6c61 6d75  es, festa velamu
+000006b0: 7320 6672 6f6e 6465 2070 6572 2075 7262  s fronde per urb
+000006c0: 656d 2e0d 0a20 2020 202d 4165 6e65 6964  em...    -Aeneid
+000006d0: 2032 2e32 3436 2d32 2e32 3439 0d0a 0d0a   2.246-2.249....
+000006e0: 2020 2020 496e 2067 656e 6572 616c 2c20      In general, 
+000006f0: 616c 6c20 7469 6d65 2073 6572 6965 7320  all time series 
+00000700: 6461 7461 2069 6e70 7574 7320 2864 662c  data inputs (df,
+00000710: 2072 6567 7265 7373 6f72 732c 2069 6d70   regressors, imp
+00000720: 6163 7473 2920 7368 6f75 6c64 2062 6520  acts) should be 
+00000730: 7769 6465 2073 7479 6c65 2064 6174 6120  wide style data 
+00000740: 696e 2061 2070 642e 4461 7461 4672 616d  in a pd.DataFram
+00000750: 650d 0a20 2020 2020 2020 2061 6e20 696e  e..        an in
+00000760: 6465 7820 7468 6174 2069 7320 6120 7064  dex that is a pd
+00000770: 2e44 6174 6574 696d 6549 6e64 6578 0d0a  .DatetimeIndex..
+00000780: 2020 2020 2020 2020 6f6e 6520 636f 6c75          one colu
+00000790: 6d6e 2070 6572 2074 696d 6520 7365 7269  mn per time seri
+000007a0: 6573 2c20 7769 7468 2061 2075 6e69 7175  es, with a uniqu
+000007b0: 656c 7920 6964 656e 7469 6669 6162 6c65  ely identifiable
+000007c0: 2063 6f6c 756d 6e20 6e61 6d65 0d0a 0d0a   column name....
+000007d0: 2020 2020 496d 7061 6374 7320 6765 7420      Impacts get 
+000007e0: 636f 6e66 7573 696e 672e 0d0a 2020 2020  confusing...    
+000007f0: 4120 7061 7374 2069 6d70 6163 7420 6f66  A past impact of
+00000800: 2030 2e30 3520 776f 756c 6420 6d65 616e   0.05 would mean
+00000810: 2061 6e20 6f75 7473 6964 652c 2075 6e66   an outside, unf
+00000820: 6f72 6563 6173 7461 626c 6520 666f 7263  orecastable forc
+00000830: 6520 6361 7573 6564 2f61 6464 6564 2035  e caused/added 5
+00000840: 2520 6f66 2074 6865 2076 616c 7565 2061  % of the value a
+00000850: 7420 7468 6973 2074 696d 652e 0d0a 2020  t this time...  
+00000860: 2020 4163 636f 7264 696e 676c 792c 2074    Accordingly, t
+00000870: 6861 7420 3525 2077 696c 6c20 6265 2072  hat 5% will be r
+00000880: 656d 6f76 6564 2062 6566 6f72 6520 666f  emoved before fo
+00000890: 7265 6361 7374 696e 672c 2074 6865 6e20  recasting, then 
+000008a0: 6164 6465 6420 6261 636b 206f 6e20 6166  added back on af
+000008b0: 7465 722e 0d0a 2020 2020 496d 7061 6374  ter...    Impact
+000008c0: 7320 6361 6e20 616c 736f 2062 6520 6e65  s can also be ne
+000008d0: 6761 7469 7665 2076 616c 7565 732e 0d0a  gative values...
+000008e0: 2020 2020 4120 6675 7475 7265 2069 6d70      A future imp
+000008f0: 6163 7420 6f66 2035 2520 776f 756c 6420  act of 5% would 
+00000900: 6d65 616e 2061 6e20 6f75 7473 6964 6520  mean an outside 
+00000910: 666f 7263 6520 6164 6473 2035 2520 6162  force adds 5% ab
+00000920: 6f76 6520 7468 6520 6f72 6967 696e 616c  ove the original
+00000930: 2066 6f72 6563 6173 742e 0d0a 2020 2020   forecast...    
+00000940: 4675 7475 7265 2069 6d70 6163 7473 2063  Future impacts c
+00000950: 616e 2062 6520 7573 6564 2074 6f20 6d6f  an be used to mo
+00000960: 6465 6c20 7072 6f64 7563 7420 676f 616c  del product goal
+00000970: 7320 6f72 2074 656d 706f 7261 7279 2061  s or temporary a
+00000980: 6e6f 6d61 6c69 6573 2077 6869 6368 2063  nomalies which c
+00000990: 616e 2774 206f 7220 7368 6f75 6c64 2774  an't or should't
+000009a0: 2062 6520 6d6f 6465 6c65 6420 6279 2066   be modeled by f
+000009b0: 6f72 6563 6173 7469 6e67 2061 6e64 2077  orecasting and w
+000009c0: 686f 7365 2072 656c 6174 6976 6520 6566  hose relative ef
+000009d0: 6665 6374 2069 7320 6b6e 6f77 6e0d 0a20  fect is known.. 
+000009e0: 2020 2043 6f6d 7061 7265 2074 6869 7320     Compare this 
+000009f0: 7769 7468 2072 6567 7265 7373 6f72 732c  with regressors,
+00000a00: 2077 6869 6368 2061 7265 2065 7373 656e   which are essen
+00000a10: 7469 616c 6c79 2074 6865 206d 6f64 656c  tially the model
+00000a20: 2065 7374 696d 6174 696e 6720 7468 6520   estimating the 
+00000a30: 7265 6c61 7469 7665 2069 6d70 6163 7420  relative impact 
+00000a40: 6769 7665 6e20 7468 6520 7261 7720 7369  given the raw si
+00000a50: 7a65 206f 7220 7072 6573 656e 6365 206f  ze or presence o
+00000a60: 6620 616e 206f 7574 7369 6465 2065 6666  f an outside eff
+00000a70: 6563 740d 0a0d 0a20 2020 2057 6172 6e20  ect....    Warn 
+00000a80: 6162 6f75 7420 7265 6d6f 7665 5f65 7863  about remove_exc
+00000a90: 6573 735f 616e 6f6d 616c 6965 7320 6672  ess_anomalies fr
+00000aa0: 6f6d 2068 6f6c 6964 6179 2064 6574 6563  om holiday detec
+00000ab0: 746f 7220 6966 2072 656c 7969 6e67 206f  tor if relying o
+00000ac0: 6e20 616e 6f6d 616c 7920 7072 6564 6963  n anomaly predic
+00000ad0: 7469 6f6e 0d0a 2020 2020 4c69 6e65 6172  tion..    Linear
+00000ae0: 2063 6f6d 706f 6e65 6e74 7320 6172 6520   components are 
+00000af0: 616c 7761 7973 206d 6f64 656c 2065 6c65  always model ele
+00000b00: 6d65 6e74 732c 2062 7574 2074 7265 6e64  ments, but trend
+00000b10: 2069 7320 6163 7475 616c 7320 2868 6973   is actuals (his
+00000b20: 746f 7279 2920 616e 6420 6d6f 6465 6c20  tory) and model 
+00000b30: 2866 7574 7572 6529 0d0a 2020 2020 5275  (future)..    Ru
+00000b40: 6e6e 696e 6720 7072 6564 6963 7420 7570  nning predict up
+00000b50: 6461 7465 7320 736f 6d65 2069 6e74 6572  dates some inter
+00000b60: 6e61 6c20 6174 7472 6962 7574 6573 2075  nal attributes u
+00000b70: 7365 6420 696e 2070 6c6f 7474 696e 6720  sed in plotting 
+00000b80: 616e 6420 6f74 6865 7220 6669 6775 7265  and other figure
+00000b90: 732c 2067 656e 6572 616c 6c79 2065 7870  s, generally exp
+00000ba0: 6563 7420 746f 2075 7365 2066 756e 6374  ect to use funct
+00000bb0: 696f 6e73 2074 6f20 6c61 7465 7374 2070  ions to latest p
+00000bc0: 7265 6469 6374 0d0a 2020 2020 5365 6173  redict..    Seas
+00000bd0: 6f6e 616c 6974 6965 7320 6172 6520 6861  onalities are ha
+00000be0: 7264 2d63 6f64 6564 2074 6f20 6265 2061  rd-coded to be a
+00000bf0: 7320 6461 7973 2073 6f20 3720 7769 6c6c  s days so 7 will
+00000c00: 2061 6c77 6179 7320 3d20 7765 656b 6c79   always = weekly
+00000c10: 2065 7665 6e20 6966 2064 6174 6120 6973   even if data is
+00000c20: 6e27 7420 6461 696c 790d 0a20 2020 2046  n't daily..    F
+00000c30: 6f72 2073 6c6f 7065 2061 6e61 6c79 7369  or slope analysi
+00000c40: 7320 616e 6420 7a65 726f 2063 726f 7373  s and zero cross
+00000c50: 696e 6773 2c20 6120 736c 6f70 6520 6f66  ings, a slope of
+00000c60: 2030 2065 7661 6c75 6174 6573 2061 7320   0 evaluates as 
+00000c70: 6120 706f 7369 7469 7665 2073 6967 6e20  a positive sign 
+00000c80: 283d 3e30 292e 2045 7861 6374 6c79 2030  (=>0). Exactly 0
+00000c90: 2073 6c6f 7065 2069 7320 7261 7265 2072   slope is rare r
+00000ca0: 6561 6c20 776f 726c 6420 6461 7461 0d0a  eal world data..
+00000cb0: 2020 2020 446f 6573 206e 6f74 2063 7572      Does not cur
+00000cc0: 7265 6e74 6c79 2066 6f6c 6c6f 7720 7468  rently follow th
+00000cd0: 6520 7265 6772 6573 7369 6f6e 5f74 7970  e regression_typ
+00000ce0: 653d 2755 7365 7227 2061 6e64 2066 6169  e='User' and fai
+00000cf0: 6c73 2069 6620 6e6f 2072 6567 7265 7373  ls if no regress
+00000d00: 6f72 2070 6174 7465 726e 206f 6620 6f74  or pattern of ot
+00000d10: 6865 7220 6d6f 6465 6c73 0d0a 2020 2020  her models..    
+00000d20: 466f 7220 636f 6d70 6f6e 656e 7420 6465  For component de
+00000d30: 636f 6d70 6f73 6974 696f 6e2c 2073 6361  composition, sca
+00000d40: 6c65 2077 696c 6c20 6265 2069 6e61 6363  le will be inacc
+00000d50: 7572 6174 6520 756e 6c65 7373 2027 4261  urate unless 'Ba
+00000d60: 7365 5363 616c 6572 2720 6973 2075 7365  seScaler' is use
+00000d70: 642c 2062 7574 2072 6567 6172 646c 6573  d, but regardles
+00000d80: 7320 7468 6973 2077 6f6e 2774 2061 6666  s this won't aff
+00000d90: 6563 7420 6669 6e61 6c20 666f 7265 6361  ect final foreca
+00000da0: 7374 0d0a 0d0a 2020 2020 4172 6773 3a0d  st....    Args:.
+00000db0: 0a20 2020 2020 2020 2070 6173 730d 0a0d  .        pass...
+00000dc0: 0a20 2020 204d 6574 686f 6473 3a0d 0a20  .    Methods:.. 
+00000dd0: 2020 2020 2020 2020 6669 740d 0a20 2020          fit..   
+00000de0: 2020 2020 2020 7072 6564 6963 740d 0a20        predict.. 
+00000df0: 2020 2020 2020 2020 686f 6c69 6461 795f          holiday_
+00000e00: 6465 7465 6374 6f72 2e64 6174 6573 5f74  detector.dates_t
+00000e10: 6f5f 686f 6c69 6461 7973 0d0a 2020 2020  o_holidays..    
+00000e20: 2020 2020 2063 7265 6174 655f 666f 7265       create_fore
+00000e30: 6361 7374 5f69 6e64 6578 3a20 6166 7465  cast_index: afte
+00000e40: 7220 2e66 6974 2c20 6361 6e20 6265 2075  r .fit, can be u
+00000e50: 7365 6420 746f 2063 7265 6174 6520 696e  sed to create in
+00000e60: 6465 7820 6f66 2070 7265 6469 6374 696f  dex of predictio
+00000e70: 6e0d 0a20 2020 2020 2020 2020 706c 6f74  n..         plot
+00000e80: 5f66 6f72 6563 6173 740d 0a20 2020 2020  _forecast..     
+00000e90: 2020 2020 706c 6f74 5f63 6f6d 706f 6e65      plot_compone
+00000ea0: 6e74 730d 0a20 2020 2020 2020 2020 706c  nts..         pl
+00000eb0: 6f74 5f74 7265 6e64 0d0a 2020 2020 2020  ot_trend..      
+00000ec0: 2020 2067 6574 5f6e 6577 5f70 6172 616d     get_new_param
+00000ed0: 730d 0a20 2020 2020 2020 2020 7265 7475  s..         retu
+00000ee0: 726e 5f63 6f6d 706f 6e65 6e74 730d 0a0d  rn_components...
+00000ef0: 0a20 2020 2041 7474 7269 6275 7465 733a  .    Attributes:
+00000f00: 0d0a 2020 2020 2020 2020 2e61 6e6f 6d61  ..        .anoma
+00000f10: 6c79 5f64 6574 6563 746f 722e 616e 6f6d  ly_detector.anom
+00000f20: 616c 6965 730d 0a20 2020 2020 2020 202e  alies..        .
+00000f30: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00000f40: 2e73 636f 7265 730d 0a20 2020 2020 2020  .scores..       
+00000f50: 202e 686f 6c69 6461 795f 636f 756e 740d   .holiday_count.
+00000f60: 0a20 2020 2020 2020 202e 686f 6c69 6461  .        .holida
+00000f70: 7973 2028 7365 7269 6573 2066 6c61 6773  ys (series flags
+00000f80: 2c20 686f 6c69 6461 7920 6465 7465 6374  , holiday detect
+00000f90: 6f72 206f 6e6c 7929 0d0a 2020 2020 2020  or only)..      
+00000fa0: 2020 2e70 6172 616d 730d 0a20 2020 2020    .params..     
+00000fb0: 2020 202e 6b65 6570 5f63 6f6c 732c 202e     .keep_cols, .
+00000fc0: 6b65 6570 5f63 6f6c 735f 6964 780d 0a20  keep_cols_idx.. 
+00000fd0: 2020 2020 2020 202e 785f 6172 7261 790d         .x_array.
+00000fe0: 0a20 2020 2020 2020 202e 7072 6564 6963  .        .predic
+00000ff0: 745f 785f 6172 7261 790d 0a20 2020 2020  t_x_array..     
+00001000: 2020 202e 7472 656e 645f 7472 6169 6e0d     .trend_train.
+00001010: 0a20 2020 2020 2020 202e 7072 6564 6963  .        .predic
+00001020: 7465 645f 7472 656e 640d 0a20 2020 2022  ted_trend..    "
+00001030: 2222 0d0a 0d0a 2020 2020 6465 6620 5f5f  ""....    def __
+00001040: 696e 6974 5f5f 280d 0a20 2020 2020 2020  init__(..       
+00001050: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00001060: 7072 6570 726f 6365 7373 696e 675f 7472  preprocessing_tr
+00001070: 616e 7366 6f72 6d61 7469 6f6e 3a20 6469  ansformation: di
+00001080: 6374 203d 204e 6f6e 652c 2020 2320 6669  ct = None,  # fi
+00001090: 6c74 6572 7320 6279 2064 6566 6175 6c74  lters by default
+000010a0: 206f 6e6c 790d 0a20 2020 2020 2020 2073   only..        s
+000010b0: 6361 6c69 6e67 3a20 7374 7220 3d20 2242  caling: str = "B
+000010c0: 6173 6553 6361 6c65 7222 2c20 2023 2070  aseScaler",  # p
+000010d0: 756c 6c65 6420 6f75 7420 6672 6f6d 2074  ulled out from t
+000010e0: 7261 6e73 666f 726d 6174 696f 6e20 6173  ransformation as
+000010f0: 2061 2073 6361 6c65 7220 6973 206e 6f74   a scaler is not
+00001100: 206f 7074 696f 6e61 6c2c 206d 6179 6265   optional, maybe
+00001110: 2061 6c6c 6f77 2061 206c 6973 740d 0a20   allow a list.. 
+00001120: 2020 2020 2020 2070 6173 745f 696d 7061         past_impa
+00001130: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
+00001140: 3a20 7374 7220 3d20 4e6f 6e65 2c20 2023  : str = None,  #
+00001150: 2027 7265 6d6f 7665 272c 2027 706c 6f74   'remove', 'plot
+00001160: 5f6f 6e6c 7927 2c20 2772 6567 7265 7373  _only', 'regress
+00001170: 6f72 270d 0a20 2020 2020 2020 2073 6561  or'..        sea
+00001180: 736f 6e61 6c69 7469 6573 3a20 6469 6374  sonalities: dict
+00001190: 203d 205b 0d0a 2020 2020 2020 2020 2020   = [..          
+000011a0: 2020 2763 6f6d 6d6f 6e5f 666f 7572 6965    'common_fourie
+000011b0: 7227 0d0a 2020 2020 2020 2020 5d2c 2020  r'..        ],  
+000011c0: 2320 696e 7465 7261 6374 696f 6e73 2061  # interactions a
+000011d0: 6464 6564 2069 6620 666f 7572 6965 7220  dded if fourier 
+000011e0: 616e 6420 6f72 6465 7220 6d61 7463 6865  and order matche
+000011f0: 730d 0a20 2020 2020 2020 2061 725f 6c61  s..        ar_la
+00001200: 6773 3a20 6c69 7374 203d 204e 6f6e 652c  gs: list = None,
+00001210: 0d0a 2020 2020 2020 2020 6172 5f69 6e74  ..        ar_int
+00001220: 6572 6163 7469 6f6e 5f73 6561 736f 6e61  eraction_seasona
+00001230: 6c69 7479 3a20 6469 6374 203d 204e 6f6e  lity: dict = Non
+00001240: 652c 2020 2320 6571 7561 6c20 6f72 206c  e,  # equal or l
+00001250: 6573 7320 7468 616e 206e 756d 6265 7220  ess than number 
+00001260: 6f66 2061 7220 6c61 6773 0d0a 2020 2020  of ar lags..    
+00001270: 2020 2020 616e 6f6d 616c 795f 6465 7465      anomaly_dete
+00001280: 6374 6f72 5f70 6172 616d 733a 2064 6963  ctor_params: dic
+00001290: 7420 3d20 4e6f 6e65 2c20 2023 2061 7070  t = None,  # app
+000012a0: 6c79 2062 6566 6f72 6520 616e 7920 7072  ly before any pr
+000012b0: 6570 726f 6365 7373 696e 6720 2861 7320  eprocessing (as 
+000012c0: 6861 7320 6f77 6e29 0d0a 2020 2020 2020  has own)..      
+000012d0: 2020 616e 6f6d 616c 795f 696e 7465 7276    anomaly_interv
+000012e0: 656e 7469 6f6e 3a20 7374 7220 3d20 4e6f  ention: str = No
+000012f0: 6e65 2c20 2023 2072 656d 6f76 652c 2063  ne,  # remove, c
+00001300: 7265 6174 6520 6665 6174 7572 652c 206d  reate feature, m
+00001310: 6f64 656c 0d0a 2020 2020 2020 2020 686f  odel..        ho
+00001320: 6c69 6461 795f 6465 7465 6374 6f72 5f70  liday_detector_p
+00001330: 6172 616d 733a 2064 6963 7420 3d20 4e6f  arams: dict = No
+00001340: 6e65 2c0d 0a20 2020 2020 2020 2068 6f6c  ne,..        hol
+00001350: 6964 6179 5f63 6f75 6e74 7269 6573 3a20  iday_countries: 
+00001360: 6469 6374 203d 204e 6f6e 652c 2020 2320  dict = None,  # 
+00001370: 6c69 7374 206f 7220 6469 6374 0d0a 2020  list or dict..  
+00001380: 2020 2020 2020 686f 6c69 6461 795f 636f        holiday_co
+00001390: 756e 7472 6965 735f 7573 6564 3a20 626f  untries_used: bo
+000013a0: 6f6c 203d 2054 7275 652c 0d0a 2020 2020  ol = True,..    
+000013b0: 2020 2020 6d75 6c74 6976 6172 6961 7465      multivariate
+000013c0: 5f66 6561 7475 7265 3a20 7374 7220 3d20  _feature: str = 
+000013d0: 4e6f 6e65 2c20 2023 2062 7920 6772 6f75  None,  # by grou
+000013e0: 702c 2069 6620 6769 7665 6e0d 0a20 2020  p, if given..   
+000013f0: 2020 2020 206d 756c 7469 7661 7269 6174       multivariat
+00001400: 655f 7472 616e 7366 6f72 6d61 7469 6f6e  e_transformation
+00001410: 3a20 7374 7220 3d20 4e6f 6e65 2c20 2023  : str = None,  #
+00001420: 2061 7070 6c69 6564 2062 6566 6f72 6520   applied before 
+00001430: 6372 6561 7469 6e67 2066 6561 7475 7265  creating feature
+00001440: 0d0a 2020 2020 2020 2020 7265 6772 6573  ..        regres
+00001450: 736f 725f 7472 616e 7366 6f72 6d61 7469  sor_transformati
+00001460: 6f6e 3a20 6469 6374 203d 204e 6f6e 652c  on: dict = None,
+00001470: 2020 2320 6170 706c 6965 6420 746f 2066    # applied to f
+00001480: 7574 7572 655f 7265 6772 6573 736f 7220  uture_regressor 
+00001490: 616e 6420 7265 6772 6573 736f 725f 7065  and regressor_pe
+000014a0: 725f 7365 7269 6573 0d0a 2020 2020 2020  r_series..      
+000014b0: 2020 7265 6772 6573 736f 7273 5f75 7365    regressors_use
+000014c0: 643a 2062 6f6f 6c20 3d20 5472 7565 2c20  d: bool = True, 
+000014d0: 2023 206f 6e2f 6f66 6620 6f66 2061 6464   # on/off of add
+000014e0: 6974 696f 6e61 6c20 7573 6572 2069 6e70  itional user inp
+000014f0: 7574 730d 0a20 2020 2020 2020 206c 696e  uts..        lin
+00001500: 6561 725f 6d6f 6465 6c3a 2064 6963 7420  ear_model: dict 
+00001510: 3d20 4e6f 6e65 2c20 2023 206c 7374 7371  = None,  # lstsq
+00001520: 2057 4549 4748 5445 4420 5269 6467 652c   WEIGHTED Ridge,
+00001530: 2062 6179 6573 6961 6e2c 2062 6179 6573   bayesian, bayes
+00001540: 6961 6e20 6869 6572 6172 6368 6961 6c2c  ian hierarchial,
+00001550: 206c 3120 6e6f 726d 6564 206f 7220 6f74   l1 normed or ot
+00001560: 6865 7220 6c6f 7373 2028 6e75 6d62 6129  her loss (numba)
+00001570: 2c0d 0a20 2020 2020 2020 2072 616e 646f  ,..        rando
+00001580: 6d77 616c 6b5f 6e3a 2069 6e74 203d 204e  mwalk_n: int = N
+00001590: 6f6e 652c 2020 2320 7573 6520 7374 6174  one,  # use stat
+000015a0: 7320 6f66 2073 6f75 7263 6520 6466 0d0a  s of source df..
+000015b0: 2020 2020 2020 2020 7472 656e 645f 7769          trend_wi
+000015c0: 6e64 6f77 3a20 696e 7420 3d20 3330 2c20  ndow: int = 30, 
+000015d0: 2023 2073 6574 2074 6f20 4e6f 6e65 2074   # set to None t
+000015e0: 6f20 7573 6520 7261 7720 7265 7369 6475  o use raw residu
+000015f0: 616c 730d 0a20 2020 2020 2020 2074 7265  als..        tre
+00001600: 6e64 5f73 7461 6e64 696e 3a20 7374 7220  nd_standin: str 
+00001610: 3d20 4e6f 6e65 2c20 2023 2072 6f6c 6c69  = None,  # rolli
+00001620: 6e67 2066 6974 2c20 696e 7465 7263 6570  ng fit, intercep
+00001630: 742d 6f6e 6c79 2c20 7261 6e64 6f6d 2e6e  t-only, random.n
+00001640: 6f72 6d61 6c20 6665 6174 7572 6573 0d0a  ormal features..
+00001650: 2020 2020 2020 2020 7472 656e 645f 616e          trend_an
+00001660: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
+00001670: 6172 616d 733a 2064 6963 7420 3d20 4e6f  arams: dict = No
+00001680: 6e65 2c20 2023 2064 6966 6665 7265 6e63  ne,  # differenc
+00001690: 6520 6669 7273 742c 2072 756e 206f 6e20  e first, run on 
+000016a0: 736c 6f70 6520 6f6e 6c79 2c20 7573 6520  slope only, use 
+000016b0: 5769 6e64 6f77 206e 2f32 2064 6966 6620  Window n/2 diff 
+000016c0: 746f 2072 756c 6520 6f75 7420 7265 7475  to rule out retu
+000016d0: 726e 2074 6f0d 0a20 2020 2020 2020 2023  rn to..        #
+000016e0: 2074 7265 6e64 5f61 6e6f 6d61 6c79 5f69   trend_anomaly_i
+000016f0: 6e74 6572 7665 6e74 696f 6e3a 2073 7472  ntervention: str
+00001700: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
+00001710: 2020 7472 656e 645f 7472 616e 7366 6f72    trend_transfor
+00001720: 6d61 7469 6f6e 3a20 6469 6374 203d 207b  mation: dict = {
+00001730: 7d2c 0d0a 2020 2020 2020 2020 7472 656e  },..        tren
+00001740: 645f 6d6f 6465 6c3a 2064 6963 7420 3d20  d_model: dict = 
+00001750: 7b0d 0a20 2020 2020 2020 2020 2020 2027  {..            '
+00001760: 4d6f 6465 6c27 3a20 274c 6173 7456 616c  Model': 'LastVal
+00001770: 7565 4e61 6976 6527 2c0d 0a20 2020 2020  ueNaive',..     
+00001780: 2020 2020 2020 2027 4d6f 6465 6c50 6172         'ModelPar
+00001790: 616d 6574 6572 7327 3a20 7b7d 2c0d 0a20  ameters': {},.. 
+000017a0: 2020 2020 2020 207d 2c20 2023 2068 6176         },  # hav
+000017b0: 6520 6f6e 6520 6f72 2074 776f 2069 6e20  e one or two in 
+000017c0: 6275 696c 742c 2074 6865 6e20 7265 6469  built, then redi
+000017d0: 7265 6374 2074 6f20 616e 7920 4175 746f  rect to any Auto
+000017e0: 5453 206d 6f64 656c 2066 6f72 206f 7468  TS model for oth
+000017f0: 6572 2063 686f 6963 6573 0d0a 2020 2020  er choices..    
+00001800: 2020 2020 7472 656e 645f 7068 693a 2066      trend_phi: f
+00001810: 6c6f 6174 203d 204e 6f6e 652c 0d0a 2020  loat = None,..  
+00001820: 2020 2020 2020 636f 6e73 7472 6169 6e74        constraint
+00001830: 3a20 6469 6374 203d 204e 6f6e 652c 0d0a  : dict = None,..
+00001840: 2020 2020 2020 2020 6d61 785f 636f 6c69          max_coli
+00001850: 6e65 6172 6974 793a 2066 6c6f 6174 203d  nearity: float =
+00001860: 2030 2e39 3938 2c0d 0a20 2020 2020 2020   0.998,..       
+00001870: 206d 6178 5f6d 756c 7469 636f 6c69 6e65   max_multicoline
+00001880: 6172 6974 793a 2066 6c6f 6174 203d 2030  arity: float = 0
+00001890: 2e30 3031 2c0d 0a20 2020 2020 2020 2023  .001,..        #
+000018a0: 206e 6f74 206d 6f64 656c 696e 6720 7265   not modeling re
+000018b0: 6c61 7465 643a 0d0a 2020 2020 2020 2020  lated:..        
+000018c0: 6672 6571 7565 6e63 793a 2073 7472 203d  frequency: str =
+000018d0: 2027 696e 6665 7227 2c0d 0a20 2020 2020   'infer',..     
+000018e0: 2020 2070 7265 6469 6374 696f 6e5f 696e     prediction_in
+000018f0: 7465 7276 616c 3a20 666c 6f61 7420 3d20  terval: float = 
+00001900: 302e 392c 0d0a 2020 2020 2020 2020 7261  0.9,..        ra
+00001910: 6e64 6f6d 5f73 6565 643a 2069 6e74 203d  ndom_seed: int =
+00001920: 2032 3032 322c 0d0a 2020 2020 2020 2020   2022,..        
+00001930: 7665 7262 6f73 653a 2069 6e74 203d 2030  verbose: int = 0
+00001940: 2c0d 0a20 2020 2020 2020 206e 5f6a 6f62  ,..        n_job
+00001950: 733a 2069 6e74 203d 2022 6175 746f 222c  s: int = "auto",
+00001960: 0d0a 2020 2020 2020 2020 2a2a 6b77 6172  ..        **kwar
+00001970: 6773 2c0d 0a20 2020 2029 3a0d 0a20 2020  gs,..    ):..   
+00001980: 2020 2020 2069 6620 7072 6570 726f 6365       if preproce
+00001990: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
+000019a0: 7469 6f6e 2069 7320 4e6f 6e65 3a0d 0a20  tion is None:.. 
+000019b0: 2020 2020 2020 2020 2020 2070 7265 7072             prepr
+000019c0: 6f63 6573 7369 6e67 5f74 7261 6e73 666f  ocessing_transfo
+000019d0: 726d 6174 696f 6e20 3d20 7b7d 0d0a 2020  rmation = {}..  
+000019e0: 2020 2020 2020 7365 6c66 2e70 7265 7072        self.prepr
+000019f0: 6f63 6573 7369 6e67 5f74 7261 6e73 666f  ocessing_transfo
+00001a00: 726d 6174 696f 6e20 3d20 7072 6570 726f  rmation = prepro
+00001a10: 6365 7373 696e 675f 7472 616e 7366 6f72  cessing_transfor
+00001a20: 6d61 7469 6f6e 0d0a 2020 2020 2020 2020  mation..        
+00001a30: 7365 6c66 2e73 6361 6c69 6e67 203d 2073  self.scaling = s
+00001a40: 6361 6c69 6e67 0d0a 2020 2020 2020 2020  caling..        
+00001a50: 7365 6c66 2e70 6173 745f 696d 7061 6374  self.past_impact
+00001a60: 735f 696e 7465 7276 656e 7469 6f6e 203d  s_intervention =
+00001a70: 2070 6173 745f 696d 7061 6374 735f 696e   past_impacts_in
+00001a80: 7465 7276 656e 7469 6f6e 0d0a 2020 2020  tervention..    
+00001a90: 2020 2020 7365 6c66 2e73 6561 736f 6e61      self.seasona
+00001aa0: 6c69 7469 6573 203d 2073 6561 736f 6e61  lities = seasona
+00001ab0: 6c69 7469 6573 0d0a 2020 2020 2020 2020  lities..        
+00001ac0: 7365 6c66 2e61 725f 6c61 6773 203d 2061  self.ar_lags = a
+00001ad0: 725f 6c61 6773 0d0a 2020 2020 2020 2020  r_lags..        
+00001ae0: 7365 6c66 2e61 725f 696e 7465 7261 6374  self.ar_interact
+00001af0: 696f 6e5f 7365 6173 6f6e 616c 6974 7920  ion_seasonality 
+00001b00: 3d20 6172 5f69 6e74 6572 6163 7469 6f6e  = ar_interaction
+00001b10: 5f73 6561 736f 6e61 6c69 7479 0d0a 2020  _seasonality..  
+00001b20: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
+00001b30: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
+00001b40: 6d73 203d 2061 6e6f 6d61 6c79 5f64 6574  ms = anomaly_det
+00001b50: 6563 746f 725f 7061 7261 6d73 0d0a 2020  ector_params..  
+00001b60: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
+00001b70: 6c79 5f69 6e74 6572 7665 6e74 696f 6e20  ly_intervention 
+00001b80: 3d20 616e 6f6d 616c 795f 696e 7465 7276  = anomaly_interv
+00001b90: 656e 7469 6f6e 0d0a 2020 2020 2020 2020  ention..        
+00001ba0: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
+00001bb0: 6563 746f 725f 7061 7261 6d73 203d 2068  ector_params = h
+00001bc0: 6f6c 6964 6179 5f64 6574 6563 746f 725f  oliday_detector_
+00001bd0: 7061 7261 6d73 0d0a 2020 2020 2020 2020  params..        
+00001be0: 7365 6c66 2e68 6f6c 6964 6179 5f63 6f75  self.holiday_cou
+00001bf0: 6e74 7269 6573 203d 2068 6f6c 6964 6179  ntries = holiday
+00001c00: 5f63 6f75 6e74 7269 6573 0d0a 2020 2020  _countries..    
+00001c10: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00001c20: 6528 7365 6c66 2e68 6f6c 6964 6179 5f63  e(self.holiday_c
+00001c30: 6f75 6e74 7269 6573 2c20 7374 7229 3a0d  ountries, str):.
+00001c40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001c50: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
+00001c60: 6965 7320 3d20 7365 6c66 2e68 6f6c 6964  ies = self.holid
+00001c70: 6179 5f63 6f75 6e74 7269 6573 2e73 706c  ay_countries.spl
+00001c80: 6974 2822 2c22 290d 0a20 2020 2020 2020  it(",")..       
+00001c90: 2073 656c 662e 686f 6c69 6461 795f 636f   self.holiday_co
+00001ca0: 756e 7472 6965 735f 7573 6564 203d 2068  untries_used = h
+00001cb0: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
+00001cc0: 5f75 7365 640d 0a20 2020 2020 2020 2073  _used..        s
+00001cd0: 656c 662e 6d75 6c74 6976 6172 6961 7465  elf.multivariate
+00001ce0: 5f66 6561 7475 7265 203d 206d 756c 7469  _feature = multi
+00001cf0: 7661 7269 6174 655f 6665 6174 7572 650d  variate_feature.
+00001d00: 0a20 2020 2020 2020 2073 656c 662e 6d75  .        self.mu
+00001d10: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
+00001d20: 666f 726d 6174 696f 6e20 3d20 6d75 6c74  formation = mult
+00001d30: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
+00001d40: 726d 6174 696f 6e0d 0a20 2020 2020 2020  rmation..       
+00001d50: 2073 656c 662e 7265 6772 6573 736f 725f   self.regressor_
+00001d60: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
+00001d70: 2072 6567 7265 7373 6f72 5f74 7261 6e73   regressor_trans
+00001d80: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
+00001d90: 2020 2073 656c 662e 7265 6772 6573 736f     self.regresso
+00001da0: 7273 5f75 7365 6420 3d20 7265 6772 6573  rs_used = regres
+00001db0: 736f 7273 5f75 7365 640d 0a20 2020 2020  sors_used..     
+00001dc0: 2020 2073 656c 662e 6c69 6e65 6172 5f6d     self.linear_m
+00001dd0: 6f64 656c 203d 206c 696e 6561 725f 6d6f  odel = linear_mo
+00001de0: 6465 6c20 6966 206c 696e 6561 725f 6d6f  del if linear_mo
+00001df0: 6465 6c20 6973 206e 6f74 204e 6f6e 6520  del is not None 
+00001e00: 656c 7365 207b 7d0d 0a20 2020 2020 2020  else {}..       
+00001e10: 2073 656c 662e 7261 6e64 6f6d 7761 6c6b   self.randomwalk
+00001e20: 5f6e 203d 2072 616e 646f 6d77 616c 6b5f  _n = randomwalk_
+00001e30: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00001e40: 7472 656e 645f 7769 6e64 6f77 203d 2074  trend_window = t
+00001e50: 7265 6e64 5f77 696e 646f 770d 0a20 2020  rend_window..   
+00001e60: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
+00001e70: 7374 616e 6469 6e20 3d20 7472 656e 645f  standin = trend_
+00001e80: 7374 616e 6469 6e0d 0a20 2020 2020 2020  standin..       
+00001e90: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
+00001ea0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
+00001eb0: 616d 7320 3d20 7472 656e 645f 616e 6f6d  ams = trend_anom
+00001ec0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
+00001ed0: 616d 730d 0a20 2020 2020 2020 2023 2073  ams..        # s
+00001ee0: 656c 662e 7472 656e 645f 616e 6f6d 616c  elf.trend_anomal
+00001ef0: 795f 696e 7465 7276 656e 7469 6f6e 203d  y_intervention =
+00001f00: 2074 7265 6e64 5f61 6e6f 6d61 6c79 5f69   trend_anomaly_i
+00001f10: 6e74 6572 7665 6e74 696f 6e0d 0a20 2020  ntervention..   
+00001f20: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
+00001f30: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
+00001f40: 2074 7265 6e64 5f74 7261 6e73 666f 726d   trend_transform
+00001f50: 6174 696f 6e0d 0a20 2020 2020 2020 2073  ation..        s
+00001f60: 656c 662e 7472 656e 645f 6d6f 6465 6c20  elf.trend_model 
+00001f70: 3d20 7472 656e 645f 6d6f 6465 6c0d 0a20  = trend_model.. 
+00001f80: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
+00001f90: 645f 7068 6920 3d20 7472 656e 645f 7068  d_phi = trend_ph
+00001fa0: 690d 0a20 2020 2020 2020 2073 656c 662e  i..        self.
+00001fb0: 636f 6e73 7472 6169 6e74 203d 2063 6f6e  constraint = con
+00001fc0: 7374 7261 696e 740d 0a20 2020 2020 2020  straint..       
+00001fd0: 2073 656c 662e 6d61 785f 636f 6c69 6e65   self.max_coline
+00001fe0: 6172 6974 7920 3d20 6d61 785f 636f 6c69  arity = max_coli
+00001ff0: 6e65 6172 6974 790d 0a20 2020 2020 2020  nearity..       
+00002000: 2073 656c 662e 6d61 785f 6d75 6c74 6963   self.max_multic
+00002010: 6f6c 696e 6561 7269 7479 203d 206d 6178  olinearity = max
+00002020: 5f6d 756c 7469 636f 6c69 6e65 6172 6974  _multicolinearit
+00002030: 790d 0a20 2020 2020 2020 2023 206f 7468  y..        # oth
+00002040: 6572 2070 6172 616d 6574 6572 730d 0a20  er parameters.. 
+00002050: 2020 2020 2020 2073 656c 662e 6672 6571         self.freq
+00002060: 7565 6e63 7920 3d20 6672 6571 7565 6e63  uency = frequenc
+00002070: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
+00002080: 7072 6564 6963 7469 6f6e 5f69 6e74 6572  prediction_inter
+00002090: 7661 6c20 3d20 7072 6564 6963 7469 6f6e  val = prediction
+000020a0: 5f69 6e74 6572 7661 6c0d 0a20 2020 2020  _interval..     
+000020b0: 2020 2073 656c 662e 696e 745f 7374 645f     self.int_std_
+000020c0: 6465 7620 3d20 6e6f 726d 2e70 7066 280d  dev = norm.ppf(.
+000020d0: 0a20 2020 2020 2020 2020 2020 2030 2e35  .            0.5
+000020e0: 202b 2030 2e35 202a 2073 656c 662e 7072   + 0.5 * self.pr
+000020f0: 6564 6963 7469 6f6e 5f69 6e74 6572 7661  ediction_interva
+00002100: 6c0d 0a20 2020 2020 2020 2029 2020 2320  l..        )  # 
+00002110: 3220 746f 2031 2073 6964 6564 2069 6e74  2 to 1 sided int
+00002120: 6572 7661 6c0d 0a20 2020 2020 2020 2073  erval..        s
+00002130: 656c 662e 7261 6e64 6f6d 5f73 6565 6420  elf.random_seed 
+00002140: 3d20 7261 6e64 6f6d 5f73 6565 640d 0a20  = random_seed.. 
+00002150: 2020 2020 2020 2073 656c 662e 7665 7262         self.verb
+00002160: 6f73 6520 3d20 7665 7262 6f73 650d 0a20  ose = verbose.. 
+00002170: 2020 2020 2020 2073 656c 662e 6e5f 6a6f         self.n_jo
+00002180: 6273 203d 206e 5f6a 6f62 730d 0a20 2020  bs = n_jobs..   
+00002190: 2020 2020 2069 6620 7365 6c66 2e6e 5f6a       if self.n_j
+000021a0: 6f62 7320 3d3d 2027 6175 746f 273a 0d0a  obs == 'auto':..
+000021b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000021c0: 2e6e 5f6a 6f62 7320 3d20 6370 755f 636f  .n_jobs = cpu_co
+000021d0: 756e 7428 6d6f 6469 6669 6572 3d30 2e37  unt(modifier=0.7
+000021e0: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
+000021f0: 6966 2076 6572 626f 7365 203e 2030 3a0d  if verbose > 0:.
+00002200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002210: 2070 7269 6e74 2866 2255 7369 6e67 207b   print(f"Using {
+00002220: 7365 6c66 2e6e 5f6a 6f62 737d 2063 7075  self.n_jobs} cpu
+00002230: 7320 666f 7220 6e5f 6a6f 6273 2e22 290d  s for n_jobs.").
+00002240: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00002250: 6172 7469 6e67 5f70 6172 616d 7320 3d20  arting_params = 
+00002260: 7365 6c66 2e67 6574 5f70 6172 616d 7328  self.get_params(
+00002270: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00002280: 7363 616c 6572 203d 2045 6d70 7479 5472  scaler = EmptyTr
+00002290: 616e 7366 6f72 6d65 7228 290d 0a20 2020  ansformer()..   
+000022a0: 2020 2020 2073 656c 662e 7072 6570 726f       self.prepro
+000022b0: 6365 7373 6572 203d 2045 6d70 7479 5472  cesser = EmptyTr
+000022c0: 616e 7366 6f72 6d65 7228 290d 0a20 2020  ansformer()..   
+000022d0: 2020 2020 2073 656c 662e 6473 5f6d 696e       self.ds_min
+000022e0: 203d 2070 642e 5469 6d65 7374 616d 7028   = pd.Timestamp(
+000022f0: 2232 3030 302d 3031 2d30 3122 290d 0a20  "2000-01-01").. 
+00002300: 2020 2020 2020 2073 656c 662e 6473 5f6d         self.ds_m
+00002310: 6178 203d 2070 642e 5469 6d65 7374 616d  ax = pd.Timestam
+00002320: 7028 2232 3032 352d 3031 2d30 3122 290d  p("2025-01-01").
+00002330: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
+00002340: 6d65 203d 2022 4361 7373 616e 6472 6122  me = "Cassandra"
+00002350: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
+00002360: 7574 7572 655f 7265 6772 6573 736f 725f  uture_regressor_
+00002370: 7472 6169 6e20 3d20 4e6f 6e65 0d0a 2020  train = None..  
+00002380: 2020 2020 2020 7365 6c66 2e66 6c61 675f        self.flag_
+00002390: 7265 6772 6573 736f 725f 7472 6169 6e20  regressor_train 
+000023a0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000023b0: 7365 6c66 2e72 6567 725f 7065 725f 7365  self.regr_per_se
+000023c0: 7269 6573 5f74 7220 3d20 4e6f 6e65 0d0a  ries_tr = None..
+000023d0: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+000023e0: 6e64 5f74 7261 696e 203d 204e 6f6e 650d  nd_train = None.
+000023f0: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+00002400: 6d70 6f6e 656e 7473 203d 204e 6f6e 650d  mponents = None.
+00002410: 0a20 2020 2020 2020 2073 656c 662e 616e  .        self.an
+00002420: 6f6d 616c 795f 6465 7465 6374 6f72 203d  omaly_detector =
+00002430: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+00002440: 656c 662e 686f 6c69 6461 795f 6465 7465  elf.holiday_dete
+00002450: 6374 6f72 203d 204e 6f6e 650d 0a20 2020  ctor = None..   
+00002460: 2020 2020 2073 656c 662e 696d 7061 6374       self.impact
+00002470: 7320 3d20 4e6f 6e65 0d0a 2020 2020 2020  s = None..      
+00002480: 2020 6966 2073 656c 662e 7472 656e 645f    if self.trend_
+00002490: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+000024a0: 5f70 6172 616d 7320 6973 206e 6f74 204e  _params is not N
+000024b0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000024c0: 2020 7365 6c66 2e74 7265 6e64 5f61 6e6f    self.trend_ano
+000024d0: 6d61 6c79 5f64 6574 6563 746f 7220 3d20  maly_detector = 
+000024e0: 416e 6f6d 616c 7952 656d 6f76 616c 280d  AnomalyRemoval(.
+000024f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002500: 202a 2a73 656c 662e 7472 656e 645f 616e   **self.trend_an
+00002510: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
+00002520: 6172 616d 730d 0a20 2020 2020 2020 2020  arams..         
+00002530: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
+00002540: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002550: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
+00002560: 616c 795f 6465 7465 6374 6f72 203d 204e  aly_detector = N
+00002570: 6f6e 650d 0a0d 0a20 2020 2064 6566 2062  one....    def b
+00002580: 6173 655f 7363 616c 6572 2873 656c 662c  ase_scaler(self,
+00002590: 2064 6629 3a0d 0a20 2020 2020 2020 2073   df):..        s
+000025a0: 656c 662e 7363 616c 6572 5f6d 6561 6e20  elf.scaler_mean 
+000025b0: 3d20 6e70 2e6d 6561 6e28 6466 2c20 6178  = np.mean(df, ax
+000025c0: 6973 3d30 290d 0a20 2020 2020 2020 2073  is=0)..        s
+000025d0: 656c 662e 7363 616c 6572 5f73 7464 203d  elf.scaler_std =
+000025e0: 206e 702e 7374 6428 6466 2c20 6178 6973   np.std(df, axis
+000025f0: 3d30 290d 0a20 2020 2020 2020 2072 6574  =0)..        ret
+00002600: 7572 6e20 2864 6620 2d20 7365 6c66 2e73  urn (df - self.s
+00002610: 6361 6c65 725f 6d65 616e 2920 2f20 7365  caler_mean) / se
+00002620: 6c66 2e73 6361 6c65 725f 7374 640d 0a0d  lf.scaler_std...
+00002630: 0a20 2020 2064 6566 2073 6361 6c65 5f64  .    def scale_d
+00002640: 6174 6128 7365 6c66 2c20 6466 293a 0d0a  ata(self, df):..
+00002650: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00002660: 7072 6570 726f 6365 7373 696e 675f 7472  preprocessing_tr
+00002670: 616e 7366 6f72 6d61 7469 6f6e 2069 7320  ansformation is 
+00002680: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00002690: 2020 2020 2020 2064 6620 3d20 7365 6c66         df = self
+000026a0: 2e70 7265 7072 6f63 6573 7365 722e 7472  .preprocesser.tr
+000026b0: 616e 7366 6f72 6d28 6466 2e63 6f70 7928  ansform(df.copy(
+000026c0: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
+000026d0: 656c 662e 7363 616c 696e 6720 6973 206e  elf.scaling is n
+000026e0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000026f0: 2020 2020 2020 6966 2073 656c 662e 7363        if self.sc
+00002700: 616c 696e 6720 3d3d 2022 4261 7365 5363  aling == "BaseSc
+00002710: 616c 6572 223a 0d0a 2020 2020 2020 2020  aler":..        
+00002720: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
+00002730: 662e 6261 7365 5f73 6361 6c65 7228 6466  f.base_scaler(df
+00002740: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00002750: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00002760: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
+00002770: 7363 616c 6572 2e74 7261 6e73 666f 726d  scaler.transform
+00002780: 2864 6629 0d0a 2020 2020 2020 2020 6966  (df)..        if
+00002790: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+000027a0: 6466 2c20 7064 2e44 6174 6146 7261 6d65  df, pd.DataFrame
+000027b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000027c0: 7265 7475 726e 2070 642e 4461 7461 4672  return pd.DataFr
+000027d0: 616d 6528 6466 2c20 636f 6c75 6d6e 733d  ame(df, columns=
+000027e0: 6466 2e63 6f6c 756d 6e73 2c20 696e 6465  df.columns, inde
+000027f0: 783d 6466 2e69 6e64 6578 290d 0a20 2020  x=df.index)..   
+00002800: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00002810: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00002820: 660d 0a0d 0a20 2020 2064 6566 2074 6f5f  f....    def to_
+00002830: 6f72 6967 696e 5f73 7061 6365 280d 0a20  origin_space(.. 
+00002840: 2020 2020 2020 2073 656c 662c 2064 662c         self, df,
+00002850: 2074 7261 6e73 5f6d 6574 686f 643d 2766   trans_method='f
+00002860: 6f72 6563 6173 7427 2c20 636f 6d70 6f6e  orecast', compon
+00002870: 656e 7473 3d46 616c 7365 2c20 626f 756e  ents=False, boun
+00002880: 6473 3d46 616c 7365 0d0a 2020 2020 293a  ds=False..    ):
+00002890: 0d0a 2020 2020 2020 2020 2222 2254 616b  ..        """Tak
+000028a0: 6520 7472 616e 7366 6f72 6d65 6420 6f75  e transformed ou
+000028b0: 7470 7574 7320 6261 636b 2074 6f20 6f72  tputs back to or
+000028c0: 6967 696e 616c 2066 6561 7475 7265 2073  iginal feature s
+000028d0: 7061 6365 2e22 2222 0d0a 2020 2020 2020  pace."""..      
+000028e0: 2020 6966 2073 656c 662e 7363 616c 696e    if self.scalin
+000028f0: 6720 3d3d 2022 4261 7365 5363 616c 6572  g == "BaseScaler
+00002900: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00002910: 2320 7265 7475 726e 2073 656c 662e 7072  # return self.pr
+00002920: 6570 726f 6365 7373 6572 2e69 6e76 6572  eprocesser.inver
+00002930: 7365 5f74 7261 6e73 666f 726d 2864 662c  se_transform(df,
+00002940: 2074 7261 6e73 5f6d 6574 686f 643d 7472   trans_method=tr
+00002950: 616e 735f 6d65 7468 6f64 2920 2a20 7365  ans_method) * se
+00002960: 6c66 2e73 6361 6c65 725f 7374 6420 2b20  lf.scaler_std + 
+00002970: 7365 6c66 2e73 6361 6c65 725f 6d65 616e  self.scaler_mean
+00002980: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00002990: 2063 6f6d 706f 6e65 6e74 733a 0d0a 2020   components:..  
+000029a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000029b0: 7475 726e 2073 656c 662e 7072 6570 726f  turn self.prepro
+000029c0: 6365 7373 6572 2e69 6e76 6572 7365 5f74  cesser.inverse_t
+000029d0: 7261 6e73 666f 726d 280d 0a20 2020 2020  ransform(..     
+000029e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000029f0: 6620 2a20 7365 6c66 2e73 6361 6c65 725f  f * self.scaler_
+00002a00: 7374 642c 2074 7261 6e73 5f6d 6574 686f  std, trans_metho
+00002a10: 643d 7472 616e 735f 6d65 7468 6f64 2c20  d=trans_method, 
+00002a20: 626f 756e 6473 3d62 6f75 6e64 730d 0a20  bounds=bounds.. 
+00002a30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00002a40: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00002a50: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002a60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002a70: 2e70 7265 7072 6f63 6573 7365 722e 696e  .preprocesser.in
+00002a80: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
+00002a90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002aa0: 2020 2020 2020 6466 202a 2073 656c 662e        df * self.
+00002ab0: 7363 616c 6572 5f73 7464 202b 2073 656c  scaler_std + sel
+00002ac0: 662e 7363 616c 6572 5f6d 6561 6e2c 0d0a  f.scaler_mean,..
+00002ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ae0: 2020 2020 7472 616e 735f 6d65 7468 6f64      trans_method
+00002af0: 3d74 7261 6e73 5f6d 6574 686f 642c 0d0a  =trans_method,..
+00002b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b10: 2020 2020 626f 756e 6473 3d62 6f75 6e64      bounds=bound
+00002b20: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00002b30: 2020 2020 290d 0a20 2020 2020 2020 2065      )..        e
+00002b40: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00002b50: 2020 2320 7265 7475 726e 2073 656c 662e    # return self.
+00002b60: 7363 616c 6572 2e69 6e76 6572 7365 5f74  scaler.inverse_t
+00002b70: 7261 6e73 666f 726d 2873 656c 662e 7072  ransform(self.pr
+00002b80: 6570 726f 6365 7373 6572 2e69 6e76 6572  eprocesser.inver
+00002b90: 7365 5f74 7261 6e73 666f 726d 2864 662c  se_transform(df,
+00002ba0: 2074 7261 6e73 5f6d 6574 686f 643d 7472   trans_method=tr
+00002bb0: 616e 735f 6d65 7468 6f64 292c 2074 7261  ans_method), tra
+00002bc0: 6e73 5f6d 6574 686f 643d 7472 616e 735f  ns_method=trans_
+00002bd0: 6d65 7468 6f64 290d 0a20 2020 2020 2020  method)..       
+00002be0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002bf0: 2e70 7265 7072 6f63 6573 7365 722e 696e  .preprocesser.in
+00002c00: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
+00002c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002c20: 2020 7365 6c66 2e73 6361 6c65 722e 696e    self.scaler.in
+00002c30: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
+00002c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002c50: 2020 2020 2020 6466 2c20 7472 616e 735f        df, trans_
+00002c60: 6d65 7468 6f64 3d74 7261 6e73 5f6d 6574  method=trans_met
+00002c70: 686f 642c 2062 6f75 6e64 733d 626f 756e  hod, bounds=boun
+00002c80: 6473 0d0a 2020 2020 2020 2020 2020 2020  ds..            
+00002c90: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+00002ca0: 2020 2020 2020 2020 7472 616e 735f 6d65          trans_me
+00002cb0: 7468 6f64 3d74 7261 6e73 5f6d 6574 686f  thod=trans_metho
+00002cc0: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+00002cd0: 2020 2020 626f 756e 6473 3d62 6f75 6e64      bounds=bound
+00002ce0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00002cf0: 290d 0a0d 0a20 2020 2064 6566 2063 7265  )....    def cre
+00002d00: 6174 655f 7428 7365 6c66 2c20 4454 696e  ate_t(self, DTin
+00002d10: 6465 7829 3a0d 0a20 2020 2020 2020 2072  dex):..        r
+00002d20: 6574 7572 6e20 2844 5469 6e64 6578 202d  eturn (DTindex -
+00002d30: 2073 656c 662e 6473 5f6d 696e 2920 2f20   self.ds_min) / 
+00002d40: 2873 656c 662e 6473 5f6d 6178 202d 2073  (self.ds_max - s
+00002d50: 656c 662e 6473 5f6d 696e 290d 0a0d 0a20  elf.ds_min).... 
+00002d60: 2020 2064 6566 2066 6974 280d 0a20 2020     def fit(..   
+00002d70: 2020 2020 2073 656c 662c 0d0a 2020 2020       self,..    
+00002d80: 2020 2020 6466 2c0d 0a20 2020 2020 2020      df,..       
+00002d90: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
+00002da0: 723d 4e6f 6e65 2c0d 0a20 2020 2020 2020  r=None,..       
+00002db0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
+00002dc0: 6572 6965 733d 4e6f 6e65 2c0d 0a20 2020  eries=None,..   
+00002dd0: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
+00002de0: 736f 7273 3d4e 6f6e 652c 0d0a 2020 2020  sors=None,..    
+00002df0: 2020 2020 6361 7465 676f 7269 6361 6c5f      categorical_
+00002e00: 6772 6f75 7073 3d4e 6f6e 652c 0d0a 2020  groups=None,..  
+00002e10: 2020 2020 2020 7061 7374 5f69 6d70 6163        past_impac
+00002e20: 7473 3d4e 6f6e 652c 0d0a 2020 2020 293a  ts=None,..    ):
+00002e30: 0d0a 2020 2020 2020 2020 2320 666c 6167  ..        # flag
+00002e40: 2072 6567 7265 7373 6f72 7320 6279 7061   regressors bypa
+00002e50: 7373 2070 7265 7072 6f63 6573 7369 6e67  ss preprocessing
+00002e60: 0d0a 2020 2020 2020 2020 2320 6964 6561  ..        # idea
+00002e70: 6c6c 7920 616c 6c6f 7720 626f 7468 2070  lly allow both p
+00002e80: 642e 4461 7461 4672 616d 6520 616e 6420  d.DataFrame and 
+00002e90: 6e70 2e61 7272 6179 2069 6e70 7574 7320  np.array inputs 
+00002ea0: 2869 6e64 6578 2066 6f72 2061 7272 6179  (index for array
+00002eb0: 3f0d 0a20 2020 2020 2020 2069 6620 7365  ?..        if se
+00002ec0: 6c66 2e63 6f6e 7374 7261 696e 7420 6973  lf.constraint is
+00002ed0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00002ee0: 2020 2020 2020 2020 7365 6c66 2e64 665f          self.df_
+00002ef0: 6f72 6967 696e 616c 203d 2064 660d 0a20  original = df.. 
+00002f00: 2020 2020 2020 2073 656c 662e 6466 203d         self.df =
+00002f10: 2064 662e 636f 7079 2829 0d0a 2020 2020   df.copy()..    
+00002f20: 2020 2020 7365 6c66 2e62 6173 6963 5f70      self.basic_p
+00002f30: 726f 6669 6c65 2873 656c 662e 6466 290d  rofile(self.df).
+00002f40: 0a20 2020 2020 2020 2023 2073 7461 6e64  .        # stand
+00002f50: 6172 6469 7a65 2067 726f 7570 696e 6773  ardize groupings
+00002f60: 2028 6578 7472 612f 6d69 7373 696e 6720   (extra/missing 
+00002f70: 6465 616c 7420 7769 7468 290d 0a20 2020  dealt with)..   
+00002f80: 2020 2020 2069 6620 6361 7465 676f 7269       if categori
+00002f90: 6361 6c5f 6772 6f75 7073 2069 7320 4e6f  cal_groups is No
+00002fa0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00002fb0: 2063 6174 6567 6f72 6963 616c 5f67 726f   categorical_gro
+00002fc0: 7570 7320 3d20 7b7d 0d0a 2020 2020 2020  ups = {}..      
+00002fd0: 2020 7365 6c66 2e63 6174 6567 6f72 6963    self.categoric
+00002fe0: 616c 5f67 726f 7570 7320 3d20 7b0d 0a20  al_groups = {.. 
+00002ff0: 2020 2020 2020 2020 2020 2063 6f6c 3a20             col: 
+00003000: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00003010: 2020 2063 6174 6567 6f72 6963 616c 5f67     categorical_g
+00003020: 726f 7570 735b 636f 6c5d 2069 6620 636f  roups[col] if co
+00003030: 6c20 696e 2063 6174 6567 6f72 6963 616c  l in categorical
+00003040: 5f67 726f 7570 732e 6b65 7973 2829 2065  _groups.keys() e
+00003050: 6c73 6520 226f 7468 6572 220d 0a20 2020  lse "other"..   
+00003060: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00003070: 2020 2020 2020 2020 666f 7220 636f 6c20          for col 
+00003080: 696e 2064 662e 636f 6c75 6d6e 730d 0a20  in df.columns.. 
+00003090: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
+000030a0: 2020 7365 6c66 2e70 6173 745f 696d 7061    self.past_impa
+000030b0: 6374 7320 3d20 7061 7374 5f69 6d70 6163  cts = past_impac
+000030c0: 7473 0d0a 2020 2020 2020 2020 2320 6966  ts..        # if
+000030d0: 2070 6173 7420 696d 7061 6374 7320 6769   past impacts gi
+000030e0: 7665 6e2c 2061 7373 756d 6520 7265 6d6f  ven, assume remo
+000030f0: 7661 6c20 756e 6c65 7373 206f 7468 6572  val unless other
+00003100: 7769 7365 2073 7065 6369 6669 6564 0d0a  wise specified..
+00003110: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003120: 7061 7374 5f69 6d70 6163 7473 5f69 6e74  past_impacts_int
+00003130: 6572 7665 6e74 696f 6e20 6973 204e 6f6e  ervention is Non
+00003140: 6520 616e 6420 7061 7374 5f69 6d70 6163  e and past_impac
+00003150: 7473 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ts is not None:.
+00003160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003170: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
+00003180: 6e74 6572 7665 6e74 696f 6e20 3d20 2272  ntervention = "r
+00003190: 656d 6f76 6522 0d0a 2020 2020 2020 2020  emove"..        
+000031a0: 656c 6966 2070 6173 745f 696d 7061 6374  elif past_impact
+000031b0: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
+000031c0: 2020 2020 2020 2020 7365 6c66 2e70 6173          self.pas
+000031d0: 745f 696d 7061 6374 735f 696e 7465 7276  t_impacts_interv
+000031e0: 656e 7469 6f6e 203d 204e 6f6e 650d 0a20  ention = None.. 
+000031f0: 2020 2020 2020 2069 6620 7265 6772 6573         if regres
+00003200: 736f 725f 7065 725f 7365 7269 6573 2069  sor_per_series i
+00003210: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00003220: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00003230: 6772 5f70 6572 5f73 6572 6965 735f 7472  gr_per_series_tr
+00003240: 203d 2072 6567 7265 7373 6f72 5f70 6572   = regressor_per
+00003250: 5f73 6572 6965 730d 0a0d 0a20 2020 2020  _series....     
+00003260: 2020 2023 2077 6861 7420 6665 6174 7572     # what featur
+00003270: 6573 2077 696c 6c20 7265 7175 6972 6520  es will require 
+00003280: 7365 7061 7261 7465 206d 6f64 656c 7320  separate models 
+00003290: 746f 2062 6520 6669 7420 6173 2058 2077  to be fit as X w
+000032a0: 696c 6c20 6e6f 7420 6265 2063 6f6e 7369  ill not be consi
+000032b0: 7374 656e 7420 666f 7220 616c 6c0d 0a20  stent for all.. 
+000032c0: 2020 2020 2020 2023 2057 6861 7420 7472         # What tr
+000032d0: 6967 6765 7273 206c 6f6f 703a 0d0a 2020  iggers loop:..  
+000032e0: 2020 2020 2020 2320 4152 204c 6167 730d        # AR Lags.
+000032f0: 0a20 2020 2020 2020 2023 2048 6f6c 6964  .        # Holid
+00003300: 6179 2063 6f75 6e74 7269 6573 2061 7320  ay countries as 
+00003310: 6469 6374 2028 6e6f 7420 6c69 7374 290d  dict (not list).
+00003320: 0a20 2020 2020 2020 2023 2072 6567 7265  .        # regre
+00003330: 7373 6f72 5f70 6572 5f73 6572 6965 7320  ssor_per_series 
+00003340: 286f 6e6c 7920 6966 2072 6567 7265 7373  (only if regress
+00003350: 6f72 2075 7365 6429 0d0a 2020 2020 2020  or used)..      
+00003360: 2020 2320 4d75 6c74 6976 6172 6961 7465    # Multivariate
+00003370: 2048 6f6c 6964 6179 2044 6574 6563 746f   Holiday Detecto
+00003380: 722c 206f 6e6c 7920 6966 2063 7265 6174  r, only if creat
+00003390: 6520 6665 6174 7572 652c 206e 6f74 2072  e feature, not r
+000033a0: 656d 6f76 616c 2028 706c 6f74 2069 6e20  emoval (plot in 
+000033b0: 7468 6973 2063 6173 6529 0d0a 2020 2020  this case)..    
+000033c0: 2020 2020 2320 4d75 6c74 6976 6172 6961      # Multivaria
+000033d0: 7465 2041 6e6f 6d61 6c79 2044 6574 6563  te Anomaly Detec
+000033e0: 746f 722c 206f 6e6c 7920 6966 2063 7265  tor, only if cre
+000033f0: 6174 6520 6665 6174 7572 652c 206e 6f74  ate feature, not
+00003400: 2072 656d 6f76 616c 0d0a 2020 2020 2020   removal..      
+00003410: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00003420: 7365 6c66 2e61 6e6f 6d61 6c79 5f64 6574  self.anomaly_det
+00003430: 6563 746f 725f 7061 7261 6d73 2c20 6469  ector_params, di
+00003440: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+00003450: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f6e    self.anomaly_n
+00003460: 6f74 5f75 6e69 203d 2028 0d0a 2020 2020  ot_uni = (..    
+00003470: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003480: 2e61 6e6f 6d61 6c79 5f64 6574 6563 746f  .anomaly_detecto
+00003490: 725f 7061 7261 6d73 2e67 6574 2827 6f75  r_params.get('ou
+000034a0: 7470 7574 272c 204e 6f6e 6529 2021 3d20  tput', None) != 
+000034b0: 2775 6e69 7661 7269 6174 6527 0d0a 2020  'univariate'..  
+000034c0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+000034d0: 2020 2020 2073 656c 662e 616e 6f6d 616c       self.anomal
+000034e0: 795f 6e6f 745f 756e 6920 3d20 4661 6c73  y_not_uni = Fals
+000034f0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00003500: 6c6f 6f70 5f72 6571 7569 7265 6420 3d20  loop_required = 
+00003510: 280d 0a20 2020 2020 2020 2020 2020 2028  (..            (
+00003520: 7365 6c66 2e61 725f 6c61 6773 2069 7320  self.ar_lags is 
+00003530: 6e6f 7420 4e6f 6e65 290d 0a20 2020 2020  not None)..     
+00003540: 2020 2020 2020 206f 7220 2829 0d0a 2020         or ()..  
+00003550: 2020 2020 2020 2020 2020 6f72 2028 0d0a            or (..
+00003560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003570: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+00003580: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
+00003590: 732c 2064 6963 7429 2061 6e64 2073 656c  s, dict) and sel
+000035a0: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
+000035b0: 6965 735f 7573 6564 0d0a 2020 2020 2020  ies_used..      
+000035c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000035d0: 2020 2020 206f 7220 2828 7265 6772 6573       or ((regres
+000035e0: 736f 725f 7065 725f 7365 7269 6573 2069  sor_per_series i
+000035f0: 7320 6e6f 7420 4e6f 6e65 2920 616e 6420  s not None) and 
+00003600: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
+00003610: 7573 6564 290d 0a20 2020 2020 2020 2020  used)..         
+00003620: 2020 206f 7220 2869 7369 6e73 7461 6e63     or (isinstanc
+00003630: 6528 7365 6c66 2e61 6e6f 6d61 6c79 5f69  e(self.anomaly_i
+00003640: 6e74 6572 7665 6e74 696f 6e2c 2064 6963  ntervention, dic
+00003650: 7429 2061 6e64 2073 656c 662e 616e 6f6d  t) and self.anom
+00003660: 616c 795f 6e6f 745f 756e 6929 0d0a 2020  aly_not_uni)..  
+00003670: 2020 2020 2020 2020 2020 6f72 2028 0d0a            or (..
+00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003690: 7365 6c66 2e70 6173 745f 696d 7061 6374  self.past_impact
+000036a0: 735f 696e 7465 7276 656e 7469 6f6e 203d  s_intervention =
+000036b0: 3d20 2272 6567 7265 7373 6f72 220d 0a20  = "regressor".. 
+000036c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000036d0: 6e64 2070 6173 745f 696d 7061 6374 7320  nd past_impacts 
+000036e0: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
+000036f0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00003700: 2020 2020 290d 0a20 2020 2020 2020 2023      )..        #
+00003710: 2063 6865 636b 2069 6620 726f 6c6c 696e   check if rollin
+00003720: 6720 7072 6564 6963 7469 6f6e 2069 7320  g prediction is 
+00003730: 7265 7175 6972 6564 0d0a 2020 2020 2020  required..      
+00003740: 2020 7365 6c66 2e70 7265 6469 6374 5f6c    self.predict_l
+00003750: 6f6f 705f 7265 7120 3d20 2873 656c 662e  oop_req = (self.
+00003760: 6172 5f6c 6167 7320 6973 206e 6f74 204e  ar_lags is not N
+00003770: 6f6e 6529 206f 7220 280d 0a20 2020 2020  one) or (..     
+00003780: 2020 2020 2020 2073 656c 662e 6d75 6c74         self.mult
+00003790: 6976 6172 6961 7465 5f66 6561 7475 7265  ivariate_feature
+000037a0: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+000037b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000037c0: 2023 2063 6865 636b 2069 6620 636f 6d70   # check if comp
+000037d0: 6f6e 656e 7420 7072 6f63 6573 7369 6e67  onent processing
+000037e0: 206d 7573 7420 6c6f 6f70 0d0a 2020 2020   must loop..    
+000037f0: 2020 2020 2320 7365 6c66 2e63 6f6d 706f      # self.compo
+00003800: 6e65 6e74 5f6c 6f6f 705f 7265 7120 3d20  nent_loop_req = 
+00003810: 2869 7369 6e73 7461 6e63 6528 7265 6772  (isinstance(regr
+00003820: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
+00003830: 2c20 6469 6374 2920 616e 6420 7365 6c66  , dict) and self
+00003840: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
+00003850: 2920 6f72 2028 6973 696e 7374 616e 6365  ) or (isinstance
+00003860: 2873 656c 662e 686f 6c69 6461 795f 636f  (self.holiday_co
+00003870: 756e 7472 6965 732c 2064 6963 7429 2061  untries, dict) a
+00003880: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
+00003890: 636f 756e 7472 6965 735f 7573 6564 290d  countries_used).
+000038a0: 0a0d 0a20 2020 2020 2020 2023 2052 454d  ...        # REM
+000038b0: 4f56 4520 4e61 4e20 6275 7420 6f6e 6c79  OVE NaN but only
+000038c0: 2074 6869 7320 736f 2066 6172 2c20 666f   this so far, fo
+000038d0: 7220 686f 6c69 6461 7920 616e 6420 616e  r holiday and an
+000038e0: 6f6d 616c 7920 6465 7465 6374 696f 6e0d  omaly detection.
+000038f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00003900: 2e70 7265 7072 6f63 6573 7369 6e67 5f74  .preprocessing_t
+00003910: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+00003920: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00003930: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+00003940: 7072 6f63 6573 7365 7220 3d20 4765 6e65  processer = Gene
+00003950: 7261 6c54 7261 6e73 666f 726d 6572 280d  ralTransformer(.
+00003960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003970: 202a 2a7b 2766 696c 6c6e 6127 3a20 7365   **{'fillna': se
+00003980: 6c66 2e70 7265 7072 6f63 6573 7369 6e67  lf.preprocessing
+00003990: 5f74 7261 6e73 666f 726d 6174 696f 6e2e  _transformation.
+000039a0: 6765 7428 2766 696c 6c6e 6127 2c20 2266  get('fillna', "f
+000039b0: 6669 6c6c 2229 7d0d 0a20 2020 2020 2020  fill")}..       
+000039c0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000039d0: 2020 2020 7365 6c66 2e64 6620 3d20 7365      self.df = se
+000039e0: 6c66 2e70 7265 7072 6f63 6573 7365 722e  lf.preprocesser.
+000039f0: 6669 745f 7472 616e 7366 6f72 6d28 7365  fit_transform(se
+00003a00: 6c66 2e64 6629 0d0a 0d0a 2020 2020 2020  lf.df)....      
+00003a10: 2020 2320 7265 6d6f 7665 2070 6173 7420    # remove past 
+00003a20: 696d 7061 6374 7320 746f 2066 696e 6420  impacts to find 
+00003a30: 226f 7267 616e 6963 220d 0a20 2020 2020  "organic"..     
+00003a40: 2020 2069 6620 7365 6c66 2e70 6173 745f     if self.past_
+00003a50: 696d 7061 6374 735f 696e 7465 7276 656e  impacts_interven
+00003a60: 7469 6f6e 203d 3d20 2272 656d 6f76 6522  tion == "remove"
+00003a70: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00003a80: 656c 662e 6466 203d 2073 656c 662e 6466  elf.df = self.df
+00003a90: 202f 2028 3120 2b20 7061 7374 5f69 6d70   / (1 + past_imp
+00003aa0: 6163 7473 2920 2023 2077 6f75 6c64 204d  acts)  # would M
+00003ab0: 494e 5553 2062 6520 6265 7474 6572 3f0d  INUS be better?.
+00003ac0: 0a20 2020 2020 2020 2023 2068 6f6c 6964  .        # holid
+00003ad0: 6179 2064 6574 6563 7469 6f6e 2066 6972  ay detection fir
+00003ae0: 7374 2c20 646f 6e27 7420 7761 6e74 2061  st, don't want a
+00003af0: 6e79 2061 6e6f 6d61 6c69 6573 2072 656d  ny anomalies rem
+00003b00: 6f76 6564 2079 6574 2c20 616e 6420 6861  oved yet, and ha
+00003b10: 7320 6f77 6e20 7072 6570 726f 6365 7373  s own preprocess
+00003b20: 696e 670d 0a20 2020 2020 2020 2069 6620  ing..        if 
+00003b30: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
+00003b40: 6563 746f 725f 7061 7261 6d73 2069 7320  ector_params is 
+00003b50: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00003b60: 2020 2020 2020 2073 656c 662e 686f 6c69         self.holi
+00003b70: 6461 795f 6465 7465 6374 6f72 203d 2048  day_detector = H
+00003b80: 6f6c 6964 6179 5472 616e 7366 6f72 6d65  olidayTransforme
+00003b90: 7228 2a2a 7365 6c66 2e68 6f6c 6964 6179  r(**self.holiday
+00003ba0: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00003bb0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00003bc0: 656c 662e 686f 6c69 6461 795f 6465 7465  elf.holiday_dete
+00003bd0: 6374 6f72 2e66 6974 2873 656c 662e 6466  ctor.fit(self.df
+00003be0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00003bf0: 656c 662e 686f 6c69 6461 7973 203d 2073  elf.holidays = s
+00003c00: 656c 662e 686f 6c69 6461 795f 6465 7465  elf.holiday_dete
+00003c10: 6374 6f72 2e64 6174 6573 5f74 6f5f 686f  ctor.dates_to_ho
+00003c20: 6c69 6461 7973 280d 0a20 2020 2020 2020  lidays(..       
+00003c30: 2020 2020 2020 2020 2073 656c 662e 6466           self.df
+00003c40: 2e69 6e64 6578 2c20 7374 796c 653d 2773  .index, style='s
+00003c50: 6572 6965 735f 666c 6167 270d 0a20 2020  eries_flag'..   
+00003c60: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00003c70: 2020 2020 2020 2020 7365 6c66 2e68 6f6c          self.hol
+00003c80: 6964 6179 5f63 6f75 6e74 203d 206e 702e  iday_count = np.
+00003c90: 636f 756e 745f 6e6f 6e7a 6572 6f28 7365  count_nonzero(se
+00003ca0: 6c66 2e68 6f6c 6964 6179 7329 0d0a 2020  lf.holidays)..  
+00003cb0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00003cc0: 662e 686f 6c69 6461 795f 6465 7465 6374  f.holiday_detect
+00003cd0: 6f72 5f70 6172 616d 735b 2272 656d 6f76  or_params["remov
+00003ce0: 655f 6578 6365 7373 5f61 6e6f 6d61 6c69  e_excess_anomali
+00003cf0: 6573 225d 3a0d 0a20 2020 2020 2020 2020  es"]:..         
+00003d00: 2020 2020 2020 2073 656c 662e 6466 203d         self.df =
+00003d10: 2073 656c 662e 6466 5b0d 0a20 2020 2020   self.df[..     
+00003d20: 2020 2020 2020 2020 2020 2020 2020 207e                 ~
+00003d30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00003d40: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
+00003d50: 2e68 6f6c 6964 6179 5f64 6574 6563 746f  .holiday_detecto
+00003d60: 722e 616e 6f6d 616c 795f 6d6f 6465 6c2e  r.anomaly_model.
+00003d70: 616e 6f6d 616c 6965 7320 3d3d 202d 3129  anomalies == -1)
+00003d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003d90: 2020 2020 2020 2020 2020 2620 2873 656c            & (sel
+00003da0: 662e 686f 6c69 6461 7973 2021 3d20 3129  f.holidays != 1)
+00003db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003dc0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00003dd0: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
+00003de0: 2020 2020 2320 6669 6e64 2061 6e6f 6d61      # find anoma
+00003df0: 6c69 6573 2c20 616e 6420 6569 7468 6572  lies, and either
+00003e00: 2072 656d 6f76 6520 6f72 2073 6574 7570   remove or setup
+00003e10: 2066 6f72 206d 6f64 656c 696e 6720 7468   for modeling th
+00003e20: 6520 616e 6f6d 616c 7920 7363 6f72 6573  e anomaly scores
+00003e30: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00003e40: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+00003e50: 6f72 5f70 6172 616d 7320 6973 206e 6f74  or_params is not
+00003e60: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00003e70: 2020 2020 7365 6c66 2e61 6e6f 6d61 6c79      self.anomaly
+00003e80: 5f64 6574 6563 746f 7220 3d20 416e 6f6d  _detector = Anom
+00003e90: 616c 7952 656d 6f76 616c 282a 2a73 656c  alyRemoval(**sel
+00003ea0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+00003eb0: 6f72 5f70 6172 616d 7329 2e66 6974 280d  or_params).fit(.
+00003ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003ed0: 2073 656c 662e 6466 0d0a 2020 2020 2020   self.df..      
+00003ee0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00003ef0: 2020 2020 2023 2052 454d 4f56 4520 484f       # REMOVE HO
+00003f00: 4c49 4441 5953 2066 726f 6d20 616e 6f6d  LIDAYS from anom
+00003f10: 616c 6965 732c 2061 7320 7468 6579 206d  alies, as they m
+00003f20: 6179 206c 6f6f 6b20 6c69 6b65 2061 6e6f  ay look like ano
+00003f30: 6d61 6c69 6573 2062 7574 2061 7265 2064  malies but are d
+00003f40: 6561 6c74 2077 6974 6820 6279 2068 6f6c  ealt with by hol
+00003f50: 6964 6179 730d 0a20 2020 2020 2020 2020  idays..         
+00003f60: 2020 2023 2074 6869 732c 2068 6f77 6576     # this, howev
+00003f70: 6572 2c20 646f 6573 206e 6f74 6869 6e67  er, does nothing
+00003f80: 2074 6f20 7072 6573 6572 7665 2063 6f75   to preserve cou
+00003f90: 6e74 7279 2068 6f6c 6964 6179 730d 0a20  ntry holidays.. 
+00003fa0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00003fb0: 6c66 2e68 6f6c 6964 6179 5f64 6574 6563  lf.holiday_detec
+00003fc0: 746f 725f 7061 7261 6d73 2069 7320 6e6f  tor_params is no
+00003fd0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00003fe0: 2020 2020 2020 2020 2068 6f6c 5f66 696c           hol_fil
+00003ff0: 7420 3d20 2873 656c 662e 686f 6c69 6461  t = (self.holida
+00004000: 7973 203d 3d20 3129 2026 2028 0d0a 2020  ys == 1) & (..  
 00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004020: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004030: 2020 2073 656c 662e 616e 6f6d 616c 795f     self.anomaly_
-00004040: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
-00004050: 6573 5b68 6f6c 5f66 696c 745d 203d 2031  es[hol_filt] = 1
-00004060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004070: 2020 2320 6173 7375 6d65 206d 6f73 7420    # assume most 
-00004080: 6172 6520 6e6f 7420 616e 6f6d 616c 6965  are not anomalie
-00004090: 7320 736f 206d 6564 6961 6e20 6973 206e  s so median is n
-000040a0: 6f74 2061 6e6f 6d0d 0a20 2020 2020 2020  ot anom..       
-000040b0: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
-000040c0: 6f6d 616c 795f 6465 7465 6374 6f72 2e73  omaly_detector.s
-000040d0: 636f 7265 735b 686f 6c5f 6669 6c74 5d20  cores[hol_filt] 
-000040e0: 3d20 6e70 2e6d 6564 6961 6e28 0d0a 2020  = np.median(..  
-000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004100: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f64    self.anomaly_d
-00004110: 6574 6563 746f 722e 7363 6f72 6573 0d0a  etector.scores..
-00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004130: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00004140: 6620 7365 6c66 2e61 6e6f 6d61 6c79 5f69  f self.anomaly_i
-00004150: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
-00004160: 7265 6d6f 7665 223a 0d0a 2020 2020 2020  remove":..      
-00004170: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00004180: 6620 3d20 7365 6c66 2e61 6e6f 6d61 6c79  f = self.anomaly
-00004190: 5f64 6574 6563 746f 722e 7472 616e 7366  _detector.transf
-000041a0: 6f72 6d28 7365 6c66 2e64 6629 0d0a 2020  orm(self.df)..  
-000041b0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-000041c0: 7369 6e73 7461 6e63 6528 7365 6c66 2e61  sinstance(self.a
-000041d0: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
-000041e0: 696f 6e2c 2064 6963 7429 3a0d 0a20 2020  ion, dict):..   
-000041f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00004200: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
-00004210: 6f72 2e66 6974 5f61 6e6f 6d61 6c79 5f63  or.fit_anomaly_c
-00004220: 6c61 7373 6966 6965 7228 290d 0a20 2020  lassifier()..   
-00004230: 2020 2020 2020 2020 2023 2064 6574 6563           # detec
-00004240: 745f 6f6e 6c79 203d 2070 6173 730d 0a20  t_only = pass.. 
-00004250: 2020 2020 2020 2023 206e 6f77 2064 6f20         # now do 
-00004260: 7374 616e 6461 7264 2070 7265 7072 6f63  standard preproc
-00004270: 6573 7369 6e67 0d0a 2020 2020 2020 2020  essing..        
-00004280: 6966 2073 656c 662e 7072 6570 726f 6365  if self.preproce
-00004290: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
-000042a0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
-000042b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000042c0: 656c 662e 7072 6570 726f 6365 7373 6572  elf.preprocesser
-000042d0: 203d 2047 656e 6572 616c 5472 616e 7366   = GeneralTransf
-000042e0: 6f72 6d65 7228 2a2a 7365 6c66 2e70 7265  ormer(**self.pre
-000042f0: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
-00004300: 666f 726d 6174 696f 6e29 0d0a 2020 2020  formation)..    
-00004310: 2020 2020 2020 2020 7365 6c66 2e64 6620          self.df 
-00004320: 3d20 7365 6c66 2e70 7265 7072 6f63 6573  = self.preproces
-00004330: 7365 722e 6669 745f 7472 616e 7366 6f72  ser.fit_transfor
-00004340: 6d28 7365 6c66 2e64 6629 0d0a 2020 2020  m(self.df)..    
-00004350: 2020 2020 6966 2073 656c 662e 7363 616c      if self.scal
-00004360: 696e 6720 6973 206e 6f74 204e 6f6e 653a  ing is not None:
-00004370: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00004380: 2073 656c 662e 7363 616c 696e 6720 3d3d   self.scaling ==
-00004390: 2022 4261 7365 5363 616c 6572 223a 0d0a   "BaseScaler":..
-000043a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043b0: 7365 6c66 2e64 6620 3d20 7365 6c66 2e62  self.df = self.b
-000043c0: 6173 655f 7363 616c 6572 2873 656c 662e  ase_scaler(self.
-000043d0: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
-000043e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000043f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004400: 7363 616c 696e 6720 6973 204e 6f6e 653a  scaling is None:
-00004410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004420: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00004430: 6545 7272 6f72 2822 7363 616c 696e 6720  eError("scaling 
-00004440: 6d75 7374 206e 6f74 2062 6520 4e6f 6e65  must not be None
-00004450: 2e20 5472 7920 2742 6173 6553 6361 6c65  . Try 'BaseScale
-00004460: 7227 2229 0d0a 2020 2020 2020 2020 2020  r'")..          
-00004470: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
-00004480: 7220 3d20 4765 6e65 7261 6c54 7261 6e73  r = GeneralTrans
-00004490: 666f 726d 6572 282a 2a73 656c 662e 7363  former(**self.sc
-000044a0: 616c 696e 6729 0d0a 2020 2020 2020 2020  aling)..        
-000044b0: 2020 2020 2020 2020 7365 6c66 2e64 6620          self.df 
-000044c0: 3d20 7365 6c66 2e73 6361 6c65 722e 6669  = self.scaler.fi
-000044d0: 745f 7472 616e 7366 6f72 6d28 7365 6c66  t_transform(self
-000044e0: 2e64 6629 0d0a 2020 2020 2020 2020 2320  .df)..        # 
-000044f0: 6164 6469 7469 6f6e 616c 2074 7261 6e73  additional trans
-00004500: 666f 726d 7320 6265 666f 7265 206d 756c  forms before mul
-00004510: 7469 7661 7269 6174 6520 6665 6174 7572  tivariate featur
-00004520: 6520 6372 6561 7469 6f6e 0d0a 2020 2020  e creation..    
-00004530: 2020 2020 6966 2073 656c 662e 6d75 6c74      if self.mult
-00004540: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
-00004550: 726d 6174 696f 6e20 6973 206e 6f74 204e  rmation is not N
-00004560: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00004570: 2020 7365 6c66 2e6d 756c 7469 7661 7269    self.multivari
-00004580: 6174 655f 7472 616e 7366 6f72 6d65 7220  ate_transformer 
-00004590: 3d20 4765 6e65 7261 6c54 7261 6e73 666f  = GeneralTransfo
-000045a0: 726d 6572 280d 0a20 2020 2020 2020 2020  rmer(..         
-000045b0: 2020 2020 2020 202a 2a73 656c 662e 6d75         **self.mu
-000045c0: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
-000045d0: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
-000045e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000045f0: 2020 2320 6e65 6564 7320 746f 2063 6f6d    # needs to com
-00004600: 6520 6166 7465 7220 7072 6570 726f 6365  e after preproce
-00004610: 7373 696e 6720 6265 6361 7573 6520 6f66  ssing because of
-00004620: 2027 736c 6963 6527 2074 7261 6e73 666f   'slice' transfo
-00004630: 726d 6572 0d0a 2020 2020 2020 2020 7365  rmer..        se
-00004640: 6c66 2e64 735f 6d69 6e20 3d20 7365 6c66  lf.ds_min = self
-00004650: 2e64 662e 696e 6465 782e 6d69 6e28 290d  .df.index.min().
-00004660: 0a20 2020 2020 2020 2073 656c 662e 6473  .        self.ds
-00004670: 5f6d 6178 203d 2073 656c 662e 6466 2e69  _max = self.df.i
-00004680: 6e64 6578 2e6d 6178 2829 0d0a 2020 2020  ndex.max()..    
-00004690: 2020 2020 7365 6c66 2e74 5f74 7261 696e      self.t_train
-000046a0: 203d 2073 656c 662e 6372 6561 7465 5f74   = self.create_t
-000046b0: 2873 656c 662e 6466 2e69 6e64 6578 290d  (self.df.index).
-000046c0: 0a20 2020 2020 2020 2073 656c 662e 6869  .        self.hi
-000046d0: 7374 6f72 795f 6461 7973 203d 2028 7365  story_days = (se
-000046e0: 6c66 2e64 735f 6d61 7820 2d20 7365 6c66  lf.ds_max - self
-000046f0: 2e64 735f 6d69 6e29 2e64 6179 730d 0a0d  .ds_min).days...
-00004700: 0a20 2020 2020 2020 2023 2042 4547 494e  .        # BEGIN
-00004710: 2043 4f4e 5354 5255 4354 494f 4e20 4f46   CONSTRUCTION OF
-00004720: 2058 2041 5252 4159 0d0a 2020 2020 2020   X ARRAY..      
-00004730: 2020 785f 6c69 7374 203d 205b 5d0d 0a20    x_list = [].. 
-00004740: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00004750: 616e 6365 2873 656c 662e 616e 6f6d 616c  ance(self.anomal
-00004760: 795f 696e 7465 7276 656e 7469 6f6e 2c20  y_intervention, 
-00004770: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-00004780: 2020 2020 2320 6e65 6564 2074 6f20 6d6f      # need to mo
-00004790: 6465 6c20 7468 6573 6520 666f 7220 7072  del these for pr
-000047a0: 6564 6963 7469 6f6e 0d0a 2020 2020 2020  ediction..      
-000047b0: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
-000047c0: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-000047d0: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
-000047e0: 6c79 5f64 6574 6563 746f 722e 7363 6f72  ly_detector.scor
-000047f0: 6573 2e72 656e 616d 6528 0d0a 2020 2020  es.rename(..    
-00004800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004810: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
-00004820: 3a20 2261 6e6f 6d61 6c79 7363 6f72 6573  : "anomalyscores
-00004830: 5f22 202b 2073 7472 2878 290d 0a20 2020  _" + str(x)..   
-00004840: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00004850: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00004860: 2020 2020 2020 2023 2061 6c6c 206f 6620         # all of 
-00004870: 7468 6520 666f 6c6c 6f77 696e 6720 6172  the following ar
-00004880: 6520 3120 6461 7920 7061 7374 206c 6167  e 1 day past lag
-00004890: 6765 640d 0a20 2020 2020 2020 2069 6620  ged..        if 
-000048a0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
-000048b0: 655f 6665 6174 7572 6520 6973 206e 6f74  e_feature is not
-000048c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000048d0: 2020 2020 2320 696e 636c 7564 6573 2062      # includes b
-000048e0: 6163 6b66 696c 6c0d 0a20 2020 2020 2020  ackfill..       
-000048f0: 2020 2020 206c 6167 5f31 5f69 6e64 7820       lag_1_indx 
-00004900: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
-00004910: 285b 5b30 5d2c 206e 702e 6172 616e 6765  ([[0], np.arange
-00004920: 286c 656e 2873 656c 662e 6466 2929 5d29  (len(self.df))])
-00004930: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-00004940: 2020 2030 203a 206c 656e 2873 656c 662e     0 : len(self.
-00004950: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
-00004960: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
-00004970: 6966 2073 656c 662e 6d75 6c74 6976 6172  if self.multivar
-00004980: 6961 7465 5f74 7261 6e73 666f 726d 6174  iate_transformat
-00004990: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-000049a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000049b0: 2020 7472 735f 6466 203d 2073 656c 662e    trs_df = self.
-000049c0: 6d75 6c74 6976 6172 6961 7465 5f74 7261  multivariate_tra
-000049d0: 6e73 666f 726d 6572 2e66 6974 5f74 7261  nsformer.fit_tra
-000049e0: 6e73 666f 726d 2873 656c 662e 6466 290d  nsform(self.df).
-000049f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004a00: 2069 6620 7472 735f 6466 2e73 6861 7065   if trs_df.shape
-00004a10: 2021 3d20 7365 6c66 2e64 662e 7368 6170   != self.df.shap
-00004a20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00004a30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00004a40: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
-00004a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a60: 2020 2022 4d75 6c74 6976 6172 6961 7465     "Multivariate
-00004a70: 2054 7261 6e73 666f 726d 6572 206e 6f74   Transformer not
-00004a80: 2075 7361 626c 6520 666f 7220 7468 6973   usable for this
-00004a90: 2072 6f6c 652e 220d 0a20 2020 2020 2020   role."..       
-00004aa0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00004ab0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00004ac0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004ad0: 2020 2074 7273 5f64 6620 3d20 7365 6c66     trs_df = self
-00004ae0: 2e64 662e 636f 7079 2829 0d0a 2020 2020  .df.copy()..    
-00004af0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004b00: 6d75 6c74 6976 6172 6961 7465 5f66 6561  multivariate_fea
-00004b10: 7475 7265 203d 3d20 2266 6561 7475 7265  ture == "feature
-00004b20: 5f61 6767 6c6f 6d65 7261 7469 6f6e 223a  _agglomeration":
-00004b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004b40: 2020 6672 6f6d 2073 6b6c 6561 726e 2e63    from sklearn.c
-00004b50: 6c75 7374 6572 2069 6d70 6f72 7420 4665  luster import Fe
-00004b60: 6174 7572 6541 6767 6c6f 6d65 7261 7469  atureAgglomerati
-00004b70: 6f6e 0d0a 0d0a 2020 2020 2020 2020 2020  on....          
-00004b80: 2020 2020 2020 7365 6c66 2e61 6767 6c6f        self.agglo
-00004b90: 6d5f 6e5f 636c 7573 7465 7273 203d 2035  m_n_clusters = 5
-00004ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004bb0: 2020 7365 6c66 2e61 6767 6c6f 6d65 7261    self.agglomera
-00004bc0: 746f 7220 3d20 4665 6174 7572 6541 6767  tor = FeatureAgg
-00004bd0: 6c6f 6d65 7261 7469 6f6e 280d 0a20 2020  lomeration(..   
-00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bf0: 206e 5f63 6c75 7374 6572 733d 7365 6c66   n_clusters=self
-00004c00: 2e61 6767 6c6f 6d5f 6e5f 636c 7573 7465  .agglom_n_cluste
-00004c10: 7273 0d0a 2020 2020 2020 2020 2020 2020  rs..            
-00004c20: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00004c30: 2020 2020 2020 2078 5f6c 6973 742e 6170         x_list.ap
-00004c40: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00004c50: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
-00004c60: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
-00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c80: 2020 7365 6c66 2e61 6767 6c6f 6d65 7261    self.agglomera
-00004c90: 746f 722e 6669 745f 7472 616e 7366 6f72  tor.fit_transfor
-00004ca0: 6d28 7472 735f 6466 295b 6c61 675f 315f  m(trs_df)[lag_1_
-00004cb0: 696e 6478 5d2c 0d0a 2020 2020 2020 2020  indx],..        
-00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cd0: 696e 6465 783d 7365 6c66 2e64 662e 696e  index=self.df.in
-00004ce0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-00004cf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00004d00: 6c75 6d6e 733d 5b0d 0a20 2020 2020 2020  lumns=[..       
-00004d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d20: 2020 2020 2022 6d75 6c74 6976 6172 5f22       "multivar_"
-00004d30: 202b 2073 7472 2878 2920 666f 7220 7820   + str(x) for x 
-00004d40: 696e 2072 616e 6765 2873 656c 662e 6167  in range(self.ag
-00004d50: 676c 6f6d 5f6e 5f63 6c75 7374 6572 7329  glom_n_clusters)
-00004d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004d70: 2020 2020 2020 2020 2020 5d2c 0d0a 2020            ],..  
-00004d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d90: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00004da0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00004db0: 2020 2020 656c 6966 2073 656c 662e 6d75      elif self.mu
-00004dc0: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
-00004dd0: 7265 203d 3d20 2267 726f 7570 5f61 7665  re == "group_ave
-00004de0: 7261 6765 223a 0d0a 2020 2020 2020 2020  rage":..        
-00004df0: 2020 2020 2020 2020 6d75 6c74 6976 6172          multivar
-00004e00: 5f64 6620 3d20 280d 0a20 2020 2020 2020  _df = (..       
-00004e10: 2020 2020 2020 2020 2020 2020 2074 7273               trs
-00004e20: 5f64 662e 6772 6f75 7062 7928 7365 6c66  _df.groupby(self
-00004e30: 2e63 6174 6567 6f72 6963 616c 5f67 726f  .categorical_gro
-00004e40: 7570 732c 2061 7869 733d 3129 0d0a 2020  ups, axis=1)..  
-00004e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e60: 2020 2e6d 6561 6e28 290d 0a20 2020 2020    .mean()..     
-00004e70: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-00004e80: 696c 6f63 5b6c 6167 5f31 5f69 6e64 785d  iloc[lag_1_indx]
-00004e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004ea0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00004eb0: 2020 2020 206d 756c 7469 7661 725f 6466       multivar_df
-00004ec0: 2e69 6e64 6578 203d 2073 656c 662e 6466  .index = self.df
-00004ed0: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-00004ee0: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
-00004ef0: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
-00004f00: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
-00004f10: 6976 6172 5f64 662e 7265 6e61 6d65 2863  ivar_df.rename(c
-00004f20: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
-00004f30: 2022 6d75 6c74 6976 6172 5f22 202b 2073   "multivar_" + s
-00004f40: 7472 2878 2929 0d0a 2020 2020 2020 2020  tr(x))..        
-00004f50: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00004f60: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00004f70: 2e6d 756c 7469 7661 7269 6174 655f 6665  .multivariate_fe
-00004f80: 6174 7572 6520 3d3d 2022 6f73 6369 6c6c  ature == "oscill
-00004f90: 6174 6f72 223a 0d0a 2020 2020 2020 2020  ator":..        
-00004fa0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00004fb0: 6f74 496d 706c 656d 656e 7465 640d 0a20  otImplemented.. 
-00004fc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00004fd0: 702e 636f 756e 745f 6e6f 6e7a 6572 6f28  p.count_nonzero(
-00004fe0: 2864 6620 2d20 6466 2e73 6869 6674 2831  (df - df.shift(1
-00004ff0: 2929 2e63 6c69 7028 7570 7065 723d 3029  )).clip(upper=0)
-00005000: 295b 3a2d 315d 0d0a 2020 2020 2020 2020  )[:-1]..        
-00005010: 6966 2073 656c 662e 7365 6173 6f6e 616c  if self.seasonal
-00005020: 6974 6965 7320 6973 206e 6f74 204e 6f6e  ities is not Non
-00005030: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00005040: 735f 6c69 7374 203d 205b 5d0d 0a20 2020  s_list = []..   
-00005050: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00005060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005070: 6f72 2073 6561 736f 6e61 6c69 7479 2069  or seasonality i
-00005080: 6e20 7365 6c66 2e73 6561 736f 6e61 6c69  n self.seasonali
-00005090: 7469 6573 3a0d 0a20 2020 2020 2020 2020  ties:..         
-000050a0: 2020 2020 2020 2020 2020 2073 5f6c 6973             s_lis
-000050b0: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
-000050c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050d0: 2020 2063 7265 6174 655f 7365 6173 6f6e     create_season
-000050e0: 616c 6974 795f 6665 6174 7572 6528 0d0a  ality_feature(..
-000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005110: 2e64 662e 696e 6465 782c 0d0a 2020 2020  .df.index,..    
-00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005130: 2020 2020 2020 2020 7365 6c66 2e74 5f74          self.t_t
-00005140: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
-00005150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005160: 2020 2073 6561 736f 6e61 6c69 7479 2c0d     seasonality,.
-00005170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005180: 2020 2020 2020 2020 2020 2020 2068 6973               his
-00005190: 746f 7279 5f64 6179 733d 7365 6c66 2e68  tory_days=self.h
-000051a0: 6973 746f 7279 5f64 6179 732c 0d0a 2020  istory_days,..  
+00004020: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f64    self.anomaly_d
+00004030: 6574 6563 746f 722e 616e 6f6d 616c 6965  etector.anomalie
+00004040: 7320 3d3d 202d 310d 0a20 2020 2020 2020  s == -1..       
+00004050: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00004060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004070: 2e61 6e6f 6d61 6c79 5f64 6574 6563 746f  .anomaly_detecto
+00004080: 722e 616e 6f6d 616c 6965 735b 686f 6c5f  r.anomalies[hol_
+00004090: 6669 6c74 5d20 3d20 310d 0a20 2020 2020  filt] = 1..     
+000040a0: 2020 2020 2020 2020 2020 2023 2061 7373             # ass
+000040b0: 756d 6520 6d6f 7374 2061 7265 206e 6f74  ume most are not
+000040c0: 2061 6e6f 6d61 6c69 6573 2073 6f20 6d65   anomalies so me
+000040d0: 6469 616e 2069 7320 6e6f 7420 616e 6f6d  dian is not anom
+000040e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000040f0: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f64    self.anomaly_d
+00004100: 6574 6563 746f 722e 7363 6f72 6573 5b68  etector.scores[h
+00004110: 6f6c 5f66 696c 745d 203d 206e 702e 6d65  ol_filt] = np.me
+00004120: 6469 616e 280d 0a20 2020 2020 2020 2020  dian(..         
+00004130: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004140: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00004150: 2e73 636f 7265 730d 0a20 2020 2020 2020  .scores..       
+00004160: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00004170: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004180: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
+00004190: 7469 6f6e 203d 3d20 2272 656d 6f76 6522  tion == "remove"
+000041a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000041b0: 2020 2073 656c 662e 6466 203d 2073 656c     self.df = sel
+000041c0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+000041d0: 6f72 2e74 7261 6e73 666f 726d 2873 656c  or.transform(sel
+000041e0: 662e 6466 290d 0a20 2020 2020 2020 2020  f.df)..         
+000041f0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00004200: 6365 2873 656c 662e 616e 6f6d 616c 795f  ce(self.anomaly_
+00004210: 696e 7465 7276 656e 7469 6f6e 2c20 6469  intervention, di
+00004220: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+00004230: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
+00004240: 6c79 5f64 6574 6563 746f 722e 6669 745f  ly_detector.fit_
+00004250: 616e 6f6d 616c 795f 636c 6173 7369 6669  anomaly_classifi
+00004260: 6572 2829 0d0a 2020 2020 2020 2020 2020  er()..          
+00004270: 2020 2320 6465 7465 6374 5f6f 6e6c 7920    # detect_only 
+00004280: 3d20 7061 7373 0d0a 2020 2020 2020 2020  = pass..        
+00004290: 2320 6e6f 7720 646f 2073 7461 6e64 6172  # now do standar
+000042a0: 6420 7072 6570 726f 6365 7373 696e 670d  d preprocessing.
+000042b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000042c0: 2e70 7265 7072 6f63 6573 7369 6e67 5f74  .preprocessing_t
+000042d0: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+000042e0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+000042f0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+00004300: 7072 6f63 6573 7365 7220 3d20 4765 6e65  processer = Gene
+00004310: 7261 6c54 7261 6e73 666f 726d 6572 282a  ralTransformer(*
+00004320: 2a73 656c 662e 7072 6570 726f 6365 7373  *self.preprocess
+00004330: 696e 675f 7472 616e 7366 6f72 6d61 7469  ing_transformati
+00004340: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
+00004350: 2073 656c 662e 6466 203d 2073 656c 662e   self.df = self.
+00004360: 7072 6570 726f 6365 7373 6572 2e66 6974  preprocesser.fit
+00004370: 5f74 7261 6e73 666f 726d 2873 656c 662e  _transform(self.
+00004380: 6466 290d 0a20 2020 2020 2020 2069 6620  df)..        if 
+00004390: 7365 6c66 2e73 6361 6c69 6e67 2069 7320  self.scaling is 
+000043a0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000043b0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+000043c0: 6361 6c69 6e67 203d 3d20 2242 6173 6553  caling == "BaseS
+000043d0: 6361 6c65 7222 3a0d 0a20 2020 2020 2020  caler":..       
+000043e0: 2020 2020 2020 2020 2073 656c 662e 6466           self.df
+000043f0: 203d 2073 656c 662e 6261 7365 5f73 6361   = self.base_sca
+00004400: 6c65 7228 7365 6c66 2e64 6629 0d0a 2020  ler(self.df)..  
+00004410: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00004420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004430: 2069 6620 7365 6c66 2e73 6361 6c69 6e67   if self.scaling
+00004440: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00004450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004460: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00004470: 2273 6361 6c69 6e67 206d 7573 7420 6e6f  "scaling must no
+00004480: 7420 6265 204e 6f6e 652e 2054 7279 2027  t be None. Try '
+00004490: 4261 7365 5363 616c 6572 2722 290d 0a20  BaseScaler'").. 
+000044a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000044b0: 656c 662e 7363 616c 6572 203d 2047 656e  elf.scaler = Gen
+000044c0: 6572 616c 5472 616e 7366 6f72 6d65 7228  eralTransformer(
+000044d0: 2a2a 7365 6c66 2e73 6361 6c69 6e67 290d  **self.scaling).
+000044e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000044f0: 2073 656c 662e 6466 203d 2073 656c 662e   self.df = self.
+00004500: 7363 616c 6572 2e66 6974 5f74 7261 6e73  scaler.fit_trans
+00004510: 666f 726d 2873 656c 662e 6466 290d 0a20  form(self.df).. 
+00004520: 2020 2020 2020 2023 2061 6464 6974 696f         # additio
+00004530: 6e61 6c20 7472 616e 7366 6f72 6d73 2062  nal transforms b
+00004540: 6566 6f72 6520 6d75 6c74 6976 6172 6961  efore multivaria
+00004550: 7465 2066 6561 7475 7265 2063 7265 6174  te feature creat
+00004560: 696f 6e0d 0a20 2020 2020 2020 2069 6620  ion..        if 
+00004570: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
+00004580: 655f 7472 616e 7366 6f72 6d61 7469 6f6e  e_transformation
+00004590: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000045a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000045b0: 6d75 6c74 6976 6172 6961 7465 5f74 7261  multivariate_tra
+000045c0: 6e73 666f 726d 6572 203d 2047 656e 6572  nsformer = Gener
+000045d0: 616c 5472 616e 7366 6f72 6d65 7228 0d0a  alTransformer(..
+000045e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045f0: 2a2a 7365 6c66 2e6d 756c 7469 7661 7269  **self.multivari
+00004600: 6174 655f 7472 616e 7366 6f72 6d61 7469  ate_transformati
+00004610: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00004620: 290d 0a20 2020 2020 2020 2023 206e 6565  )..        # nee
+00004630: 6473 2074 6f20 636f 6d65 2061 6674 6572  ds to come after
+00004640: 2070 7265 7072 6f63 6573 7369 6e67 2062   preprocessing b
+00004650: 6563 6175 7365 206f 6620 2773 6c69 6365  ecause of 'slice
+00004660: 2720 7472 616e 7366 6f72 6d65 720d 0a20  ' transformer.. 
+00004670: 2020 2020 2020 2073 656c 662e 6473 5f6d         self.ds_m
+00004680: 696e 203d 2073 656c 662e 6466 2e69 6e64  in = self.df.ind
+00004690: 6578 2e6d 696e 2829 0d0a 2020 2020 2020  ex.min()..      
+000046a0: 2020 7365 6c66 2e64 735f 6d61 7820 3d20    self.ds_max = 
+000046b0: 7365 6c66 2e64 662e 696e 6465 782e 6d61  self.df.index.ma
+000046c0: 7828 290d 0a20 2020 2020 2020 2073 656c  x()..        sel
+000046d0: 662e 745f 7472 6169 6e20 3d20 7365 6c66  f.t_train = self
+000046e0: 2e63 7265 6174 655f 7428 7365 6c66 2e64  .create_t(self.d
+000046f0: 662e 696e 6465 7829 0d0a 2020 2020 2020  f.index)..      
+00004700: 2020 7365 6c66 2e68 6973 746f 7279 5f64    self.history_d
+00004710: 6179 7320 3d20 2873 656c 662e 6473 5f6d  ays = (self.ds_m
+00004720: 6178 202d 2073 656c 662e 6473 5f6d 696e  ax - self.ds_min
+00004730: 292e 6461 7973 0d0a 0d0a 2020 2020 2020  ).days....      
+00004740: 2020 2320 4245 4749 4e20 434f 4e53 5452    # BEGIN CONSTR
+00004750: 5543 5449 4f4e 204f 4620 5820 4152 5241  UCTION OF X ARRA
+00004760: 590d 0a20 2020 2020 2020 2078 5f6c 6973  Y..        x_lis
+00004770: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
+00004780: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+00004790: 6c66 2e61 6e6f 6d61 6c79 5f69 6e74 6572  lf.anomaly_inter
+000047a0: 7665 6e74 696f 6e2c 2064 6963 7429 3a0d  vention, dict):.
+000047b0: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
+000047c0: 6565 6420 746f 206d 6f64 656c 2074 6865  eed to model the
+000047d0: 7365 2066 6f72 2070 7265 6469 6374 696f  se for predictio
+000047e0: 6e0d 0a20 2020 2020 2020 2020 2020 2078  n..            x
+000047f0: 5f6c 6973 742e 6170 7065 6e64 280d 0a20  _list.append(.. 
+00004800: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004810: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
+00004820: 6374 6f72 2e73 636f 7265 732e 7265 6e61  ctor.scores.rena
+00004830: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
+00004840: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+00004850: 3d6c 616d 6264 6120 783a 2022 616e 6f6d  =lambda x: "anom
+00004860: 616c 7973 636f 7265 735f 2220 2b20 7374  alyscores_" + st
+00004870: 7228 7829 0d0a 2020 2020 2020 2020 2020  r(x)..          
+00004880: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00004890: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000048a0: 2320 616c 6c20 6f66 2074 6865 2066 6f6c  # all of the fol
+000048b0: 6c6f 7769 6e67 2061 7265 2031 2064 6179  lowing are 1 day
+000048c0: 2070 6173 7420 6c61 6767 6564 0d0a 2020   past lagged..  
+000048d0: 2020 2020 2020 6966 2073 656c 662e 6d75        if self.mu
+000048e0: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
+000048f0: 7265 2069 7320 6e6f 7420 4e6f 6e65 3a0d  re is not None:.
+00004900: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+00004910: 6e63 6c75 6465 7320 6261 636b 6669 6c6c  ncludes backfill
+00004920: 0d0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+00004930: 675f 315f 696e 6478 203d 206e 702e 636f  g_1_indx = np.co
+00004940: 6e63 6174 656e 6174 6528 5b5b 305d 2c20  ncatenate([[0], 
+00004950: 6e70 2e61 7261 6e67 6528 6c65 6e28 7365  np.arange(len(se
+00004960: 6c66 2e64 6629 295d 295b 0d0a 2020 2020  lf.df))])[..    
+00004970: 2020 2020 2020 2020 2020 2020 3020 3a20              0 : 
+00004980: 6c65 6e28 7365 6c66 2e64 6629 0d0a 2020  len(self.df)..  
+00004990: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
+000049a0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000049b0: 2e6d 756c 7469 7661 7269 6174 655f 7472  .multivariate_tr
+000049c0: 616e 7366 6f72 6d61 7469 6f6e 2069 7320  ansformation is 
+000049d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000049e0: 2020 2020 2020 2020 2020 2074 7273 5f64             trs_d
+000049f0: 6620 3d20 7365 6c66 2e6d 756c 7469 7661  f = self.multiva
+00004a00: 7269 6174 655f 7472 616e 7366 6f72 6d65  riate_transforme
+00004a10: 722e 6669 745f 7472 616e 7366 6f72 6d28  r.fit_transform(
+00004a20: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
+00004a30: 2020 2020 2020 2020 2020 6966 2074 7273            if trs
+00004a40: 5f64 662e 7368 6170 6520 213d 2073 656c  _df.shape != sel
+00004a50: 662e 6466 2e73 6861 7065 3a0d 0a20 2020  f.df.shape:..   
+00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004a80: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+00004a90: 2020 2020 2020 2020 2020 2020 224d 756c              "Mul
+00004aa0: 7469 7661 7269 6174 6520 5472 616e 7366  tivariate Transf
+00004ab0: 6f72 6d65 7220 6e6f 7420 7573 6162 6c65  ormer not usable
+00004ac0: 2066 6f72 2074 6869 7320 726f 6c65 2e22   for this role."
+00004ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004ae0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00004af0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00004b00: 2020 2020 2020 2020 2020 2020 7472 735f              trs_
+00004b10: 6466 203d 2073 656c 662e 6466 2e63 6f70  df = self.df.cop
+00004b20: 7928 290d 0a20 2020 2020 2020 2020 2020  y()..           
+00004b30: 2069 6620 7365 6c66 2e6d 756c 7469 7661   if self.multiva
+00004b40: 7269 6174 655f 6665 6174 7572 6520 3d3d  riate_feature ==
+00004b50: 2022 6665 6174 7572 655f 6167 676c 6f6d   "feature_agglom
+00004b60: 6572 6174 696f 6e22 3a0d 0a20 2020 2020  eration":..     
+00004b70: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+00004b80: 736b 6c65 6172 6e2e 636c 7573 7465 7220  sklearn.cluster 
+00004b90: 696d 706f 7274 2046 6561 7475 7265 4167  import FeatureAg
+00004ba0: 676c 6f6d 6572 6174 696f 6e0d 0a0d 0a20  glomeration.... 
+00004bb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004bc0: 656c 662e 6167 676c 6f6d 5f6e 5f63 6c75  elf.agglom_n_clu
+00004bd0: 7374 6572 7320 3d20 350d 0a20 2020 2020  sters = 5..     
+00004be0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004bf0: 6167 676c 6f6d 6572 6174 6f72 203d 2046  agglomerator = F
+00004c00: 6561 7475 7265 4167 676c 6f6d 6572 6174  eatureAgglomerat
+00004c10: 696f 6e28 0d0a 2020 2020 2020 2020 2020  ion(..          
+00004c20: 2020 2020 2020 2020 2020 6e5f 636c 7573            n_clus
+00004c30: 7465 7273 3d73 656c 662e 6167 676c 6f6d  ters=self.agglom
+00004c40: 5f6e 5f63 6c75 7374 6572 730d 0a20 2020  _n_clusters..   
+00004c50: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00004c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c70: 785f 6c69 7374 2e61 7070 656e 6428 0d0a  x_list.append(..
+00004c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c90: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
+00004ca0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00004cb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004cc0: 6167 676c 6f6d 6572 6174 6f72 2e66 6974  agglomerator.fit
+00004cd0: 5f74 7261 6e73 666f 726d 2874 7273 5f64  _transform(trs_d
+00004ce0: 6629 5b6c 6167 5f31 5f69 6e64 785d 2c0d  f)[lag_1_indx],.
+00004cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d00: 2020 2020 2020 2020 2069 6e64 6578 3d73           index=s
+00004d10: 656c 662e 6466 2e69 6e64 6578 2c0d 0a20  elf.df.index,.. 
+00004d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d30: 2020 2020 2020 2063 6f6c 756d 6e73 3d5b         columns=[
+00004d40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004d50: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+00004d60: 756c 7469 7661 725f 2220 2b20 7374 7228  ultivar_" + str(
+00004d70: 7829 2066 6f72 2078 2069 6e20 7261 6e67  x) for x in rang
+00004d80: 6528 7365 6c66 2e61 6767 6c6f 6d5f 6e5f  e(self.agglom_n_
+00004d90: 636c 7573 7465 7273 290d 0a20 2020 2020  clusters)..     
+00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004db0: 2020 205d 2c0d 0a20 2020 2020 2020 2020     ],..         
+00004dc0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00004dd0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00004de0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00004df0: 6620 7365 6c66 2e6d 756c 7469 7661 7269  f self.multivari
+00004e00: 6174 655f 6665 6174 7572 6520 3d3d 2022  ate_feature == "
+00004e10: 6772 6f75 705f 6176 6572 6167 6522 3a0d  group_average":.
+00004e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004e30: 206d 756c 7469 7661 725f 6466 203d 2028   multivar_df = (
+00004e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004e50: 2020 2020 2020 7472 735f 6466 2e67 726f        trs_df.gro
+00004e60: 7570 6279 2873 656c 662e 6361 7465 676f  upby(self.catego
+00004e70: 7269 6361 6c5f 6772 6f75 7073 2c20 6178  rical_groups, ax
+00004e80: 6973 3d31 290d 0a20 2020 2020 2020 2020  is=1)..         
+00004e90: 2020 2020 2020 2020 2020 202e 6d65 616e             .mean
+00004ea0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00004eb0: 2020 2020 2020 2020 2e69 6c6f 635b 6c61          .iloc[la
+00004ec0: 675f 315f 696e 6478 5d0d 0a20 2020 2020  g_1_indx]..     
+00004ed0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00004ee0: 2020 2020 2020 2020 2020 2020 2020 6d75                mu
+00004ef0: 6c74 6976 6172 5f64 662e 696e 6465 7820  ltivar_df.index 
+00004f00: 3d20 7365 6c66 2e64 662e 696e 6465 780d  = self.df.index.
+00004f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f20: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
+00004f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f40: 2020 2020 206d 756c 7469 7661 725f 6466       multivar_df
+00004f50: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
+00004f60: 6c61 6d62 6461 2078 3a20 226d 756c 7469  lambda x: "multi
+00004f70: 7661 725f 2220 2b20 7374 7228 7829 290d  var_" + str(x)).
+00004f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f90: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00004fa0: 656c 6966 2073 656c 662e 6d75 6c74 6976  elif self.multiv
+00004fb0: 6172 6961 7465 5f66 6561 7475 7265 203d  ariate_feature =
+00004fc0: 3d20 226f 7363 696c 6c61 746f 7222 3a0d  = "oscillator":.
+00004fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004fe0: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
+00004ff0: 6d65 6e74 6564 0d0a 2020 2020 2020 2020  mented..        
+00005000: 2020 2020 2020 2020 6e70 2e63 6f75 6e74          np.count
+00005010: 5f6e 6f6e 7a65 726f 2828 6466 202d 2064  _nonzero((df - d
+00005020: 662e 7368 6966 7428 3129 292e 636c 6970  f.shift(1)).clip
+00005030: 2875 7070 6572 3d30 2929 5b3a 2d31 5d0d  (upper=0))[:-1].
+00005040: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00005050: 2e73 6561 736f 6e61 6c69 7469 6573 2069  .seasonalities i
+00005060: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00005070: 2020 2020 2020 2020 2073 5f6c 6973 7420           s_list 
+00005080: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+00005090: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000050a0: 2020 2020 2020 2020 666f 7220 7365 6173          for seas
+000050b0: 6f6e 616c 6974 7920 696e 2073 656c 662e  onality in self.
+000050c0: 7365 6173 6f6e 616c 6974 6965 733a 0d0a  seasonalities:..
+000050d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050e0: 2020 2020 735f 6c69 7374 2e61 7070 656e      s_list.appen
+000050f0: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+00005100: 2020 2020 2020 2020 2020 2020 6372 6561              crea
+00005110: 7465 5f73 6561 736f 6e61 6c69 7479 5f66  te_seasonality_f
+00005120: 6561 7475 7265 280d 0a20 2020 2020 2020  eature(..       
+00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005140: 2020 2020 2073 656c 662e 6466 2e69 6e64       self.df.ind
+00005150: 6578 2c0d 0a20 2020 2020 2020 2020 2020  ex,..           
+00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005170: 2073 656c 662e 745f 7472 6169 6e2c 0d0a   self.t_train,..
+00005180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005190: 2020 2020 2020 2020 2020 2020 7365 6173              seas
+000051a0: 6f6e 616c 6974 792c 0d0a 2020 2020 2020  onality,..      
 000051b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000051d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-000051e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051f0: 2020 2020 2320 494e 5445 5241 4354 494f      # INTERACTIO
-00005200: 4e53 204e 4f54 2049 4d50 4c45 4d45 4e54  NS NOT IMPLEMENT
-00005210: 4544 0d0a 2020 2020 2020 2020 2020 2020  ED..            
-00005220: 2020 2020 2020 2020 2320 4f52 4445 5220          # ORDER 
-00005230: 5350 4543 4946 4943 4154 494f 4e20 4e4f  SPECIFICATION NO
-00005240: 5420 494d 504c 454d 454e 5445 440d 0a20  T IMPLEMENTED.. 
-00005250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005260: 5f64 6620 3d20 7064 2e63 6f6e 6361 7428  _df = pd.concat(
-00005270: 735f 6c69 7374 2c20 6178 6973 3d31 290d  s_list, axis=1).
-00005280: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00005290: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-000052a0: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
-000052b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000052c0: 4572 726f 7228 6622 7365 6173 6f6e 616c  Error(f"seasonal
-000052d0: 6974 7920 7b73 6561 736f 6e61 6c69 7479  ity {seasonality
-000052e0: 7d20 6372 6561 7469 6f6e 2065 7272 6f72  } creation error
-000052f0: 2229 2066 726f 6d20 650d 0a20 2020 2020  ") from e..     
-00005300: 2020 2020 2020 2073 5f64 662e 696e 6465         s_df.inde
-00005310: 7820 3d20 7365 6c66 2e64 662e 696e 6465  x = self.df.inde
-00005320: 780d 0a20 2020 2020 2020 2020 2020 2078  x..            x
-00005330: 5f6c 6973 742e 6170 7065 6e64 2873 5f64  _list.append(s_d
-00005340: 6629 0d0a 2020 2020 2020 2020 2320 5468  f)..        # Th
-00005350: 6573 6520 6665 6174 7572 6573 2061 7265  ese features are
-00005360: 2074 6f20 7072 6576 656e 7420 6f76 6572   to prevent over
-00005370: 6669 7474 696e 6720 616e 6420 7374 616e  fitting and stan
-00005380: 6469 6e20 666f 7220 756e 6f62 7365 7276  din for unobserv
-00005390: 6564 2063 6f6d 706f 6e65 6e74 7320 6865  ed components he
-000053a0: 7265 0d0a 2020 2020 2020 2020 6966 2073  re..        if s
-000053b0: 656c 662e 7261 6e64 6f6d 7761 6c6b 5f6e  elf.randomwalk_n
-000053c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-000053d0: 2020 2020 2020 2020 2020 2078 5f6c 6973             x_lis
-000053e0: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
-000053f0: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
-00005400: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
-00005410: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00005420: 2e72 616e 646f 6d2e 6e6f 726d 616c 2873  .random.normal(s
-00005430: 697a 653d 286c 656e 2873 656c 662e 6466  ize=(len(self.df
-00005440: 292c 2073 656c 662e 7261 6e64 6f6d 7761  ), self.randomwa
-00005450: 6c6b 5f6e 2929 2e63 756d 7375 6d28 0d0a  lk_n)).cumsum(..
-00005460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005470: 2020 2020 2020 2020 6178 6973 3d30 0d0a          axis=0..
-00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005490: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-000054a0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-000054b0: 6d6e 733d 5b22 7261 6e64 6f6d 7761 6c6b  mns=["randomwalk
-000054c0: 5f22 202b 2073 7472 2878 2920 666f 7220  _" + str(x) for 
-000054d0: 7820 696e 2072 616e 6765 2873 656c 662e  x in range(self.
-000054e0: 7261 6e64 6f6d 7761 6c6b 5f6e 295d 2c0d  randomwalk_n)],.
-000054f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005500: 2020 2020 2069 6e64 6578 3d73 656c 662e       index=self.
-00005510: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
-00005520: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00005530: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00005540: 2020 2020 2069 6620 7365 6c66 2e74 7265       if self.tre
-00005550: 6e64 5f73 7461 6e64 696e 2069 7320 6e6f  nd_standin is no
-00005560: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005570: 2020 2020 2069 6620 7365 6c66 2e74 7265       if self.tre
-00005580: 6e64 5f73 7461 6e64 696e 203d 3d20 2272  nd_standin == "r
-00005590: 616e 646f 6d5f 6e6f 726d 616c 223a 0d0a  andom_normal":..
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055b0: 6e75 6d5f 7374 616e 6469 6e20 3d20 340d  num_standin = 4.
-000055c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055d0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
-000055e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055f0: 2020 2020 2070 642e 4461 7461 4672 616d       pd.DataFram
-00005600: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00005610: 2020 2020 2020 2020 2020 2020 6e70 2e72              np.r
-00005620: 616e 646f 6d2e 6e6f 726d 616c 2873 697a  andom.normal(siz
-00005630: 653d 286c 656e 2873 656c 662e 6466 292c  e=(len(self.df),
-00005640: 206e 756d 5f73 7461 6e64 696e 2929 2c0d   num_standin)),.
-00005650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005660: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00005670: 3d5b 2272 616e 646e 6f72 6d5f 2220 2b20  =["randnorm_" + 
-00005680: 7374 7228 7829 2066 6f72 2078 2069 6e20  str(x) for x in 
-00005690: 7261 6e67 6528 6e75 6d5f 7374 616e 6469  range(num_standi
-000056a0: 6e29 5d2c 0d0a 2020 2020 2020 2020 2020  n)],..          
-000056b0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000056c0: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
-000056d0: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
-000056e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000056f0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00005700: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00005710: 656c 662e 7472 656e 645f 7374 616e 6469  elf.trend_standi
-00005720: 6e20 3d3d 2022 726f 6c6c 696e 675f 7472  n == "rolling_tr
-00005730: 656e 6422 3a0d 0a20 2020 2020 2020 2020  end":..         
-00005740: 2020 2020 2020 2072 6573 6964 2c20 736c         resid, sl
-00005750: 6f70 652c 2069 6e74 6572 6365 7074 203d  ope, intercept =
-00005760: 2073 656c 662e 726f 6c6c 696e 675f 7472   self.rolling_tr
-00005770: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-00005780: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
-00005790: 7272 6179 2864 6629 2c20 6e70 2e61 7272  rray(df), np.arr
-000057a0: 6179 2873 656c 662e 6372 6561 7465 5f74  ay(self.create_t
-000057b0: 2864 662e 696e 6465 7829 290d 0a20 2020  (df.index))..   
-000057c0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057e0: 7265 7369 6420 3d20 7064 2e44 6174 6146  resid = pd.DataF
-000057f0: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
-00005800: 2020 2020 2020 2020 2020 2073 6c6f 7065             slope
-00005810: 202a 206e 702e 6173 6172 7261 7928 7365   * np.asarray(se
-00005820: 6c66 2e74 5f74 7261 696e 295b 2e2e 2e2c  lf.t_train)[...,
-00005830: 204e 6f6e 655d 202b 2069 6e74 6572 6365   None] + interce
-00005840: 7074 2c0d 0a20 2020 2020 2020 2020 2020  pt,..           
-00005850: 2020 2020 2020 2020 2069 6e64 6578 3d64           index=d
-00005860: 662e 696e 6465 782c 0d0a 2020 2020 2020  f.index,..      
-00005870: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00005880: 6c75 6d6e 733d 6466 2e63 6f6c 756d 6e73  lumns=df.columns
-00005890: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000058a0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-000058b0: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
-000058c0: 656e 6428 7265 7369 642e 7265 6e61 6d65  end(resid.rename
-000058d0: 2863 6f6c 756d 6e73 3d6c 616d 6264 6120  (columns=lambda 
-000058e0: 783a 2022 726f 6c6c 696e 675f 7472 656e  x: "rolling_tren
-000058f0: 645f 2220 2b20 7374 7228 7829 2929 0d0a  d_" + str(x)))..
-00005900: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
-00005910: 655f 7265 6772 6573 736f 7220 6973 206e  e_regressor is n
-00005920: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
-00005930: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
-00005940: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00005950: 6620 7365 6c66 2e72 6567 7265 7373 6f72  f self.regressor
-00005960: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
-00005970: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00005980: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00005990: 6c66 2e72 6567 7265 7373 6f72 5f74 7261  lf.regressor_tra
-000059a0: 6e73 666f 726d 6572 203d 2047 656e 6572  nsformer = Gener
-000059b0: 616c 5472 616e 7366 6f72 6d65 7228 0d0a  alTransformer(..
-000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059d0: 2020 2020 2a2a 7365 6c66 2e72 6567 7265      **self.regre
-000059e0: 7373 6f72 5f74 7261 6e73 666f 726d 6174  ssor_transformat
-000059f0: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00005a00: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00005a10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00005a20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005a30: 7265 6772 6573 736f 725f 7472 616e 7366  regressor_transf
-00005a40: 6f72 6d65 7220 3d20 4765 6e65 7261 6c54  ormer = GeneralT
-00005a50: 7261 6e73 666f 726d 6572 282a 2a7b 2766  ransformer(**{'f
-00005a60: 696c 6c6e 6127 3a20 2766 6669 6c6c 277d  illna': 'ffill'}
-00005a70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00005a80: 656c 662e 6675 7475 7265 5f72 6567 7265  elf.future_regre
-00005a90: 7373 6f72 5f74 7261 696e 203d 2073 656c  ssor_train = sel
-00005aa0: 662e 7265 6772 6573 736f 725f 7472 616e  f.regressor_tran
-00005ab0: 7366 6f72 6d65 722e 6669 745f 7472 616e  sformer.fit_tran
-00005ac0: 7366 6f72 6d28 0d0a 2020 2020 2020 2020  sform(..        
-00005ad0: 2020 2020 2020 2020 636c 6561 6e5f 7265          clean_re
-00005ae0: 6772 6573 736f 7228 6675 7475 7265 5f72  gressor(future_r
-00005af0: 6567 7265 7373 6f72 290d 0a20 2020 2020  egressor)..     
-00005b00: 2020 2020 2020 2029 2e66 696c 6c6e 6128         ).fillna(
-00005b10: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
-00005b20: 785f 6c69 7374 2e61 7070 656e 6428 0d0a  x_list.append(..
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 7365 6c66 2e66 7574 7572 655f 7265 6772  self.future_regr
-00005b50: 6573 736f 725f 7472 6169 6e2e 7265 696e  essor_train.rein
-00005b60: 6465 7828 7365 6c66 2e64 662e 696e 6465  dex(self.df.inde
-00005b70: 782c 2066 696c 6c5f 7661 6c75 653d 3029  x, fill_value=0)
-00005b80: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00005b90: 0a20 2020 2020 2020 2069 6620 666c 6167  .        if flag
-00005ba0: 5f72 6567 7265 7373 6f72 7320 6973 206e  _regressors is n
-00005bb0: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
-00005bc0: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
-00005bd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00005be0: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
-00005bf0: 6f72 5f74 7261 696e 203d 2063 6c65 616e  or_train = clean
-00005c00: 5f72 6567 7265 7373 6f72 280d 0a20 2020  _regressor(..   
-00005c10: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00005c20: 675f 7265 6772 6573 736f 7273 2c20 7072  g_regressors, pr
-00005c30: 6566 6978 3d22 7265 6772 666c 6167 735f  efix="regrflags_
-00005c40: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
-00005c50: 0d0a 2020 2020 2020 2020 2020 2020 785f  ..            x_
-00005c60: 6c69 7374 2e61 7070 656e 6428 7365 6c66  list.append(self
-00005c70: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
-00005c80: 7472 6169 6e2e 7265 696e 6465 7828 7365  train.reindex(se
-00005c90: 6c66 2e64 662e 696e 6465 7829 290d 0a20  lf.df.index)).. 
-00005ca0: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-00005cb0: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
-00005cc0: 6c69 6461 795f 636f 756e 7472 6965 7320  liday_countries 
-00005cd0: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
-00005ce0: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-00005cf0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00005d00: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
-00005d10: 6573 2c20 6469 6374 290d 0a20 2020 2020  es, dict)..     
-00005d20: 2020 2020 2020 2061 6e64 2073 656c 662e         and self.
-00005d30: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
-00005d40: 735f 7573 6564 0d0a 2020 2020 2020 2020  s_used..        
-00005d50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00005d60: 666f 7220 686f 6c69 6461 795f 636f 756e  for holiday_coun
-00005d70: 7472 7920 696e 2073 656c 662e 686f 6c69  try in self.holi
-00005d80: 6461 795f 636f 756e 7472 6965 733a 0d0a  day_countries:..
-00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005da0: 785f 6c69 7374 2e61 7070 656e 6428 0d0a  x_list.append(..
-00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dc0: 2020 2020 686f 6c69 6461 795f 666c 6167      holiday_flag
-00005dd0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00005de0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005df0: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
-00005e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e10: 2020 2063 6f75 6e74 7279 3d68 6f6c 6964     country=holid
-00005e20: 6179 5f63 6f75 6e74 7279 2c0d 0a20 2020  ay_country,..   
-00005e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e40: 2020 2020 2065 6e63 6f64 655f 686f 6c69       encode_holi
-00005e50: 6461 795f 7479 7065 3d54 7275 652c 0d0a  day_type=True,..
-00005e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e70: 2020 2020 292e 7265 6e61 6d65 2863 6f6c      ).rename(col
-00005e80: 756d 6e73 3d6c 616d 6264 6120 783a 2022  umns=lambda x: "
-00005e90: 686f 6c69 6461 795f 2220 2b20 7374 7228  holiday_" + str(
-00005ea0: 7829 292c 0d0a 2020 2020 2020 2020 2020  x)),..          
-00005eb0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00005ec0: 2023 2070 7574 2074 6869 7320 746f 2074   # put this to t
-00005ed0: 6865 2065 6e64 2061 7320 6974 2074 616b  he end as it tak
-00005ee0: 6573 2075 7020 6c6f 7473 206f 6620 6665  es up lots of fe
-00005ef0: 6174 7572 6520 7370 6163 6520 736f 6d65  ature space some
-00005f00: 7469 6d65 730d 0a20 2020 2020 2020 2069  times..        i
-00005f10: 6620 7365 6c66 2e68 6f6c 6964 6179 5f64  f self.holiday_d
-00005f20: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
-00005f30: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00005f40: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
-00005f50: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
-00005f60: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
-00005f70: 6c69 6461 795f 6465 7465 6374 6f72 2e64  liday_detector.d
-00005f80: 6174 6573 5f74 6f5f 686f 6c69 6461 7973  ates_to_holidays
-00005f90: 2873 656c 662e 6466 2e69 6e64 6578 2c20  (self.df.index, 
-00005fa0: 7374 796c 653d 2266 6c61 6722 290d 0a20  style="flag").. 
-00005fb0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-00005fc0: 636c 6970 2875 7070 6572 3d31 290d 0a20  clip(upper=1).. 
-00005fd0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-00005fe0: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d6c  rename(columns=l
-00005ff0: 616d 6264 6120 783a 2022 686f 6c69 6461  ambda x: "holida
-00006000: 795f 2220 2b20 7374 7228 7829 290d 0a20  y_" + str(x)).. 
-00006010: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
-00006020: 2020 2020 2020 2020 2320 4649 4e41 4c20          # FINAL 
-00006030: 4645 4154 5552 4520 5052 4f43 4553 5349  FEATURE PROCESSI
-00006040: 4e47 0d0a 2020 2020 2020 2020 785f 6172  NG..        x_ar
-00006050: 7261 7920 3d20 7064 2e63 6f6e 6361 7428  ray = pd.concat(
-00006060: 785f 6c69 7374 2c20 6178 6973 3d31 290d  x_list, axis=1).
-00006070: 0a20 2020 2020 2020 2073 656c 662e 785f  .        self.x_
-00006080: 6172 7261 7920 3d20 785f 6172 7261 7920  array = x_array 
-00006090: 2023 2063 616e 2072 656d 6f76 6520 7468   # can remove th
-000060a0: 6973 206c 6174 6572 2c20 6974 2069 7320  is later, it is 
-000060b0: 666f 7220 6465 6275 6767 696e 670d 0a20  for debugging.. 
-000060c0: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
-000060d0: 286e 702e 6973 6e61 6e28 785f 6172 7261  (np.isnan(x_arra
-000060e0: 792e 6173 7479 7065 2866 6c6f 6174 2929  y.astype(float))
-000060f0: 293a 2020 2320 7265 6d6f 7665 206c 6174  ):  # remove lat
-00006100: 6572 2c20 666f 7220 6465 6275 6767 696e  er, for debuggin
-00006110: 670d 0a20 2020 2020 2020 2020 2020 206e  g..            n
-00006120: 756c 7a20 3d20 785f 6172 7261 792e 6973  ulz = x_array.is
-00006130: 6e75 6c6c 2829 2e73 756d 2829 0d0a 2020  null().sum()..  
-00006140: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00006150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006160: 2020 6622 7468 6520 666f 6c6c 6f77 696e    f"the followin
-00006170: 6720 636f 6c75 6d6e 7320 636f 6e74 6169  g columns contai
-00006180: 6e20 6e61 6e20 7661 6c75 6573 3a20 7b6e  n nan values: {n
-00006190: 756c 7a5b 6e75 6c7a 203e 2030 5d2e 696e  ulz[nulz > 0].in
-000061a0: 6465 782e 746f 6c69 7374 2829 7d22 0d0a  dex.tolist()}"..
-000061b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-000061c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000061d0: 2056 616c 7565 4572 726f 7228 226e 616e   ValueError("nan
-000061e0: 2076 616c 7565 7320 696e 2078 5f61 7272   values in x_arr
-000061f0: 6179 2229 0d0a 2020 2020 2020 2020 6966  ay")..        if
-00006200: 206e 702e 616c 6c28 7365 6c66 2e64 6620   np.all(self.df 
-00006210: 3d3d 2030 293a 0d0a 2020 2020 2020 2020  == 0):..        
-00006220: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00006230: 7272 6f72 2822 7472 616e 7366 6f72 6d65  rror("transforme
-00006240: 6420 6461 7461 2069 7320 616c 6c20 7a65  d data is all ze
-00006250: 726f 6573 2229 0d0a 2020 2020 2020 2020  roes")..        
-00006260: 6966 206e 702e 616e 7928 2873 656c 662e  if np.any((self.
-00006270: 6466 2e69 736e 756c 6c28 292e 616c 6c28  df.isnull().all(
-00006280: 2929 293a 0d0a 2020 2020 2020 2020 2020  ))):..          
-00006290: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000062a0: 6f72 2822 7472 616e 7366 6f72 6d65 6420  or("transformed 
-000062b0: 6466 2068 6173 204e 614e 2066 696c 6c65  df has NaN fille
-000062c0: 6420 7365 7269 6573 2229 0d0a 2020 2020  d series")..    
-000062d0: 2020 2020 2320 7265 6d6f 7665 207a 6572      # remove zer
-000062e0: 6f20 7661 7269 616e 6365 2028 636f 7272  o variance (corr
-000062f0: 2069 7320 6e61 6e29 0d0a 2020 2020 2020   is nan)..      
-00006300: 2020 636f 7272 203d 206e 702e 636f 7272    corr = np.corr
-00006310: 636f 6566 2878 5f61 7272 6179 2c20 726f  coef(x_array, ro
-00006320: 7776 6172 3d30 290d 0a20 2020 2020 2020  wvar=0)..       
-00006330: 206e 6561 727a 203d 2078 5f61 7272 6179   nearz = x_array
-00006340: 2e63 6f6c 756d 6e73 5b6e 702e 6973 6e61  .columns[np.isna
-00006350: 6e28 636f 7272 292e 616c 6c28 6178 6973  n(corr).all(axis
-00006360: 3d31 295d 0d0a 2020 2020 2020 2020 6966  =1)]..        if
-00006370: 206c 656e 286e 6561 727a 2920 3e20 303a   len(nearz) > 0:
-00006380: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00006390: 2073 656c 662e 7665 7262 6f73 6520 3e20   self.verbose > 
-000063a0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-000063b0: 2020 2020 7072 696e 7428 6622 4472 6f70      print(f"Drop
-000063c0: 7069 6e67 207a 6572 6f20 7661 7269 616e  ping zero varian
-000063d0: 6365 2066 6561 7475 7265 2063 6f6c 756d  ce feature colum
-000063e0: 6e73 207b 6e65 6172 7a7d 2229 0d0a 2020  ns {nearz}")..  
-000063f0: 2020 2020 2020 2020 2020 785f 6172 7261            x_arra
-00006400: 7920 3d20 785f 6172 7261 792e 6472 6f70  y = x_array.drop
-00006410: 2863 6f6c 756d 6e73 3d6e 6561 727a 290d  (columns=nearz).
-00006420: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
-00006430: 6520 636f 6c69 6e65 6172 2066 6561 7475  e colinear featu
-00006440: 7265 730d 0a20 2020 2020 2020 2023 204e  res..        # N
-00006450: 4f54 4520 5448 4553 4520 5245 4d4f 5641  OTE THESE REMOVA
-00006460: 4c53 2052 454d 4f56 4520 5448 4520 4649  LS REMOVE THE FI
-00006470: 5253 5420 4f46 2050 4149 5220 434f 4c55  RST OF PAIR COLU
-00006480: 4d4e 2046 4952 5354 0d0a 2020 2020 2020  MN FIRST..      
-00006490: 2020 636f 7272 203d 206e 702e 636f 7272    corr = np.corr
-000064a0: 636f 6566 2878 5f61 7272 6179 2c20 726f  coef(x_array, ro
-000064b0: 7776 6172 3d30 2920 2023 2073 6563 6f6e  wvar=0)  # secon
-000064c0: 6420 6f6e 650d 0a20 2020 2020 2020 2077  d one..        w
-000064d0: 2c20 7665 6320 3d20 6e70 2e6c 696e 616c  , vec = np.linal
-000064e0: 672e 6569 6728 636f 7272 290d 0a20 2020  g.eig(corr)..   
-000064f0: 2020 2020 206e 702e 6669 6c6c 5f64 6961       np.fill_dia
-00006500: 676f 6e61 6c28 636f 7272 2c20 3029 0d0a  gonal(corr, 0)..
-00006510: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00006520: 6d61 785f 636f 6c69 6e65 6172 6974 7920  max_colinearity 
-00006530: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00006540: 2020 2020 2020 2020 2020 636f 7265 6c20            corel 
-00006550: 3d20 785f 6172 7261 792e 636f 6c75 6d6e  = x_array.column
-00006560: 735b 0d0a 2020 2020 2020 2020 2020 2020  s[..            
-00006570: 2020 2020 6e70 2e6d 696e 2863 6f72 7220      np.min(corr 
-00006580: 2a20 6e70 2e74 7269 2863 6f72 722e 7368  * np.tri(corr.sh
-00006590: 6170 655b 305d 292c 2061 7869 733d 3029  ape[0]), axis=0)
-000065a0: 203e 2073 656c 662e 6d61 785f 636f 6c69   > self.max_coli
-000065b0: 6e65 6172 6974 790d 0a20 2020 2020 2020  nearity..       
-000065c0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-000065d0: 2020 2020 6966 206c 656e 2863 6f72 656c      if len(corel
-000065e0: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-000065f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00006600: 7665 7262 6f73 6520 3e20 313a 0d0a 2020  verbose > 1:..  
-00006610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006620: 2020 7072 696e 7428 6622 4472 6f70 7069    print(f"Droppi
-00006630: 6e67 2063 6f6c 696e 6561 7220 6665 6174  ng colinear feat
-00006640: 7572 6520 636f 6c75 6d6e 7320 7b63 6f72  ure columns {cor
-00006650: 656c 7d22 290d 0a20 2020 2020 2020 2020  el}")..         
-00006660: 2020 2020 2020 2078 5f61 7272 6179 203d         x_array =
-00006670: 2078 5f61 7272 6179 2e64 726f 7028 636f   x_array.drop(co
-00006680: 6c75 6d6e 733d 636f 7265 6c29 0d0a 2020  lumns=corel)..  
-00006690: 2020 2020 2020 6966 2073 656c 662e 6d61        if self.ma
-000066a0: 785f 6d75 6c74 6963 6f6c 696e 6561 7269  x_multicolineari
-000066b0: 7479 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ty is not None:.
-000066c0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-000066d0: 696e 203d 2078 5f61 7272 6179 2e63 6f6c  in = x_array.col
-000066e0: 756d 6e73 5b77 203c 2073 656c 662e 6d61  umns[w < self.ma
-000066f0: 785f 6d75 6c74 6963 6f6c 696e 6561 7269  x_multicolineari
-00006700: 7479 5d0d 0a20 2020 2020 2020 2020 2020  ty]..           
-00006710: 2069 6620 6c65 6e28 636f 6c69 6e29 203e   if len(colin) >
-00006720: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00006730: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
-00006740: 626f 7365 203e 2031 3a0d 0a20 2020 2020  bose > 1:..     
-00006750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006760: 7269 6e74 2866 2244 726f 7070 696e 6720  rint(f"Dropping 
-00006770: 6d75 6c74 692d 636f 6c69 6e65 6172 2066  multi-colinear f
-00006780: 6561 7475 7265 2063 6f6c 756d 6e73 207b  eature columns {
-00006790: 636f 6c69 6e7d 2229 0d0a 2020 2020 2020  colin}")..      
-000067a0: 2020 2020 2020 2020 2020 785f 6172 7261            x_arra
-000067b0: 7920 3d20 785f 6172 7261 792e 6472 6f70  y = x_array.drop
-000067c0: 2863 6f6c 756d 6e73 3d63 6f6c 696e 290d  (columns=colin).
-000067d0: 0a0d 0a20 2020 2020 2020 2023 2074 6869  ...        # thi
-000067e0: 6e67 7320 7765 2077 616e 7420 6d6f 6465  ngs we want mode
-000067f0: 6c65 6420 6275 7420 7761 6e74 2074 6f20  led but want to 
-00006800: 6469 7363 6172 6420 6672 6f6d 2065 7661  discard from eva
-00006810: 6c75 6174 696f 6e20 2873 7461 6e64 696e  luation (standin
-00006820: 7329 0d0a 2020 2020 2020 2020 7265 6d6f  s)..        remo
-00006830: 7665 5f70 6174 7465 726e 7320 3d20 5b0d  ve_patterns = [.
-00006840: 0a20 2020 2020 2020 2020 2020 2022 7261  .            "ra
-00006850: 6e64 6e6f 726d 5f22 2c0d 0a20 2020 2020  ndnorm_",..     
-00006860: 2020 2020 2020 2022 726f 6c6c 696e 675f         "rolling_
-00006870: 7472 656e 645f 222c 0d0a 2020 2020 2020  trend_",..      
-00006880: 2020 2020 2020 2272 616e 646f 6d77 616c        "randomwal
-00006890: 6b5f 222c 0d0a 2020 2020 2020 2020 5d20  k_",..        ] 
-000068a0: 2023 2022 696e 7465 7263 6570 7422 2061   # "intercept" a
-000068b0: 6464 6564 2061 6674 6572 2c20 736f 206e  dded after, so n
-000068c0: 6f74 2069 6e63 6c75 6465 640d 0a0d 0a20  ot included.... 
-000068d0: 2020 2020 2020 2023 2052 554e 204c 494e         # RUN LIN
-000068e0: 4541 5220 4d4f 4445 4c0d 0a20 2020 2020  EAR MODEL..     
-000068f0: 2020 2023 2061 6464 2078 2066 6561 7475     # add x featu
-00006900: 7265 7320 7468 6174 2064 6f6e 2774 2061  res that don't a
-00006910: 7070 6c79 2074 6f20 616c 6c2c 2061 6e64  pply to all, and
-00006920: 206e 6565 6420 746f 2062 6520 6c6f 6f70   need to be loop
-00006930: 6564 0d0a 2020 2020 2020 2020 6966 2073  ed..        if s
-00006940: 656c 662e 6c6f 6f70 5f72 6571 7569 7265  elf.loop_require
-00006950: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00006960: 7365 6c66 2e70 6172 616d 7320 3d20 7b7d  self.params = {}
-00006970: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00006980: 6c66 2e6b 6565 705f 636f 6c73 203d 207b  lf.keep_cols = {
-00006990: 7d0d 0a20 2020 2020 2020 2020 2020 2073  }..            s
-000069a0: 656c 662e 785f 6172 7261 7920 3d20 7b7d  elf.x_array = {}
-000069b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000069c0: 6c66 2e6b 6565 705f 636f 6c73 5f69 6478  lf.keep_cols_idx
-000069d0: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-000069e0: 2020 2073 656c 662e 636f 6c5f 6772 6f75     self.col_grou
-000069f0: 7069 6e67 7320 3d20 7b7d 0d0a 2020 2020  pings = {}..    
-00006a00: 2020 2020 2020 2020 7472 656e 645f 7265          trend_re
-00006a10: 7369 6475 616c 7320 3d20 5b5d 0d0a 2020  siduals = []..  
-00006a20: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00006a30: 6c20 696e 2073 656c 662e 6466 2e63 6f6c  l in self.df.col
-00006a40: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
-00006a50: 2020 2020 2020 2063 5f78 203d 2078 5f61         c_x = x_a
-00006a60: 7272 6179 2e63 6f70 7928 290d 0a20 2020  rray.copy()..   
-00006a70: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00006a80: 6d70 6c65 6d65 6e74 2070 6572 5f73 6572  mplement per_ser
-00006a90: 6965 7320 686f 6c69 6461 7920 636f 756e  ies holiday coun
-00006aa0: 7472 6965 7320 666c 6167 0d0a 2020 2020  tries flag..    
-00006ab0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00006ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006ad0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
-00006ae0: 2873 656c 662e 686f 6c69 6461 795f 636f  (self.holiday_co
-00006af0: 756e 7472 6965 732c 2064 6963 7429 0d0a  untries, dict)..
-00006b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b10: 2020 2020 616e 6420 7365 6c66 2e68 6f6c      and self.hol
-00006b20: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
-00006b30: 7365 640d 0a20 2020 2020 2020 2020 2020  sed..           
-00006b40: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-00006b50: 2020 2020 2020 2020 2020 2020 2068 6320               hc 
-00006b60: 3d20 7365 6c66 2e68 6f6c 6964 6179 5f63  = self.holiday_c
-00006b70: 6f75 6e74 7269 6573 2e67 6574 2863 6f6c  ountries.get(col
-00006b80: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
-00006b90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00006ba0: 6863 2069 7320 6e6f 7420 4e6f 6e65 3a0d  hc is not None:.
-00006bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006bc0: 2020 2020 2020 2020 2063 5f68 6320 3d20           c_hc = 
-00006bd0: 686f 6c69 6461 795f 666c 6167 280d 0a20  holiday_flag(.. 
-00006be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006c00: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
-00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c20: 2020 2020 2020 2063 6f75 6e74 7279 3d68         country=h
-00006c30: 632c 0d0a 2020 2020 2020 2020 2020 2020  c,..            
-00006c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c50: 656e 636f 6465 5f68 6f6c 6964 6179 5f74  encode_holiday_t
-00006c60: 7970 653d 5472 7565 2c0d 0a20 2020 2020  ype=True,..     
+000051c0: 2020 2020 2020 6869 7374 6f72 795f 6461        history_da
+000051d0: 7973 3d73 656c 662e 6869 7374 6f72 795f  ys=self.history_
+000051e0: 6461 7973 2c0d 0a20 2020 2020 2020 2020  days,..         
+000051f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005210: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00005220: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+00005230: 4e54 4552 4143 5449 4f4e 5320 4e4f 5420  NTERACTIONS NOT 
+00005240: 494d 504c 454d 454e 5445 440d 0a20 2020  IMPLEMENTED..   
+00005250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005260: 2023 204f 5244 4552 2053 5045 4349 4649   # ORDER SPECIFI
+00005270: 4341 5449 4f4e 204e 4f54 2049 4d50 4c45  CATION NOT IMPLE
+00005280: 4d45 4e54 4544 0d0a 2020 2020 2020 2020  MENTED..        
+00005290: 2020 2020 2020 2020 735f 6466 203d 2070          s_df = p
+000052a0: 642e 636f 6e63 6174 2873 5f6c 6973 742c  d.concat(s_list,
+000052b0: 2061 7869 733d 3129 0d0a 2020 2020 2020   axis=1)..      
+000052c0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+000052d0: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+000052e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000052f0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00005300: 2273 6561 736f 6e61 6c69 7479 207b 7365  "seasonality {se
+00005310: 6173 6f6e 616c 6974 797d 2063 7265 6174  asonality} creat
+00005320: 696f 6e20 6572 726f 7222 2920 6672 6f6d  ion error") from
+00005330: 2065 0d0a 2020 2020 2020 2020 2020 2020   e..            
+00005340: 735f 6466 2e69 6e64 6578 203d 2073 656c  s_df.index = sel
+00005350: 662e 6466 2e69 6e64 6578 0d0a 2020 2020  f.df.index..    
+00005360: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
+00005370: 7070 656e 6428 735f 6466 290d 0a20 2020  ppend(s_df)..   
+00005380: 2020 2020 2023 2054 6865 7365 2066 6561       # These fea
+00005390: 7475 7265 7320 6172 6520 746f 2070 7265  tures are to pre
+000053a0: 7665 6e74 206f 7665 7266 6974 7469 6e67  vent overfitting
+000053b0: 2061 6e64 2073 7461 6e64 696e 2066 6f72   and standin for
+000053c0: 2075 6e6f 6273 6572 7665 6420 636f 6d70   unobserved comp
+000053d0: 6f6e 656e 7473 2068 6572 650d 0a20 2020  onents here..   
+000053e0: 2020 2020 2069 6620 7365 6c66 2e72 616e       if self.ran
+000053f0: 646f 6d77 616c 6b5f 6e20 6973 206e 6f74  domwalk_n is not
+00005400: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00005410: 2020 2020 785f 6c69 7374 2e61 7070 656e      x_list.appen
+00005420: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+00005430: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
+00005440: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00005450: 2020 2020 2020 206e 702e 7261 6e64 6f6d         np.random
+00005460: 2e6e 6f72 6d61 6c28 7369 7a65 3d28 6c65  .normal(size=(le
+00005470: 6e28 7365 6c66 2e64 6629 2c20 7365 6c66  n(self.df), self
+00005480: 2e72 616e 646f 6d77 616c 6b5f 6e29 292e  .randomwalk_n)).
+00005490: 6375 6d73 756d 280d 0a20 2020 2020 2020  cumsum(..       
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2061 7869 733d 300d 0a20 2020 2020 2020   axis=0..       
+000054c0: 2020 2020 2020 2020 2020 2020 2029 2c0d               ),.
+000054d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000054e0: 2020 2020 2063 6f6c 756d 6e73 3d5b 2272       columns=["r
+000054f0: 616e 646f 6d77 616c 6b5f 2220 2b20 7374  andomwalk_" + st
+00005500: 7228 7829 2066 6f72 2078 2069 6e20 7261  r(x) for x in ra
+00005510: 6e67 6528 7365 6c66 2e72 616e 646f 6d77  nge(self.randomw
+00005520: 616c 6b5f 6e29 5d2c 0d0a 2020 2020 2020  alk_n)],..      
+00005530: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00005540: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
+00005550: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
+00005560: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00005570: 2020 2029 0d0a 2020 2020 2020 2020 6966     )..        if
+00005580: 2073 656c 662e 7472 656e 645f 7374 616e   self.trend_stan
+00005590: 6469 6e20 6973 206e 6f74 204e 6f6e 653a  din is not None:
+000055a0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000055b0: 2073 656c 662e 7472 656e 645f 7374 616e   self.trend_stan
+000055c0: 6469 6e20 3d3d 2022 7261 6e64 6f6d 5f6e  din == "random_n
+000055d0: 6f72 6d61 6c22 3a0d 0a20 2020 2020 2020  ormal":..       
+000055e0: 2020 2020 2020 2020 206e 756d 5f73 7461           num_sta
+000055f0: 6e64 696e 203d 2034 0d0a 2020 2020 2020  ndin = 4..      
+00005600: 2020 2020 2020 2020 2020 785f 6c69 7374            x_list
+00005610: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+00005620: 2020 2020 2020 2020 2020 2020 2020 7064                pd
+00005630: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
+00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005650: 2020 2020 206e 702e 7261 6e64 6f6d 2e6e       np.random.n
+00005660: 6f72 6d61 6c28 7369 7a65 3d28 6c65 6e28  ormal(size=(len(
+00005670: 7365 6c66 2e64 6629 2c20 6e75 6d5f 7374  self.df), num_st
+00005680: 616e 6469 6e29 292c 0d0a 2020 2020 2020  andin)),..      
+00005690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056a0: 2020 636f 6c75 6d6e 733d 5b22 7261 6e64    columns=["rand
+000056b0: 6e6f 726d 5f22 202b 2073 7472 2878 2920  norm_" + str(x) 
+000056c0: 666f 7220 7820 696e 2072 616e 6765 286e  for x in range(n
+000056d0: 756d 5f73 7461 6e64 696e 295d 2c0d 0a20  um_standin)],.. 
+000056e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056f0: 2020 2020 2020 2069 6e64 6578 3d73 656c         index=sel
+00005700: 662e 6466 2e69 6e64 6578 2c0d 0a20 2020  f.df.index,..   
+00005710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005720: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00005730: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00005740: 2020 2065 6c69 6620 7365 6c66 2e74 7265     elif self.tre
+00005750: 6e64 5f73 7461 6e64 696e 203d 3d20 2272  nd_standin == "r
+00005760: 6f6c 6c69 6e67 5f74 7265 6e64 223a 0d0a  olling_trend":..
+00005770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005780: 7265 7369 642c 2073 6c6f 7065 2c20 696e  resid, slope, in
+00005790: 7465 7263 6570 7420 3d20 7365 6c66 2e72  tercept = self.r
+000057a0: 6f6c 6c69 6e67 5f74 7265 6e64 280d 0a20  olling_trend(.. 
+000057b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057c0: 2020 206e 702e 6173 6172 7261 7928 6466     np.asarray(df
+000057d0: 292c 206e 702e 6172 7261 7928 7365 6c66  ), np.array(self
+000057e0: 2e63 7265 6174 655f 7428 6466 2e69 6e64  .create_t(df.ind
+000057f0: 6578 2929 0d0a 2020 2020 2020 2020 2020  ex))..          
+00005800: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00005810: 2020 2020 2020 2020 2072 6573 6964 203d           resid =
+00005820: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
+00005830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005840: 2020 2020 736c 6f70 6520 2a20 6e70 2e61      slope * np.a
+00005850: 7361 7272 6179 2873 656c 662e 745f 7472  sarray(self.t_tr
+00005860: 6169 6e29 5b2e 2e2e 2c20 4e6f 6e65 5d20  ain)[..., None] 
+00005870: 2b20 696e 7465 7263 6570 742c 0d0a 2020  + intercept,..  
+00005880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005890: 2020 696e 6465 783d 6466 2e69 6e64 6578    index=df.index
+000058a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000058b0: 2020 2020 2020 2063 6f6c 756d 6e73 3d64         columns=d
+000058c0: 662e 636f 6c75 6d6e 732c 0d0a 2020 2020  f.columns,..    
+000058d0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000058e0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+000058f0: 5f6c 6973 742e 6170 7065 6e64 2872 6573  _list.append(res
+00005900: 6964 2e72 656e 616d 6528 636f 6c75 6d6e  id.rename(column
+00005910: 733d 6c61 6d62 6461 2078 3a20 2272 6f6c  s=lambda x: "rol
+00005920: 6c69 6e67 5f74 7265 6e64 5f22 202b 2073  ling_trend_" + s
+00005930: 7472 2878 2929 290d 0a20 2020 2020 2020  tr(x)))..       
+00005940: 2069 6620 6675 7475 7265 5f72 6567 7265   if future_regre
+00005950: 7373 6f72 2069 7320 6e6f 7420 4e6f 6e65  ssor is not None
+00005960: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+00005970: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
+00005980: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005990: 7265 6772 6573 736f 725f 7472 616e 7366  regressor_transf
+000059a0: 6f72 6d61 7469 6f6e 2069 7320 6e6f 7420  ormation is not 
+000059b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000059c0: 2020 2020 2020 2073 656c 662e 7265 6772         self.regr
+000059d0: 6573 736f 725f 7472 616e 7366 6f72 6d65  essor_transforme
+000059e0: 7220 3d20 4765 6e65 7261 6c54 7261 6e73  r = GeneralTrans
+000059f0: 666f 726d 6572 280d 0a20 2020 2020 2020  former(..       
+00005a00: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+00005a10: 656c 662e 7265 6772 6573 736f 725f 7472  elf.regressor_tr
+00005a20: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
+00005a30: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00005a40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00005a50: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005a60: 2020 2020 7365 6c66 2e72 6567 7265 7373      self.regress
+00005a70: 6f72 5f74 7261 6e73 666f 726d 6572 203d  or_transformer =
+00005a80: 2047 656e 6572 616c 5472 616e 7366 6f72   GeneralTransfor
+00005a90: 6d65 7228 2a2a 7b27 6669 6c6c 6e61 273a  mer(**{'fillna':
+00005aa0: 2027 6666 696c 6c27 7d29 0d0a 2020 2020   'ffill'})..    
+00005ab0: 2020 2020 2020 2020 7365 6c66 2e66 7574          self.fut
+00005ac0: 7572 655f 7265 6772 6573 736f 725f 7472  ure_regressor_tr
+00005ad0: 6169 6e20 3d20 7365 6c66 2e72 6567 7265  ain = self.regre
+00005ae0: 7373 6f72 5f74 7261 6e73 666f 726d 6572  ssor_transformer
+00005af0: 2e66 6974 5f74 7261 6e73 666f 726d 280d  .fit_transform(.
+00005b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b10: 2063 6c65 616e 5f72 6567 7265 7373 6f72   clean_regressor
+00005b20: 2866 7574 7572 655f 7265 6772 6573 736f  (future_regresso
+00005b30: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+00005b40: 292e 6669 6c6c 6e61 2830 290d 0a20 2020  ).fillna(0)..   
+00005b50: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
+00005b60: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00005b70: 2020 2020 2020 2020 2073 656c 662e 6675           self.fu
+00005b80: 7475 7265 5f72 6567 7265 7373 6f72 5f74  ture_regressor_t
+00005b90: 7261 696e 2e72 6569 6e64 6578 2873 656c  rain.reindex(sel
+00005ba0: 662e 6466 2e69 6e64 6578 2c20 6669 6c6c  f.df.index, fill
+00005bb0: 5f76 616c 7565 3d30 290d 0a20 2020 2020  _value=0)..     
+00005bc0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00005bd0: 2020 6966 2066 6c61 675f 7265 6772 6573    if flag_regres
+00005be0: 736f 7273 2069 7320 6e6f 7420 4e6f 6e65  sors is not None
+00005bf0: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+00005c00: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
+00005c10: 2020 2020 2020 2020 7365 6c66 2e66 6c61          self.fla
+00005c20: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
+00005c30: 6e20 3d20 636c 6561 6e5f 7265 6772 6573  n = clean_regres
+00005c40: 736f 7228 0d0a 2020 2020 2020 2020 2020  sor(..          
+00005c50: 2020 2020 2020 666c 6167 5f72 6567 7265        flag_regre
+00005c60: 7373 6f72 732c 2070 7265 6669 783d 2272  ssors, prefix="r
+00005c70: 6567 7266 6c61 6773 5f22 0d0a 2020 2020  egrflags_"..    
+00005c80: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00005c90: 2020 2020 2020 2078 5f6c 6973 742e 6170         x_list.ap
+00005ca0: 7065 6e64 2873 656c 662e 666c 6167 5f72  pend(self.flag_r
+00005cb0: 6567 7265 7373 6f72 5f74 7261 696e 2e72  egressor_train.r
+00005cc0: 6569 6e64 6578 2873 656c 662e 6466 2e69  eindex(self.df.i
+00005cd0: 6e64 6578 2929 0d0a 2020 2020 2020 2020  ndex))..        
+00005ce0: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+00005cf0: 2020 7365 6c66 2e68 6f6c 6964 6179 5f63    self.holiday_c
+00005d00: 6f75 6e74 7269 6573 2069 7320 6e6f 7420  ountries is not 
+00005d10: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00005d20: 2020 616e 6420 6e6f 7420 6973 696e 7374    and not isinst
+00005d30: 616e 6365 2873 656c 662e 686f 6c69 6461  ance(self.holida
+00005d40: 795f 636f 756e 7472 6965 732c 2064 6963  y_countries, dic
+00005d50: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00005d60: 616e 6420 7365 6c66 2e68 6f6c 6964 6179  and self.holiday
+00005d70: 5f63 6f75 6e74 7269 6573 5f75 7365 640d  _countries_used.
+00005d80: 0a20 2020 2020 2020 2029 3a0d 0a20 2020  .        ):..   
+00005d90: 2020 2020 2020 2020 2066 6f72 2068 6f6c           for hol
+00005da0: 6964 6179 5f63 6f75 6e74 7279 2069 6e20  iday_country in 
+00005db0: 7365 6c66 2e68 6f6c 6964 6179 5f63 6f75  self.holiday_cou
+00005dc0: 6e74 7269 6573 3a0d 0a20 2020 2020 2020  ntries:..       
+00005dd0: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
+00005de0: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00005df0: 2020 2020 2020 2020 2020 2020 2068 6f6c               hol
+00005e00: 6964 6179 5f66 6c61 6728 0d0a 2020 2020  iday_flag(..    
+00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e20: 2020 2020 7365 6c66 2e64 662e 696e 6465      self.df.inde
+00005e30: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
+00005e40: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+00005e50: 7472 793d 686f 6c69 6461 795f 636f 756e  try=holiday_coun
+00005e60: 7472 792c 0d0a 2020 2020 2020 2020 2020  try,..          
+00005e70: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00005e80: 636f 6465 5f68 6f6c 6964 6179 5f74 7970  code_holiday_typ
+00005e90: 653d 5472 7565 2c0d 0a20 2020 2020 2020  e=True,..       
+00005ea0: 2020 2020 2020 2020 2020 2020 2029 2e72               ).r
+00005eb0: 656e 616d 6528 636f 6c75 6d6e 733d 6c61  ename(columns=la
+00005ec0: 6d62 6461 2078 3a20 2268 6f6c 6964 6179  mbda x: "holiday
+00005ed0: 5f22 202b 2073 7472 2878 2929 2c0d 0a20  _" + str(x)),.. 
+00005ee0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00005ef0: 0d0a 2020 2020 2020 2020 2320 7075 7420  ..        # put 
+00005f00: 7468 6973 2074 6f20 7468 6520 656e 6420  this to the end 
+00005f10: 6173 2069 7420 7461 6b65 7320 7570 206c  as it takes up l
+00005f20: 6f74 7320 6f66 2066 6561 7475 7265 2073  ots of feature s
+00005f30: 7061 6365 2073 6f6d 6574 696d 6573 0d0a  pace sometimes..
+00005f40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005f50: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
+00005f60: 5f70 6172 616d 7320 6973 206e 6f74 204e  _params is not N
+00005f70: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00005f80: 2020 785f 6c69 7374 2e61 7070 656e 6428    x_list.append(
+00005f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005fa0: 2020 7365 6c66 2e68 6f6c 6964 6179 5f64    self.holiday_d
+00005fb0: 6574 6563 746f 722e 6461 7465 735f 746f  etector.dates_to
+00005fc0: 5f68 6f6c 6964 6179 7328 7365 6c66 2e64  _holidays(self.d
+00005fd0: 662e 696e 6465 782c 2073 7479 6c65 3d22  f.index, style="
+00005fe0: 666c 6167 2229 0d0a 2020 2020 2020 2020  flag")..        
+00005ff0: 2020 2020 2020 2020 2e63 6c69 7028 7570          .clip(up
+00006000: 7065 723d 3129 0d0a 2020 2020 2020 2020  per=1)..        
+00006010: 2020 2020 2020 2020 2e72 656e 616d 6528          .rename(
+00006020: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
+00006030: 3a20 2268 6f6c 6964 6179 5f22 202b 2073  : "holiday_" + s
+00006040: 7472 2878 2929 0d0a 2020 2020 2020 2020  tr(x))..        
+00006050: 2020 2020 290d 0a0d 0a20 2020 2020 2020      )....       
+00006060: 2023 2046 494e 414c 2046 4541 5455 5245   # FINAL FEATURE
+00006070: 2050 524f 4345 5353 494e 470d 0a20 2020   PROCESSING..   
+00006080: 2020 2020 2078 5f61 7272 6179 203d 2070       x_array = p
+00006090: 642e 636f 6e63 6174 2878 5f6c 6973 742c  d.concat(x_list,
+000060a0: 2061 7869 733d 3129 0d0a 2020 2020 2020   axis=1)..      
+000060b0: 2020 7365 6c66 2e78 5f61 7272 6179 203d    self.x_array =
+000060c0: 2078 5f61 7272 6179 2020 2320 6361 6e20   x_array  # can 
+000060d0: 7265 6d6f 7665 2074 6869 7320 6c61 7465  remove this late
+000060e0: 722c 2069 7420 6973 2066 6f72 2064 6562  r, it is for deb
+000060f0: 7567 6769 6e67 0d0a 2020 2020 2020 2020  ugging..        
+00006100: 6966 206e 702e 616e 7928 6e70 2e69 736e  if np.any(np.isn
+00006110: 616e 2878 5f61 7272 6179 2e61 7374 7970  an(x_array.astyp
+00006120: 6528 666c 6f61 7429 2929 3a20 2023 2072  e(float))):  # r
+00006130: 656d 6f76 6520 6c61 7465 722c 2066 6f72  emove later, for
+00006140: 2064 6562 7567 6769 6e67 0d0a 2020 2020   debugging..    
+00006150: 2020 2020 2020 2020 6e75 6c7a 203d 2078          nulz = x
+00006160: 5f61 7272 6179 2e69 736e 756c 6c28 292e  _array.isnull().
+00006170: 7375 6d28 290d 0a20 2020 2020 2020 2020  sum()..         
+00006180: 2020 2070 7269 6e74 280d 0a20 2020 2020     print(..     
+00006190: 2020 2020 2020 2020 2020 2066 2274 6865             f"the
+000061a0: 2066 6f6c 6c6f 7769 6e67 2063 6f6c 756d   following colum
+000061b0: 6e73 2063 6f6e 7461 696e 206e 616e 2076  ns contain nan v
+000061c0: 616c 7565 733a 207b 6e75 6c7a 5b6e 756c  alues: {nulz[nul
+000061d0: 7a20 3e20 305d 2e69 6e64 6578 2e74 6f6c  z > 0].index.tol
+000061e0: 6973 7428 297d 220d 0a20 2020 2020 2020  ist()}"..       
+000061f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00006200: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00006210: 7272 6f72 2822 6e61 6e20 7661 6c75 6573  rror("nan values
+00006220: 2069 6e20 785f 6172 7261 7922 290d 0a20   in x_array").. 
+00006230: 2020 2020 2020 2069 6620 6e70 2e61 6c6c         if np.all
+00006240: 2873 656c 662e 6466 203d 3d20 3029 3a0d  (self.df == 0):.
+00006250: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00006260: 7365 2056 616c 7565 4572 726f 7228 2274  se ValueError("t
+00006270: 7261 6e73 666f 726d 6564 2064 6174 6120  ransformed data 
+00006280: 6973 2061 6c6c 207a 6572 6f65 7322 290d  is all zeroes").
+00006290: 0a20 2020 2020 2020 2069 6620 6e70 2e61  .        if np.a
+000062a0: 6e79 2828 7365 6c66 2e64 662e 6973 6e75  ny((self.df.isnu
+000062b0: 6c6c 2829 2e61 6c6c 2829 2929 3a0d 0a20  ll().all())):.. 
+000062c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000062d0: 2056 616c 7565 4572 726f 7228 2274 7261   ValueError("tra
+000062e0: 6e73 666f 726d 6564 2064 6620 6861 7320  nsformed df has 
+000062f0: 4e61 4e20 6669 6c6c 6564 2073 6572 6965  NaN filled serie
+00006300: 7322 290d 0a20 2020 2020 2020 2023 2072  s")..        # r
+00006310: 656d 6f76 6520 7a65 726f 2076 6172 6961  emove zero varia
+00006320: 6e63 6520 2863 6f72 7220 6973 206e 616e  nce (corr is nan
+00006330: 290d 0a20 2020 2020 2020 2063 6f72 7220  )..        corr 
+00006340: 3d20 6e70 2e63 6f72 7263 6f65 6628 785f  = np.corrcoef(x_
+00006350: 6172 7261 792c 2072 6f77 7661 723d 3029  array, rowvar=0)
+00006360: 0d0a 2020 2020 2020 2020 6e65 6172 7a20  ..        nearz 
+00006370: 3d20 785f 6172 7261 792e 636f 6c75 6d6e  = x_array.column
+00006380: 735b 6e70 2e69 736e 616e 2863 6f72 7229  s[np.isnan(corr)
+00006390: 2e61 6c6c 2861 7869 733d 3129 5d0d 0a20  .all(axis=1)].. 
+000063a0: 2020 2020 2020 2069 6620 6c65 6e28 6e65         if len(ne
+000063b0: 6172 7a29 203e 2030 3a0d 0a20 2020 2020  arz) > 0:..     
+000063c0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
+000063d0: 6572 626f 7365 203e 2031 3a0d 0a20 2020  erbose > 1:..   
+000063e0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000063f0: 6e74 2866 2244 726f 7070 696e 6720 7a65  nt(f"Dropping ze
+00006400: 726f 2076 6172 6961 6e63 6520 6665 6174  ro variance feat
+00006410: 7572 6520 636f 6c75 6d6e 7320 7b6e 6561  ure columns {nea
+00006420: 727a 7d22 290d 0a20 2020 2020 2020 2020  rz}")..         
+00006430: 2020 2078 5f61 7272 6179 203d 2078 5f61     x_array = x_a
+00006440: 7272 6179 2e64 726f 7028 636f 6c75 6d6e  rray.drop(column
+00006450: 733d 6e65 6172 7a29 0d0a 2020 2020 2020  s=nearz)..      
+00006460: 2020 2320 7265 6d6f 7665 2063 6f6c 696e    # remove colin
+00006470: 6561 7220 6665 6174 7572 6573 0d0a 2020  ear features..  
+00006480: 2020 2020 2020 2320 4e4f 5445 2054 4845        # NOTE THE
+00006490: 5345 2052 454d 4f56 414c 5320 5245 4d4f  SE REMOVALS REMO
+000064a0: 5645 2054 4845 2046 4952 5354 204f 4620  VE THE FIRST OF 
+000064b0: 5041 4952 2043 4f4c 554d 4e20 4649 5253  PAIR COLUMN FIRS
+000064c0: 540d 0a20 2020 2020 2020 2063 6f72 7220  T..        corr 
+000064d0: 3d20 6e70 2e63 6f72 7263 6f65 6628 785f  = np.corrcoef(x_
+000064e0: 6172 7261 792c 2072 6f77 7661 723d 3029  array, rowvar=0)
+000064f0: 2020 2320 7365 636f 6e64 206f 6e65 0d0a    # second one..
+00006500: 2020 2020 2020 2020 772c 2076 6563 203d          w, vec =
+00006510: 206e 702e 6c69 6e61 6c67 2e65 6967 2863   np.linalg.eig(c
+00006520: 6f72 7229 0d0a 2020 2020 2020 2020 6e70  orr)..        np
+00006530: 2e66 696c 6c5f 6469 6167 6f6e 616c 2863  .fill_diagonal(c
+00006540: 6f72 722c 2030 290d 0a20 2020 2020 2020  orr, 0)..       
+00006550: 2069 6620 7365 6c66 2e6d 6178 5f63 6f6c   if self.max_col
+00006560: 696e 6561 7269 7479 2069 7320 6e6f 7420  inearity is not 
+00006570: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00006580: 2020 2063 6f72 656c 203d 2078 5f61 7272     corel = x_arr
+00006590: 6179 2e63 6f6c 756d 6e73 5b0d 0a20 2020  ay.columns[..   
+000065a0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+000065b0: 6d69 6e28 636f 7272 202a 206e 702e 7472  min(corr * np.tr
+000065c0: 6928 636f 7272 2e73 6861 7065 5b30 5d29  i(corr.shape[0])
+000065d0: 2c20 6178 6973 3d30 2920 3e20 7365 6c66  , axis=0) > self
+000065e0: 2e6d 6178 5f63 6f6c 696e 6561 7269 7479  .max_colinearity
+000065f0: 0d0a 2020 2020 2020 2020 2020 2020 5d0d  ..            ].
+00006600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006610: 6c65 6e28 636f 7265 6c29 203e 2030 3a0d  len(corel) > 0:.
+00006620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006630: 2069 6620 7365 6c66 2e76 6572 626f 7365   if self.verbose
+00006640: 203e 2031 3a0d 0a20 2020 2020 2020 2020   > 1:..         
+00006650: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00006660: 2866 2244 726f 7070 696e 6720 636f 6c69  (f"Dropping coli
+00006670: 6e65 6172 2066 6561 7475 7265 2063 6f6c  near feature col
+00006680: 756d 6e73 207b 636f 7265 6c7d 2229 0d0a  umns {corel}")..
+00006690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066a0: 785f 6172 7261 7920 3d20 785f 6172 7261  x_array = x_arra
+000066b0: 792e 6472 6f70 2863 6f6c 756d 6e73 3d63  y.drop(columns=c
+000066c0: 6f72 656c 290d 0a20 2020 2020 2020 2069  orel)..        i
+000066d0: 6620 7365 6c66 2e6d 6178 5f6d 756c 7469  f self.max_multi
+000066e0: 636f 6c69 6e65 6172 6974 7920 6973 206e  colinearity is n
+000066f0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00006700: 2020 2020 2020 636f 6c69 6e20 3d20 785f        colin = x_
+00006710: 6172 7261 792e 636f 6c75 6d6e 735b 7720  array.columns[w 
+00006720: 3c20 7365 6c66 2e6d 6178 5f6d 756c 7469  < self.max_multi
+00006730: 636f 6c69 6e65 6172 6974 795d 0d0a 2020  colinearity]..  
+00006740: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00006750: 2863 6f6c 696e 2920 3e20 303a 0d0a 2020  (colin) > 0:..  
+00006760: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006770: 2073 656c 662e 7665 7262 6f73 6520 3e20   self.verbose > 
+00006780: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00006790: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+000067a0: 4472 6f70 7069 6e67 206d 756c 7469 2d63  Dropping multi-c
+000067b0: 6f6c 696e 6561 7220 6665 6174 7572 6520  olinear feature 
+000067c0: 636f 6c75 6d6e 7320 7b63 6f6c 696e 7d22  columns {colin}"
+000067d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000067e0: 2020 2078 5f61 7272 6179 203d 2078 5f61     x_array = x_a
+000067f0: 7272 6179 2e64 726f 7028 636f 6c75 6d6e  rray.drop(column
+00006800: 733d 636f 6c69 6e29 0d0a 0d0a 2020 2020  s=colin)....    
+00006810: 2020 2020 2320 7468 696e 6773 2077 6520      # things we 
+00006820: 7761 6e74 206d 6f64 656c 6564 2062 7574  want modeled but
+00006830: 2077 616e 7420 746f 2064 6973 6361 7264   want to discard
+00006840: 2066 726f 6d20 6576 616c 7561 7469 6f6e   from evaluation
+00006850: 2028 7374 616e 6469 6e73 290d 0a20 2020   (standins)..   
+00006860: 2020 2020 2072 656d 6f76 655f 7061 7474       remove_patt
+00006870: 6572 6e73 203d 205b 0d0a 2020 2020 2020  erns = [..      
+00006880: 2020 2020 2020 2272 616e 646e 6f72 6d5f        "randnorm_
+00006890: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000068a0: 2272 6f6c 6c69 6e67 5f74 7265 6e64 5f22  "rolling_trend_"
+000068b0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+000068c0: 7261 6e64 6f6d 7761 6c6b 5f22 2c0d 0a20  randomwalk_",.. 
+000068d0: 2020 2020 2020 205d 2020 2320 2269 6e74         ]  # "int
+000068e0: 6572 6365 7074 2220 6164 6465 6420 6166  ercept" added af
+000068f0: 7465 722c 2073 6f20 6e6f 7420 696e 636c  ter, so not incl
+00006900: 7564 6564 0d0a 0d0a 2020 2020 2020 2020  uded....        
+00006910: 2320 5255 4e20 4c49 4e45 4152 204d 4f44  # RUN LINEAR MOD
+00006920: 454c 0d0a 2020 2020 2020 2020 2320 6164  EL..        # ad
+00006930: 6420 7820 6665 6174 7572 6573 2074 6861  d x features tha
+00006940: 7420 646f 6e27 7420 6170 706c 7920 746f  t don't apply to
+00006950: 2061 6c6c 2c20 616e 6420 6e65 6564 2074   all, and need t
+00006960: 6f20 6265 206c 6f6f 7065 640d 0a20 2020  o be looped..   
+00006970: 2020 2020 2069 6620 7365 6c66 2e6c 6f6f       if self.loo
+00006980: 705f 7265 7175 6972 6564 3a0d 0a20 2020  p_required:..   
+00006990: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+000069a0: 7261 6d73 203d 207b 7d0d 0a20 2020 2020  rams = {}..     
+000069b0: 2020 2020 2020 2073 656c 662e 6b65 6570         self.keep
+000069c0: 5f63 6f6c 7320 3d20 7b7d 0d0a 2020 2020  _cols = {}..    
+000069d0: 2020 2020 2020 2020 7365 6c66 2e78 5f61          self.x_a
+000069e0: 7272 6179 203d 207b 7d0d 0a20 2020 2020  rray = {}..     
+000069f0: 2020 2020 2020 2073 656c 662e 6b65 6570         self.keep
+00006a00: 5f63 6f6c 735f 6964 7820 3d20 7b7d 0d0a  _cols_idx = {}..
+00006a10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006a20: 2e63 6f6c 5f67 726f 7570 696e 6773 203d  .col_groupings =
+00006a30: 207b 7d0d 0a20 2020 2020 2020 2020 2020   {}..           
+00006a40: 2074 7265 6e64 5f72 6573 6964 7561 6c73   trend_residuals
+00006a50: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+00006a60: 2020 2066 6f72 2063 6f6c 2069 6e20 7365     for col in se
+00006a70: 6c66 2e64 662e 636f 6c75 6d6e 733a 0d0a  lf.df.columns:..
+00006a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a90: 635f 7820 3d20 785f 6172 7261 792e 636f  c_x = x_array.co
+00006aa0: 7079 2829 0d0a 2020 2020 2020 2020 2020  py()..          
+00006ab0: 2020 2020 2020 2320 696d 706c 656d 656e        # implemen
+00006ac0: 7420 7065 725f 7365 7269 6573 2068 6f6c  t per_series hol
+00006ad0: 6964 6179 2063 6f75 6e74 7269 6573 2066  iday countries f
+00006ae0: 6c61 670d 0a20 2020 2020 2020 2020 2020  lag..           
+00006af0: 2020 2020 2069 6620 280d 0a20 2020 2020       if (..     
+00006b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00006b10: 7369 6e73 7461 6e63 6528 7365 6c66 2e68  sinstance(self.h
+00006b20: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
+00006b30: 2c20 6469 6374 290d 0a20 2020 2020 2020  , dict)..       
+00006b40: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00006b50: 2073 656c 662e 686f 6c69 6461 795f 636f   self.holiday_co
+00006b60: 756e 7472 6965 735f 7573 6564 0d0a 2020  untries_used..  
+00006b70: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+00006b80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006b90: 2020 2020 2020 6863 203d 2073 656c 662e        hc = self.
+00006ba0: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
+00006bb0: 732e 6765 7428 636f 6c2c 204e 6f6e 6529  s.get(col, None)
+00006bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006bd0: 2020 2020 2020 6966 2068 6320 6973 206e        if hc is n
+00006be0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00006bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c00: 2020 635f 6863 203d 2068 6f6c 6964 6179    c_hc = holiday
+00006c10: 5f66 6c61 6728 0d0a 2020 2020 2020 2020  _flag(..        
+00006c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c30: 2020 2020 7365 6c66 2e64 662e 696e 6465      self.df.inde
+00006c40: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
+00006c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c60: 636f 756e 7472 793d 6863 2c0d 0a20 2020  country=hc,..   
 00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c80: 2020 2029 2e72 656e 616d 6528 636f 6c75     ).rename(colu
-00006c90: 6d6e 733d 6c61 6d62 6461 2078 3a20 2268  mns=lambda x: "h
-00006ca0: 6f6c 6964 6179 5f22 202b 2073 7472 2878  oliday_" + str(x
-00006cb0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00006cc0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00006cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ce0: 2020 2020 2020 2063 5f68 6320 3d20 7064         c_hc = pd
-00006cf0: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
-00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d10: 2020 2020 2020 2020 2030 2c20 696e 6465           0, inde
-00006d20: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
-00006d30: 2063 6f6c 756d 6e73 3d5b 2268 6f6c 6964   columns=["holid
-00006d40: 6179 5f30 225d 0d0a 2020 2020 2020 2020  ay_0"]..        
-00006d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00006d70: 2020 2020 2020 2063 5f78 203d 2070 642e         c_x = pd.
-00006d80: 636f 6e63 6174 285b 635f 782c 2063 5f68  concat([c_x, c_h
-00006d90: 635d 2c20 6178 6973 3d31 290d 0a20 2020  c], axis=1)..   
-00006da0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00006db0: 6d70 6c65 6d65 6e74 2072 6567 7265 7373  mplement regress
-00006dc0: 6f72 7320 7065 7220 7365 7269 6573 0d0a  ors per series..
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
-00006df0: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
-00006e00: 6573 2c20 6469 6374 2920 616e 6420 7365  es, dict) and se
-00006e10: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
-00006e20: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00006e30: 2020 2020 2020 2020 2068 6320 3d20 7265           hc = re
-00006e40: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
-00006e50: 6573 2e67 6574 2863 6f6c 2c20 4e6f 6e65  es.get(col, None
-00006e60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00006e70: 2020 2020 2020 2069 6620 6863 2069 7320         if hc is 
-00006e80: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ea0: 2020 2063 5f68 6320 3d20 280d 0a20 2020     c_hc = (..   
-00006eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ec0: 2020 2020 2020 2020 2070 642e 4461 7461           pd.Data
-00006ed0: 4672 616d 6528 6863 290d 0a20 2020 2020  Frame(hc)..     
-00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ef0: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
-00006f00: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
-00006f10: 2022 7265 6772 7065 7273 6572 6965 735f   "regrperseries_
-00006f20: 2220 2b20 7374 7228 7829 290d 0a20 2020  " + str(x))..   
-00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f40: 2020 2020 2020 2020 202e 7265 696e 6465           .reinde
-00006f50: 7828 7365 6c66 2e64 662e 696e 6465 7829  x(self.df.index)
-00006f60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006f70: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00006c80: 2020 2020 2020 2020 2065 6e63 6f64 655f           encode_
+00006c90: 686f 6c69 6461 795f 7479 7065 3d54 7275  holiday_type=Tru
+00006ca0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00006cb0: 2020 2020 2020 2020 2020 2020 292e 7265              ).re
+00006cc0: 6e61 6d65 2863 6f6c 756d 6e73 3d6c 616d  name(columns=lam
+00006cd0: 6264 6120 783a 2022 686f 6c69 6461 795f  bda x: "holiday_
+00006ce0: 2220 2b20 7374 7228 7829 290d 0a20 2020  " + str(x))..   
+00006cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d00: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d20: 635f 6863 203d 2070 642e 4461 7461 4672  c_hc = pd.DataFr
+00006d30: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
+00006d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d50: 2020 302c 2069 6e64 6578 3d73 656c 662e    0, index=self.
+00006d60: 6466 2e69 6e64 6578 2c20 636f 6c75 6d6e  df.index, column
+00006d70: 733d 5b22 686f 6c69 6461 795f 3022 5d0d  s=["holiday_0"].
+00006d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006d90: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00006da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006db0: 635f 7820 3d20 7064 2e63 6f6e 6361 7428  c_x = pd.concat(
+00006dc0: 5b63 5f78 2c20 635f 6863 5d2c 2061 7869  [c_x, c_hc], axi
+00006dd0: 733d 3129 0d0a 2020 2020 2020 2020 2020  s=1)..          
+00006de0: 2020 2020 2020 2320 696d 706c 656d 656e        # implemen
+00006df0: 7420 7265 6772 6573 736f 7273 2070 6572  t regressors per
+00006e00: 2073 6572 6965 730d 0a20 2020 2020 2020   series..       
+00006e10: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00006e20: 7374 616e 6365 2872 6567 7265 7373 6f72  stance(regressor
+00006e30: 5f70 6572 5f73 6572 6965 732c 2064 6963  _per_series, dic
+00006e40: 7429 2061 6e64 2073 656c 662e 7265 6772  t) and self.regr
+00006e50: 6573 736f 7273 5f75 7365 643a 0d0a 2020  essors_used:..  
+00006e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e70: 2020 6863 203d 2072 6567 7265 7373 6f72    hc = regressor
+00006e80: 5f70 6572 5f73 6572 6965 732e 6765 7428  _per_series.get(
+00006e90: 636f 6c2c 204e 6f6e 6529 0d0a 2020 2020  col, None)..    
+00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006eb0: 6966 2068 6320 6973 206e 6f74 204e 6f6e  if hc is not Non
+00006ec0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00006ed0: 2020 2020 2020 2020 2020 2020 635f 6863              c_hc
+00006ee0: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f00: 2020 7064 2e44 6174 6146 7261 6d65 2868    pd.DataFrame(h
+00006f10: 6329 0d0a 2020 2020 2020 2020 2020 2020  c)..            
+00006f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f30: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
+00006f40: 6c61 6d62 6461 2078 3a20 2272 6567 7270  lambda x: "regrp
+00006f50: 6572 7365 7269 6573 5f22 202b 2073 7472  erseries_" + str
+00006f60: 2878 2929 0d0a 2020 2020 2020 2020 2020  (x))..          
+00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f80: 2020 2e72 6569 6e64 6578 2873 656c 662e    .reindex(self.
+00006f90: 6466 2e69 6e64 6578 290d 0a20 2020 2020  df.index)..     
 00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 635f 6863 203d 2070 642e 4461 7461 4672  c_hc = pd.DataFr
-00006fc0: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
-00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fe0: 2020 302c 2069 6e64 6578 3d73 656c 662e    0, index=self.
-00006ff0: 6466 2e69 6e64 6578 2c20 636f 6c75 6d6e  df.index, column
-00007000: 733d 5b22 7265 6772 7065 7273 6572 6965  s=["regrperserie
-00007010: 735f 3022 5d0d 0a20 2020 2020 2020 2020  s_0"]..         
-00007020: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00007030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007040: 2020 2020 2020 635f 7820 3d20 7064 2e63        c_x = pd.c
-00007050: 6f6e 6361 7428 5b63 5f78 2c20 635f 6863  oncat([c_x, c_hc
-00007060: 5d2c 2061 7869 733d 3129 0d0a 2020 2020  ], axis=1)..    
-00007070: 2020 2020 2020 2020 2020 2020 2320 696d              # im
-00007080: 706c 656d 656e 7420 7061 7374 5f69 6d70  plement past_imp
-00007090: 6163 7473 2061 7320 7265 6772 6573 736f  acts as regresso
-000070a0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-000070b0: 2020 2069 6620 280d 0a20 2020 2020 2020     if (..       
-000070c0: 2020 2020 2020 2020 2020 2020 2069 7369               isi
-000070d0: 6e73 7461 6e63 6528 7061 7374 5f69 6d70  nstance(past_imp
-000070e0: 6163 7473 2c20 7064 2e44 6174 6146 7261  acts, pd.DataFra
-000070f0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00007100: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
-00007110: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
-00007120: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
-00007130: 7265 6772 6573 736f 7222 0d0a 2020 2020  regressor"..    
-00007140: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
-00007150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007160: 2020 2020 635f 7820 3d20 7064 2e63 6f6e      c_x = pd.con
-00007170: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
-00007180: 2020 2020 2020 2020 2020 2020 2020 5b0d                [.
-00007190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000071a0: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
-000071b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000071c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000071d0: 6173 745f 696d 7061 6374 735b 636f 6c5d  ast_impacts[col]
-000071e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000071f0: 2020 2020 2020 2020 2020 2020 2020 2e74                .t
-00007200: 6f5f 6672 616d 6528 290d 0a20 2020 2020  o_frame()..     
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
-00007230: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
-00007240: 2022 696d 7061 6374 735f 2220 2b20 7374   "impacts_" + st
-00007250: 7228 7829 292c 0d0a 2020 2020 2020 2020  r(x)),..        
-00007260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007270: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00007280: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00007290: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
-000072a0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-000072b0: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
-000072c0: 6420 4152 2066 6561 7475 7265 730d 0a20  d AR features.. 
-000072d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000072e0: 6620 7365 6c66 2e61 725f 6c61 6773 2069  f self.ar_lags i
-000072f0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00007300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007310: 2066 6f72 206c 6167 2069 6e20 7365 6c66   for lag in self
-00007320: 2e61 725f 6c61 6773 3a0d 0a20 2020 2020  .ar_lags:..     
-00007330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007340: 2020 206c 6167 5f69 6478 203d 206e 702e     lag_idx = np.
-00007350: 636f 6e63 6174 656e 6174 6528 0d0a 2020  concatenate(..  
-00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007370: 2020 2020 2020 2020 2020 5b6e 702e 7265            [np.re
-00007380: 7065 6174 285b 305d 2c20 6c61 6729 2c20  peat([0], lag), 
-00007390: 6e70 2e61 7261 6e67 6528 6c65 6e28 7365  np.arange(len(se
-000073a0: 6c66 2e64 6629 295d 0d0a 2020 2020 2020  lf.df))]..      
-000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073c0: 2020 295b 3020 3a20 6c65 6e28 7365 6c66    )[0 : len(self
-000073d0: 2e64 6629 5d0d 0a20 2020 2020 2020 2020  .df)]..         
-000073e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000073f0: 6167 5f73 203d 2073 656c 662e 6466 5b63  ag_s = self.df[c
-00007400: 6f6c 5d2e 696c 6f63 5b6c 6167 5f69 6478  ol].iloc[lag_idx
-00007410: 5d2e 7265 6e61 6d65 2866 226c 6167 7b6c  ].rename(f"lag{l
-00007420: 6167 7d5f 2229 0d0a 2020 2020 2020 2020  ag}_")..        
-00007430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007440: 6c61 675f 732e 696e 6465 7820 3d20 7365  lag_s.index = se
-00007450: 6c66 2e64 662e 696e 6465 780d 0a20 2020  lf.df.index..   
-00007460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007470: 2020 2020 2069 6620 7365 6c66 2e61 725f       if self.ar_
-00007480: 696e 7465 7261 6374 696f 6e5f 7365 6173  interaction_seas
-00007490: 6f6e 616c 6974 7920 6973 206e 6f74 204e  onality is not N
-000074a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000074b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074c0: 2020 735f 6665 6174 203d 2063 7265 6174    s_feat = creat
-000074d0: 655f 7365 6173 6f6e 616c 6974 795f 6665  e_seasonality_fe
-000074e0: 6174 7572 6528 0d0a 2020 2020 2020 2020  ature(..        
-000074f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007500: 2020 2020 2020 2020 7365 6c66 2e64 662e          self.df.
-00007510: 696e 6465 782c 0d0a 2020 2020 2020 2020  index,..        
-00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007530: 2020 2020 2020 2020 7365 6c66 2e74 5f74          self.t_t
-00007540: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
-00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007560: 2020 2020 2020 2073 656c 662e 6172 5f69         self.ar_i
-00007570: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
-00007580: 6e61 6c69 7479 2c0d 0a20 2020 2020 2020  nality,..       
+00006fb0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00006fc0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00006fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fe0: 2020 2020 2020 2020 2063 5f68 6320 3d20           c_hc = 
+00006ff0: 7064 2e44 6174 6146 7261 6d65 280d 0a20  pd.DataFrame(.. 
+00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007010: 2020 2020 2020 2020 2020 2030 2c20 696e             0, in
+00007020: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
+00007030: 782c 2063 6f6c 756d 6e73 3d5b 2272 6567  x, columns=["reg
+00007040: 7270 6572 7365 7269 6573 5f30 225d 0d0a  rperseries_0"]..
+00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007060: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00007070: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007080: 5f78 203d 2070 642e 636f 6e63 6174 285b  _x = pd.concat([
+00007090: 635f 782c 2063 5f68 635d 2c20 6178 6973  c_x, c_hc], axis
+000070a0: 3d31 290d 0a20 2020 2020 2020 2020 2020  =1)..           
+000070b0: 2020 2020 2023 2069 6d70 6c65 6d65 6e74       # implement
+000070c0: 2070 6173 745f 696d 7061 6374 7320 6173   past_impacts as
+000070d0: 2072 6567 7265 7373 6f72 0d0a 2020 2020   regressor..    
+000070e0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000070f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007100: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
+00007110: 2870 6173 745f 696d 7061 6374 732c 2070  (past_impacts, p
+00007120: 642e 4461 7461 4672 616d 6529 0d0a 2020  d.DataFrame)..  
+00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007140: 2020 616e 6420 7365 6c66 2e70 6173 745f    and self.past_
+00007150: 696d 7061 6374 735f 696e 7465 7276 656e  impacts_interven
+00007160: 7469 6f6e 203d 3d20 2272 6567 7265 7373  tion == "regress
+00007170: 6f72 220d 0a20 2020 2020 2020 2020 2020  or"..           
+00007180: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+00007190: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
+000071a0: 203d 2070 642e 636f 6e63 6174 280d 0a20   = pd.concat(.. 
+000071b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071c0: 2020 2020 2020 205b 0d0a 2020 2020 2020         [..      
+000071d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071e0: 2020 2020 2020 635f 782c 0d0a 2020 2020        c_x,..    
+000071f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007200: 2020 2020 2020 2020 7061 7374 5f69 6d70          past_imp
+00007210: 6163 7473 5b63 6f6c 5d0d 0a20 2020 2020  acts[col]..     
+00007220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007230: 2020 2020 2020 202e 746f 5f66 7261 6d65         .to_frame
+00007240: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00007250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007260: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
+00007270: 6c61 6d62 6461 2078 3a20 2269 6d70 6163  lambda x: "impac
+00007280: 7473 5f22 202b 2073 7472 2878 2929 2c0d  ts_" + str(x)),.
+00007290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000072a0: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
+000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072c0: 2020 2020 2061 7869 733d 312c 0d0a 2020       axis=1,..  
+000072d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072e0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+000072f0: 2020 2020 2023 2061 6464 2041 5220 6665       # add AR fe
+00007300: 6174 7572 6573 0d0a 2020 2020 2020 2020  atures..        
+00007310: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00007320: 6172 5f6c 6167 7320 6973 206e 6f74 204e  ar_lags is not N
+00007330: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00007340: 2020 2020 2020 2020 2020 666f 7220 6c61            for la
+00007350: 6720 696e 2073 656c 662e 6172 5f6c 6167  g in self.ar_lag
+00007360: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00007370: 2020 2020 2020 2020 2020 2020 6c61 675f              lag_
+00007380: 6964 7820 3d20 6e70 2e63 6f6e 6361 7465  idx = np.concate
+00007390: 6e61 7465 280d 0a20 2020 2020 2020 2020  nate(..         
+000073a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073b0: 2020 205b 6e70 2e72 6570 6561 7428 5b30     [np.repeat([0
+000073c0: 5d2c 206c 6167 292c 206e 702e 6172 616e  ], lag), np.aran
+000073d0: 6765 286c 656e 2873 656c 662e 6466 2929  ge(len(self.df))
+000073e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000073f0: 2020 2020 2020 2020 2020 2029 5b30 203a             )[0 :
+00007400: 206c 656e 2873 656c 662e 6466 295d 0d0a   len(self.df)]..
+00007410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007420: 2020 2020 2020 2020 6c61 675f 7320 3d20          lag_s = 
+00007430: 7365 6c66 2e64 665b 636f 6c5d 2e69 6c6f  self.df[col].ilo
+00007440: 635b 6c61 675f 6964 785d 2e72 656e 616d  c[lag_idx].renam
+00007450: 6528 6622 6c61 677b 6c61 677d 5f22 290d  e(f"lag{lag}_").
+00007460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007470: 2020 2020 2020 2020 206c 6167 5f73 2e69           lag_s.i
+00007480: 6e64 6578 203d 2073 656c 662e 6466 2e69  ndex = self.df.i
+00007490: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
+000074a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000074b0: 2073 656c 662e 6172 5f69 6e74 6572 6163   self.ar_interac
+000074c0: 7469 6f6e 5f73 6561 736f 6e61 6c69 7479  tion_seasonality
+000074d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000074e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074f0: 2020 2020 2020 2020 2020 2073 5f66 6561             s_fea
+00007500: 7420 3d20 6372 6561 7465 5f73 6561 736f  t = create_seaso
+00007510: 6e61 6c69 7479 5f66 6561 7475 7265 280d  nality_feature(.
+00007520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007540: 2073 656c 662e 6466 2e69 6e64 6578 2c0d   self.df.index,.
+00007550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007570: 2073 656c 662e 745f 7472 6169 6e2c 0d0a   self.t_train,..
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075a0: 2020 2020 2020 2020 2068 6973 746f 7279           history
-000075b0: 5f64 6179 733d 7365 6c66 2e68 6973 746f  _days=self.histo
-000075c0: 7279 5f64 6179 732c 0d0a 2020 2020 2020  ry_days,..      
+000075a0: 7365 6c66 2e61 725f 696e 7465 7261 6374  self.ar_interact
+000075b0: 696f 6e5f 7365 6173 6f6e 616c 6974 792c  ion_seasonality,
+000075c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075e0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007600: 2020 2020 2073 5f66 6561 742e 696e 6465       s_feat.inde
-00007610: 7820 3d20 6c61 675f 732e 696e 6465 780d  x = lag_s.index.
-00007620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007630: 2020 2020 2020 2020 2020 2020 206c 6167               lag
-00007640: 5f73 203d 2073 5f66 6561 742e 6d75 6c28  _s = s_feat.mul(
-00007650: 6c61 675f 732c 2061 7869 733d 3029 2e72  lag_s, axis=0).r
-00007660: 656e 616d 6528 0d0a 2020 2020 2020 2020  ename(..        
-00007670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007680: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-00007690: 6c61 6d62 6461 2078 3a20 6622 6c61 677b  lambda x: f"lag{
-000076a0: 6c61 677d 5f22 202b 2073 7472 2878 290d  lag}_" + str(x).
-000076b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000076c0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-000076d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076e0: 2020 2020 2020 2020 635f 7820 3d20 7064          c_x = pd
-000076f0: 2e63 6f6e 6361 7428 5b63 5f78 2c20 6c61  .concat([c_x, la
-00007700: 675f 735d 2c20 6178 6973 3d31 290d 0a20  g_s], axis=1).. 
-00007710: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00007720: 204e 4f54 4520 5448 4552 4520 4953 204e   NOTE THERE IS N
-00007730: 4f20 5245 4d4f 5649 4e47 204f 4620 434f  O REMOVING OF CO
-00007740: 4c49 4e45 4152 2046 4541 5455 5245 5320  LINEAR FEATURES 
-00007750: 4144 4445 4420 4845 5245 0d0a 2020 2020  ADDED HERE..    
-00007760: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007770: 2e6b 6565 705f 636f 6c73 5b63 6f6c 5d20  .keep_cols[col] 
-00007780: 3d20 635f 782e 636f 6c75 6d6e 735b 0d0a  = c_x.columns[..
-00007790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077a0: 2020 2020 7e63 5f78 2e63 6f6c 756d 6e73      ~c_x.columns
-000077b0: 2e73 7472 2e63 6f6e 7461 696e 7328 227c  .str.contains("|
-000077c0: 222e 6a6f 696e 2872 656d 6f76 655f 7061  ".join(remove_pa
-000077d0: 7474 6572 6e73 2929 0d0a 2020 2020 2020  tterns))..      
-000077e0: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
-000077f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00007800: 662e 6b65 6570 5f63 6f6c 735f 6964 785b  f.keep_cols_idx[
-00007810: 636f 6c5d 203d 2063 5f78 2e63 6f6c 756d  col] = c_x.colum
-00007820: 6e73 2e67 6574 5f69 6e64 6578 6572 5f66  ns.get_indexer_f
-00007830: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
-00007840: 2020 2020 2020 2020 2073 656c 662e 6b65           self.ke
-00007850: 6570 5f63 6f6c 735b 636f 6c5d 0d0a 2020  ep_cols[col]..  
-00007860: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00007870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007880: 2073 656c 662e 636f 6c5f 6772 6f75 7069   self.col_groupi
-00007890: 6e67 735b 636f 6c5d 203d 2028 0d0a 2020  ngs[col] = (..  
-000078a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078b0: 2020 7365 6c66 2e6b 6565 705f 636f 6c73    self.keep_cols
-000078c0: 5b63 6f6c 5d2e 7374 722e 7061 7274 6974  [col].str.partit
-000078d0: 696f 6e28 225f 2229 2e67 6574 5f6c 6576  ion("_").get_lev
-000078e0: 656c 5f76 616c 7565 7328 3029 0d0a 2020  el_values(0)..  
-000078f0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00007900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007910: 2063 5f78 5b27 696e 7465 7263 6570 7427   c_x['intercept'
-00007920: 5d20 3d20 310d 0a20 2020 2020 2020 2020  ] = 1..         
-00007930: 2020 2020 2020 2073 656c 662e 785f 6172         self.x_ar
-00007940: 7261 795b 636f 6c5d 203d 2063 5f78 0d0a  ray[col] = c_x..
-00007950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007960: 2320 4144 4449 4e47 2052 4543 454e 4359  # ADDING RECENCY
-00007970: 2057 4549 4748 5449 4e47 2041 4e44 2052   WEIGHTING AND R
-00007980: 4944 4745 2050 4152 414d 530d 0a20 2020  IDGE PARAMS..   
-00007990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000079a0: 662e 7061 7261 6d73 5b63 6f6c 5d20 3d20  f.params[col] = 
-000079b0: 6c69 6e65 6172 5f6d 6f64 656c 280d 0a20  linear_model(.. 
-000079c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079d0: 2020 2063 5f78 2c20 7365 6c66 2e64 665b     c_x, self.df[
-000079e0: 636f 6c5d 2e74 6f5f 6672 616d 6528 292c  col].to_frame(),
-000079f0: 2070 6172 616d 733d 7365 6c66 2e6c 696e   params=self.lin
-00007a00: 6561 725f 6d6f 6465 6c0d 0a20 2020 2020  ear_model..     
-00007a10: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00007a20: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00007a30: 656e 645f 7265 7369 6475 616c 732e 6170  end_residuals.ap
-00007a40: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-00007a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007a60: 6466 5b63 6f6c 5d0d 0a20 2020 2020 2020  df[col]..       
-00007a70: 2020 2020 2020 2020 2020 2020 202d 2070               - p
-00007a80: 642e 5365 7269 6573 280d 0a20 2020 2020  d.Series(..     
-00007a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007aa0: 2020 206e 702e 646f 7428 0d0a 2020 2020     np.dot(..    
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ac0: 2020 2020 2020 2020 635f 785b 7365 6c66          c_x[self
-00007ad0: 2e6b 6565 705f 636f 6c73 5b63 6f6c 5d5d  .keep_cols[col]]
-00007ae0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00007af0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00007b00: 656c 662e 7061 7261 6d73 5b63 6f6c 5d5b  elf.params[col][
-00007b10: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
-00007b20: 6478 5b63 6f6c 5d5d 2c0d 0a20 2020 2020  dx[col]],..     
-00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b40: 2020 2029 2e66 6c61 7474 656e 2829 2c0d     ).flatten(),.
-00007b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007b60: 2020 2020 2020 2020 206e 616d 653d 636f           name=co
-00007b70: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-00007b80: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00007b90: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
-00007ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007bb0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00007bc0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00007bd0: 2020 2020 2020 2020 7472 656e 645f 7265          trend_re
-00007be0: 7369 6475 616c 7320 3d20 7064 2e63 6f6e  siduals = pd.con
-00007bf0: 6361 7428 7472 656e 645f 7265 7369 6475  cat(trend_residu
-00007c00: 616c 732c 2061 7869 733d 3129 0d0a 2020  als, axis=1)..  
-00007c10: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00007c20: 2020 2020 2020 2020 2023 2052 554e 204c           # RUN L
-00007c30: 494e 4541 5220 4d4f 4445 4c2c 2057 4845  INEAR MODEL, WHE
-00007c40: 4e20 4e4f 204c 4f4f 5045 4420 4645 4154  N NO LOOPED FEAT
-00007c50: 5552 4553 0d0a 2020 2020 2020 2020 2020  URES..          
-00007c60: 2020 7365 6c66 2e6b 6565 705f 636f 6c73    self.keep_cols
-00007c70: 203d 2078 5f61 7272 6179 2e63 6f6c 756d   = x_array.colum
-00007c80: 6e73 5b0d 0a20 2020 2020 2020 2020 2020  ns[..           
-00007c90: 2020 2020 207e 785f 6172 7261 792e 636f       ~x_array.co
-00007ca0: 6c75 6d6e 732e 7374 722e 636f 6e74 6169  lumns.str.contai
-00007cb0: 6e73 2822 7c22 2e6a 6f69 6e28 7265 6d6f  ns("|".join(remo
-00007cc0: 7665 5f70 6174 7465 726e 7329 290d 0a20  ve_patterns)).. 
-00007cd0: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00007ce0: 2020 2020 2020 2020 2020 7365 6c66 2e6b            self.k
-00007cf0: 6565 705f 636f 6c73 5f69 6478 203d 2078  eep_cols_idx = x
-00007d00: 5f61 7272 6179 2e63 6f6c 756d 6e73 2e67  _array.columns.g
-00007d10: 6574 5f69 6e64 6578 6572 5f66 6f72 2873  et_indexer_for(s
-00007d20: 656c 662e 6b65 6570 5f63 6f6c 7329 0d0a  elf.keep_cols)..
-00007d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007d40: 2e63 6f6c 5f67 726f 7570 696e 6773 203d  .col_groupings =
-00007d50: 2073 656c 662e 6b65 6570 5f63 6f6c 732e   self.keep_cols.
-00007d60: 7374 722e 7061 7274 6974 696f 6e28 225f  str.partition("_
-00007d70: 2229 2e67 6574 5f6c 6576 656c 5f76 616c  ").get_level_val
-00007d80: 7565 7328 3029 0d0a 2020 2020 2020 2020  ues(0)..        
-00007d90: 2020 2020 785f 6172 7261 795b 2769 6e74      x_array['int
-00007da0: 6572 6365 7074 275d 203d 2031 0d0a 2020  ercept'] = 1..  
-00007db0: 2020 2020 2020 2020 2020 2320 7275 6e20            # run 
-00007dc0: 6d6f 6465 6c0d 0a20 2020 2020 2020 2020  model..         
-00007dd0: 2020 2073 656c 662e 7061 7261 6d73 203d     self.params =
-00007de0: 206c 696e 6561 725f 6d6f 6465 6c28 785f   linear_model(x_
-00007df0: 6172 7261 792c 2073 656c 662e 6466 2c20  array, self.df, 
-00007e00: 7061 7261 6d73 3d73 656c 662e 6c69 6e65  params=self.line
-00007e10: 6172 5f6d 6f64 656c 290d 0a20 2020 2020  ar_model)..     
-00007e20: 2020 2020 2020 2074 7265 6e64 5f72 6573         trend_res
-00007e30: 6964 7561 6c73 203d 2073 656c 662e 6466  iduals = self.df
-00007e40: 202d 206e 702e 646f 7428 0d0a 2020 2020   - np.dot(..    
-00007e50: 2020 2020 2020 2020 2020 2020 785f 6172              x_ar
-00007e60: 7261 795b 7365 6c66 2e6b 6565 705f 636f  ray[self.keep_co
-00007e70: 6c73 5d2c 2073 656c 662e 7061 7261 6d73  ls], self.params
-00007e80: 5b73 656c 662e 6b65 6570 5f63 6f6c 735f  [self.keep_cols_
-00007e90: 6964 785d 0d0a 2020 2020 2020 2020 2020  idx]..          
-00007ea0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00007eb0: 2073 656c 662e 785f 6172 7261 7920 3d20   self.x_array = 
-00007ec0: 785f 6172 7261 790d 0a0d 0a20 2020 2020  x_array....     
-00007ed0: 2020 2023 206f 7074 696f 6e20 746f 2072     # option to r
-00007ee0: 756e 2074 7265 6e64 206d 6f64 656c 206f  un trend model o
-00007ef0: 6e20 6675 6c6c 2072 6573 6964 7561 6c73  n full residuals
-00007f00: 206f 7220 6f6e 2072 6f6c 6c69 6e67 2074   or on rolling t
-00007f10: 7265 6e64 0d0a 2020 2020 2020 2020 6966  rend..        if
-00007f20: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-00007f30: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
-00007f40: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00007f50: 6d73 2069 7320 6e6f 7420 4e6f 6e65 0d0a  ms is not None..
-00007f60: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
-00007f70: 656c 662e 7472 656e 645f 7769 6e64 6f77  elf.trend_window
-00007f80: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
-00007f90: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-00007fa0: 2020 2020 2020 2320 726f 6c6c 696e 6720        # rolling 
-00007fb0: 7472 656e 640d 0a20 2020 2020 2020 2020  trend..         
-00007fc0: 2020 2074 7265 6e64 5f70 6f73 7465 7269     trend_posteri
-00007fd0: 6f72 2c20 736c 6f70 652c 2069 6e74 6572  or, slope, inter
-00007fe0: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
-00007ff0: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
-00008000: 2020 2020 2020 2020 2020 2020 7472 656e              tren
-00008010: 645f 7265 7369 6475 616c 732c 206e 702e  d_residuals, np.
-00008020: 6172 7261 7928 7365 6c66 2e74 5f74 7261  array(self.t_tra
-00008030: 696e 290d 0a20 2020 2020 2020 2020 2020  in)..           
-00008040: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00008050: 7472 656e 645f 706f 7374 6572 696f 7220  trend_posterior 
-00008060: 3d20 7064 2e44 6174 6146 7261 6d65 280d  = pd.DataFrame(.
-00008070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008080: 2074 7265 6e64 5f70 6f73 7465 7269 6f72   trend_posterior
-00008090: 2c20 696e 6465 783d 7365 6c66 2e64 662e  , index=self.df.
-000080a0: 696e 6465 782c 2063 6f6c 756d 6e73 3d73  index, columns=s
-000080b0: 656c 662e 6466 2e63 6f6c 756d 6e73 0d0a  elf.df.columns..
-000080c0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-000080d0: 2020 2020 2020 2020 2020 2072 6573 5f64             res_d
-000080e0: 6966 203d 2074 7265 6e64 5f72 6573 6964  if = trend_resid
-000080f0: 7561 6c73 202d 2074 7265 6e64 5f70 6f73  uals - trend_pos
-00008100: 7465 7269 6f72 0d0a 2020 2020 2020 2020  terior..        
-00008110: 2020 2020 7265 735f 7570 7065 7220 3d20      res_upper = 
-00008120: 7265 735f 6469 665b 7265 735f 6469 6620  res_dif[res_dif 
-00008130: 3e3d 2030 5d0d 0a20 2020 2020 2020 2020  >= 0]..         
-00008140: 2020 2072 6573 5f6c 6f77 6572 203d 2072     res_lower = r
-00008150: 6573 5f64 6966 5b72 6573 5f64 6966 203c  es_dif[res_dif <
-00008160: 3d20 305d 0d0a 2020 2020 2020 2020 2020  = 0]..          
-00008170: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
-00008180: 756e 6365 7274 6169 6e74 795f 7570 7065  uncertainty_uppe
-00008190: 7220 3d20 7265 735f 7570 7065 722e 6d65  r = res_upper.me
-000081a0: 616e 2829 0d0a 2020 2020 2020 2020 2020  an()..          
-000081b0: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
-000081c0: 756e 6365 7274 6169 6e74 795f 6c6f 7765  uncertainty_lowe
-000081d0: 7220 3d20 7265 735f 6c6f 7765 722e 6d65  r = res_lower.me
-000081e0: 616e 2829 2e61 6273 2829 0d0a 2020 2020  an().abs()..    
-000081f0: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
-00008200: 6964 7561 6c5f 756e 6365 7274 6169 6e74  idual_uncertaint
-00008210: 795f 7570 7065 725f 7374 6420 3d20 7265  y_upper_std = re
-00008220: 735f 7570 7065 722e 7374 6428 290d 0a20  s_upper.std().. 
-00008230: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008240: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
-00008250: 696e 7479 5f6c 6f77 6572 5f73 7464 203d  inty_lower_std =
-00008260: 2072 6573 5f6c 6f77 6572 2e73 7464 2829   res_lower.std()
-00008270: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00008280: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008290: 662e 7265 7369 6475 616c 5f75 6e63 6572  f.residual_uncer
-000082a0: 7461 696e 7479 5f75 7070 6572 203d 2070  tainty_upper = p
-000082b0: 642e 5365 7269 6573 2830 2c20 696e 6465  d.Series(0, inde
-000082c0: 783d 7365 6c66 2e64 662e 636f 6c75 6d6e  x=self.df.column
-000082d0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-000082e0: 7365 6c66 2e72 6573 6964 7561 6c5f 756e  self.residual_un
-000082f0: 6365 7274 6169 6e74 795f 6c6f 7765 7220  certainty_lower 
-00008300: 3d20 7064 2e53 6572 6965 7328 302c 2069  = pd.Series(0, i
-00008310: 6e64 6578 3d73 656c 662e 6466 2e63 6f6c  ndex=self.df.col
-00008320: 756d 6e73 290d 0a20 2020 2020 2020 2020  umns)..         
-00008330: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
-00008340: 5f75 6e63 6572 7461 696e 7479 5f75 7070  _uncertainty_upp
-00008350: 6572 5f73 7464 203d 2070 642e 5365 7269  er_std = pd.Seri
-00008360: 6573 2830 2c20 696e 6465 783d 7365 6c66  es(0, index=self
-00008370: 2e64 662e 636f 6c75 6d6e 7329 0d0a 2020  .df.columns)..  
-00008380: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00008390: 6573 6964 7561 6c5f 756e 6365 7274 6169  esidual_uncertai
-000083a0: 6e74 795f 6c6f 7765 725f 7374 6420 3d20  nty_lower_std = 
-000083b0: 7064 2e53 6572 6965 7328 302c 2069 6e64  pd.Series(0, ind
-000083c0: 6578 3d73 656c 662e 6466 2e63 6f6c 756d  ex=self.df.colum
-000083d0: 6e73 290d 0a20 2020 2020 2020 2069 6620  ns)..        if 
-000083e0: 7365 6c66 2e74 7265 6e64 5f77 696e 646f  self.trend_windo
-000083f0: 7720 6973 206e 6f74 204e 6f6e 653a 0d0a  w is not None:..
-00008400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008410: 2e74 7265 6e64 5f74 7261 696e 203d 2074  .trend_train = t
-00008420: 7265 6e64 5f70 6f73 7465 7269 6f72 0d0a  rend_posterior..
-00008430: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00008440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008450: 7472 656e 645f 7472 6169 6e20 3d20 7064  trend_train = pd
-00008460: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
-00008470: 2020 2020 2020 2020 2020 2020 2074 7265               tre
-00008480: 6e64 5f72 6573 6964 7561 6c73 2c20 696e  nd_residuals, in
-00008490: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
-000084a0: 782c 2063 6f6c 756d 6e73 3d73 656c 662e  x, columns=self.
-000084b0: 6466 2e63 6f6c 756d 6e73 0d0a 2020 2020  df.columns..    
-000084c0: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
-000084d0: 2020 2020 2028 0d0a 2020 2020 2020 2020       (..        
-000084e0: 2020 2020 7365 6c66 2e7a 6572 6f5f 6372      self.zero_cr
-000084f0: 6f73 7369 6e67 732c 0d0a 2020 2020 2020  ossings,..      
-00008500: 2020 2020 2020 7365 6c66 2e63 6861 6e67        self.chang
-00008510: 6570 6f69 6e74 732c 0d0a 2020 2020 2020  epoints,..      
-00008520: 2020 2020 2020 7365 6c66 2e73 6c6f 7065        self.slope
-00008530: 5f73 6967 6e2c 0d0a 2020 2020 2020 2020  _sign,..        
-00008540: 2020 2020 7365 6c66 2e61 6363 656c 2c0d      self.accel,.
-00008550: 0a20 2020 2020 2020 2029 203d 2073 656c  .        ) = sel
-00008560: 662e 616e 616c 797a 655f 7472 656e 6428  f.analyze_trend(
-00008570: 736c 6f70 652c 2069 6e64 6578 3d73 656c  slope, index=sel
-00008580: 662e 7472 656e 645f 7472 6169 6e2e 696e  f.trend_train.in
-00008590: 6465 7829 0d0a 2020 2020 2020 2020 6966  dex)..        if
-000085a0: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
-000085b0: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
-000085c0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-000085d0: 203d 2041 6e6f 6d61 6c79 5265 6d6f 7661   = AnomalyRemova
-000085e0: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
-000085f0: 2020 2020 2a2a 7365 6c66 2e74 7265 6e64      **self.trend
-00008600: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
-00008610: 725f 7061 7261 6d73 0d0a 2020 2020 2020  r_params..      
-00008620: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00008630: 2020 2020 2023 2044 4946 4620 7468 6520       # DIFF the 
-00008640: 6c65 6e67 7468 206f 6620 5720 286f 7220  length of W (or 
-00008650: 772d 313f 290d 0a20 2020 2020 2020 2020  w-1?)..         
-00008660: 2020 2073 6866 745f 6964 7820 3d20 6e70     shft_idx = np
-00008670: 2e63 6f6e 6361 7465 6e61 7465 285b 5b30  .concatenate([[0
-00008680: 5d2c 206e 702e 6172 616e 6765 286c 656e  ], np.arange(len
-00008690: 2873 6c6f 7065 2929 5d29 5b30 203a 206c  (slope))])[0 : l
-000086a0: 656e 2873 6c6f 7065 295d 0d0a 2020 2020  en(slope)]..    
-000086b0: 2020 2020 2020 2020 736c 6f70 655f 6469          slope_di
-000086c0: 6666 203d 2073 6c6f 7065 202d 2073 6c6f  ff = slope - slo
-000086d0: 7065 5b73 6866 745f 6964 785d 0d0a 2020  pe[shft_idx]..  
-000086e0: 2020 2020 2020 2020 2020 7368 6674 5f69            shft_i
-000086f0: 6478 203d 206e 702e 636f 6e63 6174 656e  dx = np.concaten
-00008700: 6174 6528 0d0a 2020 2020 2020 2020 2020  ate(..          
-00008710: 2020 2020 2020 5b6e 702e 7265 7065 6174        [np.repeat
-00008720: 285b 305d 2c20 7365 6c66 2e74 7265 6e64  ([0], self.trend
-00008730: 5f77 696e 646f 7729 2c20 6e70 2e61 7261  _window), np.ara
-00008740: 6e67 6528 6c65 6e28 736c 6f70 6529 295d  nge(len(slope))]
-00008750: 0d0a 2020 2020 2020 2020 2020 2020 295b  ..            )[
-00008760: 3020 3a20 6c65 6e28 736c 6f70 6529 5d0d  0 : len(slope)].
-00008770: 0a20 2020 2020 2020 2020 2020 2073 6c6f  .            slo
-00008780: 7065 5f64 6966 6620 3d20 736c 6f70 655f  pe_diff = slope_
-00008790: 6469 6666 202b 2073 6c6f 7065 5f64 6966  diff + slope_dif
-000087a0: 665b 7368 6674 5f69 6478 5d0d 0a20 2020  f[shft_idx]..   
-000087b0: 2020 2020 2020 2020 2023 206e 702e 6375           # np.cu
-000087c0: 6d73 756d 2873 6c6f 7065 2c20 6178 6973  msum(slope, axis
-000087d0: 3d30 290d 0a20 2020 2020 2020 2020 2020  =0)..           
-000087e0: 2023 2070 642e 4461 7461 4672 616d 6528   # pd.DataFrame(
-000087f0: 736c 6f70 6529 2e72 6f6c 6c69 6e67 2839  slope).rolling(9
-00008800: 302c 2063 656e 7465 723d 5472 7565 2c20  0, center=True, 
-00008810: 6d69 6e5f 7065 7269 6f64 733d 3229 2e6d  min_periods=2).m
-00008820: 6561 6e28 290d 0a20 2020 2020 2020 2020  ean()..         
-00008830: 2020 2023 2070 642e 4461 7461 4672 616d     # pd.DataFram
-00008840: 6528 736c 6f70 652c 2069 6e64 6578 3d64  e(slope, index=d
-00008850: 662e 696e 6465 7829 2e72 6f6c 6c69 6e67  f.index).rolling
-00008860: 2833 3635 2c20 6365 6e74 6572 3d54 7275  (365, center=Tru
-00008870: 652c 206d 696e 5f70 6572 696f 6473 3d32  e, min_periods=2
-00008880: 292e 6d65 616e 2829 5b30 5d2e 706c 6f74  ).mean()[0].plot
-00008890: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000088a0: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
-000088b0: 6c79 5f64 6574 6563 746f 722e 6669 7428  ly_detector.fit(
-000088c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000088d0: 2020 7064 2e44 6174 6146 7261 6d65 2828    pd.DataFrame((
-000088e0: 736c 6f70 6520 2d20 736c 6f70 655b 7368  slope - slope[sh
-000088f0: 6674 5f69 6478 5d29 2c20 696e 6465 783d  ft_idx]), index=
-00008900: 7365 6c66 2e64 662e 696e 6465 7829 0d0a  self.df.index)..
-00008910: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-00008920: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
-00008930: 745f 7275 6e74 696d 6520 3d20 7365 6c66  t_runtime = self
-00008940: 2e74 696d 6528 2920 2d20 7365 6c66 2e73  .time() - self.s
-00008950: 7461 7274 5469 6d65 0d0a 2020 2020 2020  tartTime..      
-00008960: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
-00008970: 0a20 2020 2064 6566 2061 6e61 6c79 7a65  .    def analyze
-00008980: 5f74 7265 6e64 2873 656c 662c 2073 6c6f  _trend(self, slo
-00008990: 7065 2c20 696e 6465 7829 3a0d 0a20 2020  pe, index):..   
-000089a0: 2020 2020 2023 2064 6573 6972 6564 2062       # desired b
-000089b0: 6568 6176 696f 7220 6973 2073 7461 7969  ehavior is stayi
-000089c0: 6e67 203e 3d30 206f 7220 7374 6179 696e  ng >=0 or stayin
-000089d0: 6720 3c3d 2030 2c20 6f6e 6c79 2067 6574  g <= 0, only get
-000089e0: 7469 6e67 2062 6579 6f6e 6420 3020 636f  ting beyond 0 co
-000089f0: 756e 7420 6173 2074 7572 6e69 6e67 2070  unt as turning p
-00008a00: 6f69 6e74 0d0a 2020 2020 2020 2020 6661  oint..        fa
-00008a10: 6c73 655f 726f 7720 3d20 6e70 2e7a 6572  lse_row = np.zer
-00008a20: 6f73 2828 312c 2073 6c6f 7065 2e73 6861  os((1, slope.sha
-00008a30: 7065 5b31 5d29 292e 6173 7479 7065 2862  pe[1])).astype(b
-00008a40: 6f6f 6c29 0d0a 2020 2020 2020 2020 2320  ool)..        # 
-00008a50: 7768 6572 6520 7468 6520 736c 6f70 6520  where the slope 
-00008a60: 6372 6f73 7365 7320 3020 746f 202d 3120  crosses 0 to -1 
-00008a70: 6f72 2072 6576 6572 7365 0d0a 2020 2020  or reverse..    
-00008a80: 2020 2020 736c 6f70 655f 7369 676e 203d      slope_sign =
-00008a90: 206e 702e 7369 676e 6269 7428 736c 6f70   np.signbit(slop
-00008aa0: 6529 0d0a 2020 2020 2020 2020 7a65 726f  e)..        zero
-00008ab0: 5f63 726f 7373 696e 6773 203d 206e 702e  _crossings = np.
-00008ac0: 7673 7461 636b 280d 0a20 2020 2020 2020  vstack(..       
-00008ad0: 2020 2020 2028 6e70 2e64 6966 6628 736c       (np.diff(sl
-00008ae0: 6f70 655f 7369 676e 2c20 6178 6973 3d30  ope_sign, axis=0
-00008af0: 292c 2066 616c 7365 5f72 6f77 290d 0a20  ), false_row).. 
-00008b00: 2020 2020 2020 2029 2020 2320 5573 6520         )  # Use 
-00008b10: 6f6e 2065 6172 6c69 6573 742c 2066 696c  on earliest, fil
-00008b20: 6c20 656e 640d 0a20 2020 2020 2020 2023  l end..        #
-00008b30: 2077 6865 7265 2074 6865 2072 6174 6520   where the rate 
-00008b40: 6f66 2063 6861 6e67 6520 6f66 2074 6865  of change of the
-00008b50: 2072 6174 6520 6f66 2063 6861 6e67 6520   rate of change 
-00008b60: 6372 6f73 7365 7320 3020 746f 202d 3120  crosses 0 to -1 
-00008b70: 6f72 2072 6576 6572 7365 0d0a 2020 2020  or reverse..    
-00008b80: 2020 2020 6163 6365 6c20 3d20 6e70 2e64      accel = np.d
-00008b90: 6966 6628 736c 6f70 652c 2061 7869 733d  iff(slope, axis=
-00008ba0: 3029 0d0a 2020 2020 2020 2020 6368 616e  0)..        chan
-00008bb0: 6765 706f 696e 7473 203d 206e 702e 7673  gepoints = np.vs
-00008bc0: 7461 636b 280d 0a20 2020 2020 2020 2020  tack(..         
-00008bd0: 2020 2028 6661 6c73 655f 726f 772c 206e     (false_row, n
-00008be0: 702e 6469 6666 286e 702e 7369 676e 6269  p.diff(np.signbi
-00008bf0: 7428 6163 6365 6c29 2c20 6178 6973 3d30  t(accel), axis=0
-00008c00: 292c 2066 616c 7365 5f72 6f77 290d 0a20  ), false_row).. 
-00008c10: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00008c20: 2020 6966 2073 656c 662e 7472 656e 645f    if self.trend_
-00008c30: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00008c40: 5f70 6172 616d 7320 6973 206e 6f74 204e  _params is not N
-00008c50: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00008c60: 2020 7365 6c66 2e74 7265 6e64 5f61 6e6f    self.trend_ano
-00008c70: 6d61 6c79 5f64 6574 6563 746f 722e 6669  maly_detector.fi
-00008c80: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-00008c90: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
-00008ca0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00008cb0: 2020 2020 2020 206e 702e 7768 6572 6528         np.where(
-00008cc0: 6368 616e 6765 706f 696e 7473 2c20 736c  changepoints, sl
-00008cd0: 6f70 652c 2030 292c 0d0a 2020 2020 2020  ope, 0),..      
-00008ce0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00008cf0: 6465 783d 696e 6465 782c 0d0a 2020 2020  dex=index,..    
-00008d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d10: 636f 6c75 6d6e 733d 7365 6c66 2e63 6f6c  columns=self.col
-00008d20: 756d 6e5f 6e61 6d65 732c 2020 2320 4e65  umn_names,  # Ne
-00008d30: 6564 2064 6966 6665 7265 6e74 2073 6f75  ed different sou
-00008d40: 7263 6520 666f 7220 696e 6465 780d 0a20  rce for index.. 
-00008d50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008d60: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00008d70: 0a20 2020 2020 2020 2023 204e 6f74 6573  .        # Notes
-00008d80: 206f 6e20 6f74 6865 7220 6170 7072 6f61   on other approa
-00008d90: 6368 6573 0d0a 2020 2020 2020 2020 2320  ches..        # 
-00008da0: 6e70 2e6e 6f6e 7a65 726f 286e 702e 6469  np.nonzero(np.di
-00008db0: 6666 286e 702e 7369 676e 2873 6c6f 7065  ff(np.sign(slope
-00008dc0: 292c 2061 7869 733d 3029 2920 2874 6869  ), axis=0)) (thi
-00008dd0: 7320 6661 766f 7273 2070 7265 7669 6f75  s favors previou
-00008de0: 7320 706f 696e 742c 2061 6464 2031 2074  s point, add 1 t
-00008df0: 6f20 6265 2061 6674 6572 290d 0a20 2020  o be after)..   
-00008e00: 2020 2020 2023 2072 6570 6c61 6369 6e67       # replacing
-00008e10: 2030 2077 6974 6820 2d31 2061 626f 7665   0 with -1 above
-00008e20: 206d 6967 6874 2077 6f72 6b0d 0a20 2020   might work..   
-00008e30: 2020 2020 2023 2068 7474 7073 3a2f 2f73       # https://s
-00008e40: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
-00008e50: 2f71 7565 7374 696f 6e73 2f33 3834 3330  /questions/38430
-00008e60: 3137 2f65 6666 6963 6965 6e74 6c79 2d64  17/efficiently-d
-00008e70: 6574 6563 742d 7369 676e 2d63 6861 6e67  etect-sign-chang
-00008e80: 6573 2d69 6e2d 7079 7468 6f6e 0d0a 2020  es-in-python..  
-00008e90: 2020 2020 2020 2320 6e70 2e77 6865 7265        # np.where
-00008ea0: 286e 702e 6469 6666 286e 702e 7369 676e  (np.diff(np.sign
-00008eb0: 6269 7428 6129 2929 5b30 5d20 2866 696e  bit(a)))[0] (fin
-00008ec0: 6473 207a 6572 6f20 6174 2062 6567 696e  ds zero at begin
-00008ed0: 6e69 6e67 2061 6e64 206e 6f74 2061 7420  ning and not at 
-00008ee0: 656e 6429 0d0a 2020 2020 2020 2020 2320  end)..        # 
-00008ef0: 6e70 2e77 6865 7265 286e 702e 6269 7477  np.where(np.bitw
-00008f00: 6973 655f 786f 7228 706f 7369 7469 7665  ise_xor(positive
-00008f10: 5b31 3a5d 2c20 706f 7369 7469 7665 5b3a  [1:], positive[:
-00008f20: 2d31 5d29 295b 305d 0d0a 2020 2020 2020  -1]))[0]..      
-00008f30: 2020 7265 7475 726e 207a 6572 6f5f 6372    return zero_cr
-00008f40: 6f73 7369 6e67 732c 2063 6861 6e67 6570  ossings, changep
-00008f50: 6f69 6e74 732c 2073 6c6f 7065 5f73 6967  oints, slope_sig
-00008f60: 6e2c 2061 6363 656c 0d0a 0d0a 2020 2020  n, accel....    
-00008f70: 6465 6620 726f 6c6c 696e 675f 7472 656e  def rolling_tren
-00008f80: 6428 7365 6c66 2c20 7472 656e 645f 7265  d(self, trend_re
-00008f90: 7369 6475 616c 732c 2074 293a 0d0a 2020  siduals, t):..  
-00008fa0: 2020 2020 2020 6461 7465 735f 3264 203d        dates_2d =
-00008fb0: 206e 702e 7265 7065 6174 280d 0a20 2020   np.repeat(..   
-00008fc0: 2020 2020 2020 2020 2074 5b2e 2e2e 2c20           t[..., 
-00008fd0: 4e6f 6e65 5d2c 0d0a 2020 2020 2020 2020  None],..        
-00008fe0: 2020 2020 2320 6466 5f68 6f6c 6964 6179      # df_holiday
-00008ff0: 5f73 6361 6c65 642e 696e 6465 782e 746f  _scaled.index.to
-00009000: 5f6a 756c 6961 6e5f 6461 7465 2829 2e74  _julian_date().t
-00009010: 6f5f 6e75 6d70 7928 295b 2e2e 2e2c 204e  o_numpy()[..., N
-00009020: 6f6e 655d 2c0d 0a20 2020 2020 2020 2020  one],..         
-00009030: 2020 2074 7265 6e64 5f72 6573 6964 7561     trend_residua
-00009040: 6c73 2e73 6861 7065 5b31 5d2c 0d0a 2020  ls.shape[1],..  
-00009050: 2020 2020 2020 2020 2020 6178 6973 3d31            axis=1
-00009060: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
-00009070: 2020 2020 2020 7769 6e64 203d 2033 3020        wind = 30 
-00009080: 6966 2073 656c 662e 7472 656e 645f 7769  if self.trend_wi
-00009090: 6e64 6f77 2069 7320 4e6f 6e65 2065 6c73  ndow is None els
-000090a0: 6520 7365 6c66 2e74 7265 6e64 5f77 696e  e self.trend_win
-000090b0: 646f 770d 0a20 2020 2020 2020 2077 5f31  dow..        w_1
-000090c0: 203d 2077 696e 6420 2d20 310d 0a20 2020   = wind - 1..   
-000090d0: 2020 2020 2073 7465 7073 5f61 6864 203d       steps_ahd =
-000090e0: 2069 6e74 2877 5f31 202f 2032 290d 0a20   int(w_1 / 2).. 
-000090f0: 2020 2020 2020 2079 3020 3d20 6e70 2e72         y0 = np.r
-00009100: 6570 6561 7428 6e70 2e61 7272 6179 2874  epeat(np.array(t
-00009110: 7265 6e64 5f72 6573 6964 7561 6c73 5b30  rend_residuals[0
-00009120: 3a31 5d29 2c20 7374 6570 735f 6168 642c  :1]), steps_ahd,
-00009130: 2061 7869 733d 3029 0d0a 2020 2020 2020   axis=0)..      
-00009140: 2020 6430 203d 202d 3120 2a20 6461 7465    d0 = -1 * date
-00009150: 735f 3264 5b31 203a 2079 302e 7368 6170  s_2d[1 : y0.shap
-00009160: 655b 305d 202b 2031 5d5b 3a3a 2d31 5d0d  e[0] + 1][::-1].
-00009170: 0a20 2020 2020 2020 2073 6861 7065 3220  .        shape2 
-00009180: 3d20 2877 5f31 202d 2073 7465 7073 5f61  = (w_1 - steps_a
-00009190: 6864 2c20 7930 2e73 6861 7065 5b31 5d29  hd, y0.shape[1])
-000091a0: 0d0a 2020 2020 2020 2020 7932 203d 206e  ..        y2 = n
-000091b0: 702e 636f 6e63 6174 656e 6174 6528 0d0a  p.concatenate(..
-000091c0: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
-000091d0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000091e0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
-000091f0: 2020 2020 7472 656e 645f 7265 7369 6475      trend_residu
-00009200: 616c 732c 0d0a 2020 2020 2020 2020 2020  als,..          
-00009210: 2020 2020 2020 6e70 2e66 756c 6c28 7368        np.full(sh
-00009220: 6170 6532 2c20 6e70 2e6e 616e 292c 0d0a  ape2, np.nan),..
-00009230: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-00009240: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00009250: 2020 6420 3d20 6e70 2e63 6f6e 6361 7465    d = np.concate
-00009260: 6e61 7465 280d 0a20 2020 2020 2020 2020  nate(..         
-00009270: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
-00009280: 2020 2020 2020 6430 2c0d 0a20 2020 2020        d0,..     
-00009290: 2020 2020 2020 2020 2020 2064 6174 6573             dates
-000092a0: 5f32 642c 0d0a 2020 2020 2020 2020 2020  _2d,..          
-000092b0: 2020 2020 2020 6e70 2e66 756c 6c28 7368        np.full(sh
-000092c0: 6170 6532 2c20 6e70 2e6e 616e 292c 0d0a  ape2, np.nan),..
-000092d0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-000092e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000092f0: 2020 736c 6f70 652c 2069 6e74 6572 6365    slope, interce
-00009300: 7074 203d 2077 696e 646f 775f 6c69 6e5f  pt = window_lin_
-00009310: 7265 675f 6d65 616e 2864 2c20 7932 2c20  reg_mean(d, y2, 
-00009320: 7769 6e64 290d 0a20 2020 2020 2020 2074  wind)..        t
-00009330: 7265 6e64 5f70 6f73 7465 7269 6f72 203d  rend_posterior =
-00009340: 2073 6c6f 7065 202a 2074 5b2e 2e2e 2c20   slope * t[..., 
-00009350: 4e6f 6e65 5d20 2b20 696e 7465 7263 6570  None] + intercep
-00009360: 740d 0a20 2020 2020 2020 2072 6574 7572  t..        retur
-00009370: 6e20 7472 656e 645f 706f 7374 6572 696f  n trend_posterio
-00009380: 722c 2073 6c6f 7065 2c20 696e 7465 7263  r, slope, interc
-00009390: 6570 740d 0a0d 0a20 2020 2064 6566 205f  ept....    def _
-000093a0: 7072 6564 6963 745f 6c69 6e65 6172 280d  predict_linear(.
-000093b0: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
-000093c0: 2020 2020 2020 2020 6461 7465 732c 0d0a          dates,..
-000093d0: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
-000093e0: 6466 2c0d 0a20 2020 2020 2020 2066 7574  df,..        fut
-000093f0: 7572 655f 7265 6772 6573 736f 722c 0d0a  ure_regressor,..
-00009400: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
-00009410: 725f 7065 725f 7365 7269 6573 2c0d 0a20  r_per_series,.. 
-00009420: 2020 2020 2020 2066 6c61 675f 7265 6772         flag_regr
-00009430: 6573 736f 7273 2c0d 0a20 2020 2020 2020  essors,..       
-00009440: 2069 6d70 6163 7473 2c0d 0a20 2020 2020   impacts,..     
-00009450: 2020 2072 6574 7572 6e5f 636f 6d70 6f6e     return_compon
-00009460: 656e 7473 3d46 616c 7365 2c0d 0a20 2020  ents=False,..   
-00009470: 2029 3a0d 0a20 2020 2020 2020 2023 2061   ):..        # a
-00009480: 6363 6570 7473 2061 6e79 2064 6174 6520  ccepts any date 
-00009490: 696e 2068 6973 746f 7279 2028 6f72 206c  in history (or l
-000094a0: 6167 2062 6579 6f6e 6429 2061 7320 6c6f  ag beyond) as lo
-000094b0: 6e67 2061 7320 7265 6772 6573 736f 7273  ng as regressors
-000094c0: 2069 6e63 6c75 6465 2074 686f 7365 2064   include those d
-000094d0: 6174 6573 2069 6e20 696e 6465 7820 6173  ates in index as
-000094e0: 2077 656c 6c0d 0a0d 0a20 2020 2020 2020   well....       
-000094f0: 2073 656c 662e 745f 7072 6564 6963 7420   self.t_predict 
-00009500: 3d20 7365 6c66 2e63 7265 6174 655f 7428  = self.create_t(
-00009510: 6461 7465 7329 0d0a 2020 2020 2020 2020  dates)..        
-00009520: 785f 6c69 7374 203d 205b 5d0d 0a20 2020  x_list = []..   
-00009530: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00009540: 6365 2873 656c 662e 616e 6f6d 616c 795f  ce(self.anomaly_
-00009550: 696e 7465 7276 656e 7469 6f6e 2c20 6469  intervention, di
-00009560: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
-00009570: 2020 2320 666f 7265 6361 7374 2061 6e6f    # forecast ano
-00009580: 6d61 6c79 2073 636f 7265 7320 6173 2074  maly scores as t
-00009590: 696d 6520 7365 7269 6573 0d0a 2020 2020  ime series..    
-000095a0: 2020 2020 2020 2020 6c65 6e5f 696e 7465          len_inte
-000095b0: 7220 3d20 6c65 6e28 6461 7465 732e 696e  r = len(dates.in
-000095c0: 7465 7273 6563 7469 6f6e 2873 656c 662e  tersection(self.
-000095d0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-000095e0: 2e73 636f 7265 732e 696e 6465 7829 290d  .scores.index)).
-000095f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00009600: 6c65 6e5f 696e 7465 7220 3c20 6c65 6e28  len_inter < len(
-00009610: 6461 7465 7329 3a0d 0a20 2020 2020 2020  dates):..       
-00009620: 2020 2020 2020 2020 2061 6d6f 6465 6c5f           amodel_
-00009630: 7061 7261 6d73 203d 2073 656c 662e 616e  params = self.an
-00009640: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-00009650: 6f6e 5b27 4d6f 6465 6c50 6172 616d 6574  on['ModelParamet
-00009660: 6572 7327 5d0d 0a20 2020 2020 2020 2020  ers']..         
-00009670: 2020 2020 2020 2023 206e 6f20 7265 6772         # no regr
-00009680: 6573 736f 7273 2070 6173 7365 6420 6865  essors passed he
-00009690: 7265 0d0a 2020 2020 2020 2020 2020 2020  re..            
-000096a0: 2020 2020 6966 2022 7265 6772 6573 7369      if "regressi
-000096b0: 6f6e 5f74 7970 6522 2069 6e20 616d 6f64  on_type" in amod
-000096c0: 656c 5f70 6172 616d 733a 0d0a 2020 2020  el_params:..    
-000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096e0: 616d 6f64 656c 5f70 6172 616d 7320 3d20  amodel_params = 
-000096f0: 6a73 6f6e 2e6c 6f61 6473 2861 6d6f 6465  json.loads(amode
-00009700: 6c5f 7061 7261 6d73 290d 0a20 2020 2020  l_params)..     
-00009710: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00009720: 6d6f 6465 6c5f 7061 7261 6d73 5b27 7265  model_params['re
-00009730: 6772 6573 7369 6f6e 5f74 7970 6527 5d20  gression_type'] 
-00009740: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00009750: 2020 2020 2020 2020 6e65 775f 7363 6f72          new_scor
-00009760: 6573 203d 206d 6f64 656c 5f66 6f72 6563  es = model_forec
-00009770: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
-00009780: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-00009790: 6e61 6d65 3d73 656c 662e 616e 6f6d 616c  name=self.anomal
-000097a0: 795f 696e 7465 7276 656e 7469 6f6e 5b27  y_intervention['
-000097b0: 4d6f 6465 6c27 5d2c 0d0a 2020 2020 2020  Model'],..      
-000097c0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000097d0: 6465 6c5f 7061 7261 6d5f 6469 6374 3d61  del_param_dict=a
-000097e0: 6d6f 6465 6c5f 7061 7261 6d73 2c0d 0a20  model_params,.. 
-000097f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009800: 2020 206d 6f64 656c 5f74 7261 6e73 666f     model_transfo
-00009810: 726d 5f64 6963 743d 7365 6c66 2e61 6e6f  rm_dict=self.ano
-00009820: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
-00009830: 6e5b 0d0a 2020 2020 2020 2020 2020 2020  n[..            
-00009840: 2020 2020 2020 2020 2020 2020 2754 7261              'Tra
-00009850: 6e73 666f 726d 6174 696f 6e50 6172 616d  nsformationParam
-00009860: 6574 6572 7327 0d0a 2020 2020 2020 2020  eters'..        
-00009870: 2020 2020 2020 2020 2020 2020 5d2c 0d0a              ],..
-00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009890: 2020 2020 6466 5f74 7261 696e 3d73 656c      df_train=sel
-000098a0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
-000098b0: 6f72 2e73 636f 7265 732c 0d0a 2020 2020  or.scores,..    
-000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098d0: 666f 7265 6361 7374 5f6c 656e 6774 683d  forecast_length=
-000098e0: 6c65 6e28 6461 7465 7329 202d 206c 656e  len(dates) - len
-000098f0: 5f69 6e74 6572 2c0d 0a20 2020 2020 2020  _inter,..       
-00009900: 2020 2020 2020 2020 2020 2020 2066 7265               fre
-00009910: 7175 656e 6379 3d73 656c 662e 6672 6571  quency=self.freq
-00009920: 7565 6e63 792c 0d0a 2020 2020 2020 2020  uency,..        
-00009930: 2020 2020 2020 2020 2020 2020 7072 6564              pred
-00009940: 6963 7469 6f6e 5f69 6e74 6572 7661 6c3d  iction_interval=
-00009950: 7365 6c66 2e70 7265 6469 6374 696f 6e5f  self.prediction_
-00009960: 696e 7465 7276 616c 2c0d 0a20 2020 2020  interval,..     
-00009970: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009980: 6169 6c5f 6f6e 5f66 6f72 6563 6173 745f  ail_on_forecast_
-00009990: 6e61 6e3d 4661 6c73 652c 0d0a 2020 2020  nan=False,..    
-000099a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099b0: 7261 6e64 6f6d 5f73 6565 643d 7365 6c66  random_seed=self
-000099c0: 2e72 616e 646f 6d5f 7365 6564 2c0d 0a20  .random_seed,.. 
-000099d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099e0: 2020 2076 6572 626f 7365 3d73 656c 662e     verbose=self.
-000099f0: 7665 7262 6f73 652c 0d0a 2020 2020 2020  verbose,..      
-00009a00: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
-00009a10: 6a6f 6273 3d73 656c 662e 6e5f 6a6f 6273  jobs=self.n_jobs
-00009a20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00009a30: 2020 2029 2e66 6f72 6563 6173 740d 0a20     ).forecast.. 
-00009a40: 2020 2020 2020 2020 2020 2023 206e 6565             # nee
-00009a50: 6420 746f 206d 6f64 656c 2074 6865 7365  d to model these
-00009a60: 2066 6f72 2070 7265 6469 6374 696f 6e0d   for prediction.
-00009a70: 0a20 2020 2020 2020 2020 2020 2078 5f6c  .            x_l
-00009a80: 6973 742e 6170 7065 6e64 280d 0a20 2020  ist.append(..   
-00009a90: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
-00009aa0: 636f 6e63 6174 285b 7365 6c66 2e61 6e6f  concat([self.ano
-00009ab0: 6d61 6c79 5f64 6574 6563 746f 722e 7363  maly_detector.sc
-00009ac0: 6f72 6573 2c20 6e65 775f 7363 6f72 6573  ores, new_scores
-00009ad0: 5d2c 2061 7869 733d 3029 0d0a 2020 2020  ], axis=0)..    
-00009ae0: 2020 2020 2020 2020 2020 2020 2e72 6569              .rei
-00009af0: 6e64 6578 2864 6174 6573 290d 0a20 2020  ndex(dates)..   
-00009b00: 2020 2020 2020 2020 2020 2020 202e 7265               .re
-00009b10: 6e61 6d65 2863 6f6c 756d 6e73 3d6c 616d  name(columns=lam
-00009b20: 6264 6120 783a 2022 616e 6f6d 616c 7973  bda x: "anomalys
-00009b30: 636f 7265 735f 2220 2b20 7374 7228 7829  cores_" + str(x)
-00009b40: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
-00009b50: 0d0a 2020 2020 2020 2020 2320 616c 6c20  ..        # all 
-00009b60: 6f66 2074 6865 2066 6f6c 6c6f 7769 6e67  of the following
-00009b70: 2061 7265 2031 2064 6179 2070 6173 7420   are 1 day past 
-00009b80: 6c61 6767 6564 0d0a 2020 2020 2020 2020  lagged..        
-00009b90: 6966 2073 656c 662e 6d75 6c74 6976 6172  if self.multivar
-00009ba0: 6961 7465 5f66 6561 7475 7265 2069 7320  iate_feature is 
-00009bb0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00009bc0: 2020 2020 2020 2023 2069 6e63 6c75 6465         # include
-00009bd0: 7320 6261 636b 6669 6c6c 0d0a 2020 2020  s backfill..    
-00009be0: 2020 2020 2020 2020 6675 6c6c 5f69 6478          full_idx
-00009bf0: 203d 2068 6973 746f 7279 5f64 662e 696e   = history_df.in
-00009c00: 6465 782e 756e 696f 6e28 0d0a 2020 2020  dex.union(..    
-00009c10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009c20: 2e63 7265 6174 655f 666f 7265 6361 7374  .create_forecast
-00009c30: 5f69 6e64 6578 280d 0a20 2020 2020 2020  _index(..       
-00009c40: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00009c50: 6563 6173 745f 6c65 6e67 7468 3d31 2c20  ecast_length=1, 
-00009c60: 6c61 7374 5f64 6174 653d 6869 7374 6f72  last_date=histor
-00009c70: 795f 6466 2e69 6e64 6578 5b2d 315d 0d0a  y_df.index[-1]..
-00009c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c90: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
-00009ca0: 0d0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
-00009cb0: 675f 315f 696e 6478 203d 206e 702e 636f  g_1_indx = np.co
-00009cc0: 6e63 6174 656e 6174 6528 5b5b 305d 2c20  ncatenate([[0], 
-00009cd0: 6e70 2e61 7261 6e67 6528 6c65 6e28 6869  np.arange(len(hi
-00009ce0: 7374 6f72 795f 6466 2929 5d29 0d0a 2020  story_df))])..  
-00009cf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00009d00: 662e 6d75 6c74 6976 6172 6961 7465 5f74  f.multivariate_t
-00009d10: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
-00009d20: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00009d30: 2020 2020 2020 2020 2020 2020 7472 735f              trs_
-00009d40: 6466 203d 2073 656c 662e 6d75 6c74 6976  df = self.multiv
-00009d50: 6172 6961 7465 5f74 7261 6e73 666f 726d  ariate_transform
-00009d60: 6572 2e74 7261 6e73 666f 726d 2868 6973  er.transform(his
-00009d70: 746f 7279 5f64 6629 0d0a 2020 2020 2020  tory_df)..      
-00009d80: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00009d90: 2020 2020 2020 2020 2020 2020 2074 7273               trs
-00009da0: 5f64 6620 3d20 6869 7374 6f72 795f 6466  _df = history_df
-00009db0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
-00009dc0: 2020 2020 2069 6620 7365 6c66 2e6d 756c       if self.mul
-00009dd0: 7469 7661 7269 6174 655f 6665 6174 7572  tivariate_featur
-00009de0: 6520 3d3d 2022 6665 6174 7572 655f 6167  e == "feature_ag
-00009df0: 676c 6f6d 6572 6174 696f 6e22 3a0d 0a20  glomeration":.. 
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00009e10: 5f6c 6973 742e 6170 7065 6e64 280d 0a20  _list.append(.. 
-00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e30: 2020 2070 642e 4461 7461 4672 616d 6528     pd.DataFrame(
-00009e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009e50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00009e60: 6767 6c6f 6d65 7261 746f 722e 7472 616e  gglomerator.tran
-00009e70: 7366 6f72 6d28 7472 735f 6466 295b 6c61  sform(trs_df)[la
-00009e80: 675f 315f 696e 6478 5d2c 0d0a 2020 2020  g_1_indx],..    
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 696e 6465 783d 6675 6c6c 5f69      index=full_i
-00009eb0: 6478 2c0d 0a20 2020 2020 2020 2020 2020  dx,..           
-00009ec0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00009ed0: 756d 6e73 3d5b 0d0a 2020 2020 2020 2020  umns=[..        
-00009ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ef0: 2020 2020 226d 756c 7469 7661 725f 2220      "multivar_" 
-00009f00: 2b20 7374 7228 7829 2066 6f72 2078 2069  + str(x) for x i
-00009f10: 6e20 7261 6e67 6528 7365 6c66 2e61 6767  n range(self.agg
-00009f20: 6c6f 6d5f 6e5f 636c 7573 7465 7273 290d  lom_n_clusters).
-00009f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009f40: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
-00009f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f60: 2029 2e72 6569 6e64 6578 2864 6174 6573   ).reindex(dates
-00009f70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00009f80: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00009f90: 2020 656c 6966 2073 656c 662e 6d75 6c74    elif self.mult
-00009fa0: 6976 6172 6961 7465 5f66 6561 7475 7265  ivariate_feature
-00009fb0: 203d 3d20 2267 726f 7570 5f61 7665 7261   == "group_avera
-00009fc0: 6765 223a 0d0a 2020 2020 2020 2020 2020  ge":..          
-00009fd0: 2020 2020 2020 6d75 6c74 6976 6172 5f64        multivar_d
-00009fe0: 6620 3d20 280d 0a20 2020 2020 2020 2020  f = (..         
-00009ff0: 2020 2020 2020 2020 2020 2074 7273 5f64             trs_d
-0000a000: 662e 6772 6f75 7062 7928 7365 6c66 2e63  f.groupby(self.c
-0000a010: 6174 6567 6f72 6963 616c 5f67 726f 7570  ategorical_group
-0000a020: 732c 2061 7869 733d 3129 0d0a 2020 2020  s, axis=1)..    
-0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 2e6d 6561 6e28 290d 0a20 2020 2020 2020  .mean()..       
-0000a050: 2020 2020 2020 2020 2020 2020 202e 696c               .il
-0000a060: 6f63 5b6c 6167 5f31 5f69 6e64 785d 0d0a  oc[lag_1_indx]..
-0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a080: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a090: 2020 206d 756c 7469 7661 725f 6466 2e69     multivar_df.i
-0000a0a0: 6e64 6578 203d 2066 756c 6c5f 6964 780d  ndex = full_idx.
-0000a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0c0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
-0000a0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0e0: 2020 2020 206d 756c 7469 7661 725f 6466       multivar_df
-0000a0f0: 2e72 6569 6e64 6578 2864 6174 6573 292e  .reindex(dates).
-0000a100: 7265 6e61 6d65 280d 0a20 2020 2020 2020  rename(..       
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2063 6f6c 756d 6e73 3d6c 616d 6264 6120   columns=lambda 
-0000a130: 783a 2022 6d75 6c74 6976 6172 5f22 202b  x: "multivar_" +
-0000a140: 2073 7472 2878 290d 0a20 2020 2020 2020   str(x)..       
-0000a150: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a170: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0000a180: 6c69 6620 7365 6c66 2e6d 756c 7469 7661  lif self.multiva
-0000a190: 7269 6174 655f 6665 6174 7572 6520 3d3d  riate_feature ==
-0000a1a0: 2022 6f73 6369 6c6c 6174 6f72 223a 0d0a   "oscillator":..
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
-0000a1d0: 656e 7465 640d 0a20 2020 2020 2020 2069  ented..        i
-0000a1e0: 6620 7365 6c66 2e73 6561 736f 6e61 6c69  f self.seasonali
-0000a1f0: 7469 6573 2069 7320 6e6f 7420 4e6f 6e65  ties is not None
-0000a200: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000a210: 5f6c 6973 7420 3d20 5b5d 0d0a 2020 2020  _list = []..    
-0000a220: 2020 2020 2020 2020 666f 7220 7365 6173          for seas
-0000a230: 6f6e 616c 6974 7920 696e 2073 656c 662e  onality in self.
-0000a240: 7365 6173 6f6e 616c 6974 6965 733a 0d0a  seasonalities:..
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 735f 6c69 7374 2e61 7070 656e 6428 0d0a  s_list.append(..
-0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a280: 2020 2020 6372 6561 7465 5f73 6561 736f      create_seaso
-0000a290: 6e61 6c69 7479 5f66 6561 7475 7265 280d  nality_feature(.
-0000a2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a2b0: 2020 2020 2020 2020 2064 6174 6573 2c0d           dates,.
-0000a2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a2d0: 2020 2020 2020 2020 2073 656c 662e 745f           self.t_
-0000a2e0: 7072 6564 6963 742c 0d0a 2020 2020 2020  predict,..      
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a300: 2020 7365 6173 6f6e 616c 6974 792c 0d0a    seasonality,..
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
-0000a330: 6461 7973 3d73 656c 662e 6869 7374 6f72  days=self.histor
-0000a340: 795f 6461 7973 2c0d 0a20 2020 2020 2020  y_days,..       
-0000a350: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0000a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a370: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a380: 2020 2023 2049 4e54 4552 4143 5449 4f4e     # INTERACTION
-0000a390: 5320 4e4f 5420 494d 504c 454d 454e 5445  S NOT IMPLEMENTE
-0000a3a0: 440d 0a20 2020 2020 2020 2020 2020 2020  D..             
-0000a3b0: 2020 2023 204f 5244 4552 2053 5045 4349     # ORDER SPECI
-0000a3c0: 4649 4341 5449 4f4e 204e 4f54 2049 4d50  FICATION NOT IMP
-0000a3d0: 4c45 4d45 4e54 4544 0d0a 2020 2020 2020  LEMENTED..      
-0000a3e0: 2020 2020 2020 735f 6466 203d 2070 642e        s_df = pd.
-0000a3f0: 636f 6e63 6174 2873 5f6c 6973 742c 2061  concat(s_list, a
-0000a400: 7869 733d 3129 0d0a 2020 2020 2020 2020  xis=1)..        
-0000a410: 2020 2020 735f 6466 2e69 6e64 6578 203d      s_df.index =
-0000a420: 2064 6174 6573 0d0a 2020 2020 2020 2020   dates..        
-0000a430: 2020 2020 785f 6c69 7374 2e61 7070 656e      x_list.appen
-0000a440: 6428 735f 6466 290d 0a20 2020 2020 2020  d(s_df)..       
-0000a450: 2069 6620 6675 7475 7265 5f72 6567 7265   if future_regre
-0000a460: 7373 6f72 2069 7320 6e6f 7420 4e6f 6e65  ssor is not None
-0000a470: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
-0000a480: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
-0000a490: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
-0000a4a0: 7070 656e 6428 6675 7475 7265 5f72 6567  ppend(future_reg
-0000a4b0: 7265 7373 6f72 2e72 6569 6e64 6578 2864  ressor.reindex(d
-0000a4c0: 6174 6573 2929 0d0a 2020 2020 2020 2020  ates))..        
-0000a4d0: 6966 2066 6c61 675f 7265 6772 6573 736f  if flag_regresso
-0000a4e0: 7273 2069 7320 6e6f 7420 4e6f 6e65 2061  rs is not None a
-0000a4f0: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
-0000a500: 7273 5f75 7365 643a 0d0a 2020 2020 2020  rs_used:..      
-0000a510: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
-0000a520: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-0000a530: 2020 2020 2020 666c 6167 5f72 6567 7265        flag_regre
-0000a540: 7373 6f72 732e 7265 696e 6465 7828 6461  ssors.reindex(da
-0000a550: 7465 7329 0d0a 2020 2020 2020 2020 2020  tes)..          
-0000a560: 2020 2920 2023 2064 6f65 736e 2774 2063    )  # doesn't c
-0000a570: 6865 636b 2066 6f72 206d 6973 7369 6e67  heck for missing
-0000a580: 2064 6174 610d 0a20 2020 2020 2020 2069   data..        i
-0000a590: 6620 280d 0a20 2020 2020 2020 2020 2020  f (..           
-0000a5a0: 2073 656c 662e 686f 6c69 6461 795f 636f   self.holiday_co
-0000a5b0: 756e 7472 6965 7320 6973 206e 6f74 204e  untries is not N
-0000a5c0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0000a5d0: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-0000a5e0: 6e63 6528 7365 6c66 2e68 6f6c 6964 6179  nce(self.holiday
-0000a5f0: 5f63 6f75 6e74 7269 6573 2c20 6469 6374  _countries, dict
-0000a600: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-0000a610: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
-0000a620: 636f 756e 7472 6965 735f 7573 6564 0d0a  countries_used..
-0000a630: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
-0000a640: 2020 2020 2020 2020 666f 7220 686f 6c69          for holi
-0000a650: 6461 795f 636f 756e 7472 7920 696e 2073  day_country in s
-0000a660: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-0000a670: 7472 6965 733a 0d0a 2020 2020 2020 2020  tries:..        
-0000a680: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
-0000a690: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
-0000a6a0: 2020 2020 2020 2020 2020 2020 686f 6c69              holi
-0000a6b0: 6461 795f 666c 6167 280d 0a20 2020 2020  day_flag(..     
-0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 2020 2064 6174 6573 2c0d 0a20 2020 2020     dates,..     
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6f0: 2020 2063 6f75 6e74 7279 3d68 6f6c 6964     country=holid
-0000a700: 6179 5f63 6f75 6e74 7279 2c0d 0a20 2020  ay_country,..   
-0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a720: 2020 2020 2065 6e63 6f64 655f 686f 6c69       encode_holi
-0000a730: 6461 795f 7479 7065 3d54 7275 652c 0d0a  day_type=True,..
-0000a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a750: 2020 2020 292e 7265 6e61 6d65 2863 6f6c      ).rename(col
-0000a760: 756d 6e73 3d6c 616d 6264 6120 783a 2022  umns=lambda x: "
-0000a770: 686f 6c69 6461 795f 2220 2b20 7374 7228  holiday_" + str(
-0000a780: 7829 292c 0d0a 2020 2020 2020 2020 2020  x)),..          
-0000a790: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000a7a0: 2023 2070 7574 2074 6869 7320 746f 2074   # put this to t
-0000a7b0: 6865 2065 6e64 2061 7320 6974 2074 616b  he end as it tak
-0000a7c0: 6573 2075 7020 6c6f 7473 206f 6620 6665  es up lots of fe
-0000a7d0: 6174 7572 6520 7370 6163 6520 736f 6d65  ature space some
-0000a7e0: 7469 6d65 730d 0a20 2020 2020 2020 2069  times..        i
-0000a7f0: 6620 7365 6c66 2e68 6f6c 6964 6179 5f64  f self.holiday_d
-0000a800: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
-0000a810: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0000a820: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
-0000a830: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
-0000a840: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
-0000a850: 6c69 6461 795f 6465 7465 6374 6f72 2e64  liday_detector.d
-0000a860: 6174 6573 5f74 6f5f 686f 6c69 6461 7973  ates_to_holidays
-0000a870: 2864 6174 6573 2c20 7374 796c 653d 2266  (dates, style="f
-0000a880: 6c61 6722 290d 0a20 2020 2020 2020 2020  lag")..         
-0000a890: 2020 2020 2020 202e 636c 6970 2875 7070         .clip(upp
-0000a8a0: 6572 3d31 290d 0a20 2020 2020 2020 2020  er=1)..         
-0000a8b0: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
-0000a8c0: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
-0000a8d0: 2022 686f 6c69 6461 795f 2220 2b20 7374   "holiday_" + st
-0000a8e0: 7228 7829 290d 0a20 2020 2020 2020 2020  r(x))..         
-0000a8f0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-0000a900: 2320 4649 4e41 4c20 4645 4154 5552 4520  # FINAL FEATURE 
-0000a910: 5052 4f43 4553 5349 4e47 0d0a 2020 2020  PROCESSING..    
-0000a920: 2020 2020 785f 6172 7261 7920 3d20 7064      x_array = pd
-0000a930: 2e63 6f6e 6361 7428 785f 6c69 7374 2c20  .concat(x_list, 
-0000a940: 6178 6973 3d31 290d 0a20 2020 2020 2020  axis=1)..       
-0000a950: 2073 656c 662e 7072 6564 6963 745f 785f   self.predict_x_
-0000a960: 6172 7261 7920 3d20 785f 6172 7261 7920  array = x_array 
-0000a970: 2023 2063 616e 2072 656d 6f76 6520 7468   # can remove th
-0000a980: 6973 206c 6174 6572 2c20 6974 2069 7320  is later, it is 
-0000a990: 666f 7220 6465 6275 6767 696e 670d 0a20  for debugging.. 
-0000a9a0: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
-0000a9b0: 286e 702e 6973 6e61 6e28 785f 6172 7261  (np.isnan(x_arra
-0000a9c0: 792e 6173 7479 7065 2866 6c6f 6174 2929  y.astype(float))
-0000a9d0: 293a 2020 2320 7265 6d6f 7665 206c 6174  ):  # remove lat
-0000a9e0: 6572 2c20 666f 7220 6465 6275 6767 696e  er, for debuggin
-0000a9f0: 670d 0a20 2020 2020 2020 2020 2020 206e  g..            n
-0000aa00: 756c 7a20 3d20 785f 6172 7261 792e 6973  ulz = x_array.is
-0000aa10: 6e75 6c6c 2829 2e73 756d 2829 0d0a 2020  null().sum()..  
-0000aa20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000aa30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000aa40: 2020 6622 7468 6520 666f 6c6c 6f77 696e    f"the followin
-0000aa50: 6720 636f 6c75 6d6e 7320 636f 6e74 6169  g columns contai
-0000aa60: 6e20 6e61 6e20 7661 6c75 6573 3a20 7b6e  n nan values: {n
-0000aa70: 756c 7a5b 6e75 6c7a 203e 2030 5d2e 696e  ulz[nulz > 0].in
-0000aa80: 6465 782e 746f 6c69 7374 2829 7d22 0d0a  dex.tolist()}"..
-0000aa90: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000aaa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000aab0: 2056 616c 7565 4572 726f 7228 226e 616e   ValueError("nan
-0000aac0: 2076 616c 7565 7320 696e 2070 7265 6469   values in predi
-0000aad0: 6374 5f78 5f61 7272 6179 2229 0d0a 0d0a  ct_x_array")....
-0000aae0: 2020 2020 2020 2020 2320 5255 4e20 4c49          # RUN LI
-0000aaf0: 4e45 4152 204d 4f44 454c 0d0a 2020 2020  NEAR MODEL..    
-0000ab00: 2020 2020 2320 6164 6420 7820 6665 6174      # add x feat
-0000ab10: 7572 6573 2074 6861 7420 646f 6e27 7420  ures that don't 
-0000ab20: 6170 706c 7920 746f 2061 6c6c 2c20 616e  apply to all, an
-0000ab30: 6420 6e65 6564 2074 6f20 6265 206c 6f6f  d need to be loo
-0000ab40: 7065 640d 0a20 2020 2020 2020 2069 6620  ped..        if 
-0000ab50: 7365 6c66 2e6c 6f6f 705f 7265 7175 6972  self.loop_requir
-0000ab60: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-0000ab70: 2073 656c 662e 7072 6564 6963 745f 785f   self.predict_x_
-0000ab80: 6172 7261 7920 3d20 7b7d 0d0a 2020 2020  array = {}..    
-0000ab90: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
-0000aba0: 706f 6e65 6e74 7320 3d20 5b5d 0d0a 2020  ponents = []..  
-0000abb0: 2020 2020 2020 2020 2020 7072 6564 6963            predic
-0000abc0: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
-0000abd0: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
-0000abe0: 7365 6c66 2e64 662e 636f 6c75 6d6e 733a  self.df.columns:
-0000abf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ac00: 2020 635f 7820 3d20 785f 6172 7261 792e    c_x = x_array.
-0000ac10: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-0000ac20: 2020 2020 2020 2020 2320 696d 706c 656d          # implem
-0000ac30: 656e 7420 7065 725f 7365 7269 6573 2068  ent per_series h
-0000ac40: 6f6c 6964 6179 2063 6f75 6e74 7269 6573  oliday countries
-0000ac50: 2066 6c61 670d 0a20 2020 2020 2020 2020   flag..         
-0000ac60: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac80: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-0000ac90: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
-0000aca0: 6573 2c20 6469 6374 290d 0a20 2020 2020  es, dict)..     
-0000acb0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000acc0: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
-0000acd0: 636f 756e 7472 6965 735f 7573 6564 0d0a  countries_used..
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000ad00: 2020 2020 2020 2020 6863 203d 2073 656c          hc = sel
-0000ad10: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
-0000ad20: 6965 732e 6765 7428 636f 6c2c 204e 6f6e  ies.get(col, Non
-0000ad30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000ad40: 2020 2020 2020 2020 6966 2068 6320 6973          if hc is
-0000ad50: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0000ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad70: 2020 2020 635f 6863 203d 2068 6f6c 6964      c_hc = holid
-0000ad80: 6179 5f66 6c61 6728 0d0a 2020 2020 2020  ay_flag(..      
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ada0: 2020 2020 2020 6461 7465 732c 0d0a 2020        dates,..  
-0000adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adc0: 2020 2020 2020 2020 2020 636f 756e 7472            countr
-0000add0: 793d 6863 2c0d 0a20 2020 2020 2020 2020  y=hc,..         
-0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adf0: 2020 2065 6e63 6f64 655f 686f 6c69 6461     encode_holida
-0000ae00: 795f 7479 7065 3d54 7275 652c 0d0a 2020  y_type=True,..  
+000075e0: 2020 6869 7374 6f72 795f 6461 7973 3d73    history_days=s
+000075f0: 656c 662e 6869 7374 6f72 795f 6461 7973  elf.history_days
+00007600: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00007610: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007630: 2020 2020 2020 2020 2020 2020 2020 735f                s_
+00007640: 6665 6174 2e69 6e64 6578 203d 206c 6167  feat.index = lag
+00007650: 5f73 2e69 6e64 6578 0d0a 2020 2020 2020  _s.index..      
+00007660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007670: 2020 2020 2020 6c61 675f 7320 3d20 735f        lag_s = s_
+00007680: 6665 6174 2e6d 756c 286c 6167 5f73 2c20  feat.mul(lag_s, 
+00007690: 6178 6973 3d30 292e 7265 6e61 6d65 280d  axis=0).rename(.
+000076a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000076b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076c0: 2063 6f6c 756d 6e73 3d6c 616d 6264 6120   columns=lambda 
+000076d0: 783a 2066 226c 6167 7b6c 6167 7d5f 2220  x: f"lag{lag}_" 
+000076e0: 2b20 7374 7228 7829 0d0a 2020 2020 2020  + str(x)..      
+000076f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007700: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00007710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007720: 2063 5f78 203d 2070 642e 636f 6e63 6174   c_x = pd.concat
+00007730: 285b 635f 782c 206c 6167 5f73 5d2c 2061  ([c_x, lag_s], a
+00007740: 7869 733d 3129 0d0a 2020 2020 2020 2020  xis=1)..        
+00007750: 2020 2020 2020 2020 2320 4e4f 5445 2054          # NOTE T
+00007760: 4845 5245 2049 5320 4e4f 2052 454d 4f56  HERE IS NO REMOV
+00007770: 494e 4720 4f46 2043 4f4c 494e 4541 5220  ING OF COLINEAR 
+00007780: 4645 4154 5552 4553 2041 4444 4544 2048  FEATURES ADDED H
+00007790: 4552 450d 0a20 2020 2020 2020 2020 2020  ERE..           
+000077a0: 2020 2020 2073 656c 662e 6b65 6570 5f63       self.keep_c
+000077b0: 6f6c 735b 636f 6c5d 203d 2063 5f78 2e63  ols[col] = c_x.c
+000077c0: 6f6c 756d 6e73 5b0d 0a20 2020 2020 2020  olumns[..       
+000077d0: 2020 2020 2020 2020 2020 2020 207e 635f               ~c_
+000077e0: 782e 636f 6c75 6d6e 732e 7374 722e 636f  x.columns.str.co
+000077f0: 6e74 6169 6e73 2822 7c22 2e6a 6f69 6e28  ntains("|".join(
+00007800: 7265 6d6f 7665 5f70 6174 7465 726e 7329  remove_patterns)
+00007810: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00007820: 2020 205d 0d0a 2020 2020 2020 2020 2020     ]..          
+00007830: 2020 2020 2020 7365 6c66 2e6b 6565 705f        self.keep_
+00007840: 636f 6c73 5f69 6478 5b63 6f6c 5d20 3d20  cols_idx[col] = 
+00007850: 635f 782e 636f 6c75 6d6e 732e 6765 745f  c_x.columns.get_
+00007860: 696e 6465 7865 725f 666f 7228 0d0a 2020  indexer_for(..  
+00007870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007880: 2020 7365 6c66 2e6b 6565 705f 636f 6c73    self.keep_cols
+00007890: 5b63 6f6c 5d0d 0a20 2020 2020 2020 2020  [col]..         
+000078a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000078b0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000078c0: 6f6c 5f67 726f 7570 696e 6773 5b63 6f6c  ol_groupings[col
+000078d0: 5d20 3d20 280d 0a20 2020 2020 2020 2020  ] = (..         
+000078e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000078f0: 6b65 6570 5f63 6f6c 735b 636f 6c5d 2e73  keep_cols[col].s
+00007900: 7472 2e70 6172 7469 7469 6f6e 2822 5f22  tr.partition("_"
+00007910: 292e 6765 745f 6c65 7665 6c5f 7661 6c75  ).get_level_valu
+00007920: 6573 2830 290d 0a20 2020 2020 2020 2020  es(0)..         
+00007930: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00007940: 2020 2020 2020 2020 2020 635f 785b 2769            c_x['i
+00007950: 6e74 6572 6365 7074 275d 203d 2031 0d0a  ntercept'] = 1..
+00007960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007970: 7365 6c66 2e78 5f61 7272 6179 5b63 6f6c  self.x_array[col
+00007980: 5d20 3d20 635f 780d 0a20 2020 2020 2020  ] = c_x..       
+00007990: 2020 2020 2020 2020 2023 2041 4444 494e           # ADDIN
+000079a0: 4720 5245 4345 4e43 5920 5745 4947 4854  G RECENCY WEIGHT
+000079b0: 494e 4720 414e 4420 5249 4447 4520 5041  ING AND RIDGE PA
+000079c0: 5241 4d53 0d0a 2020 2020 2020 2020 2020  RAMS..          
+000079d0: 2020 2020 2020 7365 6c66 2e70 6172 616d        self.param
+000079e0: 735b 636f 6c5d 203d 206c 696e 6561 725f  s[col] = linear_
+000079f0: 6d6f 6465 6c28 0d0a 2020 2020 2020 2020  model(..        
+00007a00: 2020 2020 2020 2020 2020 2020 635f 782c              c_x,
+00007a10: 2073 656c 662e 6466 5b63 6f6c 5d2e 746f   self.df[col].to
+00007a20: 5f66 7261 6d65 2829 2c20 7061 7261 6d73  _frame(), params
+00007a30: 3d73 656c 662e 6c69 6e65 6172 5f6d 6f64  =self.linear_mod
+00007a40: 656c 0d0a 2020 2020 2020 2020 2020 2020  el..            
+00007a50: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00007a60: 2020 2020 2020 2074 7265 6e64 5f72 6573         trend_res
+00007a70: 6964 7561 6c73 2e61 7070 656e 6428 0d0a  iduals.append(..
+00007a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a90: 2020 2020 7365 6c66 2e64 665b 636f 6c5d      self.df[col]
+00007aa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007ab0: 2020 2020 2020 2d20 7064 2e53 6572 6965        - pd.Serie
+00007ac0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+00007ad0: 2020 2020 2020 2020 2020 2020 6e70 2e64              np.d
+00007ae0: 6f74 280d 0a20 2020 2020 2020 2020 2020  ot(..           
+00007af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b00: 2063 5f78 5b73 656c 662e 6b65 6570 5f63   c_x[self.keep_c
+00007b10: 6f6c 735b 636f 6c5d 5d2c 0d0a 2020 2020  ols[col]],..    
+00007b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b30: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
+00007b40: 616d 735b 636f 6c5d 5b73 656c 662e 6b65  ams[col][self.ke
+00007b50: 6570 5f63 6f6c 735f 6964 785b 636f 6c5d  ep_cols_idx[col]
+00007b60: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00007b70: 2020 2020 2020 2020 2020 2020 292e 666c              ).fl
+00007b80: 6174 7465 6e28 292c 0d0a 2020 2020 2020  atten(),..      
+00007b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ba0: 2020 6e61 6d65 3d63 6f6c 2c0d 0a20 2020    name=col,..   
+00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007bc0: 2020 2020 2069 6e64 6578 3d73 656c 662e       index=self.
+00007bd0: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
+00007be0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007bf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007c00: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00007c10: 2074 7265 6e64 5f72 6573 6964 7561 6c73   trend_residuals
+00007c20: 203d 2070 642e 636f 6e63 6174 2874 7265   = pd.concat(tre
+00007c30: 6e64 5f72 6573 6964 7561 6c73 2c20 6178  nd_residuals, ax
+00007c40: 6973 3d31 290d 0a20 2020 2020 2020 2065  is=1)..        e
+00007c50: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00007c60: 2020 2320 5255 4e20 4c49 4e45 4152 204d    # RUN LINEAR M
+00007c70: 4f44 454c 2c20 5748 454e 204e 4f20 4c4f  ODEL, WHEN NO LO
+00007c80: 4f50 4544 2046 4541 5455 5245 530d 0a20  OPED FEATURES.. 
+00007c90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007ca0: 6b65 6570 5f63 6f6c 7320 3d20 785f 6172  keep_cols = x_ar
+00007cb0: 7261 792e 636f 6c75 6d6e 735b 0d0a 2020  ray.columns[..  
+00007cc0: 2020 2020 2020 2020 2020 2020 2020 7e78                ~x
+00007cd0: 5f61 7272 6179 2e63 6f6c 756d 6e73 2e73  _array.columns.s
+00007ce0: 7472 2e63 6f6e 7461 696e 7328 227c 222e  tr.contains("|".
+00007cf0: 6a6f 696e 2872 656d 6f76 655f 7061 7474  join(remove_patt
+00007d00: 6572 6e73 2929 0d0a 2020 2020 2020 2020  erns))..        
+00007d10: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
+00007d20: 2020 2073 656c 662e 6b65 6570 5f63 6f6c     self.keep_col
+00007d30: 735f 6964 7820 3d20 785f 6172 7261 792e  s_idx = x_array.
+00007d40: 636f 6c75 6d6e 732e 6765 745f 696e 6465  columns.get_inde
+00007d50: 7865 725f 666f 7228 7365 6c66 2e6b 6565  xer_for(self.kee
+00007d60: 705f 636f 6c73 290d 0a20 2020 2020 2020  p_cols)..       
+00007d70: 2020 2020 2073 656c 662e 636f 6c5f 6772       self.col_gr
+00007d80: 6f75 7069 6e67 7320 3d20 7365 6c66 2e6b  oupings = self.k
+00007d90: 6565 705f 636f 6c73 2e73 7472 2e70 6172  eep_cols.str.par
+00007da0: 7469 7469 6f6e 2822 5f22 292e 6765 745f  tition("_").get_
+00007db0: 6c65 7665 6c5f 7661 6c75 6573 2830 290d  level_values(0).
+00007dc0: 0a20 2020 2020 2020 2020 2020 2078 5f61  .            x_a
+00007dd0: 7272 6179 5b27 696e 7465 7263 6570 7427  rray['intercept'
+00007de0: 5d20 3d20 310d 0a20 2020 2020 2020 2020  ] = 1..         
+00007df0: 2020 2023 2072 756e 206d 6f64 656c 0d0a     # run model..
+00007e00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007e10: 2e70 6172 616d 7320 3d20 6c69 6e65 6172  .params = linear
+00007e20: 5f6d 6f64 656c 2878 5f61 7272 6179 2c20  _model(x_array, 
+00007e30: 7365 6c66 2e64 662c 2070 6172 616d 733d  self.df, params=
+00007e40: 7365 6c66 2e6c 696e 6561 725f 6d6f 6465  self.linear_mode
+00007e50: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00007e60: 7472 656e 645f 7265 7369 6475 616c 7320  trend_residuals 
+00007e70: 3d20 7365 6c66 2e64 6620 2d20 6e70 2e64  = self.df - np.d
+00007e80: 6f74 280d 0a20 2020 2020 2020 2020 2020  ot(..           
+00007e90: 2020 2020 2078 5f61 7272 6179 5b73 656c       x_array[sel
+00007ea0: 662e 6b65 6570 5f63 6f6c 735d 2c20 7365  f.keep_cols], se
+00007eb0: 6c66 2e70 6172 616d 735b 7365 6c66 2e6b  lf.params[self.k
+00007ec0: 6565 705f 636f 6c73 5f69 6478 5d0d 0a20  eep_cols_idx].. 
+00007ed0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00007ee0: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
+00007ef0: 5f61 7272 6179 203d 2078 5f61 7272 6179  _array = x_array
+00007f00: 0d0a 0d0a 2020 2020 2020 2020 2320 6f70  ....        # op
+00007f10: 7469 6f6e 2074 6f20 7275 6e20 7472 656e  tion to run tren
+00007f20: 6420 6d6f 6465 6c20 6f6e 2066 756c 6c20  d model on full 
+00007f30: 7265 7369 6475 616c 7320 6f72 206f 6e20  residuals or on 
+00007f40: 726f 6c6c 696e 6720 7472 656e 640d 0a20  rolling trend.. 
+00007f50: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+00007f60: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
+00007f70: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+00007f80: 6374 6f72 5f70 6172 616d 7320 6973 206e  ctor_params is n
+00007f90: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+00007fa0: 2020 2020 206f 7220 7365 6c66 2e74 7265       or self.tre
+00007fb0: 6e64 5f77 696e 646f 7720 6973 206e 6f74  nd_window is not
+00007fc0: 204e 6f6e 650d 0a20 2020 2020 2020 2029   None..        )
+00007fd0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00007fe0: 2072 6f6c 6c69 6e67 2074 7265 6e64 0d0a   rolling trend..
+00007ff0: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+00008000: 645f 706f 7374 6572 696f 722c 2073 6c6f  d_posterior, slo
+00008010: 7065 2c20 696e 7465 7263 6570 7420 3d20  pe, intercept = 
+00008020: 7365 6c66 2e72 6f6c 6c69 6e67 5f74 7265  self.rolling_tre
+00008030: 6e64 280d 0a20 2020 2020 2020 2020 2020  nd(..           
+00008040: 2020 2020 2074 7265 6e64 5f72 6573 6964       trend_resid
+00008050: 7561 6c73 2c20 6e70 2e61 7272 6179 2873  uals, np.array(s
+00008060: 656c 662e 745f 7472 6169 6e29 0d0a 2020  elf.t_train)..  
+00008070: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00008080: 2020 2020 2020 2020 2074 7265 6e64 5f70           trend_p
+00008090: 6f73 7465 7269 6f72 203d 2070 642e 4461  osterior = pd.Da
+000080a0: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
+000080b0: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+000080c0: 706f 7374 6572 696f 722c 2069 6e64 6578  posterior, index
+000080d0: 3d73 656c 662e 6466 2e69 6e64 6578 2c20  =self.df.index, 
+000080e0: 636f 6c75 6d6e 733d 7365 6c66 2e64 662e  columns=self.df.
+000080f0: 636f 6c75 6d6e 730d 0a20 2020 2020 2020  columns..       
+00008100: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00008110: 2020 2020 7265 735f 6469 6620 3d20 7472      res_dif = tr
+00008120: 656e 645f 7265 7369 6475 616c 7320 2d20  end_residuals - 
+00008130: 7472 656e 645f 706f 7374 6572 696f 720d  trend_posterior.
+00008140: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00008150: 5f75 7070 6572 203d 2072 6573 5f64 6966  _upper = res_dif
+00008160: 5b72 6573 5f64 6966 203e 3d20 305d 0d0a  [res_dif >= 0]..
+00008170: 2020 2020 2020 2020 2020 2020 7265 735f              res_
+00008180: 6c6f 7765 7220 3d20 7265 735f 6469 665b  lower = res_dif[
+00008190: 7265 735f 6469 6620 3c3d 2030 5d0d 0a20  res_dif <= 0].. 
+000081a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000081b0: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
+000081c0: 696e 7479 5f75 7070 6572 203d 2072 6573  inty_upper = res
+000081d0: 5f75 7070 6572 2e6d 6561 6e28 290d 0a20  _upper.mean().. 
+000081e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000081f0: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
+00008200: 696e 7479 5f6c 6f77 6572 203d 2072 6573  inty_lower = res
+00008210: 5f6c 6f77 6572 2e6d 6561 6e28 292e 6162  _lower.mean().ab
+00008220: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+00008230: 2073 656c 662e 7265 7369 6475 616c 5f75   self.residual_u
+00008240: 6e63 6572 7461 696e 7479 5f75 7070 6572  ncertainty_upper
+00008250: 5f73 7464 203d 2072 6573 5f75 7070 6572  _std = res_upper
+00008260: 2e73 7464 2829 0d0a 2020 2020 2020 2020  .std()..        
+00008270: 2020 2020 7365 6c66 2e72 6573 6964 7561      self.residua
+00008280: 6c5f 756e 6365 7274 6169 6e74 795f 6c6f  l_uncertainty_lo
+00008290: 7765 725f 7374 6420 3d20 7265 735f 6c6f  wer_std = res_lo
+000082a0: 7765 722e 7374 6428 290d 0a20 2020 2020  wer.std()..     
+000082b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000082c0: 2020 2020 2020 7365 6c66 2e72 6573 6964        self.resid
+000082d0: 7561 6c5f 756e 6365 7274 6169 6e74 795f  ual_uncertainty_
+000082e0: 7570 7065 7220 3d20 7064 2e53 6572 6965  upper = pd.Serie
+000082f0: 7328 302c 2069 6e64 6578 3d73 656c 662e  s(0, index=self.
+00008300: 6466 2e63 6f6c 756d 6e73 290d 0a20 2020  df.columns)..   
+00008310: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00008320: 7369 6475 616c 5f75 6e63 6572 7461 696e  sidual_uncertain
+00008330: 7479 5f6c 6f77 6572 203d 2070 642e 5365  ty_lower = pd.Se
+00008340: 7269 6573 2830 2c20 696e 6465 783d 7365  ries(0, index=se
+00008350: 6c66 2e64 662e 636f 6c75 6d6e 7329 0d0a  lf.df.columns)..
+00008360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008370: 2e72 6573 6964 7561 6c5f 756e 6365 7274  .residual_uncert
+00008380: 6169 6e74 795f 7570 7065 725f 7374 6420  ainty_upper_std 
+00008390: 3d20 7064 2e53 6572 6965 7328 302c 2069  = pd.Series(0, i
+000083a0: 6e64 6578 3d73 656c 662e 6466 2e63 6f6c  ndex=self.df.col
+000083b0: 756d 6e73 290d 0a20 2020 2020 2020 2020  umns)..         
+000083c0: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
+000083d0: 5f75 6e63 6572 7461 696e 7479 5f6c 6f77  _uncertainty_low
+000083e0: 6572 5f73 7464 203d 2070 642e 5365 7269  er_std = pd.Seri
+000083f0: 6573 2830 2c20 696e 6465 783d 7365 6c66  es(0, index=self
+00008400: 2e64 662e 636f 6c75 6d6e 7329 0d0a 2020  .df.columns)..  
+00008410: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
+00008420: 656e 645f 7769 6e64 6f77 2069 7320 6e6f  end_window is no
+00008430: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00008440: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
+00008450: 7472 6169 6e20 3d20 7472 656e 645f 706f  train = trend_po
+00008460: 7374 6572 696f 720d 0a20 2020 2020 2020  sterior..       
+00008470: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00008480: 2020 2020 7365 6c66 2e74 7265 6e64 5f74      self.trend_t
+00008490: 7261 696e 203d 2070 642e 4461 7461 4672  rain = pd.DataFr
+000084a0: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
+000084b0: 2020 2020 2020 7472 656e 645f 7265 7369        trend_resi
+000084c0: 6475 616c 732c 2069 6e64 6578 3d73 656c  duals, index=sel
+000084d0: 662e 6466 2e69 6e64 6578 2c20 636f 6c75  f.df.index, colu
+000084e0: 6d6e 733d 7365 6c66 2e64 662e 636f 6c75  mns=self.df.colu
+000084f0: 6d6e 730d 0a20 2020 2020 2020 2020 2020  mns..           
+00008500: 2029 0d0a 0d0a 2020 2020 2020 2020 280d   )....        (.
+00008510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008520: 662e 7a65 726f 5f63 726f 7373 696e 6773  f.zero_crossings
+00008530: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+00008540: 656c 662e 6368 616e 6765 706f 696e 7473  elf.changepoints
+00008550: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+00008560: 656c 662e 736c 6f70 655f 7369 676e 2c0d  elf.slope_sign,.
+00008570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008580: 662e 6163 6365 6c2c 0d0a 2020 2020 2020  f.accel,..      
+00008590: 2020 2920 3d20 7365 6c66 2e61 6e61 6c79    ) = self.analy
+000085a0: 7a65 5f74 7265 6e64 2873 6c6f 7065 2c20  ze_trend(slope, 
+000085b0: 696e 6465 783d 7365 6c66 2e74 7265 6e64  index=self.trend
+000085c0: 5f74 7261 696e 2e69 6e64 6578 290d 0a20  _train.index).. 
+000085d0: 2020 2020 2020 2069 6620 4661 6c73 653a         if False:
+000085e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000085f0: 6c66 2e74 7265 6e64 5f61 6e6f 6d61 6c79  lf.trend_anomaly
+00008600: 5f64 6574 6563 746f 7220 3d20 416e 6f6d  _detector = Anom
+00008610: 616c 7952 656d 6f76 616c 280d 0a20 2020  alyRemoval(..   
+00008620: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+00008630: 656c 662e 7472 656e 645f 616e 6f6d 616c  elf.trend_anomal
+00008640: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
+00008650: 730d 0a20 2020 2020 2020 2020 2020 2029  s..            )
+00008660: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00008670: 4449 4646 2074 6865 206c 656e 6774 6820  DIFF the length 
+00008680: 6f66 2057 2028 6f72 2077 2d31 3f29 0d0a  of W (or w-1?)..
+00008690: 2020 2020 2020 2020 2020 2020 7368 6674              shft
+000086a0: 5f69 6478 203d 206e 702e 636f 6e63 6174  _idx = np.concat
+000086b0: 656e 6174 6528 5b5b 305d 2c20 6e70 2e61  enate([[0], np.a
+000086c0: 7261 6e67 6528 6c65 6e28 736c 6f70 6529  range(len(slope)
+000086d0: 295d 295b 3020 3a20 6c65 6e28 736c 6f70  )])[0 : len(slop
+000086e0: 6529 5d0d 0a20 2020 2020 2020 2020 2020  e)]..           
+000086f0: 2073 6c6f 7065 5f64 6966 6620 3d20 736c   slope_diff = sl
+00008700: 6f70 6520 2d20 736c 6f70 655b 7368 6674  ope - slope[shft
+00008710: 5f69 6478 5d0d 0a20 2020 2020 2020 2020  _idx]..         
+00008720: 2020 2073 6866 745f 6964 7820 3d20 6e70     shft_idx = np
+00008730: 2e63 6f6e 6361 7465 6e61 7465 280d 0a20  .concatenate(.. 
+00008740: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00008750: 6e70 2e72 6570 6561 7428 5b30 5d2c 2073  np.repeat([0], s
+00008760: 656c 662e 7472 656e 645f 7769 6e64 6f77  elf.trend_window
+00008770: 292c 206e 702e 6172 616e 6765 286c 656e  ), np.arange(len
+00008780: 2873 6c6f 7065 2929 5d0d 0a20 2020 2020  (slope))]..     
+00008790: 2020 2020 2020 2029 5b30 203a 206c 656e         )[0 : len
+000087a0: 2873 6c6f 7065 295d 0d0a 2020 2020 2020  (slope)]..      
+000087b0: 2020 2020 2020 736c 6f70 655f 6469 6666        slope_diff
+000087c0: 203d 2073 6c6f 7065 5f64 6966 6620 2b20   = slope_diff + 
+000087d0: 736c 6f70 655f 6469 6666 5b73 6866 745f  slope_diff[shft_
+000087e0: 6964 785d 0d0a 2020 2020 2020 2020 2020  idx]..          
+000087f0: 2020 2320 6e70 2e63 756d 7375 6d28 736c    # np.cumsum(sl
+00008800: 6f70 652c 2061 7869 733d 3029 0d0a 2020  ope, axis=0)..  
+00008810: 2020 2020 2020 2020 2020 2320 7064 2e44            # pd.D
+00008820: 6174 6146 7261 6d65 2873 6c6f 7065 292e  ataFrame(slope).
+00008830: 726f 6c6c 696e 6728 3930 2c20 6365 6e74  rolling(90, cent
+00008840: 6572 3d54 7275 652c 206d 696e 5f70 6572  er=True, min_per
+00008850: 696f 6473 3d32 292e 6d65 616e 2829 0d0a  iods=2).mean()..
+00008860: 2020 2020 2020 2020 2020 2020 2320 7064              # pd
+00008870: 2e44 6174 6146 7261 6d65 2873 6c6f 7065  .DataFrame(slope
+00008880: 2c20 696e 6465 783d 6466 2e69 6e64 6578  , index=df.index
+00008890: 292e 726f 6c6c 696e 6728 3336 352c 2063  ).rolling(365, c
+000088a0: 656e 7465 723d 5472 7565 2c20 6d69 6e5f  enter=True, min_
+000088b0: 7065 7269 6f64 733d 3229 2e6d 6561 6e28  periods=2).mean(
+000088c0: 295b 305d 2e70 6c6f 7428 290d 0a20 2020  )[0].plot()..   
+000088d0: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
+000088e0: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+000088f0: 6374 6f72 2e66 6974 280d 0a20 2020 2020  ctor.fit(..     
+00008900: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
+00008910: 7461 4672 616d 6528 2873 6c6f 7065 202d  taFrame((slope -
+00008920: 2073 6c6f 7065 5b73 6866 745f 6964 785d   slope[shft_idx]
+00008930: 292c 2069 6e64 6578 3d73 656c 662e 6466  ), index=self.df
+00008940: 2e69 6e64 6578 290d 0a20 2020 2020 2020  .index)..       
+00008950: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
+00008960: 2020 7365 6c66 2e66 6974 5f72 756e 7469    self.fit_runti
+00008970: 6d65 203d 2073 656c 662e 7469 6d65 2829  me = self.time()
+00008980: 202d 2073 656c 662e 7374 6172 7454 696d   - self.startTim
+00008990: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+000089a0: 6e20 7365 6c66 0d0a 0d0a 2020 2020 6465  n self....    de
+000089b0: 6620 616e 616c 797a 655f 7472 656e 6428  f analyze_trend(
+000089c0: 7365 6c66 2c20 736c 6f70 652c 2069 6e64  self, slope, ind
+000089d0: 6578 293a 0d0a 2020 2020 2020 2020 2320  ex):..        # 
+000089e0: 6465 7369 7265 6420 6265 6861 7669 6f72  desired behavior
+000089f0: 2069 7320 7374 6179 696e 6720 3e3d 3020   is staying >=0 
+00008a00: 6f72 2073 7461 7969 6e67 203c 3d20 302c  or staying <= 0,
+00008a10: 206f 6e6c 7920 6765 7474 696e 6720 6265   only getting be
+00008a20: 796f 6e64 2030 2063 6f75 6e74 2061 7320  yond 0 count as 
+00008a30: 7475 726e 696e 6720 706f 696e 740d 0a20  turning point.. 
+00008a40: 2020 2020 2020 2066 616c 7365 5f72 6f77         false_row
+00008a50: 203d 206e 702e 7a65 726f 7328 2831 2c20   = np.zeros((1, 
+00008a60: 736c 6f70 652e 7368 6170 655b 315d 2929  slope.shape[1]))
+00008a70: 2e61 7374 7970 6528 626f 6f6c 290d 0a20  .astype(bool).. 
+00008a80: 2020 2020 2020 2023 2077 6865 7265 2074         # where t
+00008a90: 6865 2073 6c6f 7065 2063 726f 7373 6573  he slope crosses
+00008aa0: 2030 2074 6f20 2d31 206f 7220 7265 7665   0 to -1 or reve
+00008ab0: 7273 650d 0a20 2020 2020 2020 2073 6c6f  rse..        slo
+00008ac0: 7065 5f73 6967 6e20 3d20 6e70 2e73 6967  pe_sign = np.sig
+00008ad0: 6e62 6974 2873 6c6f 7065 290d 0a20 2020  nbit(slope)..   
+00008ae0: 2020 2020 207a 6572 6f5f 6372 6f73 7369       zero_crossi
+00008af0: 6e67 7320 3d20 6e70 2e76 7374 6163 6b28  ngs = np.vstack(
+00008b00: 0d0a 2020 2020 2020 2020 2020 2020 286e  ..            (n
+00008b10: 702e 6469 6666 2873 6c6f 7065 5f73 6967  p.diff(slope_sig
+00008b20: 6e2c 2061 7869 733d 3029 2c20 6661 6c73  n, axis=0), fals
+00008b30: 655f 726f 7729 0d0a 2020 2020 2020 2020  e_row)..        
+00008b40: 2920 2023 2055 7365 206f 6e20 6561 726c  )  # Use on earl
+00008b50: 6965 7374 2c20 6669 6c6c 2065 6e64 0d0a  iest, fill end..
+00008b60: 2020 2020 2020 2020 2320 7768 6572 6520          # where 
+00008b70: 7468 6520 7261 7465 206f 6620 6368 616e  the rate of chan
+00008b80: 6765 206f 6620 7468 6520 7261 7465 206f  ge of the rate o
+00008b90: 6620 6368 616e 6765 2063 726f 7373 6573  f change crosses
+00008ba0: 2030 2074 6f20 2d31 206f 7220 7265 7665   0 to -1 or reve
+00008bb0: 7273 650d 0a20 2020 2020 2020 2061 6363  rse..        acc
+00008bc0: 656c 203d 206e 702e 6469 6666 2873 6c6f  el = np.diff(slo
+00008bd0: 7065 2c20 6178 6973 3d30 290d 0a20 2020  pe, axis=0)..   
+00008be0: 2020 2020 2063 6861 6e67 6570 6f69 6e74       changepoint
+00008bf0: 7320 3d20 6e70 2e76 7374 6163 6b28 0d0a  s = np.vstack(..
+00008c00: 2020 2020 2020 2020 2020 2020 2866 616c              (fal
+00008c10: 7365 5f72 6f77 2c20 6e70 2e64 6966 6628  se_row, np.diff(
+00008c20: 6e70 2e73 6967 6e62 6974 2861 6363 656c  np.signbit(accel
+00008c30: 292c 2061 7869 733d 3029 2c20 6661 6c73  ), axis=0), fals
+00008c40: 655f 726f 7729 0d0a 2020 2020 2020 2020  e_row)..        
+00008c50: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00008c60: 6c66 2e74 7265 6e64 5f61 6e6f 6d61 6c79  lf.trend_anomaly
+00008c70: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00008c80: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00008c90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008ca0: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
+00008cb0: 7465 6374 6f72 2e66 6974 280d 0a20 2020  tector.fit(..   
+00008cc0: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
+00008cd0: 4461 7461 4672 616d 6528 0d0a 2020 2020  DataFrame(..    
+00008ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cf0: 6e70 2e77 6865 7265 2863 6861 6e67 6570  np.where(changep
+00008d00: 6f69 6e74 732c 2073 6c6f 7065 2c20 3029  oints, slope, 0)
+00008d10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00008d20: 2020 2020 2020 2069 6e64 6578 3d69 6e64         index=ind
+00008d30: 6578 2c0d 0a20 2020 2020 2020 2020 2020  ex,..           
+00008d40: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+00008d50: 3d73 656c 662e 636f 6c75 6d6e 5f6e 616d  =self.column_nam
+00008d60: 6573 2c20 2023 204e 6565 6420 6469 6666  es,  # Need diff
+00008d70: 6572 656e 7420 736f 7572 6365 2066 6f72  erent source for
+00008d80: 2069 6e64 6578 0d0a 2020 2020 2020 2020   index..        
+00008d90: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00008da0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00008db0: 2020 2320 4e6f 7465 7320 6f6e 206f 7468    # Notes on oth
+00008dc0: 6572 2061 7070 726f 6163 6865 730d 0a20  er approaches.. 
+00008dd0: 2020 2020 2020 2023 206e 702e 6e6f 6e7a         # np.nonz
+00008de0: 6572 6f28 6e70 2e64 6966 6628 6e70 2e73  ero(np.diff(np.s
+00008df0: 6967 6e28 736c 6f70 6529 2c20 6178 6973  ign(slope), axis
+00008e00: 3d30 2929 2028 7468 6973 2066 6176 6f72  =0)) (this favor
+00008e10: 7320 7072 6576 696f 7573 2070 6f69 6e74  s previous point
+00008e20: 2c20 6164 6420 3120 746f 2062 6520 6166  , add 1 to be af
+00008e30: 7465 7229 0d0a 2020 2020 2020 2020 2320  ter)..        # 
+00008e40: 7265 706c 6163 696e 6720 3020 7769 7468  replacing 0 with
+00008e50: 202d 3120 6162 6f76 6520 6d69 6768 7420   -1 above might 
+00008e60: 776f 726b 0d0a 2020 2020 2020 2020 2320  work..        # 
+00008e70: 6874 7470 733a 2f2f 7374 6163 6b6f 7665  https://stackove
+00008e80: 7266 6c6f 772e 636f 6d2f 7175 6573 7469  rflow.com/questi
+00008e90: 6f6e 732f 3338 3433 3031 372f 6566 6669  ons/3843017/effi
+00008ea0: 6369 656e 746c 792d 6465 7465 6374 2d73  ciently-detect-s
+00008eb0: 6967 6e2d 6368 616e 6765 732d 696e 2d70  ign-changes-in-p
+00008ec0: 7974 686f 6e0d 0a20 2020 2020 2020 2023  ython..        #
+00008ed0: 206e 702e 7768 6572 6528 6e70 2e64 6966   np.where(np.dif
+00008ee0: 6628 6e70 2e73 6967 6e62 6974 2861 2929  f(np.signbit(a))
+00008ef0: 295b 305d 2028 6669 6e64 7320 7a65 726f  )[0] (finds zero
+00008f00: 2061 7420 6265 6769 6e6e 696e 6720 616e   at beginning an
+00008f10: 6420 6e6f 7420 6174 2065 6e64 290d 0a20  d not at end).. 
+00008f20: 2020 2020 2020 2023 206e 702e 7768 6572         # np.wher
+00008f30: 6528 6e70 2e62 6974 7769 7365 5f78 6f72  e(np.bitwise_xor
+00008f40: 2870 6f73 6974 6976 655b 313a 5d2c 2070  (positive[1:], p
+00008f50: 6f73 6974 6976 655b 3a2d 315d 2929 5b30  ositive[:-1]))[0
+00008f60: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+00008f70: 6e20 7a65 726f 5f63 726f 7373 696e 6773  n zero_crossings
+00008f80: 2c20 6368 616e 6765 706f 696e 7473 2c20  , changepoints, 
+00008f90: 736c 6f70 655f 7369 676e 2c20 6163 6365  slope_sign, acce
+00008fa0: 6c0d 0a0d 0a20 2020 2064 6566 2072 6f6c  l....    def rol
+00008fb0: 6c69 6e67 5f74 7265 6e64 2873 656c 662c  ling_trend(self,
+00008fc0: 2074 7265 6e64 5f72 6573 6964 7561 6c73   trend_residuals
+00008fd0: 2c20 7429 3a0d 0a20 2020 2020 2020 2064  , t):..        d
+00008fe0: 6174 6573 5f32 6420 3d20 6e70 2e72 6570  ates_2d = np.rep
+00008ff0: 6561 7428 0d0a 2020 2020 2020 2020 2020  eat(..          
+00009000: 2020 745b 2e2e 2e2c 204e 6f6e 655d 2c0d    t[..., None],.
+00009010: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
+00009020: 665f 686f 6c69 6461 795f 7363 616c 6564  f_holiday_scaled
+00009030: 2e69 6e64 6578 2e74 6f5f 6a75 6c69 616e  .index.to_julian
+00009040: 5f64 6174 6528 292e 746f 5f6e 756d 7079  _date().to_numpy
+00009050: 2829 5b2e 2e2e 2c20 4e6f 6e65 5d2c 0d0a  ()[..., None],..
+00009060: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+00009070: 645f 7265 7369 6475 616c 732e 7368 6170  d_residuals.shap
+00009080: 655b 315d 2c0d 0a20 2020 2020 2020 2020  e[1],..         
+00009090: 2020 2061 7869 733d 312c 0d0a 2020 2020     axis=1,..    
+000090a0: 2020 2020 290d 0a20 2020 2020 2020 2077      )..        w
+000090b0: 696e 6420 3d20 3330 2069 6620 7365 6c66  ind = 30 if self
+000090c0: 2e74 7265 6e64 5f77 696e 646f 7720 6973  .trend_window is
+000090d0: 204e 6f6e 6520 656c 7365 2073 656c 662e   None else self.
+000090e0: 7472 656e 645f 7769 6e64 6f77 0d0a 2020  trend_window..  
+000090f0: 2020 2020 2020 775f 3120 3d20 7769 6e64        w_1 = wind
+00009100: 202d 2031 0d0a 2020 2020 2020 2020 7374   - 1..        st
+00009110: 6570 735f 6168 6420 3d20 696e 7428 775f  eps_ahd = int(w_
+00009120: 3120 2f20 3229 0d0a 2020 2020 2020 2020  1 / 2)..        
+00009130: 7930 203d 206e 702e 7265 7065 6174 286e  y0 = np.repeat(n
+00009140: 702e 6172 7261 7928 7472 656e 645f 7265  p.array(trend_re
+00009150: 7369 6475 616c 735b 303a 315d 292c 2073  siduals[0:1]), s
+00009160: 7465 7073 5f61 6864 2c20 6178 6973 3d30  teps_ahd, axis=0
+00009170: 290d 0a20 2020 2020 2020 2064 3020 3d20  )..        d0 = 
+00009180: 2d31 202a 2064 6174 6573 5f32 645b 3120  -1 * dates_2d[1 
+00009190: 3a20 7930 2e73 6861 7065 5b30 5d20 2b20  : y0.shape[0] + 
+000091a0: 315d 5b3a 3a2d 315d 0d0a 2020 2020 2020  1][::-1]..      
+000091b0: 2020 7368 6170 6532 203d 2028 775f 3120    shape2 = (w_1 
+000091c0: 2d20 7374 6570 735f 6168 642c 2079 302e  - steps_ahd, y0.
+000091d0: 7368 6170 655b 315d 290d 0a20 2020 2020  shape[1])..     
+000091e0: 2020 2079 3220 3d20 6e70 2e63 6f6e 6361     y2 = np.conca
+000091f0: 7465 6e61 7465 280d 0a20 2020 2020 2020  tenate(..       
+00009200: 2020 2020 205b 0d0a 2020 2020 2020 2020       [..        
+00009210: 2020 2020 2020 2020 7930 2c0d 0a20 2020          y0,..   
+00009220: 2020 2020 2020 2020 2020 2020 2074 7265               tre
+00009230: 6e64 5f72 6573 6964 7561 6c73 2c0d 0a20  nd_residuals,.. 
+00009240: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00009250: 702e 6675 6c6c 2873 6861 7065 322c 206e  p.full(shape2, n
+00009260: 702e 6e61 6e29 2c0d 0a20 2020 2020 2020  p.nan),..       
+00009270: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+00009280: 290d 0a20 2020 2020 2020 2064 203d 206e  )..        d = n
+00009290: 702e 636f 6e63 6174 656e 6174 6528 0d0a  p.concatenate(..
+000092a0: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
+000092b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000092c0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+000092d0: 2020 2020 6461 7465 735f 3264 2c0d 0a20      dates_2d,.. 
+000092e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000092f0: 702e 6675 6c6c 2873 6861 7065 322c 206e  p.full(shape2, n
+00009300: 702e 6e61 6e29 2c0d 0a20 2020 2020 2020  p.nan),..       
+00009310: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+00009320: 290d 0a20 2020 2020 2020 2073 6c6f 7065  )..        slope
+00009330: 2c20 696e 7465 7263 6570 7420 3d20 7769  , intercept = wi
+00009340: 6e64 6f77 5f6c 696e 5f72 6567 5f6d 6561  ndow_lin_reg_mea
+00009350: 6e28 642c 2079 322c 2077 696e 6429 0d0a  n(d, y2, wind)..
+00009360: 2020 2020 2020 2020 7472 656e 645f 706f          trend_po
+00009370: 7374 6572 696f 7220 3d20 736c 6f70 6520  sterior = slope 
+00009380: 2a20 745b 2e2e 2e2c 204e 6f6e 655d 202b  * t[..., None] +
+00009390: 2069 6e74 6572 6365 7074 0d0a 2020 2020   intercept..    
+000093a0: 2020 2020 7265 7475 726e 2074 7265 6e64      return trend
+000093b0: 5f70 6f73 7465 7269 6f72 2c20 736c 6f70  _posterior, slop
+000093c0: 652c 2069 6e74 6572 6365 7074 0d0a 0d0a  e, intercept....
+000093d0: 2020 2020 6465 6620 5f70 7265 6469 6374      def _predict
+000093e0: 5f6c 696e 6561 7228 0d0a 2020 2020 2020  _linear(..      
+000093f0: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
+00009400: 2064 6174 6573 2c0d 0a20 2020 2020 2020   dates,..       
+00009410: 2068 6973 746f 7279 5f64 662c 0d0a 2020   history_df,..  
+00009420: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
+00009430: 7265 7373 6f72 2c0d 0a20 2020 2020 2020  ressor,..       
+00009440: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
+00009450: 6572 6965 732c 0d0a 2020 2020 2020 2020  eries,..        
+00009460: 666c 6167 5f72 6567 7265 7373 6f72 732c  flag_regressors,
+00009470: 0d0a 2020 2020 2020 2020 696d 7061 6374  ..        impact
+00009480: 732c 0d0a 2020 2020 2020 2020 7265 7475  s,..        retu
+00009490: 726e 5f63 6f6d 706f 6e65 6e74 733d 4661  rn_components=Fa
+000094a0: 6c73 652c 0d0a 2020 2020 293a 0d0a 2020  lse,..    ):..  
+000094b0: 2020 2020 2020 2320 6163 6365 7074 7320        # accepts 
+000094c0: 616e 7920 6461 7465 2069 6e20 6869 7374  any date in hist
+000094d0: 6f72 7920 286f 7220 6c61 6720 6265 796f  ory (or lag beyo
+000094e0: 6e64 2920 6173 206c 6f6e 6720 6173 2072  nd) as long as r
+000094f0: 6567 7265 7373 6f72 7320 696e 636c 7564  egressors includ
+00009500: 6520 7468 6f73 6520 6461 7465 7320 696e  e those dates in
+00009510: 2069 6e64 6578 2061 7320 7765 6c6c 0d0a   index as well..
+00009520: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00009530: 5f70 7265 6469 6374 203d 2073 656c 662e  _predict = self.
+00009540: 6372 6561 7465 5f74 2864 6174 6573 290d  create_t(dates).
+00009550: 0a20 2020 2020 2020 2078 5f6c 6973 7420  .        x_list 
+00009560: 3d20 5b5d 0d0a 2020 2020 2020 2020 6966  = []..        if
+00009570: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00009580: 2e61 6e6f 6d61 6c79 5f69 6e74 6572 7665  .anomaly_interve
+00009590: 6e74 696f 6e2c 2064 6963 7429 3a0d 0a20  ntion, dict):.. 
+000095a0: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
+000095b0: 6563 6173 7420 616e 6f6d 616c 7920 7363  ecast anomaly sc
+000095c0: 6f72 6573 2061 7320 7469 6d65 2073 6572  ores as time ser
+000095d0: 6965 730d 0a20 2020 2020 2020 2020 2020  ies..           
+000095e0: 206c 656e 5f69 6e74 6572 203d 206c 656e   len_inter = len
+000095f0: 2864 6174 6573 2e69 6e74 6572 7365 6374  (dates.intersect
+00009600: 696f 6e28 7365 6c66 2e61 6e6f 6d61 6c79  ion(self.anomaly
+00009610: 5f64 6574 6563 746f 722e 7363 6f72 6573  _detector.scores
+00009620: 2e69 6e64 6578 2929 0d0a 2020 2020 2020  .index))..      
+00009630: 2020 2020 2020 6966 206c 656e 5f69 6e74        if len_int
+00009640: 6572 203c 206c 656e 2864 6174 6573 293a  er < len(dates):
+00009650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009660: 2020 616d 6f64 656c 5f70 6172 616d 7320    amodel_params 
+00009670: 3d20 7365 6c66 2e61 6e6f 6d61 6c79 5f69  = self.anomaly_i
+00009680: 6e74 6572 7665 6e74 696f 6e5b 274d 6f64  ntervention['Mod
+00009690: 656c 5061 7261 6d65 7465 7273 275d 0d0a  elParameters']..
+000096a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096b0: 2320 6e6f 2072 6567 7265 7373 6f72 7320  # no regressors 
+000096c0: 7061 7373 6564 2068 6572 650d 0a20 2020  passed here..   
+000096d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000096e0: 2272 6567 7265 7373 696f 6e5f 7479 7065  "regression_type
+000096f0: 2220 696e 2061 6d6f 6465 6c5f 7061 7261  " in amodel_para
+00009700: 6d73 3a0d 0a20 2020 2020 2020 2020 2020  ms:..           
+00009710: 2020 2020 2020 2020 2061 6d6f 6465 6c5f           amodel_
+00009720: 7061 7261 6d73 203d 206a 736f 6e2e 6c6f  params = json.lo
+00009730: 6164 7328 616d 6f64 656c 5f70 6172 616d  ads(amodel_param
+00009740: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00009750: 2020 2020 2020 2020 616d 6f64 656c 5f70          amodel_p
+00009760: 6172 616d 735b 2772 6567 7265 7373 696f  arams['regressio
+00009770: 6e5f 7479 7065 275d 203d 204e 6f6e 650d  n_type'] = None.
+00009780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009790: 206e 6577 5f73 636f 7265 7320 3d20 6d6f   new_scores = mo
+000097a0: 6465 6c5f 666f 7265 6361 7374 280d 0a20  del_forecast(.. 
+000097b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000097c0: 2020 206d 6f64 656c 5f6e 616d 653d 7365     model_name=se
+000097d0: 6c66 2e61 6e6f 6d61 6c79 5f69 6e74 6572  lf.anomaly_inter
+000097e0: 7665 6e74 696f 6e5b 274d 6f64 656c 275d  vention['Model']
+000097f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009800: 2020 2020 2020 206d 6f64 656c 5f70 6172         model_par
+00009810: 616d 5f64 6963 743d 616d 6f64 656c 5f70  am_dict=amodel_p
+00009820: 6172 616d 732c 0d0a 2020 2020 2020 2020  arams,..        
+00009830: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00009840: 6c5f 7472 616e 7366 6f72 6d5f 6469 6374  l_transform_dict
+00009850: 3d73 656c 662e 616e 6f6d 616c 795f 696e  =self.anomaly_in
+00009860: 7465 7276 656e 7469 6f6e 5b0d 0a20 2020  tervention[..   
+00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009880: 2020 2020 2027 5472 616e 7366 6f72 6d61       'Transforma
+00009890: 7469 6f6e 5061 7261 6d65 7465 7273 270d  tionParameters'.
+000098a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000098b0: 2020 2020 205d 2c0d 0a20 2020 2020 2020       ],..       
+000098c0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+000098d0: 7472 6169 6e3d 7365 6c66 2e61 6e6f 6d61  train=self.anoma
+000098e0: 6c79 5f64 6574 6563 746f 722e 7363 6f72  ly_detector.scor
+000098f0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+00009900: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+00009910: 745f 6c65 6e67 7468 3d6c 656e 2864 6174  t_length=len(dat
+00009920: 6573 2920 2d20 6c65 6e5f 696e 7465 722c  es) - len_inter,
+00009930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009940: 2020 2020 2020 6672 6571 7565 6e63 793d        frequency=
+00009950: 7365 6c66 2e66 7265 7175 656e 6379 2c0d  self.frequency,.
+00009960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009970: 2020 2020 2070 7265 6469 6374 696f 6e5f       prediction_
+00009980: 696e 7465 7276 616c 3d73 656c 662e 7072  interval=self.pr
+00009990: 6564 6963 7469 6f6e 5f69 6e74 6572 7661  ediction_interva
+000099a0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+000099b0: 2020 2020 2020 2020 6661 696c 5f6f 6e5f          fail_on_
+000099c0: 666f 7265 6361 7374 5f6e 616e 3d46 616c  forecast_nan=Fal
+000099d0: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+000099e0: 2020 2020 2020 2020 2072 616e 646f 6d5f           random_
+000099f0: 7365 6564 3d73 656c 662e 7261 6e64 6f6d  seed=self.random
+00009a00: 5f73 6565 642c 0d0a 2020 2020 2020 2020  _seed,..        
+00009a10: 2020 2020 2020 2020 2020 2020 7665 7262              verb
+00009a20: 6f73 653d 7365 6c66 2e76 6572 626f 7365  ose=self.verbose
+00009a30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009a40: 2020 2020 2020 206e 5f6a 6f62 733d 7365         n_jobs=se
+00009a50: 6c66 2e6e 5f6a 6f62 732c 0d0a 2020 2020  lf.n_jobs,..    
+00009a60: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
+00009a70: 7265 6361 7374 0d0a 2020 2020 2020 2020  recast..        
+00009a80: 2020 2020 2320 6e65 6564 2074 6f20 6d6f      # need to mo
+00009a90: 6465 6c20 7468 6573 6520 666f 7220 7072  del these for pr
+00009aa0: 6564 6963 7469 6f6e 0d0a 2020 2020 2020  ediction..      
+00009ab0: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
+00009ac0: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+00009ad0: 2020 2020 2020 7064 2e63 6f6e 6361 7428        pd.concat(
+00009ae0: 5b73 656c 662e 616e 6f6d 616c 795f 6465  [self.anomaly_de
+00009af0: 7465 6374 6f72 2e73 636f 7265 732c 206e  tector.scores, n
+00009b00: 6577 5f73 636f 7265 735d 2c20 6178 6973  ew_scores], axis
+00009b10: 3d30 290d 0a20 2020 2020 2020 2020 2020  =0)..           
+00009b20: 2020 2020 202e 7265 696e 6465 7828 6461       .reindex(da
+00009b30: 7465 7329 0d0a 2020 2020 2020 2020 2020  tes)..          
+00009b40: 2020 2020 2020 2e72 656e 616d 6528 636f        .rename(co
+00009b50: 6c75 6d6e 733d 6c61 6d62 6461 2078 3a20  lumns=lambda x: 
+00009b60: 2261 6e6f 6d61 6c79 7363 6f72 6573 5f22  "anomalyscores_"
+00009b70: 202b 2073 7472 2878 2929 0d0a 2020 2020   + str(x))..    
+00009b80: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00009b90: 2020 2023 2061 6c6c 206f 6620 7468 6520     # all of the 
+00009ba0: 666f 6c6c 6f77 696e 6720 6172 6520 3120  following are 1 
+00009bb0: 6461 7920 7061 7374 206c 6167 6765 640d  day past lagged.
+00009bc0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00009bd0: 2e6d 756c 7469 7661 7269 6174 655f 6665  .multivariate_fe
+00009be0: 6174 7572 6520 6973 206e 6f74 204e 6f6e  ature is not Non
+00009bf0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00009c00: 2320 696e 636c 7564 6573 2062 6163 6b66  # includes backf
+00009c10: 696c 6c0d 0a20 2020 2020 2020 2020 2020  ill..           
+00009c20: 2066 756c 6c5f 6964 7820 3d20 6869 7374   full_idx = hist
+00009c30: 6f72 795f 6466 2e69 6e64 6578 2e75 6e69  ory_df.index.uni
+00009c40: 6f6e 280d 0a20 2020 2020 2020 2020 2020  on(..           
+00009c50: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+00009c60: 5f66 6f72 6563 6173 745f 696e 6465 7828  _forecast_index(
+00009c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009c80: 2020 2020 2020 666f 7265 6361 7374 5f6c        forecast_l
+00009c90: 656e 6774 683d 312c 206c 6173 745f 6461  ength=1, last_da
+00009ca0: 7465 3d68 6973 746f 7279 5f64 662e 696e  te=history_df.in
+00009cb0: 6465 785b 2d31 5d0d 0a20 2020 2020 2020  dex[-1]..       
+00009cc0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00009cd0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00009ce0: 2020 2020 2020 206c 6167 5f31 5f69 6e64         lag_1_ind
+00009cf0: 7820 3d20 6e70 2e63 6f6e 6361 7465 6e61  x = np.concatena
+00009d00: 7465 285b 5b30 5d2c 206e 702e 6172 616e  te([[0], np.aran
+00009d10: 6765 286c 656e 2868 6973 746f 7279 5f64  ge(len(history_d
+00009d20: 6629 295d 290d 0a20 2020 2020 2020 2020  f))])..         
+00009d30: 2020 2069 6620 7365 6c66 2e6d 756c 7469     if self.multi
+00009d40: 7661 7269 6174 655f 7472 616e 7366 6f72  variate_transfor
+00009d50: 6d61 7469 6f6e 2069 7320 6e6f 7420 4e6f  mation is not No
+00009d60: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00009d70: 2020 2020 2074 7273 5f64 6620 3d20 7365       trs_df = se
+00009d80: 6c66 2e6d 756c 7469 7661 7269 6174 655f  lf.multivariate_
+00009d90: 7472 616e 7366 6f72 6d65 722e 7472 616e  transformer.tran
+00009da0: 7366 6f72 6d28 6869 7374 6f72 795f 6466  sform(history_df
+00009db0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00009dc0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00009dd0: 2020 2020 2020 7472 735f 6466 203d 2068        trs_df = h
+00009de0: 6973 746f 7279 5f64 662e 636f 7079 2829  istory_df.copy()
+00009df0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00009e00: 2073 656c 662e 6d75 6c74 6976 6172 6961   self.multivaria
+00009e10: 7465 5f66 6561 7475 7265 203d 3d20 2266  te_feature == "f
+00009e20: 6561 7475 7265 5f61 6767 6c6f 6d65 7261  eature_agglomera
+00009e30: 7469 6f6e 223a 0d0a 2020 2020 2020 2020  tion":..        
+00009e40: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
+00009e50: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+00009e60: 2020 2020 2020 2020 2020 2020 7064 2e44              pd.D
+00009e70: 6174 6146 7261 6d65 280d 0a20 2020 2020  ataFrame(..     
+00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e90: 2020 2073 656c 662e 6167 676c 6f6d 6572     self.agglomer
+00009ea0: 6174 6f72 2e74 7261 6e73 666f 726d 2874  ator.transform(t
+00009eb0: 7273 5f64 6629 5b6c 6167 5f31 5f69 6e64  rs_df)[lag_1_ind
+00009ec0: 785d 2c0d 0a20 2020 2020 2020 2020 2020  x],..           
+00009ed0: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00009ee0: 6578 3d66 756c 6c5f 6964 782c 0d0a 2020  ex=full_idx,..  
+00009ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f00: 2020 2020 2020 636f 6c75 6d6e 733d 5b0d        columns=[.
+00009f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009f20: 2020 2020 2020 2020 2020 2020 2022 6d75               "mu
+00009f30: 6c74 6976 6172 5f22 202b 2073 7472 2878  ltivar_" + str(x
+00009f40: 2920 666f 7220 7820 696e 2072 616e 6765  ) for x in range
+00009f50: 2873 656c 662e 6167 676c 6f6d 5f6e 5f63  (self.agglom_n_c
+00009f60: 6c75 7374 6572 7329 0d0a 2020 2020 2020  lusters)..      
+00009f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f80: 2020 5d2c 0d0a 2020 2020 2020 2020 2020    ],..          
+00009f90: 2020 2020 2020 2020 2020 292e 7265 696e            ).rein
+00009fa0: 6465 7828 6461 7465 7329 0d0a 2020 2020  dex(dates)..    
+00009fb0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00009fc0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00009fd0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
+00009fe0: 655f 6665 6174 7572 6520 3d3d 2022 6772  e_feature == "gr
+00009ff0: 6f75 705f 6176 6572 6167 6522 3a0d 0a20  oup_average":.. 
+0000a000: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000a010: 756c 7469 7661 725f 6466 203d 2028 0d0a  ultivar_df = (..
+0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a030: 2020 2020 7472 735f 6466 2e67 726f 7570      trs_df.group
+0000a040: 6279 2873 656c 662e 6361 7465 676f 7269  by(self.categori
+0000a050: 6361 6c5f 6772 6f75 7073 2c20 6178 6973  cal_groups, axis
+0000a060: 3d31 290d 0a20 2020 2020 2020 2020 2020  =1)..           
+0000a070: 2020 2020 2020 2020 202e 6d65 616e 2829           .mean()
+0000a080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a090: 2020 2020 2020 2e69 6c6f 635b 6c61 675f        .iloc[lag_
+0000a0a0: 315f 696e 6478 5d0d 0a20 2020 2020 2020  1_indx]..       
+0000a0b0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0000a0c0: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+0000a0d0: 6976 6172 5f64 662e 696e 6465 7820 3d20  ivar_df.index = 
+0000a0e0: 6675 6c6c 5f69 6478 0d0a 2020 2020 2020  full_idx..      
+0000a0f0: 2020 2020 2020 2020 2020 785f 6c69 7374            x_list
+0000a100: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+0000a110: 2020 2020 2020 2020 2020 2020 2020 6d75                mu
+0000a120: 6c74 6976 6172 5f64 662e 7265 696e 6465  ltivar_df.reinde
+0000a130: 7828 6461 7465 7329 2e72 656e 616d 6528  x(dates).rename(
+0000a140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a150: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+0000a160: 733d 6c61 6d62 6461 2078 3a20 226d 756c  s=lambda x: "mul
+0000a170: 7469 7661 725f 2220 2b20 7374 7228 7829  tivar_" + str(x)
+0000a180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a190: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000a1a0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0000a1b0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000a1c0: 662e 6d75 6c74 6976 6172 6961 7465 5f66  f.multivariate_f
+0000a1d0: 6561 7475 7265 203d 3d20 226f 7363 696c  eature == "oscil
+0000a1e0: 6c61 746f 7222 3a0d 0a20 2020 2020 2020  lator":..       
+0000a1f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000a200: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
+0000a210: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000a220: 7365 6173 6f6e 616c 6974 6965 7320 6973  seasonalities is
+0000a230: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0000a240: 2020 2020 2020 2020 735f 6c69 7374 203d          s_list =
+0000a250: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+0000a260: 2066 6f72 2073 6561 736f 6e61 6c69 7479   for seasonality
+0000a270: 2069 6e20 7365 6c66 2e73 6561 736f 6e61   in self.seasona
+0000a280: 6c69 7469 6573 3a0d 0a20 2020 2020 2020  lities:..       
+0000a290: 2020 2020 2020 2020 2073 5f6c 6973 742e           s_list.
+0000a2a0: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+0000a2b0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+0000a2c0: 6174 655f 7365 6173 6f6e 616c 6974 795f  ate_seasonality_
+0000a2d0: 6665 6174 7572 6528 0d0a 2020 2020 2020  feature(..      
+0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2f0: 2020 6461 7465 732c 0d0a 2020 2020 2020    dates,..      
+0000a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a310: 2020 7365 6c66 2e74 5f70 7265 6469 6374    self.t_predict
+0000a320: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000a330: 2020 2020 2020 2020 2020 2073 6561 736f             seaso
+0000a340: 6e61 6c69 7479 2c0d 0a20 2020 2020 2020  nality,..       
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a360: 2068 6973 746f 7279 5f64 6179 733d 7365   history_days=se
+0000a370: 6c66 2e68 6973 746f 7279 5f64 6179 732c  lf.history_days,
+0000a380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a390: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000a3a0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0000a3b0: 2020 2020 2020 2020 2020 2020 2320 494e              # IN
+0000a3c0: 5445 5241 4354 494f 4e53 204e 4f54 2049  TERACTIONS NOT I
+0000a3d0: 4d50 4c45 4d45 4e54 4544 0d0a 2020 2020  MPLEMENTED..    
+0000a3e0: 2020 2020 2020 2020 2020 2020 2320 4f52              # OR
+0000a3f0: 4445 5220 5350 4543 4946 4943 4154 494f  DER SPECIFICATIO
+0000a400: 4e20 4e4f 5420 494d 504c 454d 454e 5445  N NOT IMPLEMENTE
+0000a410: 440d 0a20 2020 2020 2020 2020 2020 2073  D..            s
+0000a420: 5f64 6620 3d20 7064 2e63 6f6e 6361 7428  _df = pd.concat(
+0000a430: 735f 6c69 7374 2c20 6178 6973 3d31 290d  s_list, axis=1).
+0000a440: 0a20 2020 2020 2020 2020 2020 2073 5f64  .            s_d
+0000a450: 662e 696e 6465 7820 3d20 6461 7465 730d  f.index = dates.
+0000a460: 0a20 2020 2020 2020 2020 2020 2078 5f6c  .            x_l
+0000a470: 6973 742e 6170 7065 6e64 2873 5f64 6629  ist.append(s_df)
+0000a480: 0d0a 2020 2020 2020 2020 6966 2066 7574  ..        if fut
+0000a490: 7572 655f 7265 6772 6573 736f 7220 6973  ure_regressor is
+0000a4a0: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+0000a4b0: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
+0000a4c0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000a4d0: 2078 5f6c 6973 742e 6170 7065 6e64 2866   x_list.append(f
+0000a4e0: 7574 7572 655f 7265 6772 6573 736f 722e  uture_regressor.
+0000a4f0: 7265 696e 6465 7828 6461 7465 7329 290d  reindex(dates)).
+0000a500: 0a20 2020 2020 2020 2069 6620 666c 6167  .        if flag
+0000a510: 5f72 6567 7265 7373 6f72 7320 6973 206e  _regressors is n
+0000a520: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
+0000a530: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
+0000a540: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+0000a550: 5f6c 6973 742e 6170 7065 6e64 280d 0a20  _list.append(.. 
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a570: 6c61 675f 7265 6772 6573 736f 7273 2e72  lag_regressors.r
+0000a580: 6569 6e64 6578 2864 6174 6573 290d 0a20  eindex(dates).. 
+0000a590: 2020 2020 2020 2020 2020 2029 2020 2320             )  # 
+0000a5a0: 646f 6573 6e27 7420 6368 6563 6b20 666f  doesn't check fo
+0000a5b0: 7220 6d69 7373 696e 6720 6461 7461 0d0a  r missing data..
+0000a5c0: 2020 2020 2020 2020 6966 2028 0d0a 2020          if (..  
+0000a5d0: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0000a5e0: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
+0000a5f0: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+0000a600: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
+0000a610: 7420 6973 696e 7374 616e 6365 2873 656c  t isinstance(sel
+0000a620: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
+0000a630: 6965 732c 2064 6963 7429 0d0a 2020 2020  ies, dict)..    
+0000a640: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+0000a650: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
+0000a660: 6573 5f75 7365 640d 0a20 2020 2020 2020  es_used..       
+0000a670: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+0000a680: 2066 6f72 2068 6f6c 6964 6179 5f63 6f75   for holiday_cou
+0000a690: 6e74 7279 2069 6e20 7365 6c66 2e68 6f6c  ntry in self.hol
+0000a6a0: 6964 6179 5f63 6f75 6e74 7269 6573 3a0d  iday_countries:.
+0000a6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a6c0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
+0000a6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a6e0: 2020 2020 2068 6f6c 6964 6179 5f66 6c61       holiday_fla
+0000a6f0: 6728 0d0a 2020 2020 2020 2020 2020 2020  g(..            
+0000a700: 2020 2020 2020 2020 2020 2020 6461 7465              date
+0000a710: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000a720: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+0000a730: 7472 793d 686f 6c69 6461 795f 636f 756e  try=holiday_coun
+0000a740: 7472 792c 0d0a 2020 2020 2020 2020 2020  try,..          
+0000a750: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0000a760: 636f 6465 5f68 6f6c 6964 6179 5f74 7970  code_holiday_typ
+0000a770: 653d 5472 7565 2c0d 0a20 2020 2020 2020  e=True,..       
+0000a780: 2020 2020 2020 2020 2020 2020 2029 2e72               ).r
+0000a790: 656e 616d 6528 636f 6c75 6d6e 733d 6c61  ename(columns=la
+0000a7a0: 6d62 6461 2078 3a20 2268 6f6c 6964 6179  mbda x: "holiday
+0000a7b0: 5f22 202b 2073 7472 2878 2929 2c0d 0a20  _" + str(x)),.. 
+0000a7c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000a7d0: 0d0a 2020 2020 2020 2020 2320 7075 7420  ..        # put 
+0000a7e0: 7468 6973 2074 6f20 7468 6520 656e 6420  this to the end 
+0000a7f0: 6173 2069 7420 7461 6b65 7320 7570 206c  as it takes up l
+0000a800: 6f74 7320 6f66 2066 6561 7475 7265 2073  ots of feature s
+0000a810: 7061 6365 2073 6f6d 6574 696d 6573 0d0a  pace sometimes..
+0000a820: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000a830: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
+0000a840: 5f70 6172 616d 7320 6973 206e 6f74 204e  _params is not N
+0000a850: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000a860: 2020 785f 6c69 7374 2e61 7070 656e 6428    x_list.append(
+0000a870: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a880: 2020 7365 6c66 2e68 6f6c 6964 6179 5f64    self.holiday_d
+0000a890: 6574 6563 746f 722e 6461 7465 735f 746f  etector.dates_to
+0000a8a0: 5f68 6f6c 6964 6179 7328 6461 7465 732c  _holidays(dates,
+0000a8b0: 2073 7479 6c65 3d22 666c 6167 2229 0d0a   style="flag")..
+0000a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8d0: 2e63 6c69 7028 7570 7065 723d 3129 0d0a  .clip(upper=1)..
+0000a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8f0: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
+0000a900: 6c61 6d62 6461 2078 3a20 2268 6f6c 6964  lambda x: "holid
+0000a910: 6179 5f22 202b 2073 7472 2878 2929 0d0a  ay_" + str(x))..
+0000a920: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+0000a930: 0a20 2020 2020 2020 2023 2046 494e 414c  .        # FINAL
+0000a940: 2046 4541 5455 5245 2050 524f 4345 5353   FEATURE PROCESS
+0000a950: 494e 470d 0a20 2020 2020 2020 2078 5f61  ING..        x_a
+0000a960: 7272 6179 203d 2070 642e 636f 6e63 6174  rray = pd.concat
+0000a970: 2878 5f6c 6973 742c 2061 7869 733d 3129  (x_list, axis=1)
+0000a980: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0000a990: 7265 6469 6374 5f78 5f61 7272 6179 203d  redict_x_array =
+0000a9a0: 2078 5f61 7272 6179 2020 2320 6361 6e20   x_array  # can 
+0000a9b0: 7265 6d6f 7665 2074 6869 7320 6c61 7465  remove this late
+0000a9c0: 722c 2069 7420 6973 2066 6f72 2064 6562  r, it is for deb
+0000a9d0: 7567 6769 6e67 0d0a 2020 2020 2020 2020  ugging..        
+0000a9e0: 6966 206e 702e 616e 7928 6e70 2e69 736e  if np.any(np.isn
+0000a9f0: 616e 2878 5f61 7272 6179 2e61 7374 7970  an(x_array.astyp
+0000aa00: 6528 666c 6f61 7429 2929 3a20 2023 2072  e(float))):  # r
+0000aa10: 656d 6f76 6520 6c61 7465 722c 2066 6f72  emove later, for
+0000aa20: 2064 6562 7567 6769 6e67 0d0a 2020 2020   debugging..    
+0000aa30: 2020 2020 2020 2020 6e75 6c7a 203d 2078          nulz = x
+0000aa40: 5f61 7272 6179 2e69 736e 756c 6c28 292e  _array.isnull().
+0000aa50: 7375 6d28 290d 0a20 2020 2020 2020 2020  sum()..         
+0000aa60: 2020 2070 7269 6e74 280d 0a20 2020 2020     print(..     
+0000aa70: 2020 2020 2020 2020 2020 2066 2274 6865             f"the
+0000aa80: 2066 6f6c 6c6f 7769 6e67 2063 6f6c 756d   following colum
+0000aa90: 6e73 2063 6f6e 7461 696e 206e 616e 2076  ns contain nan v
+0000aaa0: 616c 7565 733a 207b 6e75 6c7a 5b6e 756c  alues: {nulz[nul
+0000aab0: 7a20 3e20 305d 2e69 6e64 6578 2e74 6f6c  z > 0].index.tol
+0000aac0: 6973 7428 297d 220d 0a20 2020 2020 2020  ist()}"..       
+0000aad0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000aae0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000aaf0: 7272 6f72 2822 6e61 6e20 7661 6c75 6573  rror("nan values
+0000ab00: 2069 6e20 7072 6564 6963 745f 785f 6172   in predict_x_ar
+0000ab10: 7261 7922 290d 0a0d 0a20 2020 2020 2020  ray")....       
+0000ab20: 2023 2052 554e 204c 494e 4541 5220 4d4f   # RUN LINEAR MO
+0000ab30: 4445 4c0d 0a20 2020 2020 2020 2023 2061  DEL..        # a
+0000ab40: 6464 2078 2066 6561 7475 7265 7320 7468  dd x features th
+0000ab50: 6174 2064 6f6e 2774 2061 7070 6c79 2074  at don't apply t
+0000ab60: 6f20 616c 6c2c 2061 6e64 206e 6565 6420  o all, and need 
+0000ab70: 746f 2062 6520 6c6f 6f70 6564 0d0a 2020  to be looped..  
+0000ab80: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
+0000ab90: 6f70 5f72 6571 7569 7265 643a 0d0a 2020  op_required:..  
+0000aba0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000abb0: 7265 6469 6374 5f78 5f61 7272 6179 203d  redict_x_array =
+0000abc0: 207b 7d0d 0a20 2020 2020 2020 2020 2020   {}..           
+0000abd0: 2073 656c 662e 636f 6d70 6f6e 656e 7473   self.components
+0000abe0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+0000abf0: 2020 2070 7265 6469 6374 7320 3d20 5b5d     predicts = []
+0000ac00: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0000ac10: 7220 636f 6c20 696e 2073 656c 662e 6466  r col in self.df
+0000ac20: 2e63 6f6c 756d 6e73 3a0d 0a20 2020 2020  .columns:..     
+0000ac30: 2020 2020 2020 2020 2020 2063 5f78 203d             c_x =
+0000ac40: 2078 5f61 7272 6179 2e63 6f70 7928 290d   x_array.copy().
+0000ac50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ac60: 2023 2069 6d70 6c65 6d65 6e74 2070 6572   # implement per
+0000ac70: 5f73 6572 6965 7320 686f 6c69 6461 7920  _series holiday 
+0000ac80: 636f 756e 7472 6965 7320 666c 6167 0d0a  countries flag..
+0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aca0: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+0000acb0: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
+0000acc0: 616e 6365 2873 656c 662e 686f 6c69 6461  ance(self.holida
+0000acd0: 795f 636f 756e 7472 6965 732c 2064 6963  y_countries, dic
+0000ace0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+0000acf0: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+0000ad00: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
+0000ad10: 6573 5f75 7365 640d 0a20 2020 2020 2020  es_used..       
+0000ad20: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad40: 2068 6320 3d20 7365 6c66 2e68 6f6c 6964   hc = self.holid
+0000ad50: 6179 5f63 6f75 6e74 7269 6573 2e67 6574  ay_countries.get
+0000ad60: 2863 6f6c 2c20 4e6f 6e65 290d 0a20 2020  (col, None)..   
+0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad80: 2069 6620 6863 2069 7320 6e6f 7420 4e6f   if hc is not No
+0000ad90: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000ada0: 2020 2020 2020 2020 2020 2020 2063 5f68               c_h
+0000adb0: 6320 3d20 686f 6c69 6461 795f 666c 6167  c = holiday_flag
+0000adc0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000add0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000ade0: 6174 6573 2c0d 0a20 2020 2020 2020 2020  ates,..         
+0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae00: 2020 2063 6f75 6e74 7279 3d68 632c 0d0a     country=hc,..
 0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae20: 2020 2020 2020 292e 7265 6e61 6d65 2863        ).rename(c
-0000ae30: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
-0000ae40: 2022 686f 6c69 6461 795f 2220 2b20 7374   "holiday_" + st
-0000ae50: 7228 7829 290d 0a20 2020 2020 2020 2020  r(x))..         
-0000ae60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000ae70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ae80: 2020 2020 2020 2020 2020 635f 6863 203d            c_hc =
-0000ae90: 2070 642e 4461 7461 4672 616d 6528 302c   pd.DataFrame(0,
-0000aea0: 2069 6e64 6578 3d64 6174 6573 2c20 636f   index=dates, co
-0000aeb0: 6c75 6d6e 733d 5b22 686f 6c69 6461 795f  lumns=["holiday_
-0000aec0: 3022 5d29 0d0a 2020 2020 2020 2020 2020  0"])..          
-0000aed0: 2020 2020 2020 2020 2020 635f 7820 3d20            c_x = 
-0000aee0: 7064 2e63 6f6e 6361 7428 5b63 5f78 2c20  pd.concat([c_x, 
-0000aef0: 635f 6863 5d2c 2061 7869 733d 3129 0d0a  c_hc], axis=1)..
+0000ae20: 2020 2020 2020 2020 2020 2020 656e 636f              enco
+0000ae30: 6465 5f68 6f6c 6964 6179 5f74 7970 653d  de_holiday_type=
+0000ae40: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
+0000ae50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ae60: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
+0000ae70: 6c61 6d62 6461 2078 3a20 2268 6f6c 6964  lambda x: "holid
+0000ae80: 6179 5f22 202b 2073 7472 2878 2929 0d0a  ay_" + str(x))..
+0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aea0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aec0: 2020 2063 5f68 6320 3d20 7064 2e44 6174     c_hc = pd.Dat
+0000aed0: 6146 7261 6d65 2830 2c20 696e 6465 783d  aFrame(0, index=
+0000aee0: 6461 7465 732c 2063 6f6c 756d 6e73 3d5b  dates, columns=[
+0000aef0: 2268 6f6c 6964 6179 5f30 225d 290d 0a20  "holiday_0"]).. 
 0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af10: 2320 696d 706c 656d 656e 7420 7265 6772  # implement regr
-0000af20: 6573 736f 7273 2070 6572 2073 6572 6965  essors per serie
-0000af30: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0000af40: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000af50: 2872 6567 7265 7373 6f72 5f70 6572 5f73  (regressor_per_s
-0000af60: 6572 6965 732c 2064 6963 7429 2061 6e64  eries, dict) and
-0000af70: 2073 656c 662e 7265 6772 6573 736f 7273   self.regressors
-0000af80: 5f75 7365 643a 0d0a 2020 2020 2020 2020  _used:..        
-0000af90: 2020 2020 2020 2020 2020 2020 6863 203d              hc =
-0000afa0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
-0000afb0: 6572 6965 732e 6765 7428 636f 6c2c 204e  eries.get(col, N
-0000afc0: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-0000afd0: 2020 2020 2020 2020 2020 6966 2068 6320            if hc 
-0000afe0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 2020 2020 2020 635f 6863 203d 2028 0d0a        c_hc = (..
-0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 2020 2020 2020 2020 2020 2020 7064 2e44              pd.D
-0000b030: 6174 6146 7261 6d65 2868 6329 0d0a 2020  ataFrame(hc)..  
-0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b050: 2020 2020 2020 2020 2020 2e72 656e 616d            .renam
-0000b060: 6528 636f 6c75 6d6e 733d 6c61 6d62 6461  e(columns=lambda
-0000b070: 2078 3a20 2272 6567 7270 6572 7365 7269   x: "regrperseri
-0000b080: 6573 5f22 202b 2073 7472 2878 2929 0d0a  es_" + str(x))..
-0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0a0: 2020 2020 2020 2020 2020 2020 2e72 6569              .rei
-0000b0b0: 6e64 6578 2864 6174 6573 290d 0a20 2020  ndex(dates)..   
-0000b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000b0e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000b0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000b100: 2020 2020 2020 2020 2020 2063 5f68 6320             c_hc 
-0000b110: 3d20 7064 2e44 6174 6146 7261 6d65 2830  = pd.DataFrame(0
-0000b120: 2c20 696e 6465 783d 6461 7465 732c 2063  , index=dates, c
-0000b130: 6f6c 756d 6e73 3d5b 2272 6567 7270 6572  olumns=["regrper
-0000b140: 7365 7269 6573 5f30 225d 290d 0a20 2020  series_0"])..   
-0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b160: 2063 5f78 203d 2070 642e 636f 6e63 6174   c_x = pd.concat
-0000b170: 285b 635f 782c 2063 5f68 635d 2c20 6178  ([c_x, c_hc], ax
-0000b180: 6973 3d31 290d 0a20 2020 2020 2020 2020  is=1)..         
-0000b190: 2020 2020 2020 2023 2069 6d70 6c65 6d65         # impleme
-0000b1a0: 6e74 2070 6173 745f 696d 7061 6374 7320  nt past_impacts 
-0000b1b0: 6173 2072 6567 7265 7373 6f72 0d0a 2020  as regressor..  
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b1d0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-0000b1e0: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-0000b1f0: 6365 2869 6d70 6163 7473 2c20 7064 2e44  ce(impacts, pd.D
-0000b200: 6174 6146 7261 6d65 290d 0a20 2020 2020  ataFrame)..     
-0000b210: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000b220: 6e64 2073 656c 662e 7061 7374 5f69 6d70  nd self.past_imp
-0000b230: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
-0000b240: 6e20 3d3d 2022 7265 6772 6573 736f 7222  n == "regressor"
-0000b250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b260: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-0000b270: 2020 2020 2020 2020 2020 635f 7820 3d20            c_x = 
-0000b280: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
-0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2a0: 2020 2020 5b0d 0a20 2020 2020 2020 2020      [..         
-0000b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2c0: 2020 2063 5f78 2c0d 0a20 2020 2020 2020     c_x,..       
-0000b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2e0: 2020 2020 2069 6d70 6163 7473 2e72 6569       impacts.rei
-0000b2f0: 6e64 6578 2864 6174 6573 295b 636f 6c5d  ndex(dates)[col]
+0000af10: 2020 2063 5f78 203d 2070 642e 636f 6e63     c_x = pd.conc
+0000af20: 6174 285b 635f 782c 2063 5f68 635d 2c20  at([c_x, c_hc], 
+0000af30: 6178 6973 3d31 290d 0a20 2020 2020 2020  axis=1)..       
+0000af40: 2020 2020 2020 2020 2023 2069 6d70 6c65           # imple
+0000af50: 6d65 6e74 2072 6567 7265 7373 6f72 7320  ment regressors 
+0000af60: 7065 7220 7365 7269 6573 0d0a 2020 2020  per series..    
+0000af70: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000af80: 7369 6e73 7461 6e63 6528 7265 6772 6573  sinstance(regres
+0000af90: 736f 725f 7065 725f 7365 7269 6573 2c20  sor_per_series, 
+0000afa0: 6469 6374 2920 616e 6420 7365 6c66 2e72  dict) and self.r
+0000afb0: 6567 7265 7373 6f72 735f 7573 6564 3a0d  egressors_used:.
+0000afc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000afd0: 2020 2020 2068 6320 3d20 7265 6772 6573       hc = regres
+0000afe0: 736f 725f 7065 725f 7365 7269 6573 2e67  sor_per_series.g
+0000aff0: 6574 2863 6f6c 2c20 4e6f 6e65 290d 0a20  et(col, None).. 
+0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b010: 2020 2069 6620 6863 2069 7320 6e6f 7420     if hc is not 
+0000b020: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000b030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000b040: 5f68 6320 3d20 280d 0a20 2020 2020 2020  _hc = (..       
+0000b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b060: 2020 2020 2070 642e 4461 7461 4672 616d       pd.DataFram
+0000b070: 6528 6863 290d 0a20 2020 2020 2020 2020  e(hc)..         
+0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b090: 2020 202e 7265 6e61 6d65 2863 6f6c 756d     .rename(colum
+0000b0a0: 6e73 3d6c 616d 6264 6120 783a 2022 7265  ns=lambda x: "re
+0000b0b0: 6772 7065 7273 6572 6965 735f 2220 2b20  grperseries_" + 
+0000b0c0: 7374 7228 7829 290d 0a20 2020 2020 2020  str(x))..       
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 2020 2020 202e 7265 696e 6465 7828 6461       .reindex(da
+0000b0f0: 7465 7329 0d0a 2020 2020 2020 2020 2020  tes)..          
+0000b100: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000b110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b120: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b140: 2020 2020 635f 6863 203d 2070 642e 4461      c_hc = pd.Da
+0000b150: 7461 4672 616d 6528 302c 2069 6e64 6578  taFrame(0, index
+0000b160: 3d64 6174 6573 2c20 636f 6c75 6d6e 733d  =dates, columns=
+0000b170: 5b22 7265 6772 7065 7273 6572 6965 735f  ["regrperseries_
+0000b180: 3022 5d29 0d0a 2020 2020 2020 2020 2020  0"])..          
+0000b190: 2020 2020 2020 2020 2020 635f 7820 3d20            c_x = 
+0000b1a0: 7064 2e63 6f6e 6361 7428 5b63 5f78 2c20  pd.concat([c_x, 
+0000b1b0: 635f 6863 5d2c 2061 7869 733d 3129 0d0a  c_hc], axis=1)..
+0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1d0: 2320 696d 706c 656d 656e 7420 7061 7374  # implement past
+0000b1e0: 5f69 6d70 6163 7473 2061 7320 7265 6772  _impacts as regr
+0000b1f0: 6573 736f 720d 0a20 2020 2020 2020 2020  essor..         
+0000b200: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+0000b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b220: 2069 7369 6e73 7461 6e63 6528 696d 7061   isinstance(impa
+0000b230: 6374 732c 2070 642e 4461 7461 4672 616d  cts, pd.DataFram
+0000b240: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0000b250: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+0000b260: 2e70 6173 745f 696d 7061 6374 735f 696e  .past_impacts_in
+0000b270: 7465 7276 656e 7469 6f6e 203d 3d20 2272  tervention == "r
+0000b280: 6567 7265 7373 6f72 220d 0a20 2020 2020  egressor"..     
+0000b290: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
+0000b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2b0: 2020 2063 5f78 203d 2070 642e 636f 6e63     c_x = pd.conc
+0000b2c0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+0000b2d0: 2020 2020 2020 2020 2020 2020 205b 0d0a               [..
+0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2f0: 2020 2020 2020 2020 2020 2020 635f 782c              c_x,
 0000b300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b310: 2020 2020 2020 2020 2020 2020 2020 2e74                .t
-0000b320: 6f5f 6672 616d 6528 290d 0a20 2020 2020  o_frame()..     
-0000b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b340: 2020 2020 2020 202e 6669 6c6c 6e61 2830         .fillna(0
-0000b350: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000b360: 2020 2020 2020 2020 2020 2020 2020 202e                 .
-0000b370: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d6c  rename(columns=l
-0000b380: 616d 6264 6120 783a 2022 696d 7061 6374  ambda x: "impact
-0000b390: 735f 2220 2b20 7374 7228 7829 292c 0d0a  s_" + str(x)),..
-0000b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3b0: 2020 2020 2020 2020 5d2c 0d0a 2020 2020          ],..    
-0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3d0: 2020 2020 6178 6973 3d31 2c0d 0a20 2020      axis=1,..   
+0000b310: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0000b320: 7061 6374 732e 7265 696e 6465 7828 6461  pacts.reindex(da
+0000b330: 7465 7329 5b63 6f6c 5d0d 0a20 2020 2020  tes)[col]..     
+0000b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b350: 2020 2020 2020 202e 746f 5f66 7261 6d65         .to_frame
+0000b360: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b380: 2e66 696c 6c6e 6128 3029 0d0a 2020 2020  .fillna(0)..    
+0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3a0: 2020 2020 2020 2020 2e72 656e 616d 6528          .rename(
+0000b3b0: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
+0000b3c0: 3a20 2269 6d70 6163 7473 5f22 202b 2073  : "impacts_" + s
+0000b3d0: 7472 2878 2929 2c0d 0a20 2020 2020 2020  tr(x)),..       
 0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3f0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000b400: 2020 2020 2320 6164 6420 4152 2066 6561      # add AR fea
-0000b410: 7475 7265 730d 0a20 2020 2020 2020 2020  tures..         
-0000b420: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-0000b430: 725f 6c61 6773 2069 7320 6e6f 7420 4e6f  r_lags is not No
-0000b440: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0000b450: 2020 2020 2020 2020 2023 2073 6f6d 6577           # somew
-0000b460: 6861 7420 696e 6566 6669 6369 656e 7420  hat inefficient 
-0000b470: 746f 2063 7265 6174 6520 6675 6c6c 2064  to create full d
-0000b480: 6620 6f66 2064 6174 6573 2c20 6275 7420  f of dates, but 
-0000b490: 7369 6d70 6c65 7374 2074 6869 7320 7761  simplest this wa
-0000b4a0: 7920 666f 7220 2761 6e79 2064 6174 6527  y for 'any date'
-0000b4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b4c0: 2020 2020 2020 666f 7220 6c61 6720 696e        for lag in
-0000b4d0: 2073 656c 662e 6172 5f6c 6167 733a 0d0a   self.ar_lags:..
-0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4f0: 2020 2020 2020 2020 6675 6c6c 5f69 6478          full_idx
-0000b500: 203d 2068 6973 746f 7279 5f64 662e 696e   = history_df.in
-0000b510: 6465 782e 756e 696f 6e28 0d0a 2020 2020  dex.union(..    
+0000b3f0: 205d 2c0d 0a20 2020 2020 2020 2020 2020   ],..           
+0000b400: 2020 2020 2020 2020 2020 2020 2061 7869               axi
+0000b410: 733d 312c 0d0a 2020 2020 2020 2020 2020  s=1,..          
+0000b420: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+0000b430: 2020 2020 2020 2020 2020 2020 2023 2061               # a
+0000b440: 6464 2041 5220 6665 6174 7572 6573 0d0a  dd AR features..
+0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b460: 6966 2073 656c 662e 6172 5f6c 6167 7320  if self.ar_lags 
+0000b470: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b490: 2020 2320 736f 6d65 7768 6174 2069 6e65    # somewhat ine
+0000b4a0: 6666 6963 6965 6e74 2074 6f20 6372 6561  fficient to crea
+0000b4b0: 7465 2066 756c 6c20 6466 206f 6620 6461  te full df of da
+0000b4c0: 7465 732c 2062 7574 2073 696d 706c 6573  tes, but simples
+0000b4d0: 7420 7468 6973 2077 6179 2066 6f72 2027  t this way for '
+0000b4e0: 616e 7920 6461 7465 270d 0a20 2020 2020  any date'..     
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b500: 6f72 206c 6167 2069 6e20 7365 6c66 2e61  or lag in self.a
+0000b510: 725f 6c61 6773 3a0d 0a20 2020 2020 2020  r_lags:..       
 0000b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b530: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-0000b540: 6174 655f 666f 7265 6361 7374 5f69 6e64  ate_forecast_ind
-0000b550: 6578 280d 0a20 2020 2020 2020 2020 2020  ex(..           
+0000b530: 2066 756c 6c5f 6964 7820 3d20 6869 7374   full_idx = hist
+0000b540: 6f72 795f 6466 2e69 6e64 6578 2e75 6e69  ory_df.index.uni
+0000b550: 6f6e 280d 0a20 2020 2020 2020 2020 2020  on(..           
 0000b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b570: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
-0000b580: 6e67 7468 3d6c 6167 2c20 6c61 7374 5f64  ngth=lag, last_d
-0000b590: 6174 653d 6869 7374 6f72 795f 6466 2e69  ate=history_df.i
-0000b5a0: 6e64 6578 5b2d 315d 0d0a 2020 2020 2020  ndex[-1]..      
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5e0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000b5f0: 2020 2020 2020 2020 2020 2020 6c61 675f              lag_
-0000b600: 6964 7820 3d20 6e70 2e63 6f6e 6361 7465  idx = np.concate
-0000b610: 6e61 7465 280d 0a20 2020 2020 2020 2020  nate(..         
+0000b570: 2073 656c 662e 6372 6561 7465 5f66 6f72   self.create_for
+0000b580: 6563 6173 745f 696e 6465 7828 0d0a 2020  ecast_index(..  
+0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000b5b0: 7265 6361 7374 5f6c 656e 6774 683d 6c61  recast_length=la
+0000b5c0: 672c 206c 6173 745f 6461 7465 3d68 6973  g, last_date=his
+0000b5d0: 746f 7279 5f64 662e 696e 6465 785b 2d31  tory_df.index[-1
+0000b5e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000b600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b610: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
 0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b630: 2020 205b 6e70 2e72 6570 6561 7428 5b30     [np.repeat([0
-0000b640: 5d2c 206c 6167 292c 206e 702e 6172 616e  ], lag), np.aran
-0000b650: 6765 286c 656e 2868 6973 746f 7279 5f64  ge(len(history_d
-0000b660: 6629 295d 0d0a 2020 2020 2020 2020 2020  f))]..          
-0000b670: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
-0000b680: 2023 205b 303a 6c65 6e28 6869 7374 6f72   # [0:len(histor
-0000b690: 795f 6466 295d 0d0a 2020 2020 2020 2020  y_df)]..        
+0000b630: 2020 2020 206c 6167 5f69 6478 203d 206e       lag_idx = n
+0000b640: 702e 636f 6e63 6174 656e 6174 6528 0d0a  p.concatenate(..
+0000b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b660: 2020 2020 2020 2020 2020 2020 5b6e 702e              [np.
+0000b670: 7265 7065 6174 285b 305d 2c20 6c61 6729  repeat([0], lag)
+0000b680: 2c20 6e70 2e61 7261 6e67 6528 6c65 6e28  , np.arange(len(
+0000b690: 6869 7374 6f72 795f 6466 2929 5d0d 0a20  history_df))].. 
 0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6b0: 6c61 675f 7320 3d20 6869 7374 6f72 795f  lag_s = history_
-0000b6c0: 6466 5b63 6f6c 5d2e 696c 6f63 5b6c 6167  df[col].iloc[lag
-0000b6d0: 5f69 6478 5d2e 7265 6e61 6d65 2866 226c  _idx].rename(f"l
-0000b6e0: 6167 7b6c 6167 7d5f 2229 0d0a 2020 2020  ag{lag}_")..    
-0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 2020 6c61 675f 732e 696e 6465 7820      lag_s.index 
-0000b710: 3d20 6675 6c6c 5f69 6478 0d0a 2020 2020  = full_idx..    
-0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b730: 2020 2020 6c61 675f 7320 3d20 6c61 675f      lag_s = lag_
-0000b740: 732e 7265 696e 6465 7828 6461 7465 7329  s.reindex(dates)
-0000b750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b760: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000b770: 662e 6172 5f69 6e74 6572 6163 7469 6f6e  f.ar_interaction
-0000b780: 5f73 6561 736f 6e61 6c69 7479 2069 7320  _seasonality is 
-0000b790: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0000b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7b0: 2020 2020 2020 2073 5f66 6561 7420 3d20         s_feat = 
-0000b7c0: 6372 6561 7465 5f73 6561 736f 6e61 6c69  create_seasonali
-0000b7d0: 7479 5f66 6561 7475 7265 280d 0a20 2020  ty_feature(..   
+0000b6b0: 2020 2020 2020 2029 2020 2320 5b30 3a6c         )  # [0:l
+0000b6c0: 656e 2868 6973 746f 7279 5f64 6629 5d0d  en(history_df)].
+0000b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b6e0: 2020 2020 2020 2020 206c 6167 5f73 203d           lag_s =
+0000b6f0: 2068 6973 746f 7279 5f64 665b 636f 6c5d   history_df[col]
+0000b700: 2e69 6c6f 635b 6c61 675f 6964 785d 2e72  .iloc[lag_idx].r
+0000b710: 656e 616d 6528 6622 6c61 677b 6c61 677d  ename(f"lag{lag}
+0000b720: 5f22 290d 0a20 2020 2020 2020 2020 2020  _")..           
+0000b730: 2020 2020 2020 2020 2020 2020 206c 6167               lag
+0000b740: 5f73 2e69 6e64 6578 203d 2066 756c 6c5f  _s.index = full_
+0000b750: 6964 780d 0a20 2020 2020 2020 2020 2020  idx..           
+0000b760: 2020 2020 2020 2020 2020 2020 206c 6167               lag
+0000b770: 5f73 203d 206c 6167 5f73 2e72 6569 6e64  _s = lag_s.reind
+0000b780: 6578 2864 6174 6573 290d 0a20 2020 2020  ex(dates)..     
+0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7a0: 2020 2069 6620 7365 6c66 2e61 725f 696e     if self.ar_in
+0000b7b0: 7465 7261 6374 696f 6e5f 7365 6173 6f6e  teraction_season
+0000b7c0: 616c 6974 7920 6973 206e 6f74 204e 6f6e  ality is not Non
+0000b7d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
 0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7f0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0000b800: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 2020 2020 2073 656c 662e 745f 7072 6564       self.t_pred
-0000b830: 6963 742c 0d0a 2020 2020 2020 2020 2020  ict,..          
+0000b7f0: 735f 6665 6174 203d 2063 7265 6174 655f  s_feat = create_
+0000b800: 7365 6173 6f6e 616c 6974 795f 6665 6174  seasonality_feat
+0000b810: 7572 6528 0d0a 2020 2020 2020 2020 2020  ure(..          
+0000b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b830: 2020 2020 2020 6461 7465 732c 0d0a 2020        dates,..  
 0000b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b850: 2020 2020 2020 7365 6c66 2e61 725f 696e        self.ar_in
-0000b860: 7465 7261 6374 696f 6e5f 7365 6173 6f6e  teraction_season
-0000b870: 616c 6974 792c 0d0a 2020 2020 2020 2020  ality,..        
-0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b890: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
-0000b8a0: 6461 7973 3d73 656c 662e 6869 7374 6f72  days=self.histor
-0000b8b0: 795f 6461 7973 2c0d 0a20 2020 2020 2020  y_days,..       
+0000b850: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000b860: 6c66 2e74 5f70 7265 6469 6374 2c0d 0a20  lf.t_predict,.. 
+0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b890: 656c 662e 6172 5f69 6e74 6572 6163 7469  elf.ar_interacti
+0000b8a0: 6f6e 5f73 6561 736f 6e61 6c69 7479 2c0d  on_seasonality,.
+0000b8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8f0: 2020 2020 735f 6665 6174 2e69 6e64 6578      s_feat.index
-0000b900: 203d 206c 6167 5f73 2e69 6e64 6578 0d0a   = lag_s.index..
-0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2020 2020 2020 2020 2020 6c61 675f              lag_
-0000b930: 7320 3d20 735f 6665 6174 2e6d 756c 286c  s = s_feat.mul(l
-0000b940: 6167 5f73 2c20 6178 6973 3d30 292e 7265  ag_s, axis=0).re
-0000b950: 6e61 6d65 280d 0a20 2020 2020 2020 2020  name(..         
-0000b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b970: 2020 2020 2020 2063 6f6c 756d 6e73 3d6c         columns=l
-0000b980: 616d 6264 6120 783a 2066 226c 6167 7b6c  ambda x: f"lag{l
-0000b990: 6167 7d5f 2220 2b20 7374 7228 7829 0d0a  ag}_" + str(x)..
+0000b8d0: 2068 6973 746f 7279 5f64 6179 733d 7365   history_days=se
+0000b8e0: 6c66 2e68 6973 746f 7279 5f64 6179 732c  lf.history_days,
+0000b8f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b900: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000b910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b920: 2020 2020 2020 2020 2020 2020 2073 5f66               s_f
+0000b930: 6561 742e 696e 6465 7820 3d20 6c61 675f  eat.index = lag_
+0000b940: 732e 696e 6465 780d 0a20 2020 2020 2020  s.index..       
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 2020 2020 206c 6167 5f73 203d 2073 5f66       lag_s = s_f
+0000b970: 6561 742e 6d75 6c28 6c61 675f 732c 2061  eat.mul(lag_s, a
+0000b980: 7869 733d 3029 2e72 656e 616d 6528 0d0a  xis=0).rename(..
+0000b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9d0: 2020 2020 2020 2063 5f78 203d 2070 642e         c_x = pd.
-0000b9e0: 636f 6e63 6174 285b 635f 782c 206c 6167  concat([c_x, lag
-0000b9f0: 5f73 5d2c 2061 7869 733d 3129 0d0a 0d0a  _s], axis=1)....
+0000b9b0: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
+0000b9c0: 3a20 6622 6c61 677b 6c61 677d 5f22 202b  : f"lag{lag}_" +
+0000b9d0: 2073 7472 2878 290d 0a20 2020 2020 2020   str(x)..       
+0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
 0000ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba10: 2320 4144 4449 4e47 2052 4543 454e 4359  # ADDING RECENCY
-0000ba20: 2057 4549 4748 5449 4e47 2041 4e44 2052   WEIGHTING AND R
-0000ba30: 4944 4745 2050 4152 414d 530d 0a20 2020  IDGE PARAMS..   
-0000ba40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ba50: 6e70 2e61 6e79 286e 702e 6973 6e61 6e28  np.any(np.isnan(
-0000ba60: 635f 782e 6173 7479 7065 2866 6c6f 6174  c_x.astype(float
-0000ba70: 2929 293a 2020 2320 7265 6d6f 7665 206c  ))):  # remove l
-0000ba80: 6174 6572 2c20 666f 7220 6465 6275 6767  ater, for debugg
-0000ba90: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
-0000baa0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000bab0: 616c 7565 4572 726f 7228 226e 616e 2076  alueError("nan v
-0000bac0: 616c 7565 7320 696e 2070 7265 6469 6374  alues in predict
-0000bad0: 2063 5f78 5f61 7272 6179 2229 0d0a 2020   c_x_array")..  
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000baf0: 6564 6963 7473 2e61 7070 656e 6428 0d0a  edicts.append(..
-0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb10: 2020 2020 7064 2e53 6572 6965 7328 0d0a      pd.Series(..
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb30: 2020 2020 2020 2020 6e70 2e64 6f74 280d          np.dot(.
-0000bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb50: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
-0000bb60: 5b73 656c 662e 6b65 6570 5f63 6f6c 735b  [self.keep_cols[
-0000bb70: 636f 6c5d 5d2c 0d0a 2020 2020 2020 2020  col]],..        
+0000ba10: 635f 7820 3d20 7064 2e63 6f6e 6361 7428  c_x = pd.concat(
+0000ba20: 5b63 5f78 2c20 6c61 675f 735d 2c20 6178  [c_x, lag_s], ax
+0000ba30: 6973 3d31 290d 0a0d 0a20 2020 2020 2020  is=1)....       
+0000ba40: 2020 2020 2020 2020 2023 2041 4444 494e           # ADDIN
+0000ba50: 4720 5245 4345 4e43 5920 5745 4947 4854  G RECENCY WEIGHT
+0000ba60: 494e 4720 414e 4420 5249 4447 4520 5041  ING AND RIDGE PA
+0000ba70: 5241 4d53 0d0a 2020 2020 2020 2020 2020  RAMS..          
+0000ba80: 2020 2020 2020 6966 206e 702e 616e 7928        if np.any(
+0000ba90: 6e70 2e69 736e 616e 2863 5f78 2e61 7374  np.isnan(c_x.ast
+0000baa0: 7970 6528 666c 6f61 7429 2929 3a20 2023  ype(float))):  #
+0000bab0: 2072 656d 6f76 6520 6c61 7465 722c 2066   remove later, f
+0000bac0: 6f72 2064 6562 7567 6769 6e67 0d0a 2020  or debugging..  
+0000bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000baf0: 6f72 2822 6e61 6e20 7661 6c75 6573 2069  or("nan values i
+0000bb00: 6e20 7072 6564 6963 7420 635f 785f 6172  n predict c_x_ar
+0000bb10: 7261 7922 290d 0a20 2020 2020 2020 2020  ray")..         
+0000bb20: 2020 2020 2020 2070 7265 6469 6374 732e         predicts.
+0000bb30: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+0000bb40: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
+0000bb50: 5365 7269 6573 280d 0a20 2020 2020 2020  Series(..       
+0000bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb70: 206e 702e 646f 7428 0d0a 2020 2020 2020   np.dot(..      
 0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb90: 2020 2020 7365 6c66 2e70 6172 616d 735b      self.params[
-0000bba0: 636f 6c5d 5b73 656c 662e 6b65 6570 5f63  col][self.keep_c
-0000bbb0: 6f6c 735f 6964 785b 636f 6c5d 5d2c 0d0a  ols_idx[col]],..
-0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbd0: 2020 2020 2020 2020 292e 666c 6174 7465          ).flatte
-0000bbe0: 6e28 292c 0d0a 2020 2020 2020 2020 2020  n(),..          
-0000bbf0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0000bc00: 6d65 3d63 6f6c 2c0d 0a20 2020 2020 2020  me=col,..       
-0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc20: 2069 6e64 6578 3d64 6174 6573 2c0d 0a20   index=dates,.. 
-0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc40: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-0000bc50: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000bc60: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000bc70: 6564 6963 745f 785f 6172 7261 795b 636f  edict_x_array[co
-0000bc80: 6c5d 203d 2063 5f78 0d0a 2020 2020 2020  l] = c_x..      
-0000bc90: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-0000bca0: 7572 6e5f 636f 6d70 6f6e 656e 7473 3a0d  urn_components:.
-0000bcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bcc0: 2020 2020 2069 6e64 6963 6573 203d 205b       indices = [
-0000bcd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000bce0: 2020 2020 2020 2020 2020 7475 706c 6528            tuple(
-0000bcf0: 6772 6f75 7029 5b2d 315d 5b30 5d0d 0a20  group)[-1][0].. 
-0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd10: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
-0000bd20: 6772 6f75 7020 696e 2067 726f 7570 6279  group in groupby
-0000bd30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000bd40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000bd50: 6e75 6d65 7261 7465 2873 656c 662e 636f  numerate(self.co
-0000bd60: 6c5f 6772 6f75 7069 6e67 735b 636f 6c5d  l_groupings[col]
-0000bd70: 292c 206b 6579 3d69 7465 6d67 6574 7465  ), key=itemgette
-0000bd80: 7228 3129 0d0a 2020 2020 2020 2020 2020  r(1)..          
-0000bd90: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0000bda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bdb0: 2020 2020 205d 5b3a 2d31 5d0d 0a20 2020       ][:-1]..   
+0000bb90: 2020 2020 2020 635f 785b 7365 6c66 2e6b        c_x[self.k
+0000bba0: 6565 705f 636f 6c73 5b63 6f6c 5d5d 2c0d  eep_cols[col]],.
+0000bbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bbc0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000bbd0: 662e 7061 7261 6d73 5b63 6f6c 5d5b 7365  f.params[col][se
+0000bbe0: 6c66 2e6b 6565 705f 636f 6c73 5f69 6478  lf.keep_cols_idx
+0000bbf0: 5b63 6f6c 5d5d 2c0d 0a20 2020 2020 2020  [col]],..       
+0000bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc10: 2029 2e66 6c61 7474 656e 2829 2c0d 0a20   ).flatten(),.. 
+0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc30: 2020 2020 2020 206e 616d 653d 636f 6c2c         name=col,
+0000bc40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bc50: 2020 2020 2020 2020 2020 696e 6465 783d            index=
+0000bc60: 6461 7465 732c 0d0a 2020 2020 2020 2020  dates,..        
+0000bc70: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000bc80: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000bc90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bca0: 2020 7365 6c66 2e70 7265 6469 6374 5f78    self.predict_x
+0000bcb0: 5f61 7272 6179 5b63 6f6c 5d20 3d20 635f  _array[col] = c_
+0000bcc0: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
+0000bcd0: 2020 2069 6620 7265 7475 726e 5f63 6f6d     if return_com
+0000bce0: 706f 6e65 6e74 733a 0d0a 2020 2020 2020  ponents:..      
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0000bd00: 6469 6365 7320 3d20 5b0d 0a20 2020 2020  dices = [..     
+0000bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd20: 2020 2074 7570 6c65 2867 726f 7570 295b     tuple(group)[
+0000bd30: 2d31 5d5b 305d 0d0a 2020 2020 2020 2020  -1][0]..        
+0000bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd50: 666f 7220 6b65 792c 2067 726f 7570 2069  for key, group i
+0000bd60: 6e20 6772 6f75 7062 7928 0d0a 2020 2020  n groupby(..    
+0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd80: 2020 2020 2020 2020 656e 756d 6572 6174          enumerat
+0000bd90: 6528 7365 6c66 2e63 6f6c 5f67 726f 7570  e(self.col_group
+0000bda0: 696e 6773 5b63 6f6c 5d29 2c20 6b65 793d  ings[col]), key=
+0000bdb0: 6974 656d 6765 7474 6572 2831 290d 0a20  itemgetter(1).. 
 0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdd0: 206e 6577 5f69 6e64 7820 3d20 5b30 5d20   new_indx = [0] 
-0000bde0: 2b20 5b78 202b 2031 2066 6f72 2078 2069  + [x + 1 for x i
-0000bdf0: 6e20 696e 6469 6365 735d 0d0a 2020 2020  n indices]..    
-0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be10: 7465 6d70 203d 2028 0d0a 2020 2020 2020  temp = (..      
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 2020 635f 785b 7365 6c66 2e6b 6565 705f    c_x[self.keep_
-0000be40: 636f 6c73 5b63 6f6c 5d5d 0d0a 2020 2020  cols[col]]..    
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 2a20 7365 6c66 2e70 6172 616d      * self.param
-0000be70: 735b 636f 6c5d 5b73 656c 662e 6b65 6570  s[col][self.keep
-0000be80: 5f63 6f6c 735f 6964 785b 636f 6c5d 5d2e  _cols_idx[col]].
-0000be90: 666c 6174 7465 6e28 290d 0a20 2020 2020  flatten()..     
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000beb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000bec0: 2020 2020 2020 7365 6c66 2e63 6f6d 706f        self.compo
-0000bed0: 6e65 6e74 732e 6170 7065 6e64 280d 0a20  nents.append(.. 
-0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bef0: 2020 2020 2020 206e 702e 6164 642e 7265         np.add.re
-0000bf00: 6475 6365 6174 286e 702e 6173 6172 7261  duceat(np.asarra
-0000bf10: 7928 7465 6d70 292c 2073 6f72 7465 6428  y(temp), sorted(
-0000bf20: 6e65 775f 696e 6478 292c 2061 7869 733d  new_indx), axis=
-0000bf30: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0000bf40: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000bf50: 2020 2020 2020 2069 6620 7265 7475 726e         if return
-0000bf60: 5f63 6f6d 706f 6e65 6e74 733a 0d0a 2020  _components:..  
-0000bf70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000bf80: 6c66 2e63 6f6d 706f 6e65 6e74 7320 3d20  lf.components = 
-0000bf90: 6e70 2e6d 6f76 6561 7869 7328 6e70 2e61  np.moveaxis(np.a
-0000bfa0: 7272 6179 2873 656c 662e 636f 6d70 6f6e  rray(self.compon
-0000bfb0: 656e 7473 292c 2030 2c20 3229 0d0a 2020  ents), 0, 2)..  
-0000bfc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000bfd0: 6c66 2e6c 6173 745f 7573 6564 203d 2063  lf.last_used = c
-0000bfe0: 6f6c 0d0a 2020 2020 2020 2020 2020 2020  ol..            
-0000bff0: 2020 2020 7365 6c66 2e63 6f6d 706f 6e65      self.compone
-0000c000: 6e74 5f69 6e64 7820 3d20 280d 0a20 2020  nt_indx = (..   
-0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c020: 206e 6577 5f69 6e64 7820 2023 2068 6f70   new_indx  # hop
-0000c030: 6566 756c 6c79 206e 6f20 6d69 736d 6174  efully no mismat
-0000c040: 6368 696e 6720 666f 7220 6469 6666 2073  ching for diff s
-0000c050: 6572 6965 730d 0a20 2020 2020 2020 2020  eries..         
-0000c060: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000c070: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
-0000c080: 636f 6e63 6174 2870 7265 6469 6374 732c  concat(predicts,
-0000c090: 2061 7869 733d 3129 0d0a 2020 2020 2020   axis=1)..      
-0000c0a0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0000c0b0: 2020 2020 2023 2072 756e 206d 6f64 656c       # run model
-0000c0c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000c0d0: 7320 3d20 6e70 2e64 6f74 2878 5f61 7272  s = np.dot(x_arr
-0000c0e0: 6179 5b73 656c 662e 6b65 6570 5f63 6f6c  ay[self.keep_col
-0000c0f0: 735d 2c20 7365 6c66 2e70 6172 616d 735b  s], self.params[
-0000c100: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
-0000c110: 6478 5d29 0d0a 2020 2020 2020 2020 2020  dx])..          
-0000c120: 2020 6966 2072 6574 7572 6e5f 636f 6d70    if return_comp
-0000c130: 6f6e 656e 7473 3a0d 0a20 2020 2020 2020  onents:..       
-0000c140: 2020 2020 2020 2020 2061 7272 203d 2078           arr = x
-0000c150: 5f61 7272 6179 5b73 656c 662e 6b65 6570  _array[self.keep
-0000c160: 5f63 6f6c 735d 2e74 6f5f 6e75 6d70 7928  _cols].to_numpy(
-0000c170: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000c180: 2020 2074 656d 7020 3d20 280d 0a20 2020     temp = (..   
-0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1a0: 206e 702e 6d6f 7665 6178 6973 280d 0a20   np.moveaxis(.. 
-0000c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1c0: 2020 2020 2020 206e 702e 6272 6f61 6463         np.broadc
-0000c1d0: 6173 745f 746f 280d 0a20 2020 2020 2020  ast_to(..       
-0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1f0: 2020 2020 2061 7272 2c20 5b73 656c 662e       arr, [self.
-0000c200: 7061 7261 6d73 2e73 6861 7065 5b31 5d2c  params.shape[1],
-0000c210: 2061 7272 2e73 6861 7065 5b30 5d2c 2061   arr.shape[0], a
-0000c220: 7272 2e73 6861 7065 5b31 5d5d 0d0a 2020  rr.shape[1]]..  
-0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c260: 2020 302c 0d0a 2020 2020 2020 2020 2020    0,..          
-0000c270: 2020 2020 2020 2020 2020 2020 2020 322c                2,
-0000c280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c290: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000c2a0: 2020 2020 2020 2020 2020 2020 202a 2073               * s
-0000c2b0: 656c 662e 7061 7261 6d73 5b73 656c 662e  elf.params[self.
-0000c2c0: 6b65 6570 5f63 6f6c 735f 6964 785d 0d0a  keep_cols_idx]..
-0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000c2f0: 2020 2069 6e64 6963 6573 203d 205b 0d0a     indices = [..
-0000c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c310: 2020 2020 7475 706c 6528 6772 6f75 7029      tuple(group)
-0000c320: 5b2d 315d 5b30 5d0d 0a20 2020 2020 2020  [-1][0]..       
-0000c330: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000c340: 206b 6579 2c20 6772 6f75 7020 696e 2067   key, group in g
-0000c350: 726f 7570 6279 280d 0a20 2020 2020 2020  roupby(..       
-0000c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c370: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
-0000c380: 636f 6c5f 6772 6f75 7069 6e67 7329 2c20  col_groupings), 
-0000c390: 6b65 793d 6974 656d 6765 7474 6572 2831  key=itemgetter(1
-0000c3a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000c3b0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000c3c0: 2020 2020 2020 2020 2020 5d5b 3a2d 315d            ][:-1]
-0000c3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c3e0: 2020 6e65 775f 696e 6478 203d 205b 305d    new_indx = [0]
-0000c3f0: 202b 205b 7820 2b20 3120 666f 7220 7820   + [x + 1 for x 
-0000c400: 696e 2069 6e64 6963 6573 5d0d 0a20 2020  in indices]..   
-0000c410: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c420: 662e 636f 6d70 6f6e 656e 745f 696e 6478  f.component_indx
-0000c430: 203d 206e 6577 5f69 6e64 780d 0a20 2020   = new_indx..   
-0000c440: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c450: 662e 636f 6d70 6f6e 656e 7473 203d 206e  f.components = n
-0000c460: 702e 6164 642e 7265 6475 6365 6174 280d  p.add.reduceat(.
-0000c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c480: 2020 2020 2074 656d 702c 2073 6f72 7465       temp, sorte
-0000c490: 6428 6e65 775f 696e 6478 292c 2061 7869  d(new_indx), axi
-0000c4a0: 733d 310d 0a20 2020 2020 2020 2020 2020  s=1..           
-0000c4b0: 2020 2020 2029 2020 2320 2864 6174 6573       )  # (dates
-0000c4c0: 2c20 636f 6d70 732c 2073 6572 6965 7329  , comps, series)
-0000c4d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c4e0: 2020 2320 6e70 2e61 6c6c 636c 6f73 6528    # np.allclose(
-0000c4f0: 6e70 2e61 6464 2e72 6564 7563 6561 7428  np.add.reduceat(
-0000c500: 7465 6d70 2c20 5b30 5d2c 2061 7869 733d  temp, [0], axis=
-0000c510: 3129 5b3a 2c20 302c 203a 5d2c 206e 702e  1)[:, 0, :], np.
-0000c520: 646f 7428 6d6f 642e 7072 6564 6963 745f  dot(mod.predict_
-0000c530: 785f 6172 7261 795b 6d6f 642e 6b65 6570  x_array[mod.keep
-0000c540: 5f63 6f6c 735d 2c20 6d6f 642e 7061 7261  _cols], mod.para
-0000c550: 6d73 5b6d 6f64 2e6b 6565 705f 636f 6c73  ms[mod.keep_cols
-0000c560: 5f69 6478 5d29 290d 0a20 2020 2020 2020  _idx]))..       
-0000c570: 2020 2020 2072 6574 7572 6e20 7265 730d       return res.
-0000c580: 0a0d 0a20 2020 2064 6566 2070 726f 6365  ...    def proce
-0000c590: 7373 5f63 6f6d 706f 6e65 6e74 7328 7365  ss_components(se
-0000c5a0: 6c66 2c20 746f 5f6f 7269 6769 6e5f 7370  lf, to_origin_sp
-0000c5b0: 6163 653d 5472 7565 293a 0d0a 2020 2020  ace=True):..    
-0000c5c0: 2020 2020 2222 2253 6361 6c65 2061 6e64      """Scale and
-0000c5d0: 2073 7461 6e64 6172 6469 7a65 2063 6f6d   standardize com
-0000c5e0: 706f 6e65 6e74 206f 7574 7075 7473 2e22  ponent outputs."
-0000c5f0: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-0000c600: 656c 662e 636f 6d70 6f6e 656e 7473 2069  elf.components i
-0000c610: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-0000c620: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000c630: 4572 726f 7228 224d 6f64 656c 2068 6173  Error("Model has
-0000c640: 206e 6f74 2079 6574 2068 6164 2061 2070   not yet had a p
-0000c650: 7265 6469 6374 696f 6e20 6765 6e65 7261  rediction genera
-0000c660: 7465 642e 2229 0d0a 0d0a 2020 2020 2020  ted.")....      
-0000c670: 2020 745f 696e 6478 203d 2028 0d0a 2020    t_indx = (..  
-0000c680: 2020 2020 2020 2020 2020 6e65 7874 2869            next(i
-0000c690: 7465 7228 7365 6c66 2e70 7265 6469 6374  ter(self.predict
-0000c6a0: 5f78 5f61 7272 6179 2e76 616c 7565 7328  _x_array.values(
-0000c6b0: 2929 292e 696e 6465 780d 0a20 2020 2020  ))).index..     
-0000c6c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000c6d0: 616e 6365 2873 656c 662e 7072 6564 6963  ance(self.predic
-0000c6e0: 745f 785f 6172 7261 792c 2064 6963 7429  t_x_array, dict)
-0000c6f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0000c700: 7365 2073 656c 662e 7072 6564 6963 745f  se self.predict_
-0000c710: 785f 6172 7261 792e 696e 6465 780d 0a20  x_array.index.. 
-0000c720: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000c730: 2020 636f 6d70 5f6c 6973 7420 3d20 5b5d    comp_list = []
-0000c740: 0d0a 2020 2020 2020 2020 636f 6c5f 6772  ..        col_gr
-0000c750: 6f75 7020 3d20 280d 0a20 2020 2020 2020  oup = (..       
-0000c760: 2020 2020 2073 656c 662e 636f 6c5f 6772       self.col_gr
-0000c770: 6f75 7069 6e67 735b 7365 6c66 2e6c 6173  oupings[self.las
-0000c780: 745f 7573 6564 5d0d 0a20 2020 2020 2020  t_used]..       
-0000c790: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000c7a0: 6365 2873 656c 662e 636f 6c5f 6772 6f75  ce(self.col_grou
-0000c7b0: 7069 6e67 732c 2064 6963 7429 0d0a 2020  pings, dict)..  
-0000c7c0: 2020 2020 2020 2020 2020 656c 7365 2073            else s
-0000c7d0: 656c 662e 636f 6c5f 6772 6f75 7069 6e67  elf.col_grouping
-0000c7e0: 730d 0a20 2020 2020 2020 2029 0d0a 2020  s..        )..  
-0000c7f0: 2020 2020 2020 2320 756e 666f 7274 756e        # unfortun
-0000c800: 6174 656c 792c 206e 6f20 6368 6f69 6365  ately, no choice
-0000c810: 2062 7574 2074 6f20 6c6f 6f70 2074 6861   but to loop tha
-0000c820: 7420 4920 7365 6520 746f 2061 7070 6c79  t I see to apply
-0000c830: 2069 6e76 6572 7365 2074 7261 6e73 0d0a   inverse trans..
-0000c840: 2020 2020 2020 2020 666f 7220 636f 6d70          for comp
-0000c850: 2069 6e20 7261 6e67 6528 7365 6c66 2e63   in range(self.c
-0000c860: 6f6d 706f 6e65 6e74 732e 7368 6170 655b  omponents.shape[
-0000c870: 315d 293a 0d0a 2020 2020 2020 2020 2020  1]):..          
-0000c880: 2020 6966 2074 6f5f 6f72 6967 696e 5f73    if to_origin_s
-0000c890: 7061 6365 3a0d 0a20 2020 2020 2020 2020  pace:..         
-0000c8a0: 2020 2020 2020 2023 2077 696c 6c20 6861         # will ha
-0000c8b0: 7665 2069 7373 7565 7320 6f6e 2069 6e76  ve issues on inv
-0000c8c0: 6572 7365 2077 6974 6820 736f 6d65 2074  erse with some t
-0000c8d0: 7261 6e73 666f 726d 6572 730d 0a20 2020  ransformers..   
-0000c8e0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0000c8f0: 705f 6466 203d 2073 656c 662e 746f 5f6f  p_df = self.to_o
-0000c900: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
-0000c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c920: 2020 7064 2e44 6174 6146 7261 6d65 280d    pd.DataFrame(.
-0000c930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c940: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0000c950: 6d70 6f6e 656e 7473 5b3a 2c20 636f 6d70  mponents[:, comp
-0000c960: 2c20 3a5d 2c0d 0a20 2020 2020 2020 2020  , :],..         
-0000c970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c980: 6e64 6578 3d74 5f69 6e64 782c 0d0a 2020  ndex=t_indx,..  
-0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9a0: 2020 2020 2020 636f 6c75 6d6e 733d 7365        columns=se
-0000c9b0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 732c  lf.column_names,
-0000c9c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c9d0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-0000c9e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000c9f0: 6d70 6f6e 656e 7473 3d54 7275 652c 0d0a  mponents=True,..
-0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca10: 2020 2020 626f 756e 6473 3d54 7275 652c      bounds=True,
-0000ca20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ca30: 2020 2920 2023 2062 6f75 6e64 733d 5472    )  # bounds=Tr
-0000ca40: 7565 2074 6f20 616c 6967 6e20 6265 7474  ue to align bett
-0000ca50: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-0000ca60: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000ca70: 2020 2020 2020 2063 6f6d 705f 6466 203d         comp_df =
-0000ca80: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
-0000ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caa0: 2020 2020 7365 6c66 2e63 6f6d 706f 6e65      self.compone
-0000cab0: 6e74 735b 3a2c 2063 6f6d 702c 203a 5d2c  nts[:, comp, :],
-0000cac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000cad0: 2020 2020 2020 696e 6465 783d 745f 696e        index=t_in
-0000cae0: 6478 2c0d 0a20 2020 2020 2020 2020 2020  dx,..           
-0000caf0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-0000cb00: 3d73 656c 662e 636f 6c75 6d6e 5f6e 616d  =self.column_nam
-0000cb10: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-0000cb20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000cb30: 2020 2020 2320 636f 6c75 6d6e 206e 616d      # column nam
-0000cb40: 6520 6e65 6564 7320 746f 2062 6520 756e  e needs to be un
-0000cb50: 6c69 6b65 6c79 2074 6f20 6f63 6375 7220  likely to occur 
-0000cb60: 696e 2061 6e20 6163 7475 616c 2064 6174  in an actual dat
-0000cb70: 6173 6574 0d0a 2020 2020 2020 2020 2020  aset..          
-0000cb80: 2020 636f 6d70 5f64 665b 2763 736d 6f64    comp_df['csmod
-0000cb90: 5f63 6f6d 706f 6e65 6e74 275d 203d 2063  _component'] = c
-0000cba0: 6f6c 5f67 726f 7570 5b73 656c 662e 636f  ol_group[self.co
-0000cbb0: 6d70 6f6e 656e 745f 696e 6478 5b63 6f6d  mponent_indx[com
-0000cbc0: 705d 5d0d 0a20 2020 2020 2020 2020 2020  p]]..           
-0000cbd0: 2063 6f6d 705f 6c69 7374 2e61 7070 656e   comp_list.appen
-0000cbe0: 6428 636f 6d70 5f64 6629 0d0a 2020 2020  d(comp_df)..    
-0000cbf0: 2020 2020 7265 7475 726e 2070 642e 7069      return pd.pi
-0000cc00: 766f 7428 7064 2e63 6f6e 6361 7428 636f  vot(pd.concat(co
-0000cc10: 6d70 5f6c 6973 742c 2061 7869 733d 3029  mp_list, axis=0)
-0000cc20: 2c20 636f 6c75 6d6e 733d 2763 736d 6f64  , columns='csmod
-0000cc30: 5f63 6f6d 706f 6e65 6e74 2729 0d0a 0d0a  _component')....
-0000cc40: 2020 2020 6465 6620 5f70 7265 6469 6374      def _predict
-0000cc50: 5f73 7465 7028 0d0a 2020 2020 2020 2020  _step(..        
-0000cc60: 7365 6c66 2c0d 0a20 2020 2020 2020 2064  self,..        d
-0000cc70: 6174 6573 2c0d 0a20 2020 2020 2020 2074  ates,..        t
-0000cc80: 7265 6e64 5f63 6f6d 706f 6e65 6e74 2c0d  rend_component,.
-0000cc90: 0a20 2020 2020 2020 2068 6973 746f 7279  .        history
-0000cca0: 5f64 662c 0d0a 2020 2020 2020 2020 6675  _df,..        fu
-0000ccb0: 7475 7265 5f72 6567 7265 7373 6f72 2c0d  ture_regressor,.
-0000ccc0: 0a20 2020 2020 2020 2066 6c61 675f 7265  .        flag_re
-0000ccd0: 6772 6573 736f 7273 2c0d 0a20 2020 2020  gressors,..     
-0000cce0: 2020 2069 6d70 6163 7473 2c0d 0a20 2020     impacts,..   
-0000ccf0: 2020 2020 2072 6567 7265 7373 6f72 5f70       regressor_p
-0000cd00: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
-0000cd10: 293a 0d0a 2020 2020 2020 2020 2320 4e6f  ):..        # No
-0000cd20: 7465 2074 6869 7320 6973 2073 6361 6c65  te this is scale
-0000cd30: 6420 616e 6420 646f 6573 6e27 7420 6163  d and doesn't ac
-0000cd40: 636f 756e 7420 666f 7220 696d 7061 6374  count for impact
-0000cd50: 730d 0a20 2020 2020 2020 206c 696e 6561  s..        linea
-0000cd60: 725f 7072 6564 203d 2073 656c 662e 5f70  r_pred = self._p
-0000cd70: 7265 6469 6374 5f6c 696e 6561 7228 0d0a  redict_linear(..
-0000cd80: 2020 2020 2020 2020 2020 2020 6461 7465              date
-0000cd90: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000cda0: 6869 7374 6f72 795f 6466 3d68 6973 746f  history_df=histo
-0000cdb0: 7279 5f64 662c 0d0a 2020 2020 2020 2020  ry_df,..        
-0000cdc0: 2020 2020 6675 7475 7265 5f72 6567 7265      future_regre
-0000cdd0: 7373 6f72 3d66 7574 7572 655f 7265 6772  ssor=future_regr
-0000cde0: 6573 736f 722c 0d0a 2020 2020 2020 2020  essor,..        
-0000cdf0: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-0000ce00: 6f72 733d 666c 6167 5f72 6567 7265 7373  ors=flag_regress
-0000ce10: 6f72 732c 0d0a 2020 2020 2020 2020 2020  ors,..          
-0000ce20: 2020 696d 7061 6374 733d 696d 7061 6374    impacts=impact
-0000ce30: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000ce40: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
-0000ce50: 7269 6573 3d72 6567 7265 7373 6f72 5f70  ries=regressor_p
-0000ce60: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
-0000ce70: 2020 2020 2020 2020 7265 7475 726e 5f63          return_c
-0000ce80: 6f6d 706f 6e65 6e74 733d 5472 7565 2c0d  omponents=True,.
-0000ce90: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0000cea0: 2020 2020 2320 4144 4420 5052 4550 524f      # ADD PREPRO
-0000ceb0: 4345 5353 494e 4720 4245 464f 5245 2054  CESSING BEFORE T
-0000cec0: 5245 4e44 2028 4649 5420 582c 2052 4556  REND (FIT X, REV
-0000ced0: 4552 5345 206f 6e20 5052 4544 4943 542c  ERSE on PREDICT,
-0000cee0: 2054 4845 4e20 5452 454e 4429 0d0a 2020   THEN TREND)..  
-0000cef0: 2020 2020 2020 7a65 726f 735f 6466 203d        zeros_df =
-0000cf00: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
-0000cf10: 2020 2020 2020 2020 2020 2020 302c 0d0a              0,..
-0000cf20: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0000cf30: 783d 7472 656e 645f 636f 6d70 6f6e 656e  x=trend_componen
-0000cf40: 742e 666f 7265 6361 7374 2e69 6e64 6578  t.forecast.index
-0000cf50: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
-0000cf60: 6f6c 756d 6e73 3d74 7265 6e64 5f63 6f6d  olumns=trend_com
-0000cf70: 706f 6e65 6e74 2e66 6f72 6563 6173 742e  ponent.forecast.
-0000cf80: 636f 6c75 6d6e 732c 0d0a 2020 2020 2020  columns,..      
-0000cf90: 2020 290d 0a20 2020 2020 2020 2075 7070    )..        upp
-0000cfa0: 6572 5f61 646a 7573 7420 3d20 287a 6572  er_adjust = (zer
-0000cfb0: 6f73 5f64 6620 2b20 7365 6c66 2e72 6573  os_df + self.res
-0000cfc0: 6964 7561 6c5f 756e 6365 7274 6169 6e74  idual_uncertaint
-0000cfd0: 795f 7570 7065 7229 202b 2028 0d0a 2020  y_upper) + (..  
-0000cfe0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-0000cff0: 6573 6964 7561 6c5f 756e 6365 7274 6169  esidual_uncertai
-0000d000: 6e74 795f 7570 7065 725f 7374 6420 2a20  nty_upper_std * 
-0000d010: 7365 6c66 2e69 6e74 5f73 7464 5f64 6576  self.int_std_dev
-0000d020: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
-0000d030: 2020 2020 206c 6f77 6572 5f61 646a 7573       lower_adjus
-0000d040: 7420 3d20 287a 6572 6f73 5f64 6620 2b20  t = (zeros_df + 
-0000d050: 7365 6c66 2e72 6573 6964 7561 6c5f 756e  self.residual_un
-0000d060: 6365 7274 6169 6e74 795f 6c6f 7765 7229  certainty_lower)
-0000d070: 202b 2028 0d0a 2020 2020 2020 2020 2020   + (..          
-0000d080: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
-0000d090: 756e 6365 7274 6169 6e74 795f 6c6f 7765  uncertainty_lowe
-0000d0a0: 725f 7374 6420 2a20 7365 6c66 2e69 6e74  r_std * self.int
-0000d0b0: 5f73 7464 5f64 6576 0d0a 2020 2020 2020  _std_dev..      
-0000d0c0: 2020 290d 0a20 2020 2020 2020 2023 2061    )..        # a
-0000d0d0: 6464 2061 2067 7261 6475 616c 2069 6e63  dd a gradual inc
-0000d0e0: 7265 6173 6520 746f 2066 756c 6c20 756e  rease to full un
-0000d0f0: 6365 7274 6169 6e74 790d 0a20 2020 2020  certainty..     
-0000d100: 2020 2069 6620 6c69 6e65 6172 5f70 7265     if linear_pre
-0000d110: 642e 7368 6170 655b 305d 203e 2034 3a0d  d.shape[0] > 4:.
-0000d120: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
-0000d130: 7374 5f61 646a 7573 7420 3d20 7a65 726f  st_adjust = zero
-0000d140: 735f 6466 202b 2031 0d0a 2020 2020 2020  s_df + 1..      
-0000d150: 2020 2020 2020 6669 7273 745f 6164 6a75        first_adju
-0000d160: 7374 2e69 6c6f 635b 305d 203d 2030 2e35  st.iloc[0] = 0.5
-0000d170: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-0000d180: 7273 745f 6164 6a75 7374 2e69 6c6f 635b  rst_adjust.iloc[
-0000d190: 315d 203d 2030 2e37 0d0a 2020 2020 2020  1] = 0.7..      
-0000d1a0: 2020 2020 2020 7570 7065 725f 6164 6a75        upper_adju
-0000d1b0: 7374 203d 2075 7070 6572 5f61 646a 7573  st = upper_adjus
-0000d1c0: 7420 2a20 6669 7273 745f 6164 6a75 7374  t * first_adjust
-0000d1d0: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
-0000d1e0: 7765 725f 6164 6a75 7374 203d 206c 6f77  wer_adjust = low
-0000d1f0: 6572 5f61 646a 7573 7420 2a20 6669 7273  er_adjust * firs
-0000d200: 745f 6164 6a75 7374 0d0a 2020 2020 2020  t_adjust..      
-0000d210: 2020 7570 7065 7220 3d20 280d 0a20 2020    upper = (..   
-0000d220: 2020 2020 2020 2020 2074 7265 6e64 5f63           trend_c
-0000d230: 6f6d 706f 6e65 6e74 2e75 7070 6572 5f66  omponent.upper_f
-0000d240: 6f72 6563 6173 742e 7265 696e 6465 7828  orecast.reindex(
-0000d250: 6461 7465 7329 202b 206c 696e 6561 725f  dates) + linear_
-0000d260: 7072 6564 202b 2075 7070 6572 5f61 646a  pred + upper_adj
-0000d270: 7573 740d 0a20 2020 2020 2020 2029 0d0a  ust..        )..
-0000d280: 2020 2020 2020 2020 6c6f 7765 7220 3d20          lower = 
-0000d290: 280d 0a20 2020 2020 2020 2020 2020 2074  (..            t
-0000d2a0: 7265 6e64 5f63 6f6d 706f 6e65 6e74 2e6c  rend_component.l
-0000d2b0: 6f77 6572 5f66 6f72 6563 6173 742e 7265  ower_forecast.re
-0000d2c0: 696e 6465 7828 6461 7465 7329 202b 206c  index(dates) + l
-0000d2d0: 696e 6561 725f 7072 6564 202d 206c 6f77  inear_pred - low
-0000d2e0: 6572 5f61 646a 7573 740d 0a20 2020 2020  er_adjust..     
-0000d2f0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-0000d300: 6466 5f66 6f72 6563 6173 7420 3d20 5072  df_forecast = Pr
-0000d310: 6564 6963 7469 6f6e 4f62 6a65 6374 280d  edictionObject(.
-0000d320: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-0000d330: 656c 5f6e 616d 653d 7365 6c66 2e6e 616d  el_name=self.nam
-0000d340: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000d350: 666f 7265 6361 7374 5f6c 656e 6774 683d  forecast_length=
-0000d360: 6c65 6e28 6461 7465 7329 2c0d 0a20 2020  len(dates),..   
-0000d370: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
-0000d380: 745f 696e 6465 783d 6461 7465 732c 0d0a  t_index=dates,..
-0000d390: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-0000d3a0: 6361 7374 5f63 6f6c 756d 6e73 3d74 7265  cast_columns=tre
-0000d3b0: 6e64 5f63 6f6d 706f 6e65 6e74 2e66 6f72  nd_component.for
-0000d3c0: 6563 6173 742e 636f 6c75 6d6e 732c 0d0a  ecast.columns,..
-0000d3d0: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-0000d3e0: 725f 666f 7265 6361 7374 3d6c 6f77 6572  r_forecast=lower
-0000d3f0: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
-0000d400: 6f72 6563 6173 743d 7472 656e 645f 636f  orecast=trend_co
-0000d410: 6d70 6f6e 656e 742e 666f 7265 6361 7374  mponent.forecast
-0000d420: 2e72 6569 6e64 6578 2864 6174 6573 2920  .reindex(dates) 
-0000d430: 2b20 6c69 6e65 6172 5f70 7265 642c 0d0a  + linear_pred,..
-0000d440: 2020 2020 2020 2020 2020 2020 7570 7065              uppe
-0000d450: 725f 666f 7265 6361 7374 3d75 7070 6572  r_forecast=upper
-0000d460: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-0000d470: 7265 6469 6374 696f 6e5f 696e 7465 7276  rediction_interv
-0000d480: 616c 3d73 656c 662e 7072 6564 6963 7469  al=self.predicti
-0000d490: 6f6e 5f69 6e74 6572 7661 6c2c 0d0a 2020  on_interval,..  
-0000d4a0: 2020 2020 2020 2020 2020 6669 745f 7275            fit_ru
-0000d4b0: 6e74 696d 653d 7365 6c66 2e66 6974 5f72  ntime=self.fit_r
-0000d4c0: 756e 7469 6d65 2c0d 0a20 2020 2020 2020  untime,..       
-0000d4d0: 2020 2020 206d 6f64 656c 5f70 6172 616d       model_param
-0000d4e0: 6574 6572 733d 7365 6c66 2e67 6574 5f70  eters=self.get_p
-0000d4f0: 6172 616d 7328 292c 0d0a 2020 2020 2020  arams(),..      
-0000d500: 2020 290d 0a20 2020 2020 2020 2072 6574    )..        ret
-0000d510: 7572 6e20 6466 5f66 6f72 6563 6173 740d  urn df_forecast.
-0000d520: 0a0d 0a20 2020 2064 6566 2070 7265 6469  ...    def predi
-0000d530: 6374 280d 0a20 2020 2020 2020 2073 656c  ct(..        sel
-0000d540: 662c 0d0a 2020 2020 2020 2020 666f 7265  f,..        fore
-0000d550: 6361 7374 5f6c 656e 6774 682c 0d0a 2020  cast_length,..  
-0000d560: 2020 2020 2020 696e 636c 7564 655f 6869        include_hi
-0000d570: 7374 6f72 793d 4661 6c73 652c 0d0a 2020  story=False,..  
-0000d580: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
-0000d590: 7265 7373 6f72 3d4e 6f6e 652c 0d0a 2020  ressor=None,..  
-0000d5a0: 2020 2020 2020 7265 6772 6573 736f 725f        regressor_
-0000d5b0: 7065 725f 7365 7269 6573 3d4e 6f6e 652c  per_series=None,
-0000d5c0: 0d0a 2020 2020 2020 2020 666c 6167 5f72  ..        flag_r
-0000d5d0: 6567 7265 7373 6f72 733d 4e6f 6e65 2c0d  egressors=None,.
-0000d5e0: 0a20 2020 2020 2020 2066 7574 7572 655f  .        future_
-0000d5f0: 696d 7061 6374 733d 4e6f 6e65 2c0d 0a20  impacts=None,.. 
-0000d600: 2020 2020 2020 206e 6577 5f64 663d 4e6f         new_df=No
-0000d610: 6e65 2c0d 0a20 2020 2020 2020 2072 6567  ne,..        reg
-0000d620: 7265 7373 6f72 5f66 6f72 6563 6173 745f  ressor_forecast_
-0000d630: 6d6f 6465 6c3d 4e6f 6e65 2c0d 0a20 2020  model=None,..   
-0000d640: 2020 2020 2072 6567 7265 7373 6f72 5f66       regressor_f
-0000d650: 6f72 6563 6173 745f 6d6f 6465 6c5f 7061  orecast_model_pa
-0000d660: 7261 6d73 3d4e 6f6e 652c 0d0a 2020 2020  rams=None,..    
-0000d670: 2020 2020 7265 6772 6573 736f 725f 666f      regressor_fo
-0000d680: 7265 6361 7374 5f74 7261 6e73 666f 726d  recast_transform
-0000d690: 6174 696f 6e73 3d4e 6f6e 652c 0d0a 2020  ations=None,..  
-0000d6a0: 2020 2020 2020 696e 636c 7564 655f 6f72        include_or
-0000d6b0: 6761 6e69 633d 4661 6c73 652c 0d0a 2020  ganic=False,..  
-0000d6c0: 2020 293a 0d0a 2020 2020 2020 2020 2222    ):..        ""
-0000d6d0: 2247 656e 6572 6174 6520 6120 666f 7265  "Generate a fore
-0000d6e0: 6361 7374 2e0d 0a0d 0a20 2020 2020 2020  cast.....       
-0000d6f0: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
-0000d700: 7220 616e 6420 7265 6772 6573 736f 725f  r and regressor_
-0000d710: 7065 725f 7365 7269 6573 2073 686f 756c  per_series shoul
-0000d720: 6420 6f6e 6c79 2069 6e63 6c75 6465 206e  d only include n
-0000d730: 6577 2066 7574 7572 6520 7661 6c75 6573  ew future values
-0000d740: 2c20 6869 7374 6f72 7920 6973 2061 6c72  , history is alr
-0000d750: 6561 6479 2073 746f 7265 640d 0a20 2020  eady stored..   
-0000d760: 2020 2020 2074 6865 7920 7368 6f75 6c64       they should
-0000d770: 206d 6174 6368 206f 6e20 666f 7265 6361   match on foreca
-0000d780: 7374 5f6c 656e 6774 6820 616e 6420 696e  st_length and in
-0000d790: 6465 7820 6f66 2066 6f72 6563 6173 7473  dex of forecasts
-0000d7a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0000d7b0: 2020 2020 2020 2073 656c 662e 666f 7265         self.fore
-0000d7c0: 6361 7374 5f6c 656e 6774 6820 3d20 666f  cast_length = fo
-0000d7d0: 7265 6361 7374 5f6c 656e 6774 680d 0a20  recast_length.. 
-0000d7e0: 2020 2020 2020 2070 7265 6469 6374 5374         predictSt
-0000d7f0: 6172 7454 696d 6520 3d20 7365 6c66 2e74  artTime = self.t
-0000d800: 696d 6528 290d 0a20 2020 2020 2020 2069  ime()..        i
-0000d810: 6620 7365 6c66 2e74 7265 6e64 5f74 7261  f self.trend_tra
-0000d820: 696e 2069 7320 4e6f 6e65 3a0d 0a20 2020  in is None:..   
-0000d830: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000d840: 616c 7565 4572 726f 7228 2243 6173 7361  alueError("Cassa
-0000d850: 6e64 7261 206d 7573 7420 6669 7273 7420  ndra must first 
-0000d860: 6265 202e 6669 7428 2920 7375 6363 6573  be .fit() succes
-0000d870: 7366 756c 6c79 2e22 290d 0a0d 0a20 2020  sfully.")....   
-0000d880: 2020 2020 2023 2073 6361 6c65 206e 6577       # scale new
-0000d890: 5f64 6620 6966 2067 6976 656e 0d0a 2020  _df if given..  
-0000d8a0: 2020 2020 2020 6966 206e 6577 5f64 6620        if new_df 
-0000d8b0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0000d8c0: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-0000d8d0: 656c 662e 7363 616c 655f 6461 7461 286e  elf.scale_data(n
-0000d8e0: 6577 5f64 6629 0d0a 2020 2020 2020 2020  ew_df)..        
-0000d8f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000d900: 2020 2064 6620 3d20 7365 6c66 2e64 662e     df = self.df.
-0000d910: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-0000d920: 2320 6966 2066 7574 7572 6520 7265 6772  # if future regr
-0000d930: 6573 736f 7273 2061 7265 204e 6f6e 6520  essors are None 
-0000d940: 2826 2055 5345 4429 2c20 6275 7420 7765  (& USED), but we
-0000d950: 7265 2070 726f 7669 6465 6420 666f 7220  re provided for 
-0000d960: 6869 7374 6f72 792c 2069 6e73 7465 6164  history, instead
-0000d970: 2075 7365 2066 6f72 6563 6173 7473 206f   use forecasts o
-0000d980: 6620 7468 6573 6520 6665 6174 7572 6573  f these features
-0000d990: 2028 7761 726e 290d 0a20 2020 2020 2020   (warn)..       
-0000d9a0: 2066 756c 6c5f 7265 6772 203d 204e 6f6e   full_regr = Non
-0000d9b0: 650d 0a20 2020 2020 2020 2069 6620 280d  e..        if (.
-0000d9c0: 0a20 2020 2020 2020 2020 2020 2066 7574  .            fut
-0000d9d0: 7572 655f 7265 6772 6573 736f 7220 6973  ure_regressor is
-0000d9e0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0000d9f0: 2020 2061 6e64 2073 656c 662e 6675 7475     and self.futu
-0000da00: 7265 5f72 6567 7265 7373 6f72 5f74 7261  re_regressor_tra
-0000da10: 696e 2069 7320 6e6f 7420 4e6f 6e65 0d0a  in is not None..
+0000bdd0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000bde0: 2020 2020 2020 2020 2020 2020 2020 5d5b                ][
+0000bdf0: 3a2d 315d 0d0a 2020 2020 2020 2020 2020  :-1]..          
+0000be00: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
+0000be10: 6478 203d 205b 305d 202b 205b 7820 2b20  dx = [0] + [x + 
+0000be20: 3120 666f 7220 7820 696e 2069 6e64 6963  1 for x in indic
+0000be30: 6573 5d0d 0a20 2020 2020 2020 2020 2020  es]..           
+0000be40: 2020 2020 2020 2020 2074 656d 7020 3d20           temp = 
+0000be50: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000be60: 2020 2020 2020 2020 2020 2063 5f78 5b73             c_x[s
+0000be70: 656c 662e 6b65 6570 5f63 6f6c 735b 636f  elf.keep_cols[co
+0000be80: 6c5d 5d0d 0a20 2020 2020 2020 2020 2020  l]]..           
+0000be90: 2020 2020 2020 2020 2020 2020 202a 2073               * s
+0000bea0: 656c 662e 7061 7261 6d73 5b63 6f6c 5d5b  elf.params[col][
+0000beb0: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
+0000bec0: 6478 5b63 6f6c 5d5d 2e66 6c61 7474 656e  dx[col]].flatten
+0000bed0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000bee0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000bef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000bf00: 656c 662e 636f 6d70 6f6e 656e 7473 2e61  elf.components.a
+0000bf10: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf30: 6e70 2e61 6464 2e72 6564 7563 6561 7428  np.add.reduceat(
+0000bf40: 6e70 2e61 7361 7272 6179 2874 656d 7029  np.asarray(temp)
+0000bf50: 2c20 736f 7274 6564 286e 6577 5f69 6e64  , sorted(new_ind
+0000bf60: 7829 2c20 6178 6973 3d31 290d 0a20 2020  x), axis=1)..   
+0000bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf80: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+0000bf90: 6966 2072 6574 7572 6e5f 636f 6d70 6f6e  if return_compon
+0000bfa0: 656e 7473 3a0d 0a20 2020 2020 2020 2020  ents:..         
+0000bfb0: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
+0000bfc0: 6f6e 656e 7473 203d 206e 702e 6d6f 7665  onents = np.move
+0000bfd0: 6178 6973 286e 702e 6172 7261 7928 7365  axis(np.array(se
+0000bfe0: 6c66 2e63 6f6d 706f 6e65 6e74 7329 2c20  lf.components), 
+0000bff0: 302c 2032 290d 0a20 2020 2020 2020 2020  0, 2)..         
+0000c000: 2020 2020 2020 2073 656c 662e 6c61 7374         self.last
+0000c010: 5f75 7365 6420 3d20 636f 6c0d 0a20 2020  _used = col..   
+0000c020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c030: 662e 636f 6d70 6f6e 656e 745f 696e 6478  f.component_indx
+0000c040: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+0000c050: 2020 2020 2020 2020 2020 6e65 775f 696e            new_in
+0000c060: 6478 2020 2320 686f 7065 6675 6c6c 7920  dx  # hopefully 
+0000c070: 6e6f 206d 6973 6d61 7463 6869 6e67 2066  no mismatching f
+0000c080: 6f72 2064 6966 6620 7365 7269 6573 0d0a  or diff series..
+0000c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c0a0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000c0b0: 6574 7572 6e20 7064 2e63 6f6e 6361 7428  eturn pd.concat(
+0000c0c0: 7072 6564 6963 7473 2c20 6178 6973 3d31  predicts, axis=1
+0000c0d0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0000c0e0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000c0f0: 7275 6e20 6d6f 6465 6c0d 0a20 2020 2020  run model..     
+0000c100: 2020 2020 2020 2072 6573 203d 206e 702e         res = np.
+0000c110: 646f 7428 785f 6172 7261 795b 7365 6c66  dot(x_array[self
+0000c120: 2e6b 6565 705f 636f 6c73 5d2c 2073 656c  .keep_cols], sel
+0000c130: 662e 7061 7261 6d73 5b73 656c 662e 6b65  f.params[self.ke
+0000c140: 6570 5f63 6f6c 735f 6964 785d 290d 0a20  ep_cols_idx]).. 
+0000c150: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000c160: 7475 726e 5f63 6f6d 706f 6e65 6e74 733a  turn_components:
+0000c170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c180: 2020 6172 7220 3d20 785f 6172 7261 795b    arr = x_array[
+0000c190: 7365 6c66 2e6b 6565 705f 636f 6c73 5d2e  self.keep_cols].
+0000c1a0: 746f 5f6e 756d 7079 2829 0d0a 2020 2020  to_numpy()..    
+0000c1b0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0000c1c0: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+0000c1d0: 2020 2020 2020 2020 2020 6e70 2e6d 6f76            np.mov
+0000c1e0: 6561 7869 7328 0d0a 2020 2020 2020 2020  eaxis(..        
+0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c200: 6e70 2e62 726f 6164 6361 7374 5f74 6f28  np.broadcast_to(
+0000c210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c220: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+0000c230: 722c 205b 7365 6c66 2e70 6172 616d 732e  r, [self.params.
+0000c240: 7368 6170 655b 315d 2c20 6172 722e 7368  shape[1], arr.sh
+0000c250: 6170 655b 305d 2c20 6172 722e 7368 6170  ape[0], arr.shap
+0000c260: 655b 315d 5d0d 0a20 2020 2020 2020 2020  e[1]]..         
+0000c270: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000c280: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000c290: 2020 2020 2020 2020 2020 2030 2c0d 0a20             0,.. 
+0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2b0: 2020 2020 2020 2032 2c0d 0a20 2020 2020         2,..     
+0000c2c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000c2d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c2e0: 2020 2020 2020 2a20 7365 6c66 2e70 6172        * self.par
+0000c2f0: 616d 735b 7365 6c66 2e6b 6565 705f 636f  ams[self.keep_co
+0000c300: 6c73 5f69 6478 5d0d 0a20 2020 2020 2020  ls_idx]..       
+0000c310: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0000c320: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+0000c330: 6365 7320 3d20 5b0d 0a20 2020 2020 2020  ces = [..       
+0000c340: 2020 2020 2020 2020 2020 2020 2074 7570               tup
+0000c350: 6c65 2867 726f 7570 295b 2d31 5d5b 305d  le(group)[-1][0]
+0000c360: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c370: 2020 2020 2020 666f 7220 6b65 792c 2067        for key, g
+0000c380: 726f 7570 2069 6e20 6772 6f75 7062 7928  roup in groupby(
+0000c390: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c3a0: 2020 2020 2020 2020 2020 656e 756d 6572            enumer
+0000c3b0: 6174 6528 7365 6c66 2e63 6f6c 5f67 726f  ate(self.col_gro
+0000c3c0: 7570 696e 6773 292c 206b 6579 3d69 7465  upings), key=ite
+0000c3d0: 6d67 6574 7465 7228 3129 0d0a 2020 2020  mgetter(1)..    
+0000c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c400: 2020 205d 5b3a 2d31 5d0d 0a20 2020 2020     ][:-1]..     
+0000c410: 2020 2020 2020 2020 2020 206e 6577 5f69             new_i
+0000c420: 6e64 7820 3d20 5b30 5d20 2b20 5b78 202b  ndx = [0] + [x +
+0000c430: 2031 2066 6f72 2078 2069 6e20 696e 6469   1 for x in indi
+0000c440: 6365 735d 0d0a 2020 2020 2020 2020 2020  ces]..          
+0000c450: 2020 2020 2020 7365 6c66 2e63 6f6d 706f        self.compo
+0000c460: 6e65 6e74 5f69 6e64 7820 3d20 6e65 775f  nent_indx = new_
+0000c470: 696e 6478 0d0a 2020 2020 2020 2020 2020  indx..          
+0000c480: 2020 2020 2020 7365 6c66 2e63 6f6d 706f        self.compo
+0000c490: 6e65 6e74 7320 3d20 6e70 2e61 6464 2e72  nents = np.add.r
+0000c4a0: 6564 7563 6561 7428 0d0a 2020 2020 2020  educeat(..      
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000c4c0: 6d70 2c20 736f 7274 6564 286e 6577 5f69  mp, sorted(new_i
+0000c4d0: 6e64 7829 2c20 6178 6973 3d31 0d0a 2020  ndx), axis=1..  
+0000c4e0: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
+0000c4f0: 2023 2028 6461 7465 732c 2063 6f6d 7073   # (dates, comps
+0000c500: 2c20 7365 7269 6573 290d 0a20 2020 2020  , series)..     
+0000c510: 2020 2020 2020 2020 2020 2023 206e 702e             # np.
+0000c520: 616c 6c63 6c6f 7365 286e 702e 6164 642e  allclose(np.add.
+0000c530: 7265 6475 6365 6174 2874 656d 702c 205b  reduceat(temp, [
+0000c540: 305d 2c20 6178 6973 3d31 295b 3a2c 2030  0], axis=1)[:, 0
+0000c550: 2c20 3a5d 2c20 6e70 2e64 6f74 286d 6f64  , :], np.dot(mod
+0000c560: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
+0000c570: 5b6d 6f64 2e6b 6565 705f 636f 6c73 5d2c  [mod.keep_cols],
+0000c580: 206d 6f64 2e70 6172 616d 735b 6d6f 642e   mod.params[mod.
+0000c590: 6b65 6570 5f63 6f6c 735f 6964 785d 2929  keep_cols_idx]))
+0000c5a0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000c5b0: 7475 726e 2072 6573 0d0a 0d0a 2020 2020  turn res....    
+0000c5c0: 6465 6620 7072 6f63 6573 735f 636f 6d70  def process_comp
+0000c5d0: 6f6e 656e 7473 2873 656c 662c 2074 6f5f  onents(self, to_
+0000c5e0: 6f72 6967 696e 5f73 7061 6365 3d54 7275  origin_space=Tru
+0000c5f0: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+0000c600: 5363 616c 6520 616e 6420 7374 616e 6461  Scale and standa
+0000c610: 7264 697a 6520 636f 6d70 6f6e 656e 7420  rdize component 
+0000c620: 6f75 7470 7574 732e 2222 220d 0a20 2020  outputs."""..   
+0000c630: 2020 2020 2069 6620 7365 6c66 2e63 6f6d       if self.com
+0000c640: 706f 6e65 6e74 7320 6973 204e 6f6e 653a  ponents is None:
+0000c650: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0000c660: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0000c670: 4d6f 6465 6c20 6861 7320 6e6f 7420 7965  Model has not ye
+0000c680: 7420 6861 6420 6120 7072 6564 6963 7469  t had a predicti
+0000c690: 6f6e 2067 656e 6572 6174 6564 2e22 290d  on generated.").
+0000c6a0: 0a0d 0a20 2020 2020 2020 2074 5f69 6e64  ...        t_ind
+0000c6b0: 7820 3d20 280d 0a20 2020 2020 2020 2020  x = (..         
+0000c6c0: 2020 206e 6578 7428 6974 6572 2873 656c     next(iter(sel
+0000c6d0: 662e 7072 6564 6963 745f 785f 6172 7261  f.predict_x_arra
+0000c6e0: 792e 7661 6c75 6573 2829 2929 2e69 6e64  y.values())).ind
+0000c6f0: 6578 0d0a 2020 2020 2020 2020 2020 2020  ex..            
+0000c700: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+0000c710: 6c66 2e70 7265 6469 6374 5f78 5f61 7272  lf.predict_x_arr
+0000c720: 6179 2c20 6469 6374 290d 0a20 2020 2020  ay, dict)..     
+0000c730: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
+0000c740: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
+0000c750: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
+0000c760: 290d 0a20 2020 2020 2020 2063 6f6d 705f  )..        comp_
+0000c770: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
+0000c780: 2020 2063 6f6c 5f67 726f 7570 203d 2028     col_group = (
+0000c790: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000c7a0: 6c66 2e63 6f6c 5f67 726f 7570 696e 6773  lf.col_groupings
+0000c7b0: 5b73 656c 662e 6c61 7374 5f75 7365 645d  [self.last_used]
+0000c7c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000c7d0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+0000c7e0: 2e63 6f6c 5f67 726f 7570 696e 6773 2c20  .col_groupings, 
+0000c7f0: 6469 6374 290d 0a20 2020 2020 2020 2020  dict)..         
+0000c800: 2020 2065 6c73 6520 7365 6c66 2e63 6f6c     else self.col
+0000c810: 5f67 726f 7570 696e 6773 0d0a 2020 2020  _groupings..    
+0000c820: 2020 2020 290d 0a20 2020 2020 2020 2023      )..        #
+0000c830: 2075 6e66 6f72 7475 6e61 7465 6c79 2c20   unfortunately, 
+0000c840: 6e6f 2063 686f 6963 6520 6275 7420 746f  no choice but to
+0000c850: 206c 6f6f 7020 7468 6174 2049 2073 6565   loop that I see
+0000c860: 2074 6f20 6170 706c 7920 696e 7665 7273   to apply invers
+0000c870: 6520 7472 616e 730d 0a20 2020 2020 2020  e trans..       
+0000c880: 2066 6f72 2063 6f6d 7020 696e 2072 616e   for comp in ran
+0000c890: 6765 2873 656c 662e 636f 6d70 6f6e 656e  ge(self.componen
+0000c8a0: 7473 2e73 6861 7065 5b31 5d29 3a0d 0a20  ts.shape[1]):.. 
+0000c8b0: 2020 2020 2020 2020 2020 2069 6620 746f             if to
+0000c8c0: 5f6f 7269 6769 6e5f 7370 6163 653a 0d0a  _origin_space:..
+0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8e0: 2320 7769 6c6c 2068 6176 6520 6973 7375  # will have issu
+0000c8f0: 6573 206f 6e20 696e 7665 7273 6520 7769  es on inverse wi
+0000c900: 7468 2073 6f6d 6520 7472 616e 7366 6f72  th some transfor
+0000c910: 6d65 7273 0d0a 2020 2020 2020 2020 2020  mers..          
+0000c920: 2020 2020 2020 636f 6d70 5f64 6620 3d20        comp_df = 
+0000c930: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+0000c940: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+0000c950: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
+0000c960: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
+0000c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c980: 2020 7365 6c66 2e63 6f6d 706f 6e65 6e74    self.component
+0000c990: 735b 3a2c 2063 6f6d 702c 203a 5d2c 0d0a  s[:, comp, :],..
+0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9b0: 2020 2020 2020 2020 696e 6465 783d 745f          index=t_
+0000c9c0: 696e 6478 2c0d 0a20 2020 2020 2020 2020  indx,..         
+0000c9d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000c9e0: 6f6c 756d 6e73 3d73 656c 662e 636f 6c75  olumns=self.colu
+0000c9f0: 6d6e 5f6e 616d 6573 2c0d 0a20 2020 2020  mn_names,..     
+0000ca00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000ca10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000ca20: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000ca30: 733d 5472 7565 2c0d 0a20 2020 2020 2020  s=True,..       
+0000ca40: 2020 2020 2020 2020 2020 2020 2062 6f75               bou
+0000ca50: 6e64 733d 5472 7565 2c0d 0a20 2020 2020  nds=True,..     
+0000ca60: 2020 2020 2020 2020 2020 2029 2020 2320             )  # 
+0000ca70: 626f 756e 6473 3d54 7275 6520 746f 2061  bounds=True to a
+0000ca80: 6c69 676e 2062 6574 7465 720d 0a20 2020  lign better..   
+0000ca90: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cab0: 636f 6d70 5f64 6620 3d20 7064 2e44 6174  comp_df = pd.Dat
+0000cac0: 6146 7261 6d65 280d 0a20 2020 2020 2020  aFrame(..       
+0000cad0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000cae0: 662e 636f 6d70 6f6e 656e 7473 5b3a 2c20  f.components[:, 
+0000caf0: 636f 6d70 2c20 3a5d 2c0d 0a20 2020 2020  comp, :],..     
+0000cb00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000cb10: 6e64 6578 3d74 5f69 6e64 782c 0d0a 2020  ndex=t_indx,..  
+0000cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb30: 2020 636f 6c75 6d6e 733d 7365 6c66 2e63    columns=self.c
+0000cb40: 6f6c 756d 6e5f 6e61 6d65 732c 0d0a 2020  olumn_names,..  
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000cb60: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+0000cb70: 6f6c 756d 6e20 6e61 6d65 206e 6565 6473  olumn name needs
+0000cb80: 2074 6f20 6265 2075 6e6c 696b 656c 7920   to be unlikely 
+0000cb90: 746f 206f 6363 7572 2069 6e20 616e 2061  to occur in an a
+0000cba0: 6374 7561 6c20 6461 7461 7365 740d 0a20  ctual dataset.. 
+0000cbb0: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
+0000cbc0: 6466 5b27 6373 6d6f 645f 636f 6d70 6f6e  df['csmod_compon
+0000cbd0: 656e 7427 5d20 3d20 636f 6c5f 6772 6f75  ent'] = col_grou
+0000cbe0: 705b 7365 6c66 2e63 6f6d 706f 6e65 6e74  p[self.component
+0000cbf0: 5f69 6e64 785b 636f 6d70 5d5d 0d0a 2020  _indx[comp]]..  
+0000cc00: 2020 2020 2020 2020 2020 636f 6d70 5f6c            comp_l
+0000cc10: 6973 742e 6170 7065 6e64 2863 6f6d 705f  ist.append(comp_
+0000cc20: 6466 290d 0a20 2020 2020 2020 2072 6574  df)..        ret
+0000cc30: 7572 6e20 7064 2e70 6976 6f74 2870 642e  urn pd.pivot(pd.
+0000cc40: 636f 6e63 6174 2863 6f6d 705f 6c69 7374  concat(comp_list
+0000cc50: 2c20 6178 6973 3d30 292c 2063 6f6c 756d  , axis=0), colum
+0000cc60: 6e73 3d27 6373 6d6f 645f 636f 6d70 6f6e  ns='csmod_compon
+0000cc70: 656e 7427 290d 0a0d 0a20 2020 2064 6566  ent')....    def
+0000cc80: 205f 7072 6564 6963 745f 7374 6570 280d   _predict_step(.
+0000cc90: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+0000cca0: 2020 2020 2020 2020 6461 7465 732c 0d0a          dates,..
+0000ccb0: 2020 2020 2020 2020 7472 656e 645f 636f          trend_co
+0000ccc0: 6d70 6f6e 656e 742c 0d0a 2020 2020 2020  mponent,..      
+0000ccd0: 2020 6869 7374 6f72 795f 6466 2c0d 0a20    history_df,.. 
+0000cce0: 2020 2020 2020 2066 7574 7572 655f 7265         future_re
+0000ccf0: 6772 6573 736f 722c 0d0a 2020 2020 2020  gressor,..      
+0000cd00: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
+0000cd10: 732c 0d0a 2020 2020 2020 2020 696d 7061  s,..        impa
+0000cd20: 6374 732c 0d0a 2020 2020 2020 2020 7265  cts,..        re
+0000cd30: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
+0000cd40: 6573 2c0d 0a20 2020 2029 3a0d 0a20 2020  es,..    ):..   
+0000cd50: 2020 2020 2023 204e 6f74 6520 7468 6973       # Note this
+0000cd60: 2069 7320 7363 616c 6564 2061 6e64 2064   is scaled and d
+0000cd70: 6f65 736e 2774 2061 6363 6f75 6e74 2066  oesn't account f
+0000cd80: 6f72 2069 6d70 6163 7473 0d0a 2020 2020  or impacts..    
+0000cd90: 2020 2020 6c69 6e65 6172 5f70 7265 6420      linear_pred 
+0000cda0: 3d20 7365 6c66 2e5f 7072 6564 6963 745f  = self._predict_
+0000cdb0: 6c69 6e65 6172 280d 0a20 2020 2020 2020  linear(..       
+0000cdc0: 2020 2020 2064 6174 6573 2c0d 0a20 2020       dates,..   
+0000cdd0: 2020 2020 2020 2020 2068 6973 746f 7279           history
+0000cde0: 5f64 663d 6869 7374 6f72 795f 6466 2c0d  _df=history_df,.
+0000cdf0: 0a20 2020 2020 2020 2020 2020 2066 7574  .            fut
+0000ce00: 7572 655f 7265 6772 6573 736f 723d 6675  ure_regressor=fu
+0000ce10: 7475 7265 5f72 6567 7265 7373 6f72 2c0d  ture_regressor,.
+0000ce20: 0a20 2020 2020 2020 2020 2020 2066 6c61  .            fla
+0000ce30: 675f 7265 6772 6573 736f 7273 3d66 6c61  g_regressors=fla
+0000ce40: 675f 7265 6772 6573 736f 7273 2c0d 0a20  g_regressors,.. 
+0000ce50: 2020 2020 2020 2020 2020 2069 6d70 6163             impac
+0000ce60: 7473 3d69 6d70 6163 7473 2c0d 0a20 2020  ts=impacts,..   
+0000ce70: 2020 2020 2020 2020 2072 6567 7265 7373           regress
+0000ce80: 6f72 5f70 6572 5f73 6572 6965 733d 7265  or_per_series=re
+0000ce90: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
+0000cea0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+0000ceb0: 2072 6574 7572 6e5f 636f 6d70 6f6e 656e   return_componen
+0000cec0: 7473 3d54 7275 652c 0d0a 2020 2020 2020  ts=True,..      
+0000ced0: 2020 290d 0a20 2020 2020 2020 2023 2041    )..        # A
+0000cee0: 4444 2050 5245 5052 4f43 4553 5349 4e47  DD PREPROCESSING
+0000cef0: 2042 4546 4f52 4520 5452 454e 4420 2846   BEFORE TREND (F
+0000cf00: 4954 2058 2c20 5245 5645 5253 4520 6f6e  IT X, REVERSE on
+0000cf10: 2050 5245 4449 4354 2c20 5448 454e 2054   PREDICT, THEN T
+0000cf20: 5245 4e44 290d 0a20 2020 2020 2020 207a  REND)..        z
+0000cf30: 6572 6f73 5f64 6620 3d20 7064 2e44 6174  eros_df = pd.Dat
+0000cf40: 6146 7261 6d65 280d 0a20 2020 2020 2020  aFrame(..       
+0000cf50: 2020 2020 2030 2c0d 0a20 2020 2020 2020       0,..       
+0000cf60: 2020 2020 2069 6e64 6578 3d74 7265 6e64       index=trend
+0000cf70: 5f63 6f6d 706f 6e65 6e74 2e66 6f72 6563  _component.forec
+0000cf80: 6173 742e 696e 6465 782c 0d0a 2020 2020  ast.index,..    
+0000cf90: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+0000cfa0: 7472 656e 645f 636f 6d70 6f6e 656e 742e  trend_component.
+0000cfb0: 666f 7265 6361 7374 2e63 6f6c 756d 6e73  forecast.columns
+0000cfc0: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
+0000cfd0: 2020 2020 2020 7570 7065 725f 6164 6a75        upper_adju
+0000cfe0: 7374 203d 2028 7a65 726f 735f 6466 202b  st = (zeros_df +
+0000cff0: 2073 656c 662e 7265 7369 6475 616c 5f75   self.residual_u
+0000d000: 6e63 6572 7461 696e 7479 5f75 7070 6572  ncertainty_upper
+0000d010: 2920 2b20 280d 0a20 2020 2020 2020 2020  ) + (..         
+0000d020: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
+0000d030: 5f75 6e63 6572 7461 696e 7479 5f75 7070  _uncertainty_upp
+0000d040: 6572 5f73 7464 202a 2073 656c 662e 696e  er_std * self.in
+0000d050: 745f 7374 645f 6465 760d 0a20 2020 2020  t_std_dev..     
+0000d060: 2020 2029 0d0a 2020 2020 2020 2020 6c6f     )..        lo
+0000d070: 7765 725f 6164 6a75 7374 203d 2028 7a65  wer_adjust = (ze
+0000d080: 726f 735f 6466 202b 2073 656c 662e 7265  ros_df + self.re
+0000d090: 7369 6475 616c 5f75 6e63 6572 7461 696e  sidual_uncertain
+0000d0a0: 7479 5f6c 6f77 6572 2920 2b20 280d 0a20  ty_lower) + (.. 
+0000d0b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d0c0: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
+0000d0d0: 696e 7479 5f6c 6f77 6572 5f73 7464 202a  inty_lower_std *
+0000d0e0: 2073 656c 662e 696e 745f 7374 645f 6465   self.int_std_de
+0000d0f0: 760d 0a20 2020 2020 2020 2029 0d0a 2020  v..        )..  
+0000d100: 2020 2020 2020 2320 6164 6420 6120 6772        # add a gr
+0000d110: 6164 7561 6c20 696e 6372 6561 7365 2074  adual increase t
+0000d120: 6f20 6675 6c6c 2075 6e63 6572 7461 696e  o full uncertain
+0000d130: 7479 0d0a 2020 2020 2020 2020 6966 206c  ty..        if l
+0000d140: 696e 6561 725f 7072 6564 2e73 6861 7065  inear_pred.shape
+0000d150: 5b30 5d20 3e20 343a 0d0a 2020 2020 2020  [0] > 4:..      
+0000d160: 2020 2020 2020 6669 7273 745f 6164 6a75        first_adju
+0000d170: 7374 203d 207a 6572 6f73 5f64 6620 2b20  st = zeros_df + 
+0000d180: 310d 0a20 2020 2020 2020 2020 2020 2066  1..            f
+0000d190: 6972 7374 5f61 646a 7573 742e 696c 6f63  irst_adjust.iloc
+0000d1a0: 5b30 5d20 3d20 302e 350d 0a20 2020 2020  [0] = 0.5..     
+0000d1b0: 2020 2020 2020 2066 6972 7374 5f61 646a         first_adj
+0000d1c0: 7573 742e 696c 6f63 5b31 5d20 3d20 302e  ust.iloc[1] = 0.
+0000d1d0: 370d 0a20 2020 2020 2020 2020 2020 2075  7..            u
+0000d1e0: 7070 6572 5f61 646a 7573 7420 3d20 7570  pper_adjust = up
+0000d1f0: 7065 725f 6164 6a75 7374 202a 2066 6972  per_adjust * fir
+0000d200: 7374 5f61 646a 7573 740d 0a20 2020 2020  st_adjust..     
+0000d210: 2020 2020 2020 206c 6f77 6572 5f61 646a         lower_adj
+0000d220: 7573 7420 3d20 6c6f 7765 725f 6164 6a75  ust = lower_adju
+0000d230: 7374 202a 2066 6972 7374 5f61 646a 7573  st * first_adjus
+0000d240: 740d 0a20 2020 2020 2020 2075 7070 6572  t..        upper
+0000d250: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+0000d260: 2020 7472 656e 645f 636f 6d70 6f6e 656e    trend_componen
+0000d270: 742e 7570 7065 725f 666f 7265 6361 7374  t.upper_forecast
+0000d280: 2e72 6569 6e64 6578 2864 6174 6573 2920  .reindex(dates) 
+0000d290: 2b20 6c69 6e65 6172 5f70 7265 6420 2b20  + linear_pred + 
+0000d2a0: 7570 7065 725f 6164 6a75 7374 0d0a 2020  upper_adjust..  
+0000d2b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000d2c0: 206c 6f77 6572 203d 2028 0d0a 2020 2020   lower = (..    
+0000d2d0: 2020 2020 2020 2020 7472 656e 645f 636f          trend_co
+0000d2e0: 6d70 6f6e 656e 742e 6c6f 7765 725f 666f  mponent.lower_fo
+0000d2f0: 7265 6361 7374 2e72 6569 6e64 6578 2864  recast.reindex(d
+0000d300: 6174 6573 2920 2b20 6c69 6e65 6172 5f70  ates) + linear_p
+0000d310: 7265 6420 2d20 6c6f 7765 725f 6164 6a75  red - lower_adju
+0000d320: 7374 0d0a 2020 2020 2020 2020 290d 0a0d  st..        )...
+0000d330: 0a20 2020 2020 2020 2064 665f 666f 7265  .        df_fore
+0000d340: 6361 7374 203d 2050 7265 6469 6374 696f  cast = Predictio
+0000d350: 6e4f 626a 6563 7428 0d0a 2020 2020 2020  nObject(..      
+0000d360: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
+0000d370: 3d73 656c 662e 6e61 6d65 2c0d 0a20 2020  =self.name,..   
+0000d380: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+0000d390: 745f 6c65 6e67 7468 3d6c 656e 2864 6174  t_length=len(dat
+0000d3a0: 6573 292c 0d0a 2020 2020 2020 2020 2020  es),..          
+0000d3b0: 2020 666f 7265 6361 7374 5f69 6e64 6578    forecast_index
+0000d3c0: 3d64 6174 6573 2c0d 0a20 2020 2020 2020  =dates,..       
+0000d3d0: 2020 2020 2066 6f72 6563 6173 745f 636f       forecast_co
+0000d3e0: 6c75 6d6e 733d 7472 656e 645f 636f 6d70  lumns=trend_comp
+0000d3f0: 6f6e 656e 742e 666f 7265 6361 7374 2e63  onent.forecast.c
+0000d400: 6f6c 756d 6e73 2c0d 0a20 2020 2020 2020  olumns,..       
+0000d410: 2020 2020 206c 6f77 6572 5f66 6f72 6563       lower_forec
+0000d420: 6173 743d 6c6f 7765 722c 0d0a 2020 2020  ast=lower,..    
+0000d430: 2020 2020 2020 2020 666f 7265 6361 7374          forecast
+0000d440: 3d74 7265 6e64 5f63 6f6d 706f 6e65 6e74  =trend_component
+0000d450: 2e66 6f72 6563 6173 742e 7265 696e 6465  .forecast.reinde
+0000d460: 7828 6461 7465 7329 202b 206c 696e 6561  x(dates) + linea
+0000d470: 725f 7072 6564 2c0d 0a20 2020 2020 2020  r_pred,..       
+0000d480: 2020 2020 2075 7070 6572 5f66 6f72 6563       upper_forec
+0000d490: 6173 743d 7570 7065 722c 0d0a 2020 2020  ast=upper,..    
+0000d4a0: 2020 2020 2020 2020 7072 6564 6963 7469          predicti
+0000d4b0: 6f6e 5f69 6e74 6572 7661 6c3d 7365 6c66  on_interval=self
+0000d4c0: 2e70 7265 6469 6374 696f 6e5f 696e 7465  .prediction_inte
+0000d4d0: 7276 616c 2c0d 0a20 2020 2020 2020 2020  rval,..         
+0000d4e0: 2020 2066 6974 5f72 756e 7469 6d65 3d73     fit_runtime=s
+0000d4f0: 656c 662e 6669 745f 7275 6e74 696d 652c  elf.fit_runtime,
+0000d500: 0d0a 2020 2020 2020 2020 2020 2020 6d6f  ..            mo
+0000d510: 6465 6c5f 7061 7261 6d65 7465 7273 3d73  del_parameters=s
+0000d520: 656c 662e 6765 745f 7061 7261 6d73 2829  elf.get_params()
+0000d530: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
+0000d540: 2020 2020 2020 7265 7475 726e 2064 665f        return df_
+0000d550: 666f 7265 6361 7374 0d0a 0d0a 2020 2020  forecast....    
+0000d560: 6465 6620 7072 6564 6963 7428 0d0a 2020  def predict(..  
+0000d570: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
+0000d580: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
+0000d590: 6e67 7468 2c0d 0a20 2020 2020 2020 2069  ngth,..        i
+0000d5a0: 6e63 6c75 6465 5f68 6973 746f 7279 3d46  nclude_history=F
+0000d5b0: 616c 7365 2c0d 0a20 2020 2020 2020 2066  alse,..        f
+0000d5c0: 7574 7572 655f 7265 6772 6573 736f 723d  uture_regressor=
+0000d5d0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2072  None,..        r
+0000d5e0: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0000d5f0: 6965 733d 4e6f 6e65 2c0d 0a20 2020 2020  ies=None,..     
+0000d600: 2020 2066 6c61 675f 7265 6772 6573 736f     flag_regresso
+0000d610: 7273 3d4e 6f6e 652c 0d0a 2020 2020 2020  rs=None,..      
+0000d620: 2020 6675 7475 7265 5f69 6d70 6163 7473    future_impacts
+0000d630: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+0000d640: 6e65 775f 6466 3d4e 6f6e 652c 0d0a 2020  new_df=None,..  
+0000d650: 2020 2020 2020 7265 6772 6573 736f 725f        regressor_
+0000d660: 666f 7265 6361 7374 5f6d 6f64 656c 3d4e  forecast_model=N
+0000d670: 6f6e 652c 0d0a 2020 2020 2020 2020 7265  one,..        re
+0000d680: 6772 6573 736f 725f 666f 7265 6361 7374  gressor_forecast
+0000d690: 5f6d 6f64 656c 5f70 6172 616d 733d 4e6f  _model_params=No
+0000d6a0: 6e65 2c0d 0a20 2020 2020 2020 2072 6567  ne,..        reg
+0000d6b0: 7265 7373 6f72 5f66 6f72 6563 6173 745f  ressor_forecast_
+0000d6c0: 7472 616e 7366 6f72 6d61 7469 6f6e 733d  transformations=
+0000d6d0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2069  None,..        i
+0000d6e0: 6e63 6c75 6465 5f6f 7267 616e 6963 3d46  nclude_organic=F
+0000d6f0: 616c 7365 2c0d 0a20 2020 2029 3a0d 0a20  alse,..    ):.. 
+0000d700: 2020 2020 2020 2022 2222 4765 6e65 7261         """Genera
+0000d710: 7465 2061 2066 6f72 6563 6173 742e 0d0a  te a forecast...
+0000d720: 0d0a 2020 2020 2020 2020 6675 7475 7265  ..        future
+0000d730: 5f72 6567 7265 7373 6f72 2061 6e64 2072  _regressor and r
+0000d740: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0000d750: 6965 7320 7368 6f75 6c64 206f 6e6c 7920  ies should only 
+0000d760: 696e 636c 7564 6520 6e65 7720 6675 7475  include new futu
+0000d770: 7265 2076 616c 7565 732c 2068 6973 746f  re values, histo
+0000d780: 7279 2069 7320 616c 7265 6164 7920 7374  ry is already st
+0000d790: 6f72 6564 0d0a 2020 2020 2020 2020 7468  ored..        th
+0000d7a0: 6579 2073 686f 756c 6420 6d61 7463 6820  ey should match 
+0000d7b0: 6f6e 2066 6f72 6563 6173 745f 6c65 6e67  on forecast_leng
+0000d7c0: 7468 2061 6e64 2069 6e64 6578 206f 6620  th and index of 
+0000d7d0: 666f 7265 6361 7374 730d 0a20 2020 2020  forecasts..     
+0000d7e0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000d7f0: 7365 6c66 2e66 6f72 6563 6173 745f 6c65  self.forecast_le
+0000d800: 6e67 7468 203d 2066 6f72 6563 6173 745f  ngth = forecast_
+0000d810: 6c65 6e67 7468 0d0a 2020 2020 2020 2020  length..        
+0000d820: 7072 6564 6963 7453 7461 7274 5469 6d65  predictStartTime
+0000d830: 203d 2073 656c 662e 7469 6d65 2829 0d0a   = self.time()..
+0000d840: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d850: 7472 656e 645f 7472 6169 6e20 6973 204e  trend_train is N
+0000d860: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000d870: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000d880: 6f72 2822 4361 7373 616e 6472 6120 6d75  or("Cassandra mu
+0000d890: 7374 2066 6972 7374 2062 6520 2e66 6974  st first be .fit
+0000d8a0: 2829 2073 7563 6365 7373 6675 6c6c 792e  () successfully.
+0000d8b0: 2229 0d0a 0d0a 2020 2020 2020 2020 2320  ")....        # 
+0000d8c0: 7363 616c 6520 6e65 775f 6466 2069 6620  scale new_df if 
+0000d8d0: 6769 7665 6e0d 0a20 2020 2020 2020 2069  given..        i
+0000d8e0: 6620 6e65 775f 6466 2069 7320 6e6f 7420  f new_df is not 
+0000d8f0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000d900: 2020 2064 6620 3d20 7365 6c66 2e73 6361     df = self.sca
+0000d910: 6c65 5f64 6174 6128 6e65 775f 6466 290d  le_data(new_df).
+0000d920: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0000d930: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+0000d940: 2073 656c 662e 6466 2e63 6f70 7928 290d   self.df.copy().
+0000d950: 0a20 2020 2020 2020 2023 2069 6620 6675  .        # if fu
+0000d960: 7475 7265 2072 6567 7265 7373 6f72 7320  ture regressors 
+0000d970: 6172 6520 4e6f 6e65 2028 2620 5553 4544  are None (& USED
+0000d980: 292c 2062 7574 2077 6572 6520 7072 6f76  ), but were prov
+0000d990: 6964 6564 2066 6f72 2068 6973 746f 7279  ided for history
+0000d9a0: 2c20 696e 7374 6561 6420 7573 6520 666f  , instead use fo
+0000d9b0: 7265 6361 7374 7320 6f66 2074 6865 7365  recasts of these
+0000d9c0: 2066 6561 7475 7265 7320 2877 6172 6e29   features (warn)
+0000d9d0: 0d0a 2020 2020 2020 2020 6675 6c6c 5f72  ..        full_r
+0000d9e0: 6567 7220 3d20 4e6f 6e65 0d0a 2020 2020  egr = None..    
+0000d9f0: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
+0000da00: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
+0000da10: 7265 7373 6f72 2069 7320 4e6f 6e65 0d0a  ressor is None..
 0000da20: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000da30: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
-0000da40: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
-0000da50: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-0000da60: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
-0000da70: 626f 7365 203e 2030 3a0d 0a20 2020 2020  bose > 0:..     
-0000da80: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000da90: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000daa0: 2020 2020 2020 2022 6675 7475 7265 5f72         "future_r
-0000dab0: 6567 7265 7373 6f72 206e 6f74 2070 726f  egressor not pro
-0000dac0: 7669 6465 6420 746f 2043 6173 7361 6e64  vided to Cassand
-0000dad0: 7261 2c20 7573 696e 6720 666f 7265 6361  ra, using foreca
-0000dae0: 7374 7320 6f66 2068 6973 746f 7269 6361  sts of historica
-0000daf0: 6c22 0d0a 2020 2020 2020 2020 2020 2020  l"..            
-0000db00: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-0000db10: 2020 2066 7574 7572 655f 7265 6772 6573     future_regres
-0000db20: 736f 7220 3d20 6d6f 6465 6c5f 666f 7265  sor = model_fore
-0000db30: 6361 7374 280d 0a20 2020 2020 2020 2020  cast(..         
-0000db40: 2020 2020 2020 206d 6f64 656c 5f6e 616d         model_nam
-0000db50: 653d 7365 6c66 2e74 7265 6e64 5f6d 6f64  e=self.trend_mod
-0000db60: 656c 5b27 4d6f 6465 6c27 5d0d 0a20 2020  el['Model']..   
-0000db70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000db80: 7265 6772 6573 736f 725f 666f 7265 6361  regressor_foreca
-0000db90: 7374 5f6d 6f64 656c 2069 7320 4e6f 6e65  st_model is None
-0000dba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dbb0: 2020 656c 7365 2072 6567 7265 7373 6f72    else regressor
-0000dbc0: 5f66 6f72 6563 6173 745f 6d6f 6465 6c2c  _forecast_model,
-0000dbd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dbe0: 2020 6d6f 6465 6c5f 7061 7261 6d5f 6469    model_param_di
-0000dbf0: 6374 3d73 656c 662e 7472 656e 645f 6d6f  ct=self.trend_mo
-0000dc00: 6465 6c5b 274d 6f64 656c 5061 7261 6d65  del['ModelParame
-0000dc10: 7465 7273 275d 0d0a 2020 2020 2020 2020  ters']..        
-0000dc20: 2020 2020 2020 2020 6966 2072 6567 7265          if regre
-0000dc30: 7373 6f72 5f66 6f72 6563 6173 745f 6d6f  ssor_forecast_mo
-0000dc40: 6465 6c5f 7061 7261 6d73 2069 7320 4e6f  del_params is No
-0000dc50: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000dc60: 2020 2020 656c 7365 2072 6567 7265 7373      else regress
-0000dc70: 6f72 5f66 6f72 6563 6173 745f 6d6f 6465  or_forecast_mode
-0000dc80: 6c5f 7061 7261 6d73 2c0d 0a20 2020 2020  l_params,..     
-0000dc90: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-0000dca0: 5f74 7261 6e73 666f 726d 5f64 6963 743d  _transform_dict=
-0000dcb0: 7365 6c66 2e70 7265 7072 6f63 6573 7369  self.preprocessi
-0000dcc0: 6e67 5f74 7261 6e73 666f 726d 6174 696f  ng_transformatio
-0000dcd0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000dce0: 2020 2069 6620 7265 6772 6573 736f 725f     if regressor_
-0000dcf0: 666f 7265 6361 7374 5f74 7261 6e73 666f  forecast_transfo
-0000dd00: 726d 6174 696f 6e73 2069 7320 4e6f 6e65  rmations is None
-0000dd10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dd20: 2020 656c 7365 2072 6567 7265 7373 6f72    else regressor
-0000dd30: 5f66 6f72 6563 6173 745f 7472 616e 7366  _forecast_transf
-0000dd40: 6f72 6d61 7469 6f6e 732c 0d0a 2020 2020  ormations,..    
-0000dd50: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
-0000dd60: 7261 696e 3d73 656c 662e 6675 7475 7265  rain=self.future
-0000dd70: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
-0000dd80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000dd90: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
-0000dda0: 7468 3d66 6f72 6563 6173 745f 6c65 6e67  th=forecast_leng
-0000ddb0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-0000ddc0: 2020 2020 2066 7265 7175 656e 6379 3d73       frequency=s
-0000ddd0: 656c 662e 6672 6571 7565 6e63 792c 0d0a  elf.frequency,..
-0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddf0: 7072 6564 6963 7469 6f6e 5f69 6e74 6572  prediction_inter
-0000de00: 7661 6c3d 7365 6c66 2e70 7265 6469 6374  val=self.predict
-0000de10: 696f 6e5f 696e 7465 7276 616c 2c0d 0a20  ion_interval,.. 
-0000de20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000de30: 6169 6c5f 6f6e 5f66 6f72 6563 6173 745f  ail_on_forecast_
-0000de40: 6e61 6e3d 4661 6c73 652c 0d0a 2020 2020  nan=False,..    
-0000de50: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
-0000de60: 6f6d 5f73 6565 643d 7365 6c66 2e72 616e  om_seed=self.ran
-0000de70: 646f 6d5f 7365 6564 2c0d 0a20 2020 2020  dom_seed,..     
-0000de80: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
-0000de90: 7365 3d73 656c 662e 7665 7262 6f73 652c  se=self.verbose,
-0000dea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000deb0: 2020 6e5f 6a6f 6273 3d73 656c 662e 6e5f    n_jobs=self.n_
-0000dec0: 6a6f 6273 2c0d 0a20 2020 2020 2020 2020  jobs,..         
-0000ded0: 2020 2029 2e66 6f72 6563 6173 740d 0a20     ).forecast.. 
-0000dee0: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-0000def0: 7265 6772 203d 2070 642e 636f 6e63 6174  regr = pd.concat
-0000df00: 285b 7365 6c66 2e66 7574 7572 655f 7265  ([self.future_re
-0000df10: 6772 6573 736f 725f 7472 6169 6e2c 2066  gressor_train, f
-0000df20: 7574 7572 655f 7265 6772 6573 736f 725d  uture_regressor]
-0000df30: 290d 0a20 2020 2020 2020 2069 6620 666f  )..        if fo
-0000df40: 7265 6361 7374 5f6c 656e 6774 6820 6973  recast_length is
-0000df50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000df60: 2020 2020 6578 7065 6374 6564 5f66 6f72      expected_for
-0000df70: 655f 6c65 6e20 3d20 6c65 6e28 6466 290d  e_len = len(df).
-0000df80: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0000df90: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-0000dfa0: 6374 6564 5f66 6f72 655f 6c65 6e20 3d20  cted_fore_len = 
-0000dfb0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000dfc0: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
-0000dfd0: 7468 202b 206c 656e 2864 6629 2069 6620  th + len(df) if 
-0000dfe0: 696e 636c 7564 655f 6869 7374 6f72 7920  include_history 
-0000dff0: 656c 7365 2066 6f72 6563 6173 745f 6c65  else forecast_le
-0000e000: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
-0000e010: 2020 290d 0a20 2020 2020 2020 2069 6620    )..        if 
-0000e020: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
-0000e030: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000e040: 2073 656c 662e 7265 6772 6573 736f 7273   self.regressors
-0000e050: 5f75 7365 643a 0d0a 2020 2020 2020 2020  _used:..        
-0000e060: 2020 2020 6966 206c 656e 2866 7574 7572      if len(futur
-0000e070: 655f 7265 6772 6573 736f 7229 203d 3d20  e_regressor) == 
-0000e080: 6578 7065 6374 6564 5f66 6f72 655f 6c65  expected_fore_le
-0000e090: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-0000e0a0: 2020 2020 6675 6c6c 5f72 6567 7220 3d20      full_regr = 
-0000e0b0: 7365 6c66 2e72 6567 7265 7373 6f72 5f74  self.regressor_t
-0000e0c0: 7261 6e73 666f 726d 6572 2e74 7261 6e73  ransformer.trans
-0000e0d0: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
-0000e0e0: 2020 2020 2020 2020 2020 2063 6c65 616e             clean
-0000e0f0: 5f72 6567 7265 7373 6f72 2866 7574 7572  _regressor(futur
-0000e100: 655f 7265 6772 6573 736f 7229 0d0a 2020  e_regressor)..  
-0000e110: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0000e120: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000e130: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000e140: 2020 2020 6675 6c6c 5f72 6567 7220 3d20      full_regr = 
-0000e150: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
-0000e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e170: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-0000e180: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e190: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
-0000e1a0: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
+0000da30: 7365 6c66 2e66 7574 7572 655f 7265 6772  self.future_regr
+0000da40: 6573 736f 725f 7472 6169 6e20 6973 206e  essor_train is n
+0000da50: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+0000da60: 2020 2020 2061 6e64 2066 6f72 6563 6173       and forecas
+0000da70: 745f 6c65 6e67 7468 2069 7320 6e6f 7420  t_length is not 
+0000da80: 4e6f 6e65 0d0a 2020 2020 2020 2020 293a  None..        ):
+0000da90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000daa0: 2073 656c 662e 7665 7262 6f73 6520 3e20   self.verbose > 
+0000dab0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+0000dac0: 2020 2020 7072 696e 7428 0d0a 2020 2020      print(..    
+0000dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dae0: 2266 7574 7572 655f 7265 6772 6573 736f  "future_regresso
+0000daf0: 7220 6e6f 7420 7072 6f76 6964 6564 2074  r not provided t
+0000db00: 6f20 4361 7373 616e 6472 612c 2075 7369  o Cassandra, usi
+0000db10: 6e67 2066 6f72 6563 6173 7473 206f 6620  ng forecasts of 
+0000db20: 6869 7374 6f72 6963 616c 220d 0a20 2020  historical"..   
+0000db30: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000db40: 2020 2020 2020 2020 2020 2020 6675 7475              futu
+0000db50: 7265 5f72 6567 7265 7373 6f72 203d 206d  re_regressor = m
+0000db60: 6f64 656c 5f66 6f72 6563 6173 7428 0d0a  odel_forecast(..
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db80: 6d6f 6465 6c5f 6e61 6d65 3d73 656c 662e  model_name=self.
+0000db90: 7472 656e 645f 6d6f 6465 6c5b 274d 6f64  trend_model['Mod
+0000dba0: 656c 275d 0d0a 2020 2020 2020 2020 2020  el']..          
+0000dbb0: 2020 2020 2020 6966 2072 6567 7265 7373        if regress
+0000dbc0: 6f72 5f66 6f72 6563 6173 745f 6d6f 6465  or_forecast_mode
+0000dbd0: 6c20 6973 204e 6f6e 650d 0a20 2020 2020  l is None..     
+0000dbe0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+0000dbf0: 7265 6772 6573 736f 725f 666f 7265 6361  regressor_foreca
+0000dc00: 7374 5f6d 6f64 656c 2c0d 0a20 2020 2020  st_model,..     
+0000dc10: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000dc20: 5f70 6172 616d 5f64 6963 743d 7365 6c66  _param_dict=self
+0000dc30: 2e74 7265 6e64 5f6d 6f64 656c 5b27 4d6f  .trend_model['Mo
+0000dc40: 6465 6c50 6172 616d 6574 6572 7327 5d0d  delParameters'].
+0000dc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dc60: 2069 6620 7265 6772 6573 736f 725f 666f   if regressor_fo
+0000dc70: 7265 6361 7374 5f6d 6f64 656c 5f70 6172  recast_model_par
+0000dc80: 616d 7320 6973 204e 6f6e 650d 0a20 2020  ams is None..   
+0000dc90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000dca0: 6520 7265 6772 6573 736f 725f 666f 7265  e regressor_fore
+0000dcb0: 6361 7374 5f6d 6f64 656c 5f70 6172 616d  cast_model_param
+0000dcc0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000dcd0: 2020 2020 6d6f 6465 6c5f 7472 616e 7366      model_transf
+0000dce0: 6f72 6d5f 6469 6374 3d73 656c 662e 7072  orm_dict=self.pr
+0000dcf0: 6570 726f 6365 7373 696e 675f 7472 616e  eprocessing_tran
+0000dd00: 7366 6f72 6d61 7469 6f6e 0d0a 2020 2020  sformation..    
+0000dd10: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0000dd20: 6567 7265 7373 6f72 5f66 6f72 6563 6173  egressor_forecas
+0000dd30: 745f 7472 616e 7366 6f72 6d61 7469 6f6e  t_transformation
+0000dd40: 7320 6973 204e 6f6e 650d 0a20 2020 2020  s is None..     
+0000dd50: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+0000dd60: 7265 6772 6573 736f 725f 666f 7265 6361  regressor_foreca
+0000dd70: 7374 5f74 7261 6e73 666f 726d 6174 696f  st_transformatio
+0000dd80: 6e73 2c0d 0a20 2020 2020 2020 2020 2020  ns,..           
+0000dd90: 2020 2020 2064 665f 7472 6169 6e3d 7365       df_train=se
+0000dda0: 6c66 2e66 7574 7572 655f 7265 6772 6573  lf.future_regres
+0000ddb0: 736f 725f 7472 6169 6e2c 0d0a 2020 2020  sor_train,..    
+0000ddc0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+0000ddd0: 6361 7374 5f6c 656e 6774 683d 666f 7265  cast_length=fore
+0000dde0: 6361 7374 5f6c 656e 6774 682c 0d0a 2020  cast_length,..  
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+0000de00: 6571 7565 6e63 793d 7365 6c66 2e66 7265  equency=self.fre
+0000de10: 7175 656e 6379 2c0d 0a20 2020 2020 2020  quency,..       
+0000de20: 2020 2020 2020 2020 2070 7265 6469 6374           predict
+0000de30: 696f 6e5f 696e 7465 7276 616c 3d73 656c  ion_interval=sel
+0000de40: 662e 7072 6564 6963 7469 6f6e 5f69 6e74  f.prediction_int
+0000de50: 6572 7661 6c2c 0d0a 2020 2020 2020 2020  erval,..        
+0000de60: 2020 2020 2020 2020 6661 696c 5f6f 6e5f          fail_on_
+0000de70: 666f 7265 6361 7374 5f6e 616e 3d46 616c  forecast_nan=Fal
+0000de80: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+0000de90: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+0000dea0: 3d73 656c 662e 7261 6e64 6f6d 5f73 6565  =self.random_see
+0000deb0: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+0000dec0: 2020 2020 7665 7262 6f73 653d 7365 6c66      verbose=self
+0000ded0: 2e76 6572 626f 7365 2c0d 0a20 2020 2020  .verbose,..     
+0000dee0: 2020 2020 2020 2020 2020 206e 5f6a 6f62             n_job
+0000def0: 733d 7365 6c66 2e6e 5f6a 6f62 732c 0d0a  s=self.n_jobs,..
+0000df00: 2020 2020 2020 2020 2020 2020 292e 666f              ).fo
+0000df10: 7265 6361 7374 0d0a 2020 2020 2020 2020  recast..        
+0000df20: 2020 2020 6675 6c6c 5f72 6567 7220 3d20      full_regr = 
+0000df30: 7064 2e63 6f6e 6361 7428 5b73 656c 662e  pd.concat([self.
+0000df40: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
+0000df50: 5f74 7261 696e 2c20 6675 7475 7265 5f72  _train, future_r
+0000df60: 6567 7265 7373 6f72 5d29 0d0a 2020 2020  egressor])..    
+0000df70: 2020 2020 6966 2066 6f72 6563 6173 745f      if forecast_
+0000df80: 6c65 6e67 7468 2069 7320 4e6f 6e65 3a0d  length is None:.
+0000df90: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0000dfa0: 6563 7465 645f 666f 7265 5f6c 656e 203d  ected_fore_len =
+0000dfb0: 206c 656e 2864 6629 0d0a 2020 2020 2020   len(df)..      
+0000dfc0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000dfd0: 2020 2020 2065 7870 6563 7465 645f 666f       expected_fo
+0000dfe0: 7265 5f6c 656e 203d 2028 0d0a 2020 2020  re_len = (..    
+0000dff0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+0000e000: 6361 7374 5f6c 656e 6774 6820 2b20 6c65  cast_length + le
+0000e010: 6e28 6466 2920 6966 2069 6e63 6c75 6465  n(df) if include
+0000e020: 5f68 6973 746f 7279 2065 6c73 6520 666f  _history else fo
+0000e030: 7265 6361 7374 5f6c 656e 6774 680d 0a20  recast_length.. 
+0000e040: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+0000e050: 2020 2020 2020 6966 2066 7574 7572 655f        if future_
+0000e060: 7265 6772 6573 736f 7220 6973 206e 6f74  regressor is not
+0000e070: 204e 6f6e 6520 616e 6420 7365 6c66 2e72   None and self.r
+0000e080: 6567 7265 7373 6f72 735f 7573 6564 3a0d  egressors_used:.
+0000e090: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000e0a0: 6c65 6e28 6675 7475 7265 5f72 6567 7265  len(future_regre
+0000e0b0: 7373 6f72 2920 3d3d 2065 7870 6563 7465  ssor) == expecte
+0000e0c0: 645f 666f 7265 5f6c 656e 3a0d 0a20 2020  d_fore_len:..   
+0000e0d0: 2020 2020 2020 2020 2020 2020 2066 756c               ful
+0000e0e0: 6c5f 7265 6772 203d 2073 656c 662e 7265  l_regr = self.re
+0000e0f0: 6772 6573 736f 725f 7472 616e 7366 6f72  gressor_transfor
+0000e100: 6d65 722e 7472 616e 7366 6f72 6d28 0d0a  mer.transform(..
+0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e120: 2020 2020 636c 6561 6e5f 7265 6772 6573      clean_regres
+0000e130: 736f 7228 6675 7475 7265 5f72 6567 7265  sor(future_regre
+0000e140: 7373 6f72 290d 0a20 2020 2020 2020 2020  ssor)..         
+0000e150: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000e160: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000e170: 2020 2020 2020 2020 2020 2020 2066 756c               ful
+0000e180: 6c5f 7265 6772 203d 2070 642e 636f 6e63  l_regr = pd.conc
+0000e190: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+0000e1a0: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
 0000e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1c0: 2073 656c 662e 7265 6772 6573 736f 725f   self.regressor_
-0000e1d0: 7472 616e 7366 6f72 6d65 722e 7472 616e  transformer.tran
-0000e1e0: 7366 6f72 6d28 0d0a 2020 2020 2020 2020  sform(..        
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e200: 2020 2020 636c 6561 6e5f 7265 6772 6573      clean_regres
-0000e210: 736f 7228 0d0a 2020 2020 2020 2020 2020  sor(..          
-0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e230: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
-0000e240: 7265 7373 6f72 2e6c 6f63 5b0d 0a20 2020  ressor.loc[..   
+0000e1c0: 2020 2020 7365 6c66 2e66 7574 7572 655f      self.future_
+0000e1d0: 7265 6772 6573 736f 725f 7472 6169 6e2c  regressor_train,
+0000e1e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e1f0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0000e200: 6567 7265 7373 6f72 5f74 7261 6e73 666f  egressor_transfo
+0000e210: 726d 6572 2e74 7261 6e73 666f 726d 280d  rmer.transform(.
+0000e220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e230: 2020 2020 2020 2020 2020 2020 2063 6c65               cle
+0000e240: 616e 5f72 6567 7265 7373 6f72 280d 0a20  an_regressor(.. 
 0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e270: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
-0000e280: 722e 696e 6465 782e 6469 6666 6572 656e  r.index.differen
-0000e290: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000e2c0: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
-0000e2d0: 6f72 5f74 7261 696e 2e69 6e64 6578 0d0a  or_train.index..
+0000e260: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e270: 7574 7572 655f 7265 6772 6573 736f 722e  uture_regressor.
+0000e280: 6c6f 635b 0d0a 2020 2020 2020 2020 2020  loc[..          
+0000e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2a0: 2020 2020 2020 2020 2020 6675 7475 7265            future
+0000e2b0: 5f72 6567 7265 7373 6f72 2e69 6e64 6578  _regressor.index
+0000e2c0: 2e64 6966 6665 7265 6e63 6528 0d0a 2020  .difference(..  
+0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e300: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e320: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
-0000e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e340: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000e2f0: 2020 2020 2020 7365 6c66 2e66 7574 7572        self.futur
+0000e300: 655f 7265 6772 6573 736f 725f 7472 6169  e_regressor_trai
+0000e310: 6e2e 696e 6465 780d 0a20 2020 2020 2020  n.index..       
+0000e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e330: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e360: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
-0000e370: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-0000e380: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000e390: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-0000e3a0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
-0000e3b0: 6772 6573 736f 7273 2069 7320 6e6f 7420  gressors is not 
-0000e3c0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0000e3d0: 2020 616e 6420 666f 7265 6361 7374 5f6c    and forecast_l
-0000e3e0: 656e 6774 6820 6973 206e 6f74 204e 6f6e  ength is not Non
-0000e3f0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
-0000e400: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
-0000e410: 7273 5f75 7365 640d 0a20 2020 2020 2020  rs_used..       
-0000e420: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
-0000e430: 2069 6620 6c65 6e28 666c 6167 5f72 6567   if len(flag_reg
-0000e440: 7265 7373 6f72 7329 203d 3d20 6578 7065  ressors) == expe
-0000e450: 6374 6564 5f66 6f72 655f 6c65 6e3a 0d0a  cted_fore_len:..
-0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e470: 616c 6c5f 666c 6167 7320 3d20 636c 6561  all_flags = clea
-0000e480: 6e5f 7265 6772 6573 736f 7228 666c 6167  n_regressor(flag
-0000e490: 5f72 6567 7265 7373 6f72 732c 2070 7265  _regressors, pre
-0000e4a0: 6669 783d 2272 6567 7266 6c61 6773 5f22  fix="regrflags_"
-0000e4b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0000e4c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000e4d0: 2020 2020 2020 616c 6c5f 666c 6167 7320        all_flags 
-0000e4e0: 3d20 7064 2e63 6f6e 6361 7428 0d0a 2020  = pd.concat(..  
-0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e500: 2020 5b0d 0a20 2020 2020 2020 2020 2020    [..           
-0000e510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000e520: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
-0000e530: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
+0000e360: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000e370: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e390: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
+0000e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3b0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+0000e3c0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000e3d0: 6966 2028 0d0a 2020 2020 2020 2020 2020  if (..          
+0000e3e0: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
+0000e3f0: 7320 6973 206e 6f74 204e 6f6e 650d 0a20  s is not None.. 
+0000e400: 2020 2020 2020 2020 2020 2061 6e64 2066             and f
+0000e410: 6f72 6563 6173 745f 6c65 6e67 7468 2069  orecast_length i
+0000e420: 7320 6e6f 7420 4e6f 6e65 0d0a 2020 2020  s not None..    
+0000e430: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+0000e440: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
+0000e450: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
+0000e460: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000e470: 2866 6c61 675f 7265 6772 6573 736f 7273  (flag_regressors
+0000e480: 2920 3d3d 2065 7870 6563 7465 645f 666f  ) == expected_fo
+0000e490: 7265 5f6c 656e 3a0d 0a20 2020 2020 2020  re_len:..       
+0000e4a0: 2020 2020 2020 2020 2061 6c6c 5f66 6c61           all_fla
+0000e4b0: 6773 203d 2063 6c65 616e 5f72 6567 7265  gs = clean_regre
+0000e4c0: 7373 6f72 2866 6c61 675f 7265 6772 6573  ssor(flag_regres
+0000e4d0: 736f 7273 2c20 7072 6566 6978 3d22 7265  sors, prefix="re
+0000e4e0: 6772 666c 6167 735f 2229 0d0a 2020 2020  grflags_")..    
+0000e4f0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000e500: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000e510: 6c6c 5f66 6c61 6773 203d 2070 642e 636f  ll_flags = pd.co
+0000e520: 6e63 6174 280d 0a20 2020 2020 2020 2020  ncat(..         
+0000e530: 2020 2020 2020 2020 2020 205b 0d0a 2020             [..  
 0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e550: 2063 6c65 616e 5f72 6567 7265 7373 6f72   clean_regressor
-0000e560: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000e570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e580: 6c61 675f 7265 6772 6573 736f 7273 2e6c  lag_regressors.l
-0000e590: 6f63 5b0d 0a20 2020 2020 2020 2020 2020  oc[..           
+0000e550: 2020 2020 2020 7365 6c66 2e66 6c61 675f        self.flag_
+0000e560: 7265 6772 6573 736f 725f 7472 6169 6e2c  regressor_train,
+0000e570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e580: 2020 2020 2020 2020 2020 636c 6561 6e5f            clean_
+0000e590: 7265 6772 6573 736f 7228 0d0a 2020 2020  regressor(..    
 0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5b0: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
-0000e5c0: 736f 7273 2e69 6e64 6578 2e64 6966 6665  sors.index.diffe
-0000e5d0: 7265 6e63 6528 0d0a 2020 2020 2020 2020  rence(..        
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e600: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
-0000e610: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
+0000e5b0: 2020 2020 2020 2020 666c 6167 5f72 6567          flag_reg
+0000e5c0: 7265 7373 6f72 732e 6c6f 635b 0d0a 2020  ressors.loc[..  
+0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5e0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+0000e5f0: 6167 5f72 6567 7265 7373 6f72 732e 696e  ag_regressors.in
+0000e600: 6465 782e 6469 6666 6572 656e 6365 280d  dex.difference(.
+0000e610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e630: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e650: 2020 2020 2020 2020 2020 2020 5d2c 0d0a              ],..
+0000e630: 2020 2020 2073 656c 662e 666c 6167 5f72       self.flag_r
+0000e640: 6567 7265 7373 6f72 5f74 7261 696e 2e69  egressor_train.i
+0000e650: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
 0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e670: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0000e680: 6978 3d22 7265 6772 666c 6167 735f 222c  ix="regrflags_",
-0000e690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e6a0: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
-0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6c0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
-0000e6d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000e6e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000e6f0: 2020 2069 6620 280d 0a20 2020 2020 2020     if (..       
-0000e700: 2020 2020 2020 2020 2073 656c 662e 666c           self.fl
-0000e710: 6167 5f72 6567 7265 7373 6f72 5f74 7261  ag_regressor_tra
-0000e720: 696e 2069 7320 6e6f 7420 4e6f 6e65 0d0a  in is not None..
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 616e 6420 666f 7265 6361 7374 5f6c 656e  and forecast_len
-0000e750: 6774 6820 6973 206e 6f74 204e 6f6e 650d  gth is not None.
-0000e760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e770: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
-0000e780: 736f 7273 5f75 7365 640d 0a20 2020 2020  sors_used..     
-0000e790: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0000e7a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000e7b0: 2056 616c 7565 4572 726f 7228 2266 6c61   ValueError("fla
-0000e7c0: 675f 7265 6772 6573 736f 7273 2073 7570  g_regressors sup
-0000e7d0: 706c 6965 6420 696e 2074 7261 696e 696e  plied in trainin
-0000e7e0: 6720 6275 7420 6e6f 7420 7072 6564 6963  g but not predic
-0000e7f0: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
-0000e800: 2061 6c6c 5f66 6c61 6773 203d 2073 656c   all_flags = sel
-0000e810: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
-0000e820: 5f74 7261 696e 0d0a 2020 2020 2020 2020  _train..        
-0000e830: 6966 2066 7574 7572 655f 696d 7061 6374  if future_impact
-0000e840: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
-0000e850: 6420 666f 7265 6361 7374 5f6c 656e 6774  d forecast_lengt
-0000e860: 6820 6973 206e 6f74 204e 6f6e 653a 0d0a  h is not None:..
-0000e870: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000e880: 656e 2866 7574 7572 655f 696d 7061 6374  en(future_impact
-0000e890: 7329 203d 3d20 6578 7065 6374 6564 5f66  s) == expected_f
-0000e8a0: 6f72 655f 6c65 6e3a 0d0a 2020 2020 2020  ore_len:..      
-0000e8b0: 2020 2020 2020 2020 2020 696d 7061 6374            impact
-0000e8c0: 7320 3d20 6675 7475 7265 5f69 6d70 6163  s = future_impac
-0000e8d0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
-0000e8e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000e8f0: 2020 2020 2020 2069 6d70 6163 7473 203d         impacts =
-0000e900: 2070 642e 636f 6e63 6174 285b 7365 6c66   pd.concat([self
-0000e910: 2e70 6173 745f 696d 7061 6374 732c 2066  .past_impacts, f
-0000e920: 7574 7572 655f 696d 7061 6374 735d 290d  uture_impacts]).
-0000e930: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0000e940: 2020 2020 2020 2020 2020 2020 696d 7061              impa
-0000e950: 6374 7320 3d20 7365 6c66 2e70 6173 745f  cts = self.past_
-0000e960: 696d 7061 6374 730d 0a20 2020 2020 2020  impacts..       
-0000e970: 2023 2049 2064 6f6e 2774 2074 6869 6e6b   # I don't think
-0000e980: 2074 6865 7265 2069 7320 6120 6d6f 7265   there is a more
-0000e990: 2065 6666 6963 6965 6e74 2077 6179 2074   efficient way t
-0000e9a0: 6f20 636f 6d62 696e 6520 7468 6573 6520  o combine these 
-0000e9b0: 6469 6374 7320 6f66 2064 6174 6166 7261  dicts of datafra
-0000e9c0: 6d65 730d 0a20 2020 2020 2020 2069 6620  mes..        if 
-0000e9d0: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
-0000e9e0: 7269 6573 2069 7320 6e6f 7420 4e6f 6e65  ries is not None
-0000e9f0: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
-0000ea00: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
-0000ea10: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000ea20: 7369 6e73 7461 6e63 6528 7265 6772 6573  sinstance(regres
-0000ea30: 736f 725f 7065 725f 7365 7269 6573 2c20  sor_per_series, 
-0000ea40: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-0000ea50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000ea60: 6c75 6545 7272 6f72 2822 7265 6772 6573  lueError("regres
-0000ea70: 736f 725f 7065 725f 7365 7269 6573 206d  sor_per_series m
-0000ea80: 7573 7420 6265 2064 6963 7422 290d 0a20  ust be dict").. 
-0000ea90: 2020 2020 2020 2020 2020 2072 6567 725f             regr_
-0000eaa0: 7073 5f66 6f72 6520 3d20 7b7d 0d0a 2020  ps_fore = {}..  
-0000eab0: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
-0000eac0: 792c 2076 616c 7565 2069 6e20 7365 6c66  y, value in self
-0000ead0: 2e72 6567 725f 7065 725f 7365 7269 6573  .regr_per_series
-0000eae0: 5f74 722e 6974 656d 7328 293a 0d0a 2020  _tr.items():..  
-0000eaf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000eb00: 206c 656e 2872 6567 7265 7373 6f72 5f70   len(regressor_p
-0000eb10: 6572 5f73 6572 6965 735b 6b65 795d 2920  er_series[key]) 
-0000eb20: 3d3d 2065 7870 6563 7465 645f 666f 7265  == expected_fore
-0000eb30: 5f6c 656e 3a0d 0a20 2020 2020 2020 2020  _len:..         
-0000eb40: 2020 2020 2020 2020 2020 2072 6567 725f             regr_
-0000eb50: 7073 5f66 6f72 655b 6b65 795d 203d 2072  ps_fore[key] = r
-0000eb60: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
-0000eb70: 6965 735b 6b65 795d 0d0a 2020 2020 2020  ies[key]..      
-0000eb80: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000eb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eba0: 2020 2020 2072 6567 725f 7073 5f66 6f72       regr_ps_for
-0000ebb0: 655b 6b65 795d 203d 2070 642e 636f 6e63  e[key] = pd.conc
-0000ebc0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
-0000ebd0: 2020 2020 2020 2020 2020 2020 205b 7365               [se
-0000ebe0: 6c66 2e72 6567 725f 7065 725f 7365 7269  lf.regr_per_seri
-0000ebf0: 6573 5f74 725b 6b65 795d 2c20 7265 6772  es_tr[key], regr
-0000ec00: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
-0000ec10: 5b6b 6579 5d5d 0d0a 2020 2020 2020 2020  [key]]..        
-0000ec20: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2072 6567 725f 7073 5f66 6f72 655b     regr_ps_fore[
-0000ec50: 6b65 795d 203d 2072 6567 725f 7073 5f66  key] = regr_ps_f
-0000ec60: 6f72 655b 6b65 795d 2e69 6c6f 635b 0d0a  ore[key].iloc[..
-0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec80: 2020 2020 2020 2020 7e72 6567 725f 7073          ~regr_ps
-0000ec90: 5f66 6f72 655b 6b65 795d 2e69 6e64 6578  _fore[key].index
-0000eca0: 2e64 7570 6c69 6361 7465 6428 290d 0a20  .duplicated().. 
+0000e670: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e690: 2020 2020 205d 2c0d 0a20 2020 2020 2020       ],..       
+0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6b0: 2020 2020 2070 7265 6669 783d 2272 6567       prefix="reg
+0000e6c0: 7266 6c61 6773 5f22 2c0d 0a20 2020 2020  rflags_",..     
+0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6e0: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+0000e6f0: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+0000e700: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000e710: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0000e720: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0000e730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e740: 2020 7365 6c66 2e66 6c61 675f 7265 6772    self.flag_regr
+0000e750: 6573 736f 725f 7472 6169 6e20 6973 206e  essor_train is n
+0000e760: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+0000e770: 2020 2020 2020 2020 2061 6e64 2066 6f72           and for
+0000e780: 6563 6173 745f 6c65 6e67 7468 2069 7320  ecast_length is 
+0000e790: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+0000e7a0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+0000e7b0: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
+0000e7c0: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+0000e7d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000e7e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000e7f0: 7272 6f72 2822 666c 6167 5f72 6567 7265  rror("flag_regre
+0000e800: 7373 6f72 7320 7375 7070 6c69 6564 2069  ssors supplied i
+0000e810: 6e20 7472 6169 6e69 6e67 2062 7574 206e  n training but n
+0000e820: 6f74 2070 7265 6469 6374 2229 0d0a 2020  ot predict")..  
+0000e830: 2020 2020 2020 2020 2020 616c 6c5f 666c            all_fl
+0000e840: 6167 7320 3d20 7365 6c66 2e66 6c61 675f  ags = self.flag_
+0000e850: 7265 6772 6573 736f 725f 7472 6169 6e0d  regressor_train.
+0000e860: 0a20 2020 2020 2020 2069 6620 6675 7475  .        if futu
+0000e870: 7265 5f69 6d70 6163 7473 2069 7320 6e6f  re_impacts is no
+0000e880: 7420 4e6f 6e65 2061 6e64 2066 6f72 6563  t None and forec
+0000e890: 6173 745f 6c65 6e67 7468 2069 7320 6e6f  ast_length is no
+0000e8a0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0000e8b0: 2020 2020 2069 6620 6c65 6e28 6675 7475       if len(futu
+0000e8c0: 7265 5f69 6d70 6163 7473 2920 3d3d 2065  re_impacts) == e
+0000e8d0: 7870 6563 7465 645f 666f 7265 5f6c 656e  xpected_fore_len
+0000e8e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e8f0: 2020 2069 6d70 6163 7473 203d 2066 7574     impacts = fut
+0000e900: 7572 655f 696d 7061 6374 730d 0a20 2020  ure_impacts..   
+0000e910: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e930: 696d 7061 6374 7320 3d20 7064 2e63 6f6e  impacts = pd.con
+0000e940: 6361 7428 5b73 656c 662e 7061 7374 5f69  cat([self.past_i
+0000e950: 6d70 6163 7473 2c20 6675 7475 7265 5f69  mpacts, future_i
+0000e960: 6d70 6163 7473 5d29 0d0a 2020 2020 2020  mpacts])..      
+0000e970: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000e980: 2020 2020 2069 6d70 6163 7473 203d 2073       impacts = s
+0000e990: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
+0000e9a0: 0d0a 2020 2020 2020 2020 2320 4920 646f  ..        # I do
+0000e9b0: 6e27 7420 7468 696e 6b20 7468 6572 6520  n't think there 
+0000e9c0: 6973 2061 206d 6f72 6520 6566 6669 6369  is a more effici
+0000e9d0: 656e 7420 7761 7920 746f 2063 6f6d 6269  ent way to combi
+0000e9e0: 6e65 2074 6865 7365 2064 6963 7473 206f  ne these dicts o
+0000e9f0: 6620 6461 7461 6672 616d 6573 0d0a 2020  f dataframes..  
+0000ea00: 2020 2020 2020 6966 2072 6567 7265 7373        if regress
+0000ea10: 6f72 5f70 6572 5f73 6572 6965 7320 6973  or_per_series is
+0000ea20: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+0000ea30: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
+0000ea40: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000ea50: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0000ea60: 6365 2872 6567 7265 7373 6f72 5f70 6572  ce(regressor_per
+0000ea70: 5f73 6572 6965 732c 2064 6963 7429 3a0d  _series, dict):.
+0000ea80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ea90: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000eaa0: 7228 2272 6567 7265 7373 6f72 5f70 6572  r("regressor_per
+0000eab0: 5f73 6572 6965 7320 6d75 7374 2062 6520  _series must be 
+0000eac0: 6469 6374 2229 0d0a 2020 2020 2020 2020  dict")..        
+0000ead0: 2020 2020 7265 6772 5f70 735f 666f 7265      regr_ps_fore
+0000eae0: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
+0000eaf0: 2020 2066 6f72 206b 6579 2c20 7661 6c75     for key, valu
+0000eb00: 6520 696e 2073 656c 662e 7265 6772 5f70  e in self.regr_p
+0000eb10: 6572 5f73 6572 6965 735f 7472 2e69 7465  er_series_tr.ite
+0000eb20: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+0000eb30: 2020 2020 2020 2069 6620 6c65 6e28 7265         if len(re
+0000eb40: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
+0000eb50: 6573 5b6b 6579 5d29 203d 3d20 6578 7065  es[key]) == expe
+0000eb60: 6374 6564 5f66 6f72 655f 6c65 6e3a 0d0a  cted_fore_len:..
+0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb80: 2020 2020 7265 6772 5f70 735f 666f 7265      regr_ps_fore
+0000eb90: 5b6b 6579 5d20 3d20 7265 6772 6573 736f  [key] = regresso
+0000eba0: 725f 7065 725f 7365 7269 6573 5b6b 6579  r_per_series[key
+0000ebb0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000ebc0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000ebd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ebe0: 6772 5f70 735f 666f 7265 5b6b 6579 5d20  gr_ps_fore[key] 
+0000ebf0: 3d20 7064 2e63 6f6e 6361 7428 0d0a 2020  = pd.concat(..  
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 2020 2020 2020 5b73 656c 662e 7265 6772        [self.regr
+0000ec20: 5f70 6572 5f73 6572 6965 735f 7472 5b6b  _per_series_tr[k
+0000ec30: 6579 5d2c 2072 6567 7265 7373 6f72 5f70  ey], regressor_p
+0000ec40: 6572 5f73 6572 6965 735b 6b65 795d 5d0d  er_series[key]].
+0000ec50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ec60: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000ec70: 2020 2020 2020 2020 2020 2020 7265 6772              regr
+0000ec80: 5f70 735f 666f 7265 5b6b 6579 5d20 3d20  _ps_fore[key] = 
+0000ec90: 7265 6772 5f70 735f 666f 7265 5b6b 6579  regr_ps_fore[key
+0000eca0: 5d2e 696c 6f63 5b0d 0a20 2020 2020 2020  ].iloc[..       
 0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 2020 205d 0d0a 2020 2020 2020 2020 2020     ]..          
-0000ecd0: 2020 2020 2020 7365 6c66 2e72 6567 725f        self.regr_
-0000ece0: 7073 203d 2072 6567 725f 7073 5f66 6f72  ps = regr_ps_for
-0000ecf0: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
-0000ed00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000ed10: 6772 5f70 735f 666f 7265 203d 2073 656c  gr_ps_fore = sel
-0000ed20: 662e 7265 6772 5f70 6572 5f73 6572 6965  f.regr_per_serie
-0000ed30: 735f 7472 0d0a 0d0a 2020 2020 2020 2020  s_tr....        
-0000ed40: 2320 6765 6e65 7261 7465 2074 7265 6e64  # generate trend
-0000ed50: 0d0a 2020 2020 2020 2020 2320 4d41 5920  ..        # MAY 
-0000ed60: 5741 4e54 2054 4f20 5041 5353 2066 7574  WANT TO PASS fut
-0000ed70: 7572 655f 7265 6772 6573 736f 7220 4845  ure_regressor HE
-0000ed80: 5245 0d0a 2020 2020 2020 2020 7265 7369  RE..        resi
-0000ed90: 6420 3d20 4e6f 6e65 0d0a 2020 2020 2020  d = None..      
-0000eda0: 2020 6966 2066 6f72 6563 6173 745f 6c65    if forecast_le
-0000edb0: 6e67 7468 2069 7320 6e6f 7420 4e6f 6e65  ngth is not None
-0000edc0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0000edd0: 2063 7265 6174 6520 6e65 7720 726f 6c6c   create new roll
-0000ede0: 696e 6720 7265 7369 6475 616c 2069 6620  ing residual if 
-0000edf0: 6e65 7720 6461 7461 2070 726f 7669 6465  new data provide
-0000ee00: 640d 0a20 2020 2020 2020 2020 2020 2069  d..            i
-0000ee10: 6620 6e65 775f 6466 2069 7320 6e6f 7420  f new_df is not 
-0000ee20: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000ee30: 2020 2020 2020 2072 6573 6964 203d 2064         resid = d
-0000ee40: 6620 2d20 7365 6c66 2e5f 7072 6564 6963  f - self._predic
-0000ee50: 745f 6c69 6e65 6172 280d 0a20 2020 2020  t_linear(..     
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000ee70: 6174 6573 3d64 662e 696e 6465 782c 0d0a  ates=df.index,..
-0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee90: 2020 2020 6869 7374 6f72 795f 6466 3d64      history_df=d
-0000eea0: 662c 0d0a 2020 2020 2020 2020 2020 2020  f,..            
-0000eeb0: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-0000eec0: 6567 7265 7373 6f72 3d66 756c 6c5f 7265  egressor=full_re
-0000eed0: 6772 2c0d 0a20 2020 2020 2020 2020 2020  gr,..           
-0000eee0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
-0000eef0: 6772 6573 736f 7273 3d61 6c6c 5f66 6c61  gressors=all_fla
-0000ef00: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
-0000ef10: 2020 2020 2020 2020 2069 6d70 6163 7473           impacts
-0000ef20: 3d69 6d70 6163 7473 2c0d 0a20 2020 2020  =impacts,..     
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ef40: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
-0000ef50: 6965 733d 7265 6772 5f70 735f 666f 7265  ies=regr_ps_fore
-0000ef60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000ef70: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-0000ef80: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
-0000ef90: 656e 645f 7769 6e64 6f77 2069 7320 6e6f  end_window is no
-0000efa0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000efb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000efc0: 6964 2c20 736c 6f70 652c 2069 6e74 6572  id, slope, inter
-0000efd0: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
-0000efe0: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
-0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f000: 2020 2020 7265 7369 642c 206e 702e 6172      resid, np.ar
-0000f010: 7261 7928 7365 6c66 2e63 7265 6174 655f  ray(self.create_
-0000f020: 7428 6466 2e69 6e64 6578 2929 0d0a 2020  t(df.index))..  
-0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f040: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-0000f050: 2020 2020 2020 2020 2072 6573 6964 203d           resid =
-0000f060: 2070 642e 4461 7461 4672 616d 6528 7265   pd.DataFrame(re
-0000f070: 7369 642c 2069 6e64 6578 3d64 662e 696e  sid, index=df.in
-0000f080: 6465 782c 2063 6f6c 756d 6e73 3d64 662e  dex, columns=df.
-0000f090: 636f 6c75 6d6e 7329 0d0a 2020 2020 2020  columns)..      
-0000f0a0: 2020 2020 2020 6466 5f74 7261 696e 203d        df_train =
-0000f0b0: 2073 656c 662e 7472 656e 645f 7472 6169   self.trend_trai
-0000f0c0: 6e20 6966 2072 6573 6964 2069 7320 4e6f  n if resid is No
-0000f0d0: 6e65 2065 6c73 6520 7265 7369 640d 0a20  ne else resid.. 
-0000f0e0: 2020 2020 2020 2020 2020 2023 2063 6f6d             # com
-0000f0f0: 6269 6e65 2072 6567 7265 7373 6f72 2074  bine regressor t
-0000f100: 7970 6573 2064 6570 656e 6469 6e67 206f  ypes depending o
-0000f110: 6e20 7768 6174 2069 7320 6769 7665 6e0d  n what is given.
-0000f120: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000f130: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000f140: 2020 2073 656c 662e 6675 7475 7265 5f72     self.future_r
-0000f150: 6567 7265 7373 6f72 5f74 7261 696e 2069  egressor_train i
-0000f160: 7320 4e6f 6e65 0d0a 2020 2020 2020 2020  s None..        
-0000f170: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
-0000f180: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
-0000f190: 7472 6169 6e20 6973 206e 6f74 204e 6f6e  train is not Non
-0000f1a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000f1b0: 2020 2061 6e64 2073 656c 662e 7265 6772     and self.regr
-0000f1c0: 6573 736f 7273 5f75 7365 640d 0a20 2020  essors_used..   
-0000f1d0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
-0000f1e0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0000f1f0: 705f 7265 6772 5f74 7261 696e 203d 2073  p_regr_train = s
-0000f200: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
-0000f210: 6f72 5f74 7261 696e 2e72 6569 6e64 6578  or_train.reindex
-0000f220: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000f230: 2020 2020 2020 2069 6e64 6578 3d64 665f         index=df_
-0000f240: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
-0000f250: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000ecc0: 207e 7265 6772 5f70 735f 666f 7265 5b6b   ~regr_ps_fore[k
+0000ecd0: 6579 5d2e 696e 6465 782e 6475 706c 6963  ey].index.duplic
+0000ece0: 6174 6564 2829 0d0a 2020 2020 2020 2020  ated()..        
+0000ecf0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ed10: 656c 662e 7265 6772 5f70 7320 3d20 7265  elf.regr_ps = re
+0000ed20: 6772 5f70 735f 666f 7265 0d0a 2020 2020  gr_ps_fore..    
+0000ed30: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000ed40: 2020 2020 2020 2072 6567 725f 7073 5f66         regr_ps_f
+0000ed50: 6f72 6520 3d20 7365 6c66 2e72 6567 725f  ore = self.regr_
+0000ed60: 7065 725f 7365 7269 6573 5f74 720d 0a0d  per_series_tr...
+0000ed70: 0a20 2020 2020 2020 2023 2067 656e 6572  .        # gener
+0000ed80: 6174 6520 7472 656e 640d 0a20 2020 2020  ate trend..     
+0000ed90: 2020 2023 204d 4159 2057 414e 5420 544f     # MAY WANT TO
+0000eda0: 2050 4153 5320 6675 7475 7265 5f72 6567   PASS future_reg
+0000edb0: 7265 7373 6f72 2048 4552 450d 0a20 2020  ressor HERE..   
+0000edc0: 2020 2020 2072 6573 6964 203d 204e 6f6e       resid = Non
+0000edd0: 650d 0a20 2020 2020 2020 2069 6620 666f  e..        if fo
+0000ede0: 7265 6361 7374 5f6c 656e 6774 6820 6973  recast_length is
+0000edf0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0000ee00: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+0000ee10: 206e 6577 2072 6f6c 6c69 6e67 2072 6573   new rolling res
+0000ee20: 6964 7561 6c20 6966 206e 6577 2064 6174  idual if new dat
+0000ee30: 6120 7072 6f76 6964 6564 0d0a 2020 2020  a provided..    
+0000ee40: 2020 2020 2020 2020 6966 206e 6577 5f64          if new_d
+0000ee50: 6620 6973 206e 6f74 204e 6f6e 653a 0d0a  f is not None:..
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee70: 7265 7369 6420 3d20 6466 202d 2073 656c  resid = df - sel
+0000ee80: 662e 5f70 7265 6469 6374 5f6c 696e 6561  f._predict_linea
+0000ee90: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+0000eea0: 2020 2020 2020 2020 6461 7465 733d 6466          dates=df
+0000eeb0: 2e69 6e64 6578 2c0d 0a20 2020 2020 2020  .index,..       
+0000eec0: 2020 2020 2020 2020 2020 2020 2068 6973               his
+0000eed0: 746f 7279 5f64 663d 6466 2c0d 0a20 2020  tory_df=df,..   
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eef0: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
+0000ef00: 723d 6675 6c6c 5f72 6567 722c 0d0a 2020  r=full_regr,..  
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef20: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
+0000ef30: 733d 616c 6c5f 666c 6167 732c 0d0a 2020  s=all_flags,..  
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef50: 2020 696d 7061 6374 733d 696d 7061 6374    impacts=impact
+0000ef60: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000ef70: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
+0000ef80: 725f 7065 725f 7365 7269 6573 3d72 6567  r_per_series=reg
+0000ef90: 725f 7073 5f66 6f72 652c 0d0a 2020 2020  r_ps_fore,..    
+0000efa0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000efc0: 6620 7365 6c66 2e74 7265 6e64 5f77 696e  f self.trend_win
+0000efd0: 646f 7720 6973 206e 6f74 204e 6f6e 653a  dow is not None:
+0000efe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000eff0: 2020 2020 2020 7265 7369 642c 2073 6c6f        resid, slo
+0000f000: 7065 2c20 696e 7465 7263 6570 7420 3d20  pe, intercept = 
+0000f010: 7365 6c66 2e72 6f6c 6c69 6e67 5f74 7265  self.rolling_tre
+0000f020: 6e64 280d 0a20 2020 2020 2020 2020 2020  nd(..           
+0000f030: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000f040: 6964 2c20 6e70 2e61 7272 6179 2873 656c  id, np.array(sel
+0000f050: 662e 6372 6561 7465 5f74 2864 662e 696e  f.create_t(df.in
+0000f060: 6465 7829 290d 0a20 2020 2020 2020 2020  dex))..         
+0000f070: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f090: 2020 7265 7369 6420 3d20 7064 2e44 6174    resid = pd.Dat
+0000f0a0: 6146 7261 6d65 2872 6573 6964 2c20 696e  aFrame(resid, in
+0000f0b0: 6465 783d 6466 2e69 6e64 6578 2c20 636f  dex=df.index, co
+0000f0c0: 6c75 6d6e 733d 6466 2e63 6f6c 756d 6e73  lumns=df.columns
+0000f0d0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+0000f0e0: 665f 7472 6169 6e20 3d20 7365 6c66 2e74  f_train = self.t
+0000f0f0: 7265 6e64 5f74 7261 696e 2069 6620 7265  rend_train if re
+0000f100: 7369 6420 6973 204e 6f6e 6520 656c 7365  sid is None else
+0000f110: 2072 6573 6964 0d0a 2020 2020 2020 2020   resid..        
+0000f120: 2020 2020 2320 636f 6d62 696e 6520 7265      # combine re
+0000f130: 6772 6573 736f 7220 7479 7065 7320 6465  gressor types de
+0000f140: 7065 6e64 696e 6720 6f6e 2077 6861 7420  pending on what 
+0000f150: 6973 2067 6976 656e 0d0a 2020 2020 2020  is given..      
+0000f160: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
+0000f170: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f180: 2e66 7574 7572 655f 7265 6772 6573 736f  .future_regresso
+0000f190: 725f 7472 6169 6e20 6973 204e 6f6e 650d  r_train is None.
+0000f1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f1b0: 2061 6e64 2073 656c 662e 666c 6167 5f72   and self.flag_r
+0000f1c0: 6567 7265 7373 6f72 5f74 7261 696e 2069  egressor_train i
+0000f1d0: 7320 6e6f 7420 4e6f 6e65 0d0a 2020 2020  s not None..    
+0000f1e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000f1f0: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
+0000f200: 7573 6564 0d0a 2020 2020 2020 2020 2020  used..          
+0000f210: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+0000f220: 2020 2020 2020 636f 6d70 5f72 6567 725f        comp_regr_
+0000f230: 7472 6169 6e20 3d20 7365 6c66 2e66 6c61  train = self.fla
+0000f240: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
+0000f250: 6e2e 7265 696e 6465 7828 0d0a 2020 2020  n.reindex(..    
 0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f270: 636f 6d70 5f72 6567 7220 3d20 616c 6c5f  comp_regr = all_
-0000f280: 666c 6167 732e 7461 696c 2866 6f72 6563  flags.tail(forec
-0000f290: 6173 745f 6c65 6e67 7468 290d 0a20 2020  ast_length)..   
-0000f2a0: 2020 2020 2020 2020 2065 6c69 6620 280d           elif (.
-0000f2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f2c0: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
-0000f2d0: 7265 7373 6f72 5f74 7261 696e 2069 7320  ressor_train is 
-0000f2e0: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
-0000f2f0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000f300: 6c66 2e66 6c61 675f 7265 6772 6573 736f  lf.flag_regresso
-0000f310: 725f 7472 6169 6e20 6973 204e 6f6e 650d  r_train is None.
-0000f320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f330: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
-0000f340: 736f 7273 5f75 7365 640d 0a20 2020 2020  sors_used..     
-0000f350: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0000f360: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
-0000f370: 7265 6772 5f74 7261 696e 203d 2073 656c  regr_train = sel
-0000f380: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
-0000f390: 6f72 5f74 7261 696e 2e72 6569 6e64 6578  or_train.reindex
-0000f3a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000f3b0: 2020 2020 2020 2069 6e64 6578 3d64 665f         index=df_
-0000f3c0: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
-0000f3d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000f270: 696e 6465 783d 6466 5f74 7261 696e 2e69  index=df_train.i
+0000f280: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
+0000f290: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000f2a0: 2020 2020 2020 2020 2063 6f6d 705f 7265           comp_re
+0000f2b0: 6772 203d 2061 6c6c 5f66 6c61 6773 2e74  gr = all_flags.t
+0000f2c0: 6169 6c28 666f 7265 6361 7374 5f6c 656e  ail(forecast_len
+0000f2d0: 6774 6829 0d0a 2020 2020 2020 2020 2020  gth)..          
+0000f2e0: 2020 656c 6966 2028 0d0a 2020 2020 2020    elif (..      
+0000f2f0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0000f300: 7574 7572 655f 7265 6772 6573 736f 725f  uture_regressor_
+0000f310: 7472 6169 6e20 6973 206e 6f74 204e 6f6e  train is not Non
+0000f320: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000f330: 2020 2061 6e64 2073 656c 662e 666c 6167     and self.flag
+0000f340: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
+0000f350: 2069 7320 4e6f 6e65 0d0a 2020 2020 2020   is None..      
+0000f360: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+0000f370: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
+0000f380: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+0000f390: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000f3a0: 2020 2020 636f 6d70 5f72 6567 725f 7472      comp_regr_tr
+0000f3b0: 6169 6e20 3d20 7365 6c66 2e66 7574 7572  ain = self.futur
+0000f3c0: 655f 7265 6772 6573 736f 725f 7472 6169  e_regressor_trai
+0000f3d0: 6e2e 7265 696e 6465 7828 0d0a 2020 2020  n.reindex(..    
 0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3f0: 636f 6d70 5f72 6567 7220 3d20 6675 6c6c  comp_regr = full
-0000f400: 5f72 6567 722e 7461 696c 2866 6f72 6563  _regr.tail(forec
-0000f410: 6173 745f 6c65 6e67 7468 290d 0a20 2020  ast_length)..   
-0000f420: 2020 2020 2020 2020 2065 6c69 6620 280d           elif (.
-0000f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f440: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
-0000f450: 7265 7373 6f72 5f74 7261 696e 2069 7320  ressor_train is 
-0000f460: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
-0000f470: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000f480: 6c66 2e66 6c61 675f 7265 6772 6573 736f  lf.flag_regresso
-0000f490: 725f 7472 6169 6e20 6973 206e 6f74 204e  r_train is not N
-0000f4a0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0000f4b0: 2020 2020 2061 6e64 2073 656c 662e 7265       and self.re
-0000f4c0: 6772 6573 736f 7273 5f75 7365 640d 0a20  gressors_used.. 
-0000f4d0: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
-0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000f4f0: 6f6d 705f 7265 6772 5f74 7261 696e 203d  omp_regr_train =
-0000f500: 2070 642e 636f 6e63 6174 280d 0a20 2020   pd.concat(..   
-0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f520: 205b 7365 6c66 2e66 7574 7572 655f 7265   [self.future_re
-0000f530: 6772 6573 736f 725f 7472 6169 6e2c 2073  gressor_train, s
-0000f540: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
-0000f550: 6f72 5f74 7261 696e 5d2c 2061 7869 733d  or_train], axis=
-0000f560: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-0000f570: 2020 2029 2e72 6569 6e64 6578 2869 6e64     ).reindex(ind
-0000f580: 6578 3d64 665f 7472 6169 6e2e 696e 6465  ex=df_train.inde
-0000f590: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-0000f5a0: 2020 2020 636f 6d70 5f72 6567 7220 3d20      comp_regr = 
-0000f5b0: 7064 2e63 6f6e 6361 7428 5b66 756c 6c5f  pd.concat([full_
-0000f5c0: 7265 6772 2c20 616c 6c5f 666c 6167 735d  regr, all_flags]
-0000f5d0: 2c20 6178 6973 3d31 292e 7461 696c 280d  , axis=1).tail(.
-0000f5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f5f0: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
-0000f600: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
-0000f610: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000f620: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000f630: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000f640: 5f72 6567 725f 7472 6169 6e20 3d20 4e6f  _regr_train = No
-0000f650: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000f660: 2020 2020 636f 6d70 5f72 6567 7220 3d20      comp_regr = 
-0000f670: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-0000f680: 2020 2020 7472 656e 645f 666f 7265 6361      trend_foreca
-0000f690: 7374 203d 206d 6f64 656c 5f66 6f72 6563  st = model_forec
-0000f6a0: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
-0000f6b0: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
-0000f6c0: 3d73 656c 662e 7472 656e 645f 6d6f 6465  =self.trend_mode
-0000f6d0: 6c5b 274d 6f64 656c 275d 2c0d 0a20 2020  l['Model'],..   
-0000f6e0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000f6f0: 656c 5f70 6172 616d 5f64 6963 743d 7365  el_param_dict=se
-0000f700: 6c66 2e74 7265 6e64 5f6d 6f64 656c 5b27  lf.trend_model['
-0000f710: 4d6f 6465 6c50 6172 616d 6574 6572 7327  ModelParameters'
-0000f720: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0000f730: 2020 2020 6d6f 6465 6c5f 7472 616e 7366      model_transf
-0000f740: 6f72 6d5f 6469 6374 3d73 656c 662e 7472  orm_dict=self.tr
-0000f750: 656e 645f 7472 616e 7366 6f72 6d61 7469  end_transformati
-0000f760: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0000f770: 2020 2020 2064 665f 7472 6169 6e3d 6466       df_train=df
-0000f780: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
-0000f790: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
-0000f7a0: 745f 6c65 6e67 7468 3d66 6f72 6563 6173  t_length=forecas
-0000f7b0: 745f 6c65 6e67 7468 2c0d 0a20 2020 2020  t_length,..     
-0000f7c0: 2020 2020 2020 2020 2020 2066 7265 7175             frequ
-0000f7d0: 656e 6379 3d73 656c 662e 6672 6571 7565  ency=self.freque
-0000f7e0: 6e63 792c 0d0a 2020 2020 2020 2020 2020  ncy,..          
-0000f7f0: 2020 2020 2020 7072 6564 6963 7469 6f6e        prediction
-0000f800: 5f69 6e74 6572 7661 6c3d 7365 6c66 2e70  _interval=self.p
-0000f810: 7265 6469 6374 696f 6e5f 696e 7465 7276  rediction_interv
-0000f820: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
-0000f830: 2020 2020 2023 206e 6f5f 6e65 6761 7469       # no_negati
-0000f840: 7665 733d 6e6f 5f6e 6567 6174 6976 6573  ves=no_negatives
-0000f850: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000f860: 2020 2023 2063 6f6e 7374 7261 696e 743d     # constraint=
-0000f870: 636f 6e73 7472 6169 6e74 2c0d 0a20 2020  constraint,..   
-0000f880: 2020 2020 2020 2020 2020 2020 2066 7574               fut
-0000f890: 7572 655f 7265 6772 6573 736f 725f 7472  ure_regressor_tr
-0000f8a0: 6169 6e3d 636f 6d70 5f72 6567 725f 7472  ain=comp_regr_tr
-0000f8b0: 6169 6e2c 0d0a 2020 2020 2020 2020 2020  ain,..          
+0000f3f0: 696e 6465 783d 6466 5f74 7261 696e 2e69  index=df_train.i
+0000f400: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
+0000f410: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000f420: 2020 2020 2020 2020 2063 6f6d 705f 7265           comp_re
+0000f430: 6772 203d 2066 756c 6c5f 7265 6772 2e74  gr = full_regr.t
+0000f440: 6169 6c28 666f 7265 6361 7374 5f6c 656e  ail(forecast_len
+0000f450: 6774 6829 0d0a 2020 2020 2020 2020 2020  gth)..          
+0000f460: 2020 656c 6966 2028 0d0a 2020 2020 2020    elif (..      
+0000f470: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+0000f480: 7574 7572 655f 7265 6772 6573 736f 725f  uture_regressor_
+0000f490: 7472 6169 6e20 6973 206e 6f74 204e 6f6e  train is not Non
+0000f4a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000f4b0: 2020 2061 6e64 2073 656c 662e 666c 6167     and self.flag
+0000f4c0: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
+0000f4d0: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0000f4f0: 6420 7365 6c66 2e72 6567 7265 7373 6f72  d self.regressor
+0000f500: 735f 7573 6564 0d0a 2020 2020 2020 2020  s_used..        
+0000f510: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
+0000f520: 2020 2020 2020 2020 636f 6d70 5f72 6567          comp_reg
+0000f530: 725f 7472 6169 6e20 3d20 7064 2e63 6f6e  r_train = pd.con
+0000f540: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
+0000f550: 2020 2020 2020 2020 2020 5b73 656c 662e            [self.
+0000f560: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
+0000f570: 5f74 7261 696e 2c20 7365 6c66 2e66 6c61  _train, self.fla
+0000f580: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
+0000f590: 6e5d 2c20 6178 6973 3d31 0d0a 2020 2020  n], axis=1..    
+0000f5a0: 2020 2020 2020 2020 2020 2020 292e 7265              ).re
+0000f5b0: 696e 6465 7828 696e 6465 783d 6466 5f74  index(index=df_t
+0000f5c0: 7261 696e 2e69 6e64 6578 290d 0a20 2020  rain.index)..   
+0000f5d0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000f5e0: 705f 7265 6772 203d 2070 642e 636f 6e63  p_regr = pd.conc
+0000f5f0: 6174 285b 6675 6c6c 5f72 6567 722c 2061  at([full_regr, a
+0000f600: 6c6c 5f66 6c61 6773 5d2c 2061 7869 733d  ll_flags], axis=
+0000f610: 3129 2e74 6169 6c28 0d0a 2020 2020 2020  1).tail(..      
+0000f620: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f630: 7265 6361 7374 5f6c 656e 6774 680d 0a20  recast_length.. 
+0000f640: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000f650: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000f660: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000f670: 2020 2020 2063 6f6d 705f 7265 6772 5f74       comp_regr_t
+0000f680: 7261 696e 203d 204e 6f6e 650d 0a20 2020  rain = None..   
+0000f690: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000f6a0: 705f 7265 6772 203d 204e 6f6e 650d 0a0d  p_regr = None...
+0000f6b0: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
+0000f6c0: 6e64 5f66 6f72 6563 6173 7420 3d20 6d6f  nd_forecast = mo
+0000f6d0: 6465 6c5f 666f 7265 6361 7374 280d 0a20  del_forecast(.. 
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000f6f0: 6f64 656c 5f6e 616d 653d 7365 6c66 2e74  odel_name=self.t
+0000f700: 7265 6e64 5f6d 6f64 656c 5b27 4d6f 6465  rend_model['Mode
+0000f710: 6c27 5d2c 0d0a 2020 2020 2020 2020 2020  l'],..          
+0000f720: 2020 2020 2020 6d6f 6465 6c5f 7061 7261        model_para
+0000f730: 6d5f 6469 6374 3d73 656c 662e 7472 656e  m_dict=self.tren
+0000f740: 645f 6d6f 6465 6c5b 274d 6f64 656c 5061  d_model['ModelPa
+0000f750: 7261 6d65 7465 7273 275d 2c0d 0a20 2020  rameters'],..   
+0000f760: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000f770: 656c 5f74 7261 6e73 666f 726d 5f64 6963  el_transform_dic
+0000f780: 743d 7365 6c66 2e74 7265 6e64 5f74 7261  t=self.trend_tra
+0000f790: 6e73 666f 726d 6174 696f 6e2c 0d0a 2020  nsformation,..  
+0000f7a0: 2020 2020 2020 2020 2020 2020 2020 6466                df
+0000f7b0: 5f74 7261 696e 3d64 665f 7472 6169 6e2c  _train=df_train,
+0000f7c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f7d0: 2020 666f 7265 6361 7374 5f6c 656e 6774    forecast_lengt
+0000f7e0: 683d 666f 7265 6361 7374 5f6c 656e 6774  h=forecast_lengt
+0000f7f0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0000f800: 2020 2020 6672 6571 7565 6e63 793d 7365      frequency=se
+0000f810: 6c66 2e66 7265 7175 656e 6379 2c0d 0a20  lf.frequency,.. 
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f830: 7265 6469 6374 696f 6e5f 696e 7465 7276  rediction_interv
+0000f840: 616c 3d73 656c 662e 7072 6564 6963 7469  al=self.predicti
+0000f850: 6f6e 5f69 6e74 6572 7661 6c2c 0d0a 2020  on_interval,..  
+0000f860: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000f870: 6e6f 5f6e 6567 6174 6976 6573 3d6e 6f5f  no_negatives=no_
+0000f880: 6e65 6761 7469 7665 732c 0d0a 2020 2020  negatives,..    
+0000f890: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+0000f8a0: 6e73 7472 6169 6e74 3d63 6f6e 7374 7261  nstraint=constra
+0000f8b0: 696e 742c 0d0a 2020 2020 2020 2020 2020  int,..          
 0000f8c0: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
-0000f8d0: 7265 7373 6f72 5f66 6f72 6563 6173 743d  ressor_forecast=
-0000f8e0: 636f 6d70 5f72 6567 722c 0d0a 2020 2020  comp_regr,..    
-0000f8f0: 2020 2020 2020 2020 2020 2020 2320 686f              # ho
-0000f900: 6c69 6461 795f 636f 756e 7472 793d 686f  liday_country=ho
-0000f910: 6c69 6461 795f 636f 756e 7472 792c 0d0a  liday_country,..
-0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f930: 6661 696c 5f6f 6e5f 666f 7265 6361 7374  fail_on_forecast
-0000f940: 5f6e 616e 3d54 7275 652c 0d0a 2020 2020  _nan=True,..    
-0000f950: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
-0000f960: 6f6d 5f73 6565 643d 7365 6c66 2e72 616e  om_seed=self.ran
-0000f970: 646f 6d5f 7365 6564 2c0d 0a20 2020 2020  dom_seed,..     
-0000f980: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
-0000f990: 7365 3d73 656c 662e 7665 7262 6f73 652c  se=self.verbose,
-0000f9a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f9b0: 2020 6e5f 6a6f 6273 3d73 656c 662e 6e5f    n_jobs=self.n_
-0000f9c0: 6a6f 6273 2c0d 0a20 2020 2020 2020 2020  jobs,..         
-0000f9d0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-0000f9e0: 2020 2320 7068 6920 6973 206f 6e20 6675    # phi is on fu
-0000f9f0: 7475 7265 2070 7265 6469 6374 2073 7465  ture predict ste
-0000fa00: 7020 6f6e 6c79 0d0a 2020 2020 2020 2020  p only..        
-0000fa10: 2020 2020 6966 2073 656c 662e 7472 656e      if self.tren
-0000fa20: 645f 7068 6920 6973 206e 6f74 204e 6f6e  d_phi is not Non
-0000fa30: 6520 616e 6420 7365 6c66 2e74 7265 6e64  e and self.trend
-0000fa40: 5f70 6869 2021 3d20 313a 0d0a 2020 2020  _phi != 1:..    
-0000fa50: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0000fa60: 203d 2074 7265 6e64 5f66 6f72 6563 6173   = trend_forecas
-0000fa70: 742e 666f 7265 6361 7374 2e6d 756c 280d  t.forecast.mul(.
-0000fa80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fa90: 2020 2020 2070 642e 5365 7269 6573 280d       pd.Series(.
-0000faa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fab0: 2020 2020 2020 2020 205b 7365 6c66 2e74           [self.t
-0000fac0: 7265 6e64 5f70 6869 5d20 2a20 7472 656e  rend_phi] * tren
-0000fad0: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
-0000fae0: 6173 742e 7368 6170 655b 305d 2c0d 0a20  ast.shape[0],.. 
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2020 2020 2020 2069 6e64 6578 3d74 7265         index=tre
-0000fb10: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
-0000fb20: 6361 7374 2e69 6e64 6578 2c0d 0a20 2020  cast.index,..   
+0000f8d0: 7265 7373 6f72 5f74 7261 696e 3d63 6f6d  ressor_train=com
+0000f8e0: 705f 7265 6772 5f74 7261 696e 2c0d 0a20  p_regr_train,.. 
+0000f8f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f900: 7574 7572 655f 7265 6772 6573 736f 725f  uture_regressor_
+0000f910: 666f 7265 6361 7374 3d63 6f6d 705f 7265  forecast=comp_re
+0000f920: 6772 2c0d 0a20 2020 2020 2020 2020 2020  gr,..           
+0000f930: 2020 2020 2023 2068 6f6c 6964 6179 5f63       # holiday_c
+0000f940: 6f75 6e74 7279 3d68 6f6c 6964 6179 5f63  ountry=holiday_c
+0000f950: 6f75 6e74 7279 2c0d 0a20 2020 2020 2020  ountry,..       
+0000f960: 2020 2020 2020 2020 2066 6169 6c5f 6f6e           fail_on
+0000f970: 5f66 6f72 6563 6173 745f 6e61 6e3d 5472  _forecast_nan=Tr
+0000f980: 7565 2c0d 0a20 2020 2020 2020 2020 2020  ue,..           
+0000f990: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+0000f9a0: 3d73 656c 662e 7261 6e64 6f6d 5f73 6565  =self.random_see
+0000f9b0: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+0000f9c0: 2020 2020 7665 7262 6f73 653d 7365 6c66      verbose=self
+0000f9d0: 2e76 6572 626f 7365 2c0d 0a20 2020 2020  .verbose,..     
+0000f9e0: 2020 2020 2020 2020 2020 206e 5f6a 6f62             n_job
+0000f9f0: 733d 7365 6c66 2e6e 5f6a 6f62 732c 0d0a  s=self.n_jobs,..
+0000fa00: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000fa10: 2020 2020 2020 2020 2020 2023 2070 6869             # phi
+0000fa20: 2069 7320 6f6e 2066 7574 7572 6520 7072   is on future pr
+0000fa30: 6564 6963 7420 7374 6570 206f 6e6c 790d  edict step only.
+0000fa40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000fa50: 7365 6c66 2e74 7265 6e64 5f70 6869 2069  self.trend_phi i
+0000fa60: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+0000fa70: 656c 662e 7472 656e 645f 7068 6920 213d  elf.trend_phi !=
+0000fa80: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+0000fa90: 2020 2020 2074 656d 7020 3d20 7472 656e       temp = tren
+0000faa0: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
+0000fab0: 6173 742e 6d75 6c28 0d0a 2020 2020 2020  ast.mul(..      
+0000fac0: 2020 2020 2020 2020 2020 2020 2020 7064                pd
+0000fad0: 2e53 6572 6965 7328 0d0a 2020 2020 2020  .Series(..      
+0000fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faf0: 2020 5b73 656c 662e 7472 656e 645f 7068    [self.trend_ph
+0000fb00: 695d 202a 2074 7265 6e64 5f66 6f72 6563  i] * trend_forec
+0000fb10: 6173 742e 666f 7265 6361 7374 2e73 6861  ast.forecast.sha
+0000fb20: 7065 5b30 5d2c 0d0a 2020 2020 2020 2020  pe[0],..        
 0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb40: 2029 2e70 6f77 2872 616e 6765 2874 7265   ).pow(range(tre
-0000fb50: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
-0000fb60: 6361 7374 2e73 6861 7065 5b30 5d29 292c  cast.shape[0])),
-0000fb70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fb80: 2020 2020 2020 6178 6973 3d30 2c0d 0a20        axis=0,.. 
-0000fb90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000fba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fbb0: 2020 2320 6f76 6572 7772 6974 6520 626f    # overwrite bo
-0000fbc0: 756e 6473 2069 6620 7573 696e 6720 7068  unds if using ph
-0000fbd0: 690d 0a20 2020 2020 2020 2020 2020 2020  i..             
-0000fbe0: 2020 2074 7265 6e64 5f66 6f72 6563 6173     trend_forecas
-0000fbf0: 742e 666f 7265 6361 7374 203d 2074 7265  t.forecast = tre
-0000fc00: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
-0000fc10: 6361 7374 202b 2074 656d 700d 0a20 2020  cast + temp..   
-0000fc20: 2020 2020 2020 2020 2020 2020 2074 7265               tre
-0000fc30: 6e64 5f66 6f72 6563 6173 742e 7570 7065  nd_forecast.uppe
-0000fc40: 725f 666f 7265 6361 7374 203d 2074 7265  r_forecast = tre
-0000fc50: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
-0000fc60: 6361 7374 0d0a 2020 2020 2020 2020 2020  cast..          
-0000fc70: 2020 2020 2020 7472 656e 645f 666f 7265        trend_fore
-0000fc80: 6361 7374 2e6c 6f77 6572 5f66 6f72 6563  cast.lower_forec
-0000fc90: 6173 7420 3d20 7472 656e 645f 666f 7265  ast = trend_fore
-0000fca0: 6361 7374 2e66 6f72 6563 6173 740d 0a20  cast.forecast.. 
-0000fcb0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
-0000fcc0: 636c 7564 655f 6869 7374 6f72 793a 0d0a  clude_history:..
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 7472 656e 645f 666f 7265 6361 7374 2e66  trend_forecast.f
-0000fcf0: 6f72 6563 6173 7420 3d20 7064 2e63 6f6e  orecast = pd.con
-0000fd00: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
-0000fd10: 2020 2020 2020 2020 2020 5b0d 0a20 2020            [..   
-0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd30: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
-0000fd40: 7472 6169 6e20 6966 2072 6573 6964 2069  train if resid i
-0000fd50: 7320 4e6f 6e65 2065 6c73 6520 7265 7369  s None else resi
-0000fd60: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
-0000fd70: 2020 2020 2020 2020 2020 2020 7472 656e              tren
-0000fd80: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
-0000fd90: 6173 742c 0d0a 2020 2020 2020 2020 2020  ast,..          
-0000fda0: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
-0000fdb0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdd0: 7472 656e 645f 666f 7265 6361 7374 2e6c  trend_forecast.l
-0000fde0: 6f77 6572 5f66 6f72 6563 6173 7420 3d20  ower_forecast = 
-0000fdf0: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
-0000fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe10: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-0000fe20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fe30: 7472 656e 645f 7472 6169 6e20 6966 2072  trend_train if r
-0000fe40: 6573 6964 2069 7320 4e6f 6e65 2065 6c73  esid is None els
-0000fe50: 6520 7265 7369 642c 0d0a 2020 2020 2020  e resid,..      
-0000fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe70: 2020 7472 656e 645f 666f 7265 6361 7374    trend_forecast
-0000fe80: 2e6c 6f77 6572 5f66 6f72 6563 6173 742c  .lower_forecast,
-0000fe90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fea0: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
-0000feb0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0000fec0: 2020 2020 2020 2020 2020 2020 7472 656e              tren
-0000fed0: 645f 666f 7265 6361 7374 2e75 7070 6572  d_forecast.upper
-0000fee0: 5f66 6f72 6563 6173 7420 3d20 7064 2e63  _forecast = pd.c
-0000fef0: 6f6e 6361 7428 0d0a 2020 2020 2020 2020  oncat(..        
-0000ff00: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
-0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff20: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
-0000ff30: 645f 7472 6169 6e20 6966 2072 6573 6964  d_train if resid
-0000ff40: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
-0000ff50: 7369 642c 0d0a 2020 2020 2020 2020 2020  sid,..          
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0000ff70: 656e 645f 666f 7265 6361 7374 2e75 7070  end_forecast.upp
-0000ff80: 6572 5f66 6f72 6563 6173 742c 0d0a 2020  er_forecast,..  
+0000fb40: 696e 6465 783d 7472 656e 645f 666f 7265  index=trend_fore
+0000fb50: 6361 7374 2e66 6f72 6563 6173 742e 696e  cast.forecast.in
+0000fb60: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
+0000fb70: 2020 2020 2020 2020 2020 292e 706f 7728            ).pow(
+0000fb80: 7261 6e67 6528 7472 656e 645f 666f 7265  range(trend_fore
+0000fb90: 6361 7374 2e66 6f72 6563 6173 742e 7368  cast.forecast.sh
+0000fba0: 6170 655b 305d 2929 2c0d 0a20 2020 2020  ape[0])),..     
+0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000fbc0: 7869 733d 302c 0d0a 2020 2020 2020 2020  xis=0,..        
+0000fbd0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000fbe0: 2020 2020 2020 2020 2020 2023 206f 7665             # ove
+0000fbf0: 7277 7269 7465 2062 6f75 6e64 7320 6966  rwrite bounds if
+0000fc00: 2075 7369 6e67 2070 6869 0d0a 2020 2020   using phi..    
+0000fc10: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+0000fc20: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
+0000fc30: 6173 7420 3d20 7472 656e 645f 666f 7265  ast = trend_fore
+0000fc40: 6361 7374 2e66 6f72 6563 6173 7420 2b20  cast.forecast + 
+0000fc50: 7465 6d70 0d0a 2020 2020 2020 2020 2020  temp..          
+0000fc60: 2020 2020 2020 7472 656e 645f 666f 7265        trend_fore
+0000fc70: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
+0000fc80: 6173 7420 3d20 7472 656e 645f 666f 7265  ast = trend_fore
+0000fc90: 6361 7374 2e66 6f72 6563 6173 740d 0a20  cast.forecast.. 
+0000fca0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000fcb0: 7265 6e64 5f66 6f72 6563 6173 742e 6c6f  rend_forecast.lo
+0000fcc0: 7765 725f 666f 7265 6361 7374 203d 2074  wer_forecast = t
+0000fcd0: 7265 6e64 5f66 6f72 6563 6173 742e 666f  rend_forecast.fo
+0000fce0: 7265 6361 7374 0d0a 2020 2020 2020 2020  recast..        
+0000fcf0: 2020 2020 6966 2069 6e63 6c75 6465 5f68      if include_h
+0000fd00: 6973 746f 7279 3a0d 0a20 2020 2020 2020  istory:..       
+0000fd10: 2020 2020 2020 2020 2074 7265 6e64 5f66           trend_f
+0000fd20: 6f72 6563 6173 742e 666f 7265 6361 7374  orecast.forecast
+0000fd30: 203d 2070 642e 636f 6e63 6174 280d 0a20   = pd.concat(.. 
+0000fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd50: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
+0000fd60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000fd70: 6c66 2e74 7265 6e64 5f74 7261 696e 2069  lf.trend_train i
+0000fd80: 6620 7265 7369 6420 6973 204e 6f6e 6520  f resid is None 
+0000fd90: 656c 7365 2072 6573 6964 2c0d 0a20 2020  else resid,..   
+0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fdb0: 2020 2020 2074 7265 6e64 5f66 6f72 6563       trend_forec
+0000fdc0: 6173 742e 666f 7265 6361 7374 2c0d 0a20  ast.forecast,.. 
+0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fde0: 2020 205d 0d0a 2020 2020 2020 2020 2020     ]..          
+0000fdf0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000fe00: 2020 2020 2020 2020 2074 7265 6e64 5f66           trend_f
+0000fe10: 6f72 6563 6173 742e 6c6f 7765 725f 666f  orecast.lower_fo
+0000fe20: 7265 6361 7374 203d 2070 642e 636f 6e63  recast = pd.conc
+0000fe30: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+0000fe40: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
+0000fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe60: 2020 2020 7365 6c66 2e74 7265 6e64 5f74      self.trend_t
+0000fe70: 7261 696e 2069 6620 7265 7369 6420 6973  rain if resid is
+0000fe80: 204e 6f6e 6520 656c 7365 2072 6573 6964   None else resid
+0000fe90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000fea0: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
+0000feb0: 5f66 6f72 6563 6173 742e 6c6f 7765 725f  _forecast.lower_
+0000fec0: 666f 7265 6361 7374 2c0d 0a20 2020 2020  forecast,..     
+0000fed0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000fee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fef0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+0000ff00: 2020 2020 2074 7265 6e64 5f66 6f72 6563       trend_forec
+0000ff10: 6173 742e 7570 7065 725f 666f 7265 6361  ast.upper_foreca
+0000ff20: 7374 203d 2070 642e 636f 6e63 6174 280d  st = pd.concat(.
+0000ff30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff40: 2020 2020 205b 0d0a 2020 2020 2020 2020       [..        
+0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff60: 7365 6c66 2e74 7265 6e64 5f74 7261 696e  self.trend_train
+0000ff70: 2069 6620 7265 7369 6420 6973 204e 6f6e   if resid is Non
+0000ff80: 6520 656c 7365 2072 6573 6964 2c0d 0a20  e else resid,.. 
 0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffa0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
-0000ffb0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000ffc0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000ffd0: 2020 2074 7265 6e64 5f66 6f72 6563 6173     trend_forecas
-0000ffe0: 7420 3d20 5072 6564 6963 7469 6f6e 4f62  t = PredictionOb
-0000fff0: 6a65 6374 280d 0a20 2020 2020 2020 2020  ject(..         
-00010000: 2020 2020 2020 2066 6f72 6563 6173 743d         forecast=
-00010010: 7365 6c66 2e74 7265 6e64 5f74 7261 696e  self.trend_train
-00010020: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00010030: 2020 206c 6f77 6572 5f66 6f72 6563 6173     lower_forecas
-00010040: 743d 7365 6c66 2e74 7265 6e64 5f74 7261  t=self.trend_tra
-00010050: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
-00010060: 2020 2020 2075 7070 6572 5f66 6f72 6563       upper_forec
-00010070: 6173 743d 7365 6c66 2e74 7265 6e64 5f74  ast=self.trend_t
-00010080: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
-00010090: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-000100a0: 2320 6172 5f6c 6167 732c 206d 756c 7469  # ar_lags, multi
-000100b0: 7661 7269 6174 6520 6665 6174 7572 6573  variate features
-000100c0: 2072 6571 7569 7265 2031 2073 7465 7020   require 1 step 
-000100d0: 6c6f 6f70 0d0a 2020 2020 2020 2020 6966  loop..        if
-000100e0: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
-000100f0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00010100: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00010110: 7374 203d 2073 656c 662e 5f70 7265 6469  st = self._predi
-00010120: 6374 5f73 7465 7028 0d0a 2020 2020 2020  ct_step(..      
-00010130: 2020 2020 2020 2020 2020 6461 7465 733d            dates=
-00010140: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
-00010150: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-00010160: 5f63 6f6d 706f 6e65 6e74 3d74 7265 6e64  _component=trend
-00010170: 5f66 6f72 6563 6173 742c 0d0a 2020 2020  _forecast,..    
-00010180: 2020 2020 2020 2020 2020 2020 6869 7374              hist
-00010190: 6f72 795f 6466 3d64 662c 0d0a 2020 2020  ory_df=df,..    
-000101a0: 2020 2020 2020 2020 2020 2020 6675 7475              futu
-000101b0: 7265 5f72 6567 7265 7373 6f72 3d66 756c  re_regressor=ful
-000101c0: 6c5f 7265 6772 2c0d 0a20 2020 2020 2020  l_regr,..       
-000101d0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
-000101e0: 6772 6573 736f 7273 3d61 6c6c 5f66 6c61  gressors=all_fla
-000101f0: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
-00010200: 2020 2020 2069 6d70 6163 7473 3d69 6d70       impacts=imp
-00010210: 6163 7473 2c0d 0a20 2020 2020 2020 2020  acts,..         
-00010220: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
-00010230: 5f70 6572 5f73 6572 6965 733d 7265 6772  _per_series=regr
-00010240: 5f70 735f 666f 7265 2c0d 0a20 2020 2020  _ps_fore,..     
-00010250: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00010260: 2020 656c 6966 2073 656c 662e 7072 6564    elif self.pred
-00010270: 6963 745f 6c6f 6f70 5f72 6571 3a0d 0a20  ict_loop_req:.. 
-00010280: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00010290: 7465 7020 696e 2072 616e 6765 2866 6f72  tep in range(for
-000102a0: 6563 6173 745f 6c65 6e67 7468 293a 0d0a  ecast_length):..
-000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102c0: 666f 7265 6361 7374 5f69 6e64 6578 203d  forecast_index =
-000102d0: 2064 662e 696e 6465 782e 756e 696f 6e28   df.index.union(
-000102e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000102f0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-00010300: 655f 666f 7265 6361 7374 5f69 6e64 6578  e_forecast_index
-00010310: 2831 2c20 6c61 7374 5f64 6174 653d 6466  (1, last_date=df
-00010320: 2e69 6e64 6578 5b2d 315d 290d 0a20 2020  .index[-1])..   
-00010330: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010350: 6466 5f66 6f72 6563 6173 7420 3d20 7365  df_forecast = se
-00010360: 6c66 2e5f 7072 6564 6963 745f 7374 6570  lf._predict_step
-00010370: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00010380: 2020 2020 2020 2064 6174 6573 3d66 6f72         dates=for
-00010390: 6563 6173 745f 696e 6465 782c 0d0a 2020  ecast_index,..  
-000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103b0: 2020 7472 656e 645f 636f 6d70 6f6e 656e    trend_componen
-000103c0: 743d 7472 656e 645f 666f 7265 6361 7374  t=trend_forecast
-000103d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000103e0: 2020 2020 2020 2068 6973 746f 7279 5f64         history_d
-000103f0: 663d 6466 2c0d 0a20 2020 2020 2020 2020  f=df,..         
-00010400: 2020 2020 2020 2020 2020 2066 7574 7572             futur
-00010410: 655f 7265 6772 6573 736f 723d 6675 6c6c  e_regressor=full
-00010420: 5f72 6567 722c 0d0a 2020 2020 2020 2020  _regr,..        
-00010430: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-00010440: 5f72 6567 7265 7373 6f72 733d 616c 6c5f  _regressors=all_
-00010450: 666c 6167 732c 0d0a 2020 2020 2020 2020  flags,..        
-00010460: 2020 2020 2020 2020 2020 2020 696d 7061              impa
-00010470: 6374 733d 696d 7061 6374 732c 0d0a 2020  cts=impacts,..  
-00010480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010490: 2020 7265 6772 6573 736f 725f 7065 725f    regressor_per_
-000104a0: 7365 7269 6573 3d72 6567 725f 7073 5f66  series=regr_ps_f
-000104b0: 6f72 652c 0d0a 2020 2020 2020 2020 2020  ore,..          
-000104c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000104d0: 2020 2020 2020 2020 2064 6620 3d20 7064           df = pd
-000104e0: 2e63 6f6e 6361 7428 5b64 662c 2064 665f  .concat([df, df_
-000104f0: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
-00010500: 742e 696c 6f63 5b2d 313a 5d5d 290d 0a20  t.iloc[-1:]]).. 
-00010510: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00010520: 7420 696e 636c 7564 655f 6869 7374 6f72  t include_histor
-00010530: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00010540: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
-00010550: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
-00010560: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
-00010570: 7461 696c 2866 6f72 6563 6173 745f 6c65  tail(forecast_le
-00010580: 6e67 7468 290d 0a20 2020 2020 2020 2020  ngth)..         
-00010590: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-000105a0: 7374 2e6c 6f77 6572 5f66 6f72 6563 6173  st.lower_forecas
-000105b0: 7420 3d20 6466 5f66 6f72 6563 6173 742e  t = df_forecast.
-000105c0: 6c6f 7765 725f 666f 7265 6361 7374 2e74  lower_forecast.t
-000105d0: 6169 6c28 0d0a 2020 2020 2020 2020 2020  ail(..          
-000105e0: 2020 2020 2020 2020 2020 666f 7265 6361            foreca
-000105f0: 7374 5f6c 656e 6774 680d 0a20 2020 2020  st_length..     
-00010600: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00010610: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00010620: 5f66 6f72 6563 6173 742e 7570 7065 725f  _forecast.upper_
-00010630: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
-00010640: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
-00010650: 6563 6173 742e 7461 696c 280d 0a20 2020  ecast.tail(..   
-00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010670: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
-00010680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010690: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
-000106a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000106b0: 666f 7265 6361 7374 5f69 6e64 6578 203d  forecast_index =
-000106c0: 2073 656c 662e 6372 6561 7465 5f66 6f72   self.create_for
-000106d0: 6563 6173 745f 696e 6465 7828 0d0a 2020  ecast_index(..  
-000106e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000106f0: 7265 6361 7374 5f6c 656e 6774 682c 206c  recast_length, l
-00010700: 6173 745f 6461 7465 3d64 662e 696e 6465  ast_date=df.inde
-00010710: 785b 2d31 5d0d 0a20 2020 2020 2020 2020  x[-1]..         
-00010720: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00010730: 2020 6966 2069 6e63 6c75 6465 5f68 6973    if include_his
-00010740: 746f 7279 3a0d 0a20 2020 2020 2020 2020  tory:..         
-00010750: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
-00010760: 696e 6465 7820 3d20 6466 2e69 6e64 6578  index = df.index
-00010770: 2e75 6e69 6f6e 2866 6f72 6563 6173 745f  .union(forecast_
-00010780: 696e 6465 7829 0d0a 2020 2020 2020 2020  index)..        
-00010790: 2020 2020 6466 5f66 6f72 6563 6173 7420      df_forecast 
-000107a0: 3d20 7365 6c66 2e5f 7072 6564 6963 745f  = self._predict_
-000107b0: 7374 6570 280d 0a20 2020 2020 2020 2020  step(..         
-000107c0: 2020 2020 2020 2064 6174 6573 3d66 6f72         dates=for
-000107d0: 6563 6173 745f 696e 6465 782c 0d0a 2020  ecast_index,..  
-000107e0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000107f0: 656e 645f 636f 6d70 6f6e 656e 743d 7472  end_component=tr
-00010800: 656e 645f 666f 7265 6361 7374 2c0d 0a20  end_forecast,.. 
-00010810: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00010820: 6973 746f 7279 5f64 663d 6466 2c0d 0a20  istory_df=df,.. 
-00010830: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010840: 7574 7572 655f 7265 6772 6573 736f 723d  uture_regressor=
-00010850: 6675 6c6c 5f72 6567 722c 0d0a 2020 2020  full_regr,..    
-00010860: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-00010870: 5f72 6567 7265 7373 6f72 733d 616c 6c5f  _regressors=all_
-00010880: 666c 6167 732c 0d0a 2020 2020 2020 2020  flags,..        
-00010890: 2020 2020 2020 2020 696d 7061 6374 733d          impacts=
-000108a0: 696d 7061 6374 732c 0d0a 2020 2020 2020  impacts,..      
-000108b0: 2020 2020 2020 2020 2020 7265 6772 6573            regres
-000108c0: 736f 725f 7065 725f 7365 7269 6573 3d72  sor_per_series=r
-000108d0: 6567 725f 7073 5f66 6f72 652c 0d0a 2020  egr_ps_fore,..  
-000108e0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
-000108f0: 2020 2020 2020 2023 2073 6176 6520 6675         # save fu
-00010900: 7475 7265 2069 6e64 6578 2062 6566 6f72  ture index befor
-00010910: 6520 696e 636c 7564 655f 6869 7374 6f72  e include_histor
-00010920: 7920 6973 2061 6464 6564 0d0a 2020 2020  y is added..    
-00010930: 2020 2020 6966 2066 7574 7572 655f 696d      if future_im
-00010940: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
-00010950: 6520 616e 6420 666f 7265 6361 7374 5f6c  e and forecast_l
-00010960: 656e 6774 6820 6973 206e 6f74 204e 6f6e  ength is not Non
-00010970: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00010980: 6675 7475 7265 5f69 6d70 6163 7473 203d  future_impacts =
-00010990: 2066 7574 7572 655f 696d 7061 6374 732e   future_impacts.
-000109a0: 7265 696e 6465 7828 0d0a 2020 2020 2020  reindex(..      
-000109b0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-000109c0: 733d 6466 5f66 6f72 6563 6173 742e 666f  s=df_forecast.fo
-000109d0: 7265 6361 7374 2e63 6f6c 756d 6e73 2c0d  recast.columns,.
-000109e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000109f0: 2069 6e64 6578 3d73 656c 662e 666f 7265   index=self.fore
-00010a00: 6361 7374 5f69 6e64 6578 2c0d 0a20 2020  cast_index,..   
-00010a10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00010a20: 6c5f 7661 6c75 653d 302c 0d0a 2020 2020  l_value=0,..    
-00010a30: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00010a40: 2020 2023 2075 6e64 6f20 7072 6570 726f     # undo prepro
-00010a50: 6365 7373 696e 6720 616e 6420 7363 616c  cessing and scal
-00010a60: 696e 670d 0a20 2020 2020 2020 2023 2061  ing..        # a
-00010a70: 6363 6f75 6e74 2066 6f72 2073 6f6d 6520  ccount for some 
-00010a80: 7472 616e 7366 6f72 6d65 7273 2072 6571  transformers req
-00010a90: 7569 7269 6e67 2064 6966 6665 7265 6e74  uiring different
-00010aa0: 206d 6574 686f 6473 206f 6e20 6f72 6967   methods on orig
-00010ab0: 696e 616c 2064 6174 6120 616e 6420 666f  inal data and fo
-00010ac0: 7265 6361 7374 0d0a 2020 2020 2020 2020  recast..        
-00010ad0: 6966 2066 6f72 6563 6173 745f 6c65 6e67  if forecast_leng
-00010ae0: 7468 2069 7320 4e6f 6e65 3a0d 0a20 2020  th is None:..   
-00010af0: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
-00010b00: 6361 7374 2e66 6f72 6563 6173 7420 3d20  cast.forecast = 
-00010b10: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
-00010b20: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
-00010b30: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00010b40: 7374 2e66 6f72 6563 6173 742c 2074 7261  st.forecast, tra
-00010b50: 6e73 5f6d 6574 686f 643d 276f 7269 6769  ns_method='origi
-00010b60: 6e61 6c27 0d0a 2020 2020 2020 2020 2020  nal'..          
-00010b70: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00010b80: 2064 665f 666f 7265 6361 7374 2e6c 6f77   df_forecast.low
-00010b90: 6572 5f66 6f72 6563 6173 7420 3d20 7365  er_forecast = se
-00010ba0: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
-00010bb0: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-00010bc0: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
-00010bd0: 2e6c 6f77 6572 5f66 6f72 6563 6173 742c  .lower_forecast,
-00010be0: 2074 7261 6e73 5f6d 6574 686f 643d 276f   trans_method='o
-00010bf0: 7269 6769 6e61 6c27 0d0a 2020 2020 2020  riginal'..      
-00010c00: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00010c10: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
-00010c20: 2e75 7070 6572 5f66 6f72 6563 6173 7420  .upper_forecast 
-00010c30: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
-00010c40: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
-00010c50: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
-00010c60: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
-00010c70: 6173 742c 2074 7261 6e73 5f6d 6574 686f  ast, trans_metho
-00010c80: 643d 276f 7269 6769 6e61 6c27 0d0a 2020  d='original'..  
-00010c90: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00010ca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00010cb0: 6564 6963 7465 645f 7472 656e 6420 3d20  edicted_trend = 
-00010cc0: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
-00010cd0: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
-00010ce0: 2020 2020 2020 2074 7265 6e64 5f66 6f72         trend_for
-00010cf0: 6563 6173 742e 666f 7265 6361 7374 2c20  ecast.forecast, 
-00010d00: 7472 616e 735f 6d65 7468 6f64 3d27 6f72  trans_method='or
-00010d10: 6967 696e 616c 270d 0a20 2020 2020 2020  iginal'..       
-00010d20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00010d30: 656c 6966 206e 6f74 2069 6e63 6c75 6465  elif not include
-00010d40: 5f68 6973 746f 7279 3a0d 0a20 2020 2020  _history:..     
-00010d50: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00010d60: 7374 2e66 6f72 6563 6173 7420 3d20 7365  st.forecast = se
-00010d70: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
-00010d80: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-00010d90: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
-00010da0: 2e66 6f72 6563 6173 742c 2074 7261 6e73  .forecast, trans
-00010db0: 5f6d 6574 686f 643d 2766 6f72 6563 6173  _method='forecas
-00010dc0: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
-00010dd0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00010de0: 665f 666f 7265 6361 7374 2e6c 6f77 6572  f_forecast.lower
-00010df0: 5f66 6f72 6563 6173 7420 3d20 7365 6c66  _forecast = self
-00010e00: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
-00010e10: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00010e20: 2020 2064 665f 666f 7265 6361 7374 2e6c     df_forecast.l
-00010e30: 6f77 6572 5f66 6f72 6563 6173 742c 2074  ower_forecast, t
-00010e40: 7261 6e73 5f6d 6574 686f 643d 2766 6f72  rans_method='for
-00010e50: 6563 6173 7427 0d0a 2020 2020 2020 2020  ecast'..        
-00010e60: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00010e70: 2020 2064 665f 666f 7265 6361 7374 2e75     df_forecast.u
-00010e80: 7070 6572 5f66 6f72 6563 6173 7420 3d20  pper_forecast = 
-00010e90: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
-00010ea0: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
-00010eb0: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00010ec0: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
-00010ed0: 742c 2074 7261 6e73 5f6d 6574 686f 643d  t, trans_method=
-00010ee0: 2766 6f72 6563 6173 7427 0d0a 2020 2020  'forecast'..    
-00010ef0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00010f00: 2020 2020 2020 2073 656c 662e 7072 6564         self.pred
-00010f10: 6963 7465 645f 7472 656e 6420 3d20 7365  icted_trend = se
-00010f20: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
-00010f30: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-00010f40: 2020 2020 2074 7265 6e64 5f66 6f72 6563       trend_forec
-00010f50: 6173 742e 666f 7265 6361 7374 2c20 7472  ast.forecast, tr
-00010f60: 616e 735f 6d65 7468 6f64 3d27 666f 7265  ans_method='fore
-00010f70: 6361 7374 270d 0a20 2020 2020 2020 2020  cast'..         
-00010f80: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
-00010f90: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00010fa0: 2068 646e 203d 206c 656e 2864 665f 666f   hdn = len(df_fo
-00010fb0: 7265 6361 7374 2e66 6f72 6563 6173 7429  recast.forecast)
-00010fc0: 202d 2066 6f72 6563 6173 745f 6c65 6e67   - forecast_leng
-00010fd0: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
-00010fe0: 6466 5f66 6f72 6563 6173 742e 666f 7265  df_forecast.fore
-00010ff0: 6361 7374 203d 2070 642e 636f 6e63 6174  cast = pd.concat
-00011000: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00011010: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
-00011020: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00011030: 6f5f 6f72 6967 696e 5f73 7061 6365 280d  o_origin_space(.
-00011040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011050: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
-00011060: 6361 7374 2e66 6f72 6563 6173 742e 6865  cast.forecast.he
-00011070: 6164 2868 646e 292c 2074 7261 6e73 5f6d  ad(hdn), trans_m
-00011080: 6574 686f 643d 276f 7269 6769 6e61 6c27  ethod='original'
-00011090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000110a0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-000110b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000110c0: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
-000110d0: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
-000110e0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-000110f0: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
-00011100: 742e 7461 696c 2866 6f72 6563 6173 745f  t.tail(forecast_
-00011110: 6c65 6e67 7468 292c 0d0a 2020 2020 2020  length),..      
-00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011130: 2020 7472 616e 735f 6d65 7468 6f64 3d27    trans_method='
-00011140: 666f 7265 6361 7374 272c 0d0a 2020 2020  forecast',..    
+0000ffa0: 2020 2020 2020 2074 7265 6e64 5f66 6f72         trend_for
+0000ffb0: 6563 6173 742e 7570 7065 725f 666f 7265  ecast.upper_fore
+0000ffc0: 6361 7374 2c0d 0a20 2020 2020 2020 2020  cast,..         
+0000ffd0: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+0000ffe0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000fff0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00010000: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+00010010: 645f 666f 7265 6361 7374 203d 2050 7265  d_forecast = Pre
+00010020: 6469 6374 696f 6e4f 626a 6563 7428 0d0a  dictionObject(..
+00010030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010040: 666f 7265 6361 7374 3d73 656c 662e 7472  forecast=self.tr
+00010050: 656e 645f 7472 6169 6e2c 0d0a 2020 2020  end_train,..    
+00010060: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+00010070: 725f 666f 7265 6361 7374 3d73 656c 662e  r_forecast=self.
+00010080: 7472 656e 645f 7472 6169 6e2c 0d0a 2020  trend_train,..  
+00010090: 2020 2020 2020 2020 2020 2020 2020 7570                up
+000100a0: 7065 725f 666f 7265 6361 7374 3d73 656c  per_forecast=sel
+000100b0: 662e 7472 656e 645f 7472 6169 6e2c 0d0a  f.trend_train,..
+000100c0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+000100d0: 0a20 2020 2020 2020 2023 2061 725f 6c61  .        # ar_la
+000100e0: 6773 2c20 6d75 6c74 6976 6172 6961 7465  gs, multivariate
+000100f0: 2066 6561 7475 7265 7320 7265 7175 6972   features requir
+00010100: 6520 3120 7374 6570 206c 6f6f 700d 0a20  e 1 step loop.. 
+00010110: 2020 2020 2020 2069 6620 666f 7265 6361         if foreca
+00010120: 7374 5f6c 656e 6774 6820 6973 204e 6f6e  st_length is Non
+00010130: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00010140: 6466 5f66 6f72 6563 6173 7420 3d20 7365  df_forecast = se
+00010150: 6c66 2e5f 7072 6564 6963 745f 7374 6570  lf._predict_step
+00010160: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00010170: 2020 2064 6174 6573 3d64 662e 696e 6465     dates=df.inde
+00010180: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
+00010190: 2020 2020 7472 656e 645f 636f 6d70 6f6e      trend_compon
+000101a0: 656e 743d 7472 656e 645f 666f 7265 6361  ent=trend_foreca
+000101b0: 7374 2c0d 0a20 2020 2020 2020 2020 2020  st,..           
+000101c0: 2020 2020 2068 6973 746f 7279 5f64 663d       history_df=
+000101d0: 6466 2c0d 0a20 2020 2020 2020 2020 2020  df,..           
+000101e0: 2020 2020 2066 7574 7572 655f 7265 6772       future_regr
+000101f0: 6573 736f 723d 6675 6c6c 5f72 6567 722c  essor=full_regr,
+00010200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010210: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
+00010220: 733d 616c 6c5f 666c 6167 732c 0d0a 2020  s=all_flags,..  
+00010230: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00010240: 7061 6374 733d 696d 7061 6374 732c 0d0a  pacts=impacts,..
+00010250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010260: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
+00010270: 7269 6573 3d72 6567 725f 7073 5f66 6f72  ries=regr_ps_for
+00010280: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00010290: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+000102a0: 7365 6c66 2e70 7265 6469 6374 5f6c 6f6f  self.predict_loo
+000102b0: 705f 7265 713a 0d0a 2020 2020 2020 2020  p_req:..        
+000102c0: 2020 2020 666f 7220 7374 6570 2069 6e20      for step in 
+000102d0: 7261 6e67 6528 666f 7265 6361 7374 5f6c  range(forecast_l
+000102e0: 656e 6774 6829 3a0d 0a20 2020 2020 2020  ength):..       
+000102f0: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+00010300: 745f 696e 6465 7820 3d20 6466 2e69 6e64  t_index = df.ind
+00010310: 6578 2e75 6e69 6f6e 280d 0a20 2020 2020  ex.union(..     
+00010320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010330: 656c 662e 6372 6561 7465 5f66 6f72 6563  elf.create_forec
+00010340: 6173 745f 696e 6465 7828 312c 206c 6173  ast_index(1, las
+00010350: 745f 6461 7465 3d64 662e 696e 6465 785b  t_date=df.index[
+00010360: 2d31 5d29 0d0a 2020 2020 2020 2020 2020  -1])..          
+00010370: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00010380: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010390: 6361 7374 203d 2073 656c 662e 5f70 7265  cast = self._pre
+000103a0: 6469 6374 5f73 7465 7028 0d0a 2020 2020  dict_step(..    
+000103b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103c0: 6461 7465 733d 666f 7265 6361 7374 5f69  dates=forecast_i
+000103d0: 6e64 6578 2c0d 0a20 2020 2020 2020 2020  ndex,..         
+000103e0: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
+000103f0: 5f63 6f6d 706f 6e65 6e74 3d74 7265 6e64  _component=trend
+00010400: 5f66 6f72 6563 6173 742c 0d0a 2020 2020  _forecast,..    
+00010410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010420: 6869 7374 6f72 795f 6466 3d64 662c 0d0a  history_df=df,..
+00010430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010440: 2020 2020 6675 7475 7265 5f72 6567 7265      future_regre
+00010450: 7373 6f72 3d66 756c 6c5f 7265 6772 2c0d  ssor=full_regr,.
+00010460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010470: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
+00010480: 736f 7273 3d61 6c6c 5f66 6c61 6773 2c0d  sors=all_flags,.
+00010490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000104a0: 2020 2020 2069 6d70 6163 7473 3d69 6d70       impacts=imp
+000104b0: 6163 7473 2c0d 0a20 2020 2020 2020 2020  acts,..         
+000104c0: 2020 2020 2020 2020 2020 2072 6567 7265             regre
+000104d0: 7373 6f72 5f70 6572 5f73 6572 6965 733d  ssor_per_series=
+000104e0: 7265 6772 5f70 735f 666f 7265 2c0d 0a20  regr_ps_fore,.. 
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00010500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010510: 2020 6466 203d 2070 642e 636f 6e63 6174    df = pd.concat
+00010520: 285b 6466 2c20 6466 5f66 6f72 6563 6173  ([df, df_forecas
+00010530: 742e 666f 7265 6361 7374 2e69 6c6f 635b  t.forecast.iloc[
+00010540: 2d31 3a5d 5d29 0d0a 2020 2020 2020 2020  -1:]])..        
+00010550: 2020 2020 6966 206e 6f74 2069 6e63 6c75      if not inclu
+00010560: 6465 5f68 6973 746f 7279 3a0d 0a20 2020  de_history:..   
+00010570: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00010580: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+00010590: 7420 3d20 6466 5f66 6f72 6563 6173 742e  t = df_forecast.
+000105a0: 666f 7265 6361 7374 2e74 6169 6c28 666f  forecast.tail(fo
+000105b0: 7265 6361 7374 5f6c 656e 6774 6829 0d0a  recast_length)..
+000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105d0: 6466 5f66 6f72 6563 6173 742e 6c6f 7765  df_forecast.lowe
+000105e0: 725f 666f 7265 6361 7374 203d 2064 665f  r_forecast = df_
+000105f0: 666f 7265 6361 7374 2e6c 6f77 6572 5f66  forecast.lower_f
+00010600: 6f72 6563 6173 742e 7461 696c 280d 0a20  orecast.tail(.. 
+00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010620: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
+00010630: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
+00010640: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00010650: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010660: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
+00010670: 7420 3d20 6466 5f66 6f72 6563 6173 742e  t = df_forecast.
+00010680: 7570 7065 725f 666f 7265 6361 7374 2e74  upper_forecast.t
+00010690: 6169 6c28 0d0a 2020 2020 2020 2020 2020  ail(..          
+000106a0: 2020 2020 2020 2020 2020 666f 7265 6361            foreca
+000106b0: 7374 5f6c 656e 6774 680d 0a20 2020 2020  st_length..     
+000106c0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+000106d0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000106e0: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+000106f0: 745f 696e 6465 7820 3d20 7365 6c66 2e63  t_index = self.c
+00010700: 7265 6174 655f 666f 7265 6361 7374 5f69  reate_forecast_i
+00010710: 6e64 6578 280d 0a20 2020 2020 2020 2020  ndex(..         
+00010720: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
+00010730: 6c65 6e67 7468 2c20 6c61 7374 5f64 6174  length, last_dat
+00010740: 653d 6466 2e69 6e64 6578 5b2d 315d 0d0a  e=df.index[-1]..
+00010750: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00010760: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00010770: 636c 7564 655f 6869 7374 6f72 793a 0d0a  clude_history:..
+00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010790: 666f 7265 6361 7374 5f69 6e64 6578 203d  forecast_index =
+000107a0: 2064 662e 696e 6465 782e 756e 696f 6e28   df.index.union(
+000107b0: 666f 7265 6361 7374 5f69 6e64 6578 290d  forecast_index).
+000107c0: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+000107d0: 666f 7265 6361 7374 203d 2073 656c 662e  forecast = self.
+000107e0: 5f70 7265 6469 6374 5f73 7465 7028 0d0a  _predict_step(..
+000107f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010800: 6461 7465 733d 666f 7265 6361 7374 5f69  dates=forecast_i
+00010810: 6e64 6578 2c0d 0a20 2020 2020 2020 2020  ndex,..         
+00010820: 2020 2020 2020 2074 7265 6e64 5f63 6f6d         trend_com
+00010830: 706f 6e65 6e74 3d74 7265 6e64 5f66 6f72  ponent=trend_for
+00010840: 6563 6173 742c 0d0a 2020 2020 2020 2020  ecast,..        
+00010850: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
+00010860: 6466 3d64 662c 0d0a 2020 2020 2020 2020  df=df,..        
+00010870: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
+00010880: 6567 7265 7373 6f72 3d66 756c 6c5f 7265  egressor=full_re
+00010890: 6772 2c0d 0a20 2020 2020 2020 2020 2020  gr,..           
+000108a0: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
+000108b0: 736f 7273 3d61 6c6c 5f66 6c61 6773 2c0d  sors=all_flags,.
+000108c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000108d0: 2069 6d70 6163 7473 3d69 6d70 6163 7473   impacts=impacts
+000108e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000108f0: 2020 2072 6567 7265 7373 6f72 5f70 6572     regressor_per
+00010900: 5f73 6572 6965 733d 7265 6772 5f70 735f  _series=regr_ps_
+00010910: 666f 7265 2c0d 0a20 2020 2020 2020 2020  fore,..         
+00010920: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+00010930: 2320 7361 7665 2066 7574 7572 6520 696e  # save future in
+00010940: 6465 7820 6265 666f 7265 2069 6e63 6c75  dex before inclu
+00010950: 6465 5f68 6973 746f 7279 2069 7320 6164  de_history is ad
+00010960: 6465 640d 0a20 2020 2020 2020 2069 6620  ded..        if 
+00010970: 6675 7475 7265 5f69 6d70 6163 7473 2069  future_impacts i
+00010980: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2066  s not None and f
+00010990: 6f72 6563 6173 745f 6c65 6e67 7468 2069  orecast_length i
+000109a0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000109b0: 2020 2020 2020 2020 2066 7574 7572 655f           future_
+000109c0: 696d 7061 6374 7320 3d20 6675 7475 7265  impacts = future
+000109d0: 5f69 6d70 6163 7473 2e72 6569 6e64 6578  _impacts.reindex
+000109e0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000109f0: 2020 2063 6f6c 756d 6e73 3d64 665f 666f     columns=df_fo
+00010a00: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
+00010a10: 636f 6c75 6d6e 732c 0d0a 2020 2020 2020  columns,..      
+00010a20: 2020 2020 2020 2020 2020 696e 6465 783d            index=
+00010a30: 666f 7265 6361 7374 5f69 6e64 6578 2c0d  forecast_index,.
+00010a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010a50: 2066 696c 6c5f 7661 6c75 653d 302c 0d0a   fill_value=0,..
+00010a60: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00010a70: 2020 2020 2020 2023 2075 6e64 6f20 7072         # undo pr
+00010a80: 6570 726f 6365 7373 696e 6720 616e 6420  eprocessing and 
+00010a90: 7363 616c 696e 670d 0a20 2020 2020 2020  scaling..       
+00010aa0: 2023 2061 6363 6f75 6e74 2066 6f72 2073   # account for s
+00010ab0: 6f6d 6520 7472 616e 7366 6f72 6d65 7273  ome transformers
+00010ac0: 2072 6571 7569 7269 6e67 2064 6966 6665   requiring diffe
+00010ad0: 7265 6e74 206d 6574 686f 6473 206f 6e20  rent methods on 
+00010ae0: 6f72 6967 696e 616c 2064 6174 6120 616e  original data an
+00010af0: 6420 666f 7265 6361 7374 0d0a 2020 2020  d forecast..    
+00010b00: 2020 2020 6966 2066 6f72 6563 6173 745f      if forecast_
+00010b10: 6c65 6e67 7468 2069 7320 4e6f 6e65 3a0d  length is None:.
+00010b20: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00010b30: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+00010b40: 7420 3d20 7365 6c66 2e74 6f5f 6f72 6967  t = self.to_orig
+00010b50: 696e 5f73 7061 6365 280d 0a20 2020 2020  in_space(..     
+00010b60: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+00010b70: 7265 6361 7374 2e66 6f72 6563 6173 742c  recast.forecast,
+00010b80: 2074 7261 6e73 5f6d 6574 686f 643d 276f   trans_method='o
+00010b90: 7269 6769 6e61 6c27 0d0a 2020 2020 2020  riginal'..      
+00010ba0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00010bb0: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00010bc0: 2e6c 6f77 6572 5f66 6f72 6563 6173 7420  .lower_forecast 
+00010bd0: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
+00010be0: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00010bf0: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010c00: 6361 7374 2e6c 6f77 6572 5f66 6f72 6563  cast.lower_forec
+00010c10: 6173 742c 2074 7261 6e73 5f6d 6574 686f  ast, trans_metho
+00010c20: 643d 276f 7269 6769 6e61 6c27 0d0a 2020  d='original'..  
+00010c30: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00010c40: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010c50: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
+00010c60: 6173 7420 3d20 7365 6c66 2e74 6f5f 6f72  ast = self.to_or
+00010c70: 6967 696e 5f73 7061 6365 280d 0a20 2020  igin_space(..   
+00010c80: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00010c90: 666f 7265 6361 7374 2e75 7070 6572 5f66  forecast.upper_f
+00010ca0: 6f72 6563 6173 742c 2074 7261 6e73 5f6d  orecast, trans_m
+00010cb0: 6574 686f 643d 276f 7269 6769 6e61 6c27  ethod='original'
+00010cc0: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00010cd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00010ce0: 662e 7072 6564 6963 7465 645f 7472 656e  f.predicted_tren
+00010cf0: 6420 3d20 7365 6c66 2e74 6f5f 6f72 6967  d = self.to_orig
+00010d00: 696e 5f73 7061 6365 280d 0a20 2020 2020  in_space(..     
+00010d10: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
+00010d20: 5f66 6f72 6563 6173 742e 666f 7265 6361  _forecast.foreca
+00010d30: 7374 2c20 7472 616e 735f 6d65 7468 6f64  st, trans_method
+00010d40: 3d27 6f72 6967 696e 616c 270d 0a20 2020  ='original'..   
+00010d50: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00010d60: 2020 2020 656c 6966 206e 6f74 2069 6e63      elif not inc
+00010d70: 6c75 6465 5f68 6973 746f 7279 3a0d 0a20  lude_history:.. 
+00010d80: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+00010d90: 7265 6361 7374 2e66 6f72 6563 6173 7420  recast.forecast 
+00010da0: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
+00010db0: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00010dc0: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010dd0: 6361 7374 2e66 6f72 6563 6173 742c 2074  cast.forecast, t
+00010de0: 7261 6e73 5f6d 6574 686f 643d 2766 6f72  rans_method='for
+00010df0: 6563 6173 7427 0d0a 2020 2020 2020 2020  ecast'..        
+00010e00: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00010e10: 2020 2064 665f 666f 7265 6361 7374 2e6c     df_forecast.l
+00010e20: 6f77 6572 5f66 6f72 6563 6173 7420 3d20  ower_forecast = 
+00010e30: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00010e40: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00010e50: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010e60: 7374 2e6c 6f77 6572 5f66 6f72 6563 6173  st.lower_forecas
+00010e70: 742c 2074 7261 6e73 5f6d 6574 686f 643d  t, trans_method=
+00010e80: 2766 6f72 6563 6173 7427 0d0a 2020 2020  'forecast'..    
+00010e90: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00010ea0: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010eb0: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
+00010ec0: 7420 3d20 7365 6c66 2e74 6f5f 6f72 6967  t = self.to_orig
+00010ed0: 696e 5f73 7061 6365 280d 0a20 2020 2020  in_space(..     
+00010ee0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+00010ef0: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
+00010f00: 6563 6173 742c 2074 7261 6e73 5f6d 6574  ecast, trans_met
+00010f10: 686f 643d 2766 6f72 6563 6173 7427 0d0a  hod='forecast'..
+00010f20: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00010f30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010f40: 7072 6564 6963 7465 645f 7472 656e 6420  predicted_trend 
+00010f50: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
+00010f60: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00010f70: 2020 2020 2020 2020 2074 7265 6e64 5f66           trend_f
+00010f80: 6f72 6563 6173 742e 666f 7265 6361 7374  orecast.forecast
+00010f90: 2c20 7472 616e 735f 6d65 7468 6f64 3d27  , trans_method='
+00010fa0: 666f 7265 6361 7374 270d 0a20 2020 2020  forecast'..     
+00010fb0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00010fc0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00010fd0: 2020 2020 2068 646e 203d 206c 656e 2864       hdn = len(d
+00010fe0: 665f 666f 7265 6361 7374 2e66 6f72 6563  f_forecast.forec
+00010ff0: 6173 7429 202d 2066 6f72 6563 6173 745f  ast) - forecast_
+00011000: 6c65 6e67 7468 0d0a 2020 2020 2020 2020  length..        
+00011010: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
+00011020: 666f 7265 6361 7374 203d 2070 642e 636f  forecast = pd.co
+00011030: 6e63 6174 280d 0a20 2020 2020 2020 2020  ncat(..         
+00011040: 2020 2020 2020 205b 0d0a 2020 2020 2020         [..      
+00011050: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00011060: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
+00011070: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00011080: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00011090: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+000110a0: 742e 6865 6164 2868 646e 292c 2074 7261  t.head(hdn), tra
+000110b0: 6e73 5f6d 6574 686f 643d 276f 7269 6769  ns_method='origi
+000110c0: 6e61 6c27 0d0a 2020 2020 2020 2020 2020  nal'..          
+000110d0: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 2020 7365 6c66 2e74 6f5f 6f72 6967 696e    self.to_origin
+00011100: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00011110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011120: 2064 665f 666f 7265 6361 7374 2e66 6f72   df_forecast.for
+00011130: 6563 6173 742e 7461 696c 2866 6f72 6563  ecast.tail(forec
+00011140: 6173 745f 6c65 6e67 7468 292c 0d0a 2020  ast_length),..  
 00011150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011160: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00011170: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
-00011180: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00011190: 2020 6466 5f66 6f72 6563 6173 742e 6c6f    df_forecast.lo
-000111a0: 7765 725f 666f 7265 6361 7374 203d 2070  wer_forecast = p
-000111b0: 642e 636f 6e63 6174 280d 0a20 2020 2020  d.concat(..     
-000111c0: 2020 2020 2020 2020 2020 205b 0d0a 2020             [..  
-000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111e0: 2020 7365 6c66 2e74 6f5f 6f72 6967 696e    self.to_origin
-000111f0: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
-00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011210: 2064 665f 666f 7265 6361 7374 2e6c 6f77   df_forecast.low
-00011220: 6572 5f66 6f72 6563 6173 742e 6865 6164  er_forecast.head
-00011230: 2868 646e 292c 0d0a 2020 2020 2020 2020  (hdn),..        
-00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011250: 7472 616e 735f 6d65 7468 6f64 3d27 6f72  trans_method='or
-00011260: 6967 696e 616c 272c 0d0a 2020 2020 2020  iginal',..      
+00011160: 2020 2020 2020 7472 616e 735f 6d65 7468        trans_meth
+00011170: 6f64 3d27 666f 7265 6361 7374 272c 0d0a  od='forecast',..
+00011180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011190: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+000111a0: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+000111b0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000111c0: 2020 2020 2020 6466 5f66 6f72 6563 6173        df_forecas
+000111d0: 742e 6c6f 7765 725f 666f 7265 6361 7374  t.lower_forecast
+000111e0: 203d 2070 642e 636f 6e63 6174 280d 0a20   = pd.concat(.. 
+000111f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00011200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011210: 2020 2020 2020 7365 6c66 2e74 6f5f 6f72        self.to_or
+00011220: 6967 696e 5f73 7061 6365 280d 0a20 2020  igin_space(..   
+00011230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011240: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00011250: 2e6c 6f77 6572 5f66 6f72 6563 6173 742e  .lower_forecast.
+00011260: 6865 6164 2868 646e 292c 0d0a 2020 2020  head(hdn),..    
 00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011280: 2020 626f 756e 6473 3d54 7275 652c 0d0a    bounds=True,..
-00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-000112b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000112c0: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
-000112d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000112e0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
-000112f0: 7265 6361 7374 2e6c 6f77 6572 5f66 6f72  recast.lower_for
-00011300: 6563 6173 742e 7461 696c 2866 6f72 6563  ecast.tail(forec
-00011310: 6173 745f 6c65 6e67 7468 292c 0d0a 2020  ast_length),..  
-00011320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011330: 2020 2020 2020 7472 616e 735f 6d65 7468        trans_meth
-00011340: 6f64 3d27 666f 7265 6361 7374 272c 0d0a  od='forecast',..
-00011350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011360: 2020 2020 2020 2020 626f 756e 6473 3d54          bounds=T
-00011370: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-00011380: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
-00011390: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
-000113a0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-000113b0: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
-000113c0: 6f72 6563 6173 742e 7570 7065 725f 666f  orecast.upper_fo
-000113d0: 7265 6361 7374 203d 2070 642e 636f 6e63  recast = pd.conc
-000113e0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
-000113f0: 2020 2020 205b 0d0a 2020 2020 2020 2020       [..        
-00011400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011410: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
-00011420: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00011430: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
-00011440: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
-00011450: 6563 6173 742e 6865 6164 2868 646e 292c  ecast.head(hdn),
-00011460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011470: 2020 2020 2020 2020 2020 7472 616e 735f            trans_
-00011480: 6d65 7468 6f64 3d27 6f72 6967 696e 616c  method='original
-00011490: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-000114a0: 2020 2020 2020 2020 2020 2020 626f 756e              boun
-000114b0: 6473 3d54 7275 652c 0d0a 2020 2020 2020  ds=True,..      
-000114c0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-000114d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000114e0: 2020 2020 2020 7365 6c66 2e74 6f5f 6f72        self.to_or
-000114f0: 6967 696e 5f73 7061 6365 280d 0a20 2020  igin_space(..   
-00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011510: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
-00011520: 2e75 7070 6572 5f66 6f72 6563 6173 742e  .upper_forecast.
-00011530: 7461 696c 2866 6f72 6563 6173 745f 6c65  tail(forecast_le
-00011540: 6e67 7468 292c 0d0a 2020 2020 2020 2020  ngth),..        
-00011550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011560: 7472 616e 735f 6d65 7468 6f64 3d27 666f  trans_method='fo
-00011570: 7265 6361 7374 272c 0d0a 2020 2020 2020  recast',..      
+00011280: 2020 2020 7472 616e 735f 6d65 7468 6f64      trans_method
+00011290: 3d27 6f72 6967 696e 616c 272c 0d0a 2020  ='original',..  
+000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112b0: 2020 2020 2020 626f 756e 6473 3d54 7275        bounds=Tru
+000112c0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000112d0: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
+000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112f0: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00011300: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00011310: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011320: 665f 666f 7265 6361 7374 2e6c 6f77 6572  f_forecast.lower
+00011330: 5f66 6f72 6563 6173 742e 7461 696c 2866  _forecast.tail(f
+00011340: 6f72 6563 6173 745f 6c65 6e67 7468 292c  orecast_length),
+00011350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011360: 2020 2020 2020 2020 2020 7472 616e 735f            trans_
+00011370: 6d65 7468 6f64 3d27 666f 7265 6361 7374  method='forecast
+00011380: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00011390: 2020 2020 2020 2020 2020 2020 626f 756e              boun
+000113a0: 6473 3d54 7275 652c 0d0a 2020 2020 2020  ds=True,..      
+000113b0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+000113c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000113d0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+000113e0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+000113f0: 6466 5f66 6f72 6563 6173 742e 7570 7065  df_forecast.uppe
+00011400: 725f 666f 7265 6361 7374 203d 2070 642e  r_forecast = pd.
+00011410: 636f 6e63 6174 280d 0a20 2020 2020 2020  concat(..       
+00011420: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
+00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011440: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00011450: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00011460: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011470: 665f 666f 7265 6361 7374 2e75 7070 6572  f_forecast.upper
+00011480: 5f66 6f72 6563 6173 742e 6865 6164 2868  _forecast.head(h
+00011490: 646e 292c 0d0a 2020 2020 2020 2020 2020  dn),..          
+000114a0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000114b0: 616e 735f 6d65 7468 6f64 3d27 6f72 6967  ans_method='orig
+000114c0: 696e 616c 272c 0d0a 2020 2020 2020 2020  inal',..        
+000114d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114e0: 626f 756e 6473 3d54 7275 652c 0d0a 2020  bounds=True,..  
+000114f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011500: 2020 292c 0d0a 2020 2020 2020 2020 2020    ),..          
+00011510: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00011520: 6f5f 6f72 6967 696e 5f73 7061 6365 280d  o_origin_space(.
+00011530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011540: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00011550: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
+00011560: 6173 742e 7461 696c 2866 6f72 6563 6173  ast.tail(forecas
+00011570: 745f 6c65 6e67 7468 292c 0d0a 2020 2020  t_length),..    
 00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011590: 2020 626f 756e 6473 3d54 7275 652c 0d0a    bounds=True,..
-000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115b0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-000115c0: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
-000115d0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000115e0: 2020 2020 2020 7365 6c66 2e70 7265 6469        self.predi
-000115f0: 6374 6564 5f74 7265 6e64 203d 2070 642e  cted_trend = pd.
-00011600: 636f 6e63 6174 280d 0a20 2020 2020 2020  concat(..       
-00011610: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
-00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
-00011640: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
-00011650: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00011660: 7265 6e64 5f66 6f72 6563 6173 742e 666f  rend_forecast.fo
-00011670: 7265 6361 7374 2e68 6561 6428 6864 6e29  recast.head(hdn)
-00011680: 2c20 7472 616e 735f 6d65 7468 6f64 3d27  , trans_method='
-00011690: 6f72 6967 696e 616c 270d 0a20 2020 2020  original'..     
-000116a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000116b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000116c0: 2020 2020 2020 2073 656c 662e 746f 5f6f         self.to_o
-000116d0: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
-000116e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116f0: 2020 2020 2020 7472 656e 645f 666f 7265        trend_fore
-00011700: 6361 7374 2e66 6f72 6563 6173 742e 7461  cast.forecast.ta
-00011710: 696c 2866 6f72 6563 6173 745f 6c65 6e67  il(forecast_leng
-00011720: 7468 292c 0d0a 2020 2020 2020 2020 2020  th),..          
-00011730: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00011740: 616e 735f 6d65 7468 6f64 3d27 666f 7265  ans_method='fore
-00011750: 6361 7374 272c 0d0a 2020 2020 2020 2020  cast',..        
-00011760: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
-00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 5d0d 0a20 2020 2020 2020 2020 2020 2029  ]..            )
-00011790: 0d0a 0d0a 2020 2020 2020 2020 2320 7570  ....        # up
-000117a0: 6461 7465 2074 7265 6e64 2061 6e61 6c79  date trend analy
-000117b0: 7369 7320 6261 7365 6420 6f6e 2074 7265  sis based on tre
-000117c0: 6e64 2066 6f72 6563 6173 7420 6173 2077  nd forecast as w
-000117d0: 656c 6c0d 0a20 2020 2020 2020 2069 6620  ell..        if 
-000117e0: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
-000117f0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00011800: 696e 636c 7564 655f 6869 7374 6f72 793a  include_history:
-00011810: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00011820: 656e 645f 706f 7374 6572 696f 722c 2073  end_posterior, s
-00011830: 656c 662e 736c 6f70 652c 2069 6e74 6572  elf.slope, inter
-00011840: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
-00011850: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
-00011860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011870: 2e70 7265 6469 6374 6564 5f74 7265 6e64  .predicted_trend
-00011880: 2c20 6e70 2e61 7272 6179 2873 656c 662e  , np.array(self.
-00011890: 745f 7072 6564 6963 7429 0d0a 2020 2020  t_predict)..    
-000118a0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000118b0: 2020 2020 2020 2028 0d0a 2020 2020 2020         (..      
-000118c0: 2020 2020 2020 2020 2020 7365 6c66 2e7a            self.z
-000118d0: 6572 6f5f 6372 6f73 7369 6e67 732c 0d0a  ero_crossings,..
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 7365 6c66 2e63 6861 6e67 6570 6f69 6e74  self.changepoint
-00011900: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00011910: 2020 2020 7365 6c66 2e73 6c6f 7065 5f73      self.slope_s
-00011920: 6967 6e2c 0d0a 2020 2020 2020 2020 2020  ign,..          
-00011930: 2020 2020 2020 7365 6c66 2e61 6363 656c        self.accel
-00011940: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-00011950: 203d 2073 656c 662e 616e 616c 797a 655f   = self.analyze_
-00011960: 7472 656e 6428 7365 6c66 2e73 6c6f 7065  trend(self.slope
-00011970: 2c20 696e 6465 783d 7365 6c66 2e70 7265  , index=self.pre
-00011980: 6469 6374 6564 5f74 7265 6e64 2e69 6e64  dicted_trend.ind
-00011990: 6578 290d 0a0d 0a20 2020 2020 2020 2023  ex)....        #
-000119a0: 2064 6f6e 2774 2066 6f72 6765 7420 746f   don't forget to
-000119b0: 2061 6464 2069 6e20 7061 7374 5f69 6d70   add in past_imp
-000119c0: 6163 7473 2028 7573 6520 6675 7475 7265  acts (use future
-000119d0: 2069 6d70 6163 7473 2061 6761 696e 3f29   impacts again?)
-000119e0: 2041 4654 4552 2075 6e73 6361 6c69 6e67   AFTER unscaling
-000119f0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00011a00: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
-00011a10: 6e74 6572 7665 6e74 696f 6e20 213d 2022  ntervention != "
-00011a20: 7265 6772 6573 736f 7222 3a0d 0a20 2020  regressor":..   
-00011a30: 2020 2020 2020 2020 2069 6620 6675 7475           if futu
-00011a40: 7265 5f69 6d70 6163 7473 2069 7320 6e6f  re_impacts is no
-00011a50: 7420 4e6f 6e65 2061 6e64 2073 656c 662e  t None and self.
-00011a60: 7061 7374 5f69 6d70 6163 7473 2069 7320  past_impacts is 
-00011a70: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00011a80: 2020 2020 2020 2070 6173 745f 696d 7061         past_impa
-00011a90: 6374 7320 3d20 7064 2e44 6174 6146 7261  cts = pd.DataFra
-00011aa0: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
-00011ab0: 2020 2020 2020 2020 2030 2c20 696e 6465           0, inde
-00011ac0: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
-00011ad0: 2063 6f6c 756d 6e73 3d73 656c 662e 6466   columns=self.df
-00011ae0: 2e63 6f6c 756d 6e73 0d0a 2020 2020 2020  .columns..      
-00011af0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00011b00: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b20: 7061 7374 5f69 6d70 6163 7473 203d 2073  past_impacts = s
-00011b30: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
-00011b40: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00011b50: 726f 6c6c 2066 6f72 7761 7264 2074 6169  roll forward tai
-00011b60: 6c20 6f66 2070 6173 7420 696d 7061 6374  l of past impact
-00011b70: 732c 2061 7373 756d 696e 6720 6974 2063  s, assuming it c
-00011b80: 6f6e 7469 6e75 6573 0d0a 2020 2020 2020  ontinues..      
-00011b90: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
-00011ba0: 7374 5f69 6d70 6163 7473 2069 7320 6e6f  st_impacts is no
-00011bb0: 7420 4e6f 6e65 2061 6e64 2066 6f72 6563  t None and forec
-00011bc0: 6173 745f 6c65 6e67 7468 2069 7320 6e6f  ast_length is no
-00011bd0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00011be0: 2020 2020 2020 2020 2066 7574 7572 655f           future_
-00011bf0: 696d 7074 7320 3d20 7064 2e44 6174 6146  impts = pd.DataF
-00011c00: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
-00011c10: 2020 2020 2020 2020 2020 206e 702e 7265             np.re
-00011c20: 7065 6174 280d 0a20 2020 2020 2020 2020  peat(..         
-00011c30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00011c40: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
-00011c50: 2e69 6c6f 635b 2d31 3a5d 2e74 6f5f 6e75  .iloc[-1:].to_nu
-00011c60: 6d70 7928 292c 2066 6f72 6563 6173 745f  mpy(), forecast_
-00011c70: 6c65 6e67 7468 2c20 6178 6973 3d30 0d0a  length, axis=0..
-00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c90: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-00011ca0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-00011cb0: 783d 6466 5f66 6f72 6563 6173 742e 666f  x=df_forecast.fo
-00011cc0: 7265 6361 7374 2e69 6e64 6578 5b2d 666f  recast.index[-fo
-00011cd0: 7265 6361 7374 5f6c 656e 6774 683a 5d2c  recast_length:],
-00011ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011cf0: 2020 2020 2020 636f 6c75 6d6e 733d 7365        columns=se
-00011d00: 6c66 2e70 6173 745f 696d 7061 6374 732e  lf.past_impacts.
-00011d10: 636f 6c75 6d6e 732c 0d0a 2020 2020 2020  columns,..      
-00011d20: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00011d30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011d40: 6675 7475 7265 5f69 6d70 6163 7473 2069  future_impacts i
-00011d50: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d70: 2066 7574 7572 655f 696d 7074 7320 3d20   future_impts = 
-00011d80: 6675 7475 7265 5f69 6d70 7473 202b 2066  future_impts + f
-00011d90: 7574 7572 655f 696d 7061 6374 730d 0a20  uture_impacts.. 
-00011da0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00011db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011dc0: 2020 6675 7475 7265 5f69 6d70 7473 203d    future_impts =
-00011dd0: 2070 642e 4461 7461 4672 616d 6528 290d   pd.DataFrame().
-00011de0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011df0: 7365 6c66 2e70 6173 745f 696d 7061 6374  self.past_impact
-00011e00: 7320 6973 206e 6f74 204e 6f6e 6520 6f72  s is not None or
-00011e10: 2066 7574 7572 655f 696d 7061 6374 7320   future_impacts 
-00011e20: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00011e30: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00011e40: 7074 7320 3d20 3120 2b20 7064 2e63 6f6e  pts = 1 + pd.con
-00011e50: 6361 7428 5b70 6173 745f 696d 7061 6374  cat([past_impact
-00011e60: 732c 2066 7574 7572 655f 696d 7074 735d  s, future_impts]
-00011e70: 2c20 6178 6973 3d30 292e 7265 696e 6465  , axis=0).reinde
-00011e80: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-00011e90: 2020 2020 2020 2020 696e 6465 783d 6466          index=df
-00011ea0: 5f66 6f72 6563 6173 742e 666f 7265 6361  _forecast.foreca
-00011eb0: 7374 2e69 6e64 6578 2c0d 0a20 2020 2020  st.index,..     
-00011ec0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00011ed0: 6f6c 756d 6e73 3d64 665f 666f 7265 6361  olumns=df_foreca
-00011ee0: 7374 2e66 6f72 6563 6173 742e 636f 6c75  st.forecast.colu
-00011ef0: 6d6e 732c 0d0a 2020 2020 2020 2020 2020  mns,..          
-00011f00: 2020 2020 2020 2020 2020 6669 6c6c 5f76            fill_v
-00011f10: 616c 7565 3d31 2c0d 0a20 2020 2020 2020  alue=1,..       
-00011f20: 2020 2020 2020 2020 2029 2020 2320 6d69           )  # mi
-00011f30: 6e75 7320 6f72 2070 6c75 730d 0a20 2020  nus or plus..   
-00011f40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011f50: 662e 696d 7061 6374 7320 3d20 696d 7074  f.impacts = impt
-00011f60: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00011f70: 2020 2069 6620 696e 636c 7564 655f 6f72     if include_or
-00011f80: 6761 6e69 633a 0d0a 2020 2020 2020 2020  ganic:..        
-00011f90: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
-00011fa0: 6f72 6563 6173 742e 6f72 6761 6e69 635f  orecast.organic_
-00011fb0: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+00011590: 2020 2020 7472 616e 735f 6d65 7468 6f64      trans_method
+000115a0: 3d27 666f 7265 6361 7374 272c 0d0a 2020  ='forecast',..  
+000115b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115c0: 2020 2020 2020 626f 756e 6473 3d54 7275        bounds=Tru
+000115d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000115e0: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
+000115f0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+00011600: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00011610: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00011620: 7265 6469 6374 6564 5f74 7265 6e64 203d  redicted_trend =
+00011630: 2070 642e 636f 6e63 6174 280d 0a20 2020   pd.concat(..   
+00011640: 2020 2020 2020 2020 2020 2020 205b 0d0a               [..
+00011650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011660: 2020 2020 7365 6c66 2e74 6f5f 6f72 6967      self.to_orig
+00011670: 696e 5f73 7061 6365 280d 0a20 2020 2020  in_space(..     
+00011680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011690: 2020 2074 7265 6e64 5f66 6f72 6563 6173     trend_forecas
+000116a0: 742e 666f 7265 6361 7374 2e68 6561 6428  t.forecast.head(
+000116b0: 6864 6e29 2c20 7472 616e 735f 6d65 7468  hdn), trans_meth
+000116c0: 6f64 3d27 6f72 6967 696e 616c 270d 0a20  od='original'.. 
+000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116e0: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+000116f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011700: 746f 5f6f 7269 6769 6e5f 7370 6163 6528  to_origin_space(
+00011710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011720: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+00011730: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+00011740: 742e 7461 696c 2866 6f72 6563 6173 745f  t.tail(forecast_
+00011750: 6c65 6e67 7468 292c 0d0a 2020 2020 2020  length),..      
+00011760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011770: 2020 7472 616e 735f 6d65 7468 6f64 3d27    trans_method='
+00011780: 666f 7265 6361 7374 272c 0d0a 2020 2020  forecast',..    
+00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117a0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000117b0: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
+000117c0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+000117d0: 2320 7570 6461 7465 2074 7265 6e64 2061  # update trend a
+000117e0: 6e61 6c79 7369 7320 6261 7365 6420 6f6e  nalysis based on
+000117f0: 2074 7265 6e64 2066 6f72 6563 6173 7420   trend forecast 
+00011800: 6173 2077 656c 6c0d 0a20 2020 2020 2020  as well..       
+00011810: 2069 6620 666f 7265 6361 7374 5f6c 656e   if forecast_len
+00011820: 6774 6820 6973 206e 6f74 204e 6f6e 6520  gth is not None 
+00011830: 616e 6420 696e 636c 7564 655f 6869 7374  and include_hist
+00011840: 6f72 793a 0d0a 2020 2020 2020 2020 2020  ory:..          
+00011850: 2020 7472 656e 645f 706f 7374 6572 696f    trend_posterio
+00011860: 722c 2073 656c 662e 736c 6f70 652c 2069  r, self.slope, i
+00011870: 6e74 6572 6365 7074 203d 2073 656c 662e  ntercept = self.
+00011880: 726f 6c6c 696e 675f 7472 656e 6428 0d0a  rolling_trend(..
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 7365 6c66 2e70 7265 6469 6374 6564 5f74  self.predicted_t
+000118b0: 7265 6e64 2c20 6e70 2e61 7272 6179 2873  rend, np.array(s
+000118c0: 656c 662e 745f 7072 6564 6963 7429 0d0a  elf.t_predict)..
+000118d0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000118e0: 2020 2020 2020 2020 2020 2028 0d0a 2020             (..  
+000118f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00011900: 6c66 2e7a 6572 6f5f 6372 6f73 7369 6e67  lf.zero_crossing
+00011910: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00011920: 2020 2020 7365 6c66 2e63 6861 6e67 6570      self.changep
+00011930: 6f69 6e74 732c 0d0a 2020 2020 2020 2020  oints,..        
+00011940: 2020 2020 2020 2020 7365 6c66 2e73 6c6f          self.slo
+00011950: 7065 5f73 6967 6e2c 0d0a 2020 2020 2020  pe_sign,..      
+00011960: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00011970: 6363 656c 2c0d 0a20 2020 2020 2020 2020  ccel,..         
+00011980: 2020 2029 203d 2073 656c 662e 616e 616c     ) = self.anal
+00011990: 797a 655f 7472 656e 6428 7365 6c66 2e73  yze_trend(self.s
+000119a0: 6c6f 7065 2c20 696e 6465 783d 7365 6c66  lope, index=self
+000119b0: 2e70 7265 6469 6374 6564 5f74 7265 6e64  .predicted_trend
+000119c0: 2e69 6e64 6578 290d 0a0d 0a20 2020 2020  .index)....     
+000119d0: 2020 2023 2064 6f6e 2774 2066 6f72 6765     # don't forge
+000119e0: 7420 746f 2061 6464 2069 6e20 7061 7374  t to add in past
+000119f0: 5f69 6d70 6163 7473 2028 7573 6520 6675  _impacts (use fu
+00011a00: 7475 7265 2069 6d70 6163 7473 2061 6761  ture impacts aga
+00011a10: 696e 3f29 2041 4654 4552 2075 6e73 6361  in?) AFTER unsca
+00011a20: 6c69 6e67 0d0a 2020 2020 2020 2020 6966  ling..        if
+00011a30: 2073 656c 662e 7061 7374 5f69 6d70 6163   self.past_impac
+00011a40: 7473 5f69 6e74 6572 7665 6e74 696f 6e20  ts_intervention 
+00011a50: 213d 2022 7265 6772 6573 736f 7222 3a0d  != "regressor":.
+00011a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011a70: 6675 7475 7265 5f69 6d70 6163 7473 2069  future_impacts i
+00011a80: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+00011a90: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
+00011aa0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00011ab0: 2020 2020 2020 2020 2020 2070 6173 745f             past_
+00011ac0: 696d 7061 6374 7320 3d20 7064 2e44 6174  impacts = pd.Dat
+00011ad0: 6146 7261 6d65 280d 0a20 2020 2020 2020  aFrame(..       
+00011ae0: 2020 2020 2020 2020 2020 2020 2030 2c20               0, 
+00011af0: 696e 6465 783d 7365 6c66 2e64 662e 696e  index=self.df.in
+00011b00: 6465 782c 2063 6f6c 756d 6e73 3d73 656c  dex, columns=sel
+00011b10: 662e 6466 2e63 6f6c 756d 6e73 0d0a 2020  f.df.columns..  
+00011b20: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00011b30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00011b40: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00011b50: 2020 2020 7061 7374 5f69 6d70 6163 7473      past_impacts
+00011b60: 203d 2073 656c 662e 7061 7374 5f69 6d70   = self.past_imp
+00011b70: 6163 7473 0d0a 2020 2020 2020 2020 2020  acts..          
+00011b80: 2020 2320 726f 6c6c 2066 6f72 7761 7264    # roll forward
+00011b90: 2074 6169 6c20 6f66 2070 6173 7420 696d   tail of past im
+00011ba0: 7061 6374 732c 2061 7373 756d 696e 6720  pacts, assuming 
+00011bb0: 6974 2063 6f6e 7469 6e75 6573 0d0a 2020  it continues..  
+00011bc0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00011bd0: 662e 7061 7374 5f69 6d70 6163 7473 2069  f.past_impacts i
+00011be0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2066  s not None and f
+00011bf0: 6f72 6563 6173 745f 6c65 6e67 7468 2069  orecast_length i
+00011c00: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00011c10: 2020 2020 2020 2020 2020 2020 2066 7574               fut
+00011c20: 7572 655f 696d 7074 7320 3d20 7064 2e44  ure_impts = pd.D
+00011c30: 6174 6146 7261 6d65 280d 0a20 2020 2020  ataFrame(..     
+00011c40: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00011c50: 702e 7265 7065 6174 280d 0a20 2020 2020  p.repeat(..     
+00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c70: 2020 2073 656c 662e 7061 7374 5f69 6d70     self.past_imp
+00011c80: 6163 7473 2e69 6c6f 635b 2d31 3a5d 2e74  acts.iloc[-1:].t
+00011c90: 6f5f 6e75 6d70 7928 292c 2066 6f72 6563  o_numpy(), forec
+00011ca0: 6173 745f 6c65 6e67 7468 2c20 6178 6973  ast_length, axis
+00011cb0: 3d30 0d0a 2020 2020 2020 2020 2020 2020  =0..            
+00011cc0: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
+00011cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ce0: 696e 6465 783d 6466 5f66 6f72 6563 6173  index=df_forecas
+00011cf0: 742e 666f 7265 6361 7374 2e69 6e64 6578  t.forecast.index
+00011d00: 5b2d 666f 7265 6361 7374 5f6c 656e 6774  [-forecast_lengt
+00011d10: 683a 5d2c 0d0a 2020 2020 2020 2020 2020  h:],..          
+00011d20: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+00011d30: 733d 7365 6c66 2e70 6173 745f 696d 7061  s=self.past_impa
+00011d40: 6374 732e 636f 6c75 6d6e 732c 0d0a 2020  cts.columns,..  
+00011d50: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00011d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d70: 2069 6620 6675 7475 7265 5f69 6d70 6163   if future_impac
+00011d80: 7473 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ts is not None:.
+00011d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011da0: 2020 2020 2066 7574 7572 655f 696d 7074       future_impt
+00011db0: 7320 3d20 6675 7475 7265 5f69 6d70 7473  s = future_impts
+00011dc0: 202b 2066 7574 7572 655f 696d 7061 6374   + future_impact
+00011dd0: 730d 0a20 2020 2020 2020 2020 2020 2065  s..            e
+00011de0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00011df0: 2020 2020 2020 6675 7475 7265 5f69 6d70        future_imp
+00011e00: 7473 203d 2070 642e 4461 7461 4672 616d  ts = pd.DataFram
+00011e10: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+00011e20: 2069 6620 7365 6c66 2e70 6173 745f 696d   if self.past_im
+00011e30: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
+00011e40: 6520 6f72 2066 7574 7572 655f 696d 7061  e or future_impa
+00011e50: 6374 7320 6973 206e 6f74 204e 6f6e 653a  cts is not None:
+00011e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011e70: 2020 696d 7074 7320 3d20 3120 2b20 280d    impts = 1 + (.
+00011e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e90: 2020 2020 2070 642e 636f 6e63 6174 280d       pd.concat(.
+00011ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011eb0: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
+00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ed0: 2020 2020 2020 2020 7061 7374 5f69 6d70          past_imp
+00011ee0: 6163 7473 2c0d 0a20 2020 2020 2020 2020  acts,..         
+00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f00: 2020 2066 7574 7572 655f 696d 7074 735b     future_impts[
+00011f10: 7e66 7574 7572 655f 696d 7074 732e 696e  ~future_impts.in
+00011f20: 6465 782e 6973 696e 2870 6173 745f 696d  dex.isin(past_im
+00011f30: 7061 6374 732e 696e 6465 7829 5d2c 0d0a  pacts.index)],..
+00011f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f50: 2020 2020 2020 2020 5d2c 0d0a 2020 2020          ],..    
+00011f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f70: 2020 2020 6178 6973 3d30 2c0d 0a20 2020      axis=0,..   
+00011f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f90: 2029 2e72 6569 6e64 6578 280d 0a20 2020   ).reindex(..   
+00011fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fb0: 2020 2020 2069 6e64 6578 3d64 665f 666f       index=df_fo
 00011fc0: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
-00011fd0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00011fe0: 2020 2020 2020 2020 6466 5f66 6f72 6563          df_forec
-00011ff0: 6173 742e 666f 7265 6361 7374 203d 2064  ast.forecast = d
-00012000: 665f 666f 7265 6361 7374 2e66 6f72 6563  f_forecast.forec
-00012010: 6173 7420 2a20 696d 7074 730d 0a20 2020  ast * impts..   
-00012020: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-00012030: 666f 7265 6361 7374 2e6c 6f77 6572 5f66  forecast.lower_f
-00012040: 6f72 6563 6173 7420 3d20 6466 5f66 6f72  orecast = df_for
-00012050: 6563 6173 742e 6c6f 7765 725f 666f 7265  ecast.lower_fore
-00012060: 6361 7374 202a 2069 6d70 7473 0d0a 2020  cast * impts..  
-00012070: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00012080: 5f66 6f72 6563 6173 742e 7570 7065 725f  _forecast.upper_
-00012090: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
-000120a0: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
-000120b0: 6563 6173 7420 2a20 696d 7074 730d 0a0d  ecast * impts...
-000120c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000120d0: 2e63 6f6e 7374 7261 696e 7420 6973 206e  .constraint is n
-000120e0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-000120f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00012100: 6e63 6528 7365 6c66 2e63 6f6e 7374 7261  nce(self.constra
-00012110: 696e 742c 2064 6963 7429 3a0d 0a20 2020  int, dict):..   
-00012120: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00012130: 7374 7261 696e 745f 6d65 7468 6f64 203d  straint_method =
-00012140: 2073 656c 662e 636f 6e73 7472 6169 6e74   self.constraint
-00012150: 2e67 6574 2822 636f 6e73 7472 6169 6e74  .get("constraint
-00012160: 5f6d 6574 686f 6422 2c20 2271 7561 6e74  _method", "quant
-00012170: 696c 6522 290d 0a20 2020 2020 2020 2020  ile")..         
-00012180: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
-00012190: 745f 7265 6775 6c61 7269 7a61 7469 6f6e  t_regularization
-000121a0: 203d 2073 656c 662e 636f 6e73 7472 6169   = self.constrai
-000121b0: 6e74 2e67 6574 280d 0a20 2020 2020 2020  nt.get(..       
-000121c0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-000121d0: 6e73 7472 6169 6e74 5f72 6567 756c 6172  nstraint_regular
-000121e0: 697a 6174 696f 6e22 2c20 310d 0a20 2020  ization", 1..   
-000121f0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012210: 6c6f 7765 725f 636f 6e73 7472 6169 6e74  lower_constraint
-00012220: 203d 2073 656c 662e 636f 6e73 7472 6169   = self.constrai
-00012230: 6e74 2e67 6574 2822 6c6f 7765 725f 636f  nt.get("lower_co
-00012240: 6e73 7472 6169 6e74 222c 2030 290d 0a20  nstraint", 0).. 
-00012250: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00012260: 7070 6572 5f63 6f6e 7374 7261 696e 7420  pper_constraint 
-00012270: 3d20 7365 6c66 2e63 6f6e 7374 7261 696e  = self.constrain
-00012280: 742e 6765 7428 2275 7070 6572 5f63 6f6e  t.get("upper_con
-00012290: 7374 7261 696e 7422 2c20 3129 0d0a 2020  straint", 1)..  
-000122a0: 2020 2020 2020 2020 2020 2020 2020 626f                bo
-000122b0: 756e 6473 203d 2073 656c 662e 636f 6e73  unds = self.cons
-000122c0: 7472 6169 6e74 2e67 6574 2822 626f 756e  traint.get("boun
-000122d0: 6473 222c 2046 616c 7365 290d 0a20 2020  ds", False)..   
-000122e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-000122f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012300: 636f 6e73 7472 6169 6e74 5f6d 6574 686f  constraint_metho
-00012310: 6420 3d20 2273 7464 6576 5f6d 696e 220d  d = "stdev_min".
-00012320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012330: 206c 6f77 6572 5f63 6f6e 7374 7261 696e   lower_constrain
-00012340: 7420 3d20 666c 6f61 7428 7365 6c66 2e63  t = float(self.c
-00012350: 6f6e 7374 7261 696e 7429 0d0a 2020 2020  onstraint)..    
-00012360: 2020 2020 2020 2020 2020 2020 7570 7065              uppe
-00012370: 725f 636f 6e73 7472 6169 6e74 203d 2066  r_constraint = f
-00012380: 6c6f 6174 2873 656c 662e 636f 6e73 7472  loat(self.constr
-00012390: 6169 6e74 290d 0a20 2020 2020 2020 2020  aint)..         
-000123a0: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
-000123b0: 745f 7265 6775 6c61 7269 7a61 7469 6f6e  t_regularization
-000123c0: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
-000123d0: 2020 2020 2020 626f 756e 6473 203d 2046        bounds = F
-000123e0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-000123f0: 2020 6966 2073 656c 662e 7665 7262 6f73    if self.verbos
-00012400: 6520 3e3d 2033 3a0d 0a20 2020 2020 2020  e >= 3:..       
-00012410: 2020 2020 2020 2020 2070 7269 6e74 280d           print(.
-00012420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012430: 2020 2020 2066 2255 7369 6e67 2063 6f6e       f"Using con
-00012440: 7374 7261 696e 7420 7769 7468 206d 6574  straint with met
-00012450: 686f 643a 207b 636f 6e73 7472 6169 6e74  hod: {constraint
-00012460: 5f6d 6574 686f 647d 2c20 7b63 6f6e 7374  _method}, {const
-00012470: 7261 696e 745f 7265 6775 6c61 7269 7a61  raint_regulariza
-00012480: 7469 6f6e 7d2c 207b 6c6f 7765 725f 636f  tion}, {lower_co
-00012490: 6e73 7472 6169 6e74 7d2c 207b 7570 7065  nstraint}, {uppe
-000124a0: 725f 636f 6e73 7472 6169 6e74 7d2c 207b  r_constraint}, {
-000124b0: 626f 756e 6473 7d22 0d0a 2020 2020 2020  bounds}"..      
-000124c0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
-000124d0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
-000124e0: 7265 6361 7374 203d 2064 665f 666f 7265  recast = df_fore
-000124f0: 6361 7374 2e61 7070 6c79 5f63 6f6e 7374  cast.apply_const
-00012500: 7261 696e 7473 280d 0a20 2020 2020 2020  raints(..       
-00012510: 2020 2020 2020 2020 2063 6f6e 7374 7261           constra
-00012520: 696e 745f 6d65 7468 6f64 2c0d 0a20 2020  int_method,..   
-00012530: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00012540: 7374 7261 696e 745f 7265 6775 6c61 7269  straint_regulari
-00012550: 7a61 7469 6f6e 2c0d 0a20 2020 2020 2020  zation,..       
-00012560: 2020 2020 2020 2020 2075 7070 6572 5f63           upper_c
-00012570: 6f6e 7374 7261 696e 742c 0d0a 2020 2020  onstraint,..    
-00012580: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-00012590: 725f 636f 6e73 7472 6169 6e74 2c0d 0a20  r_constraint,.. 
-000125a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000125b0: 6f75 6e64 732c 0d0a 2020 2020 2020 2020  ounds,..        
-000125c0: 2020 2020 2020 2020 7365 6c66 2e64 665f          self.df_
-000125d0: 6f72 6967 696e 616c 2c0d 0a20 2020 2020  original,..     
-000125e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000125f0: 2020 2320 5245 5455 524e 2043 4f4d 504f    # RETURN COMPO
-00012600: 4e45 4e54 5320 286c 6f6e 6720 7374 796c  NENTS (long styl
-00012610: 6529 206f 7074 696f 6e0d 0a20 2020 2020  e) option..     
-00012620: 2020 2064 665f 666f 7265 6361 7374 2e70     df_forecast.p
-00012630: 7265 6469 6374 5f72 756e 7469 6d65 203d  redict_runtime =
-00012640: 2073 656c 662e 7469 6d65 2829 202d 2070   self.time() - p
-00012650: 7265 6469 6374 5374 6172 7454 696d 650d  redictStartTime.
-00012660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012670: 6466 5f66 6f72 6563 6173 740d 0a0d 0a20  df_forecast.... 
-00012680: 2020 2064 6566 2061 7574 6f5f 6669 7428     def auto_fit(
-00012690: 7365 6c66 2c20 6466 2c20 7661 6c69 6461  self, df, valida
-000126a0: 7469 6f6e 5f6d 6574 686f 6429 3a20 2023  tion_method):  #
-000126b0: 2061 6c73 6f20 6164 6420 7265 6772 6573   also add regres
-000126c0: 736f 7220 696e 7075 740d 0a20 2020 2020  sor input..     
-000126d0: 2020 2023 206f 7074 696f 6e20 746f 2063     # option to c
-000126e0: 6f6d 706c 6574 656c 7920 736b 6970 2073  ompletely skip s
-000126f0: 6f6d 6520 7468 696e 6773 2028 616e 6f6d  ome things (anom
-00012700: 616c 6965 732c 2068 6f6c 6964 6179 2064  alies, holiday d
-00012710: 6574 6563 746f 722c 2061 7220 6c61 6773  etector, ar lags
-00012720: 290d 0a20 2020 2020 2020 2023 2072 756e  )..        # run
-00012730: 2063 726f 7373 2076 616c 6964 6174 696f   cross validatio
-00012740: 6e20 746f 2063 686f 6f73 650d 0a20 2020  n to choose..   
-00012750: 2020 2020 2023 2072 6574 7572 6e20 6d65       # return me
-00012760: 7472 6963 7320 6f66 2062 6573 7420 6d6f  trics of best mo
-00012770: 6465 6c2c 2073 6574 2062 6173 6520 7061  del, set base pa
-00012780: 7261 6d73 0d0a 2020 2020 2020 2020 7365  rams..        se
-00012790: 6c66 2e73 7461 7274 696e 675f 7061 7261  lf.starting_para
-000127a0: 6d73 203d 2073 656c 662e 6765 745f 7061  ms = self.get_pa
-000127b0: 7261 6d73 2829 0d0a 2020 2020 2020 2020  rams()..        
-000127c0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
-000127d0: 656e 7465 640d 0a0d 0a20 2020 2064 6566  ented....    def
-000127e0: 206e 6578 745f 6669 7428 7365 6c66 293a   next_fit(self):
-000127f0: 0d0a 2020 2020 2020 2020 2320 6f70 7469  ..        # opti
-00012800: 6f6e 2074 6f20 7072 696e 7420 6120 6772  on to print a gr
-00012810: 6170 6820 6f66 2065 6163 6820 7768 696c  aph of each whil
-00012820: 6520 676f 696e 6720 2872 756e 2061 6761  e going (run aga
-00012830: 696e 2075 6e74 696c 2079 6f75 2073 6565  in until you see
-00012840: 206f 6e65 2079 6f75 206c 696b 6529 0d0a   one you like)..
-00012850: 2020 2020 2020 2020 2320 6170 7065 6e64          # append
-00012860: 2074 6f20 616e 2069 6e74 6572 6e61 6c20   to an internal 
-00012870: 7265 636f 7264 2c20 7072 696e 7420 6e65  record, print ne
-00012880: 7720 7061 7261 6d73 0d0a 2020 2020 2020  w params..      
-00012890: 2020 2320 706c 6f74 3a20 3320 7374 6163    # plot: 3 stac
-000128a0: 6b65 642c 2069 6e20 7361 6d70 6c65 2c20  ked, in sample, 
-000128b0: 7468 656e 2065 6163 6820 7661 6c69 6461  then each valida
-000128c0: 7469 6f6e 0d0a 2020 2020 2020 2020 2320  tion..        # 
-000128d0: 6d61 7962 6520 7573 6520 6765 6e65 7469  maybe use geneti
-000128e0: 6320 6f70 7469 6d69 7a61 7469 6f6e 2069  c optimization i
-000128f0: 6620 7468 6973 2075 7365 6420 6166 7465  f this used afte
-00012900: 7220 6175 746f 5f66 6974 0d0a 2020 2020  r auto_fit..    
-00012910: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
-00012920: 706c 656d 656e 7465 640d 0a0d 0a20 2020  plemented....   
-00012930: 2064 6566 2063 726f 7373 5f76 616c 6964   def cross_valid
-00012940: 6174 6528 7365 6c66 2c20 6466 2c20 7661  ate(self, df, va
-00012950: 6c69 6461 7469 6f6e 5f6d 6574 686f 6429  lidation_method)
-00012960: 3a0d 0a20 2020 2020 2020 2023 2072 756e  :..        # run
-00012970: 206f 6e65 206d 6f64 656c 2061 6e64 2072   one model and r
-00012980: 6574 7572 6e20 7363 6f72 6573 0d0a 2020  eturn scores..  
-00012990: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
-000129a0: 496d 706c 656d 656e 7465 640d 0a0d 0a20  Implemented.... 
-000129b0: 2020 2064 6566 2074 7265 6174 6d65 6e74     def treatment
-000129c0: 5f63 6175 7361 6c5f 696d 7061 6374 280d  _causal_impact(.
-000129d0: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
-000129e0: 662c 2069 6e74 6572 7665 6e74 696f 6e5f  f, intervention_
-000129f0: 6461 7465 730d 0a20 2020 2029 3a20 2023  dates..    ):  #
-00012a00: 2061 6c73 6f20 6164 6420 7265 6772 6573   also add regres
-00012a10: 736f 7220 696e 7075 740d 0a20 2020 2020  sor input..     
-00012a20: 2020 2023 2072 6567 7265 7373 6f72 7320     # regressors 
-00012a30: 696d 706f 7274 616e 742c 2065 7374 696d  important, estim
-00012a40: 6174 696f 6e20 6279 206c 696e 6561 7220  ation by linear 
-00012a50: 666c 6167 2028 7265 7475 726e 2073 7461  flag (return sta
-00012a60: 7473 2920 6f72 2062 7920 2520 7673 2066  ts) or by % vs f
-00012a70: 6f72 6563 6173 7420 6672 6f6d 2063 7574  orecast from cut
-00012a80: 6f66 660d 0a20 2020 2020 2020 2023 2073  off..        # s
-00012a90: 7461 7274 2061 6e64 2065 6e64 2064 6174  tart and end dat
-00012aa0: 6573 2c20 6d75 6c74 6970 6c65 2074 7265  es, multiple tre
-00012ab0: 6174 6d65 6e74 732c 2076 6172 7920 6279  atments, vary by
-00012ac0: 2073 6572 6965 730d 0a20 2020 2020 2020   series..       
-00012ad0: 2023 206f 7220 6d61 7962 6520 696e 7374   # or maybe inst
-00012ae0: 6561 642c 206a 7573 7420 7265 7475 726e  ead, just return
-00012af0: 2074 6865 2073 7461 7473 2066 6f72 2061   the stats for a
-00012b00: 6c6c 2069 6e70 7574 2072 6567 7265 7373  ll input regress
-00012b10: 6f72 730d 0a20 2020 2020 2020 2023 2073  ors..        # s
-00012b20: 7469 6c6c 2077 6f72 6b69 6e67 206f 6e20  till working on 
-00012b30: 7468 6973 2c20 706f 7373 6962 6c79 206a  this, possibly j
-00012b40: 7573 7420 6874 7470 733a 2f2f 6d61 7468  ust https://math
-00012b50: 2e73 7461 636b 6578 6368 616e 6765 2e63  .stackexchange.c
-00012b60: 6f6d 2f71 7565 7374 696f 6e73 2f32 3131  om/questions/211
-00012b70: 3235 3533 2f73 7461 7469 7374 6963 616c  2553/statistical
-00012b80: 2d73 6967 6e69 6669 6361 6e63 652d 6f66  -significance-of
-00012b90: 2d6c 696e 6561 722d 6c65 6173 742d 7371  -linear-least-sq
-00012ba0: 7561 7265 730d 0a20 2020 2020 2020 2023  uares..        #
-00012bb0: 2061 6e64 206f 7468 6572 2066 6561 7475   and other featu
-00012bc0: 7265 7320 616c 6120 5374 6174 736d 6f64  res ala Statsmod
-00012bd0: 656c 7320 4f4c 532c 2056 6172 28ce b25e  els OLS, Var(..^
-00012be0: 293d cf83 3228 58e2 80b2 5829 e288 9231  )=..2(X...X)...1
-00012bf0: 2077 6865 7265 20cf 8332 3e30 2069 7320   where ..2>0 is 
-00012c00: 7468 6520 636f 6d6d 6f6e 2076 6172 6961  the common varia
-00012c10: 6e63 6520 6f66 2065 6163 6820 656c 656d  nce of each elem
-00012c20: 656e 7420 6f66 2074 6865 2065 7272 6f72  ent of the error
-00012c30: 2076 6563 746f 720d 0a20 2020 2020 2020   vector..       
-00012c40: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
-00012c50: 6d65 6e74 6564 0d0a 0d0a 2020 2020 6465  mented....    de
-00012c60: 6620 7072 6564 6963 745f 6e65 775f 7072  f predict_new_pr
-00012c70: 6f64 7563 7428 7365 6c66 293a 0d0a 2020  oduct(self):..  
-00012c80: 2020 2020 2020 2320 626f 7272 6f77 2074        # borrow t
-00012c90: 6865 206c 696e 6561 7220 636f 6d70 6f6e  he linear compon
-00012ca0: 656e 7473 2066 726f 6d20 6120 7265 6c61  ents from a rela
-00012cb0: 7465 6420 7072 6f64 7563 7420 286f 7220  ted product (or 
-00012cc0: 6176 672f 6d6f 6465 2069 6620 6e6f 7420  avg/mode if not 
-00012cd0: 6769 7665 6e29 0d0a 2020 2020 2020 2020  given)..        
-00012ce0: 2320 6861 7665 2074 6865 2074 7265 6e64  # have the trend
-00012cf0: 2073 7461 7274 2061 7420 7a65 726f 2074   start at zero t
-00012d00: 6865 6e20 7570 2c20 6c69 6b65 2072 6576  hen up, like rev
-00012d10: 6572 7365 2070 6869 0d0a 2020 2020 2020  erse phi..      
-00012d20: 2020 2320 706f 7373 6962 6c79 2062 6f72    # possibly bor
-00012d30: 726f 7720 7761 726d 7570 2066 726f 6d20  row warmup from 
-00012d40: 616e 7920 7365 7269 6573 2074 6861 7420  any series that 
-00012d50: 6861 7665 2061 206c 6f67 6973 7469 632d  have a logistic-
-00012d60: 6c69 6b65 2074 7265 6e64 0d0a 2020 2020  like trend..    
-00012d70: 2020 2020 2320 636c 7573 7465 7220 616e      # cluster an
-00012d80: 6420 6368 6f6f 7365 2074 6865 2062 6967  d choose the big
-00012d90: 6765 7374 2063 6c75 7374 6572 2028 6173  gest cluster (as
-00012da0: 2061 7667 2076 616c 7565 206e 6169 7665   avg value naive
-00012db0: 206d 6574 686f 642c 206d 6179 6265 2072   method, maybe r
-00012dc0: 6f75 6e64 206f 7220 6669 6c74 6572 2066  ound or filter f
-00012dd0: 6972 7374 290d 0a20 2020 2020 2020 2072  irst)..        r
-00012de0: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-00012df0: 6e74 6564 0d0a 0d0a 2020 2020 6465 6620  nted....    def 
-00012e00: 6665 6174 7572 655f 696d 706f 7274 616e  feature_importan
-00012e10: 6365 2873 656c 6629 3a0d 0a20 2020 2020  ce(self):..     
-00012e20: 2020 2023 2072 616e 6b20 636f 6566 6669     # rank coeffi
-00012e30: 6369 656e 7473 2062 7920 696d 706f 7274  cients by import
-00012e40: 616e 6365 0d0a 2020 2020 2020 2020 7265  ance..        re
-00012e50: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
-00012e60: 7465 640d 0a0d 0a20 2020 2064 6566 2063  ted....    def c
-00012e70: 6f6d 7061 7265 5f61 6374 7561 6c5f 636f  ompare_actual_co
-00012e80: 6d70 6f6e 656e 7473 2873 656c 6629 3a0d  mponents(self):.
-00012e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012ea0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
-00012eb0: 0d0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
-00012ec0: 775f 7061 7261 6d73 2873 656c 662c 206d  w_params(self, m
-00012ed0: 6574 686f 643d 2766 6173 7427 293a 0d0a  ethod='fast'):..
-00012ee0: 2020 2020 2020 2020 2320 6861 7665 2066          # have f
-00012ef0: 6173 7420 6f70 7469 6f6e 2074 6861 7420  ast option that 
-00012f00: 6176 6f69 6473 2061 6e79 206f 6620 7468  avoids any of th
-00012f10: 6520 6c6f 6f70 2061 7070 726f 6163 6865  e loop approache
-00012f20: 730d 0a20 2020 2020 2020 2073 6361 6c69  s..        scali
-00012f30: 6e67 203d 2072 616e 646f 6d2e 6368 6f69  ng = random.choi
-00012f40: 6365 7328 5b27 4261 7365 5363 616c 6572  ces(['BaseScaler
-00012f50: 272c 2027 6f74 6865 7227 5d2c 205b 302e  ', 'other'], [0.
-00012f60: 382c 2030 2e32 5d29 5b30 5d0d 0a20 2020  8, 0.2])[0]..   
-00012f70: 2020 2020 2069 6620 7363 616c 696e 6720       if scaling 
-00012f80: 3d3d 2022 6f74 6865 7222 3a0d 0a20 2020  == "other":..   
-00012f90: 2020 2020 2020 2020 2073 6361 6c69 6e67           scaling
-00012fa0: 203d 2052 616e 646f 6d54 7261 6e73 666f   = RandomTransfo
-00012fb0: 726d 280d 0a20 2020 2020 2020 2020 2020  rm(..           
-00012fc0: 2020 2020 2074 7261 6e73 666f 726d 6572       transformer
-00012fd0: 5f6c 6973 743d 7363 616c 6572 732c 0d0a  _list=scalers,..
-00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ff0: 7472 616e 7366 6f72 6d65 725f 6d61 785f  transformer_max_
-00013000: 6465 7074 683d 312c 0d0a 2020 2020 2020  depth=1,..      
-00013010: 2020 2020 2020 2020 2020 616c 6c6f 775f            allow_
-00013020: 6e6f 6e65 3d46 616c 7365 2c0d 0a20 2020  none=False,..   
-00013030: 2020 2020 2020 2020 2020 2020 206e 6f5f               no_
-00013040: 6e61 6e5f 6669 6c6c 3d54 7275 652c 0d0a  nan_fill=True,..
-00013050: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00013060: 2020 2020 2020 2068 6f6c 6964 6179 5f70         holiday_p
-00013070: 6172 616d 7320 3d20 7261 6e64 6f6d 2e63  arams = random.c
-00013080: 686f 6963 6573 285b 4e6f 6e65 2c20 2761  hoices([None, 'a
-00013090: 6e79 275d 2c20 5b30 2e35 2c20 302e 355d  ny'], [0.5, 0.5]
-000130a0: 295b 305d 0d0a 2020 2020 2020 2020 2320  )[0]..        # 
-000130b0: 686f 6c69 6461 795f 696e 7465 7276 656e  holiday_interven
-000130c0: 7469 6f6e 203d 204e 6f6e 650d 0a20 2020  tion = None..   
-000130d0: 2020 2020 2069 6620 686f 6c69 6461 795f       if holiday_
-000130e0: 7061 7261 6d73 2069 7320 6e6f 7420 4e6f  params is not No
-000130f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00013100: 2023 2068 6f6c 6964 6179 5f69 6e74 6572   # holiday_inter
-00013110: 7665 6e74 696f 6e20 3d20 7261 6e64 6f6d  vention = random
-00013120: 2e63 686f 6963 6528 5b27 6372 6561 7465  .choice(['create
-00013130: 5f66 6561 7475 7265 272c 2027 7573 655f  _feature', 'use_
-00013140: 696d 7061 6374 275d 290d 0a20 2020 2020  impact'])..     
-00013150: 2020 2020 2020 2068 6f6c 6964 6179 5f70         holiday_p
-00013160: 6172 616d 7320 3d20 486f 6c69 6461 7954  arams = HolidayT
-00013170: 7261 6e73 666f 726d 6572 2e67 6574 5f6e  ransformer.get_n
-00013180: 6577 5f70 6172 616d 7328 6d65 7468 6f64  ew_params(method
-00013190: 3d6d 6574 686f 6429 0d0a 2020 2020 2020  =method)..      
-000131a0: 2020 2020 2020 686f 6c69 6461 795f 7061        holiday_pa
-000131b0: 7261 6d73 5b27 696d 7061 6374 275d 203d  rams['impact'] =
-000131c0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-000131d0: 2020 2068 6f6c 6964 6179 5f70 6172 616d     holiday_param
-000131e0: 735b 2772 6567 7265 7373 696f 6e5f 7061  s['regression_pa
-000131f0: 7261 6d73 275d 203d 204e 6f6e 650d 0a20  rams'] = None.. 
-00013200: 2020 2020 2020 2020 2020 2068 6f6c 6964             holid
-00013210: 6179 5f70 6172 616d 735b 2772 656d 6f76  ay_params['remov
-00013220: 655f 6578 6365 7373 5f61 6e6f 6d61 6c69  e_excess_anomali
-00013230: 6573 275d 203d 2072 616e 646f 6d2e 6368  es'] = random.ch
-00013240: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
-00013250: 2020 2020 2020 2020 5b54 7275 652c 2046          [True, F
-00013260: 616c 7365 5d2c 205b 302e 3035 2c20 302e  alse], [0.05, 0.
-00013270: 3935 5d0d 0a20 2020 2020 2020 2020 2020  95]..           
-00013280: 2029 5b30 5d0d 0a20 2020 2020 2020 2020   )[0]..         
+00011fd0: 696e 6465 782c 0d0a 2020 2020 2020 2020  index,..        
+00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ff0: 636f 6c75 6d6e 733d 6466 5f66 6f72 6563  columns=df_forec
+00012000: 6173 742e 666f 7265 6361 7374 2e63 6f6c  ast.forecast.col
+00012010: 756d 6e73 2c0d 0a20 2020 2020 2020 2020  umns,..         
+00012020: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00012030: 696c 6c5f 7661 6c75 653d 302c 0d0a 2020  ill_value=0,..  
+00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012050: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00012060: 2020 2020 2029 2020 2320 6d69 6e75 7320       )  # minus 
+00012070: 6f72 2070 6c75 730d 0a20 2020 2020 2020  or plus..       
+00012080: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
+00012090: 7061 6374 7320 3d20 696d 7074 730d 0a20  pacts = impts.. 
+000120a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000120b0: 6620 696e 636c 7564 655f 6f72 6761 6e69  f include_organi
+000120c0: 633a 0d0a 2020 2020 2020 2020 2020 2020  c:..            
+000120d0: 2020 2020 2020 2020 6466 5f66 6f72 6563          df_forec
+000120e0: 6173 742e 6f72 6761 6e69 635f 666f 7265  ast.organic_fore
+000120f0: 6361 7374 203d 2064 665f 666f 7265 6361  cast = df_foreca
+00012100: 7374 2e66 6f72 6563 6173 742e 636f 7079  st.forecast.copy
+00012110: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00012120: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
+00012130: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+00012140: 7265 6361 7374 2e66 6f72 6563 6173 7420  recast.forecast 
+00012150: 2a20 696d 7074 730d 0a20 2020 2020 2020  * impts..       
+00012160: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00012170: 6361 7374 2e6c 6f77 6572 5f66 6f72 6563  cast.lower_forec
+00012180: 6173 7420 3d20 6466 5f66 6f72 6563 6173  ast = df_forecas
+00012190: 742e 6c6f 7765 725f 666f 7265 6361 7374  t.lower_forecast
+000121a0: 202a 2069 6d70 7473 0d0a 2020 2020 2020   * impts..      
+000121b0: 2020 2020 2020 2020 2020 6466 5f66 6f72            df_for
+000121c0: 6563 6173 742e 7570 7065 725f 666f 7265  ecast.upper_fore
+000121d0: 6361 7374 203d 2064 665f 666f 7265 6361  cast = df_foreca
+000121e0: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
+000121f0: 7420 2a20 696d 7074 730d 0a0d 0a20 2020  t * impts....   
+00012200: 2020 2020 2069 6620 7365 6c66 2e63 6f6e       if self.con
+00012210: 7374 7261 696e 7420 6973 206e 6f74 204e  straint is not N
+00012220: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00012230: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00012240: 7365 6c66 2e63 6f6e 7374 7261 696e 742c  self.constraint,
+00012250: 2064 6963 7429 3a0d 0a20 2020 2020 2020   dict):..       
+00012260: 2020 2020 2020 2020 2063 6f6e 7374 7261           constra
+00012270: 696e 745f 6d65 7468 6f64 203d 2073 656c  int_method = sel
+00012280: 662e 636f 6e73 7472 6169 6e74 2e67 6574  f.constraint.get
+00012290: 2822 636f 6e73 7472 6169 6e74 5f6d 6574  ("constraint_met
+000122a0: 686f 6422 2c20 2271 7561 6e74 696c 6522  hod", "quantile"
+000122b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000122c0: 2020 2063 6f6e 7374 7261 696e 745f 7265     constraint_re
+000122d0: 6775 6c61 7269 7a61 7469 6f6e 203d 2073  gularization = s
+000122e0: 656c 662e 636f 6e73 7472 6169 6e74 2e67  elf.constraint.g
+000122f0: 6574 280d 0a20 2020 2020 2020 2020 2020  et(..           
+00012300: 2020 2020 2020 2020 2022 636f 6e73 7472           "constr
+00012310: 6169 6e74 5f72 6567 756c 6172 697a 6174  aint_regularizat
+00012320: 696f 6e22 2c20 310d 0a20 2020 2020 2020  ion", 1..       
+00012330: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00012340: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+00012350: 725f 636f 6e73 7472 6169 6e74 203d 2073  r_constraint = s
+00012360: 656c 662e 636f 6e73 7472 6169 6e74 2e67  elf.constraint.g
+00012370: 6574 2822 6c6f 7765 725f 636f 6e73 7472  et("lower_constr
+00012380: 6169 6e74 222c 2030 290d 0a20 2020 2020  aint", 0)..     
+00012390: 2020 2020 2020 2020 2020 2075 7070 6572             upper
+000123a0: 5f63 6f6e 7374 7261 696e 7420 3d20 7365  _constraint = se
+000123b0: 6c66 2e63 6f6e 7374 7261 696e 742e 6765  lf.constraint.ge
+000123c0: 7428 2275 7070 6572 5f63 6f6e 7374 7261  t("upper_constra
+000123d0: 696e 7422 2c20 3129 0d0a 2020 2020 2020  int", 1)..      
+000123e0: 2020 2020 2020 2020 2020 626f 756e 6473            bounds
+000123f0: 203d 2073 656c 662e 636f 6e73 7472 6169   = self.constrai
+00012400: 6e74 2e67 6574 2822 626f 756e 6473 222c  nt.get("bounds",
+00012410: 2046 616c 7365 290d 0a20 2020 2020 2020   False)..       
+00012420: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00012430: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+00012440: 7472 6169 6e74 5f6d 6574 686f 6420 3d20  traint_method = 
+00012450: 2273 7464 6576 5f6d 696e 220d 0a20 2020  "stdev_min"..   
+00012460: 2020 2020 2020 2020 2020 2020 206c 6f77               low
+00012470: 6572 5f63 6f6e 7374 7261 696e 7420 3d20  er_constraint = 
+00012480: 666c 6f61 7428 7365 6c66 2e63 6f6e 7374  float(self.const
+00012490: 7261 696e 7429 0d0a 2020 2020 2020 2020  raint)..        
+000124a0: 2020 2020 2020 2020 7570 7065 725f 636f          upper_co
+000124b0: 6e73 7472 6169 6e74 203d 2066 6c6f 6174  nstraint = float
+000124c0: 2873 656c 662e 636f 6e73 7472 6169 6e74  (self.constraint
+000124d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000124e0: 2020 2063 6f6e 7374 7261 696e 745f 7265     constraint_re
+000124f0: 6775 6c61 7269 7a61 7469 6f6e 203d 2031  gularization = 1
+00012500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012510: 2020 626f 756e 6473 203d 2046 616c 7365    bounds = False
+00012520: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00012530: 2073 656c 662e 7665 7262 6f73 6520 3e3d   self.verbose >=
+00012540: 2033 3a0d 0a20 2020 2020 2020 2020 2020   3:..           
+00012550: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
+00012560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012570: 2066 2255 7369 6e67 2063 6f6e 7374 7261   f"Using constra
+00012580: 696e 7420 7769 7468 206d 6574 686f 643a  int with method:
+00012590: 207b 636f 6e73 7472 6169 6e74 5f6d 6574   {constraint_met
+000125a0: 686f 647d 2c20 7b63 6f6e 7374 7261 696e  hod}, {constrain
+000125b0: 745f 7265 6775 6c61 7269 7a61 7469 6f6e  t_regularization
+000125c0: 7d2c 207b 6c6f 7765 725f 636f 6e73 7472  }, {lower_constr
+000125d0: 6169 6e74 7d2c 207b 7570 7065 725f 636f  aint}, {upper_co
+000125e0: 6e73 7472 6169 6e74 7d2c 207b 626f 756e  nstraint}, {boun
+000125f0: 6473 7d22 0d0a 2020 2020 2020 2020 2020  ds}"..          
+00012600: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
+00012610: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00012620: 7374 203d 2064 665f 666f 7265 6361 7374  st = df_forecast
+00012630: 2e61 7070 6c79 5f63 6f6e 7374 7261 696e  .apply_constrain
+00012640: 7473 280d 0a20 2020 2020 2020 2020 2020  ts(..           
+00012650: 2020 2020 2063 6f6e 7374 7261 696e 745f       constraint_
+00012660: 6d65 7468 6f64 2c0d 0a20 2020 2020 2020  method,..       
+00012670: 2020 2020 2020 2020 2063 6f6e 7374 7261           constra
+00012680: 696e 745f 7265 6775 6c61 7269 7a61 7469  int_regularizati
+00012690: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+000126a0: 2020 2020 2075 7070 6572 5f63 6f6e 7374       upper_const
+000126b0: 7261 696e 742c 0d0a 2020 2020 2020 2020  raint,..        
+000126c0: 2020 2020 2020 2020 6c6f 7765 725f 636f          lower_co
+000126d0: 6e73 7472 6169 6e74 2c0d 0a20 2020 2020  nstraint,..     
+000126e0: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
+000126f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00012700: 2020 2020 7365 6c66 2e64 665f 6f72 6967      self.df_orig
+00012710: 696e 616c 2c0d 0a20 2020 2020 2020 2020  inal,..         
+00012720: 2020 2029 0d0a 2020 2020 2020 2020 2320     )..        # 
+00012730: 5245 5455 524e 2043 4f4d 504f 4e45 4e54  RETURN COMPONENT
+00012740: 5320 286c 6f6e 6720 7374 796c 6529 206f  S (long style) o
+00012750: 7074 696f 6e0d 0a20 2020 2020 2020 2064  ption..        d
+00012760: 665f 666f 7265 6361 7374 2e70 7265 6469  f_forecast.predi
+00012770: 6374 5f72 756e 7469 6d65 203d 2073 656c  ct_runtime = sel
+00012780: 662e 7469 6d65 2829 202d 2070 7265 6469  f.time() - predi
+00012790: 6374 5374 6172 7454 696d 650d 0a20 2020  ctStartTime..   
+000127a0: 2020 2020 2072 6574 7572 6e20 6466 5f66       return df_f
+000127b0: 6f72 6563 6173 740d 0a0d 0a20 2020 2064  orecast....    d
+000127c0: 6566 2061 7574 6f5f 6669 7428 7365 6c66  ef auto_fit(self
+000127d0: 2c20 6466 2c20 7661 6c69 6461 7469 6f6e  , df, validation
+000127e0: 5f6d 6574 686f 6429 3a20 2023 2061 6c73  _method):  # als
+000127f0: 6f20 6164 6420 7265 6772 6573 736f 7220  o add regressor 
+00012800: 696e 7075 740d 0a20 2020 2020 2020 2023  input..        #
+00012810: 206f 7074 696f 6e20 746f 2063 6f6d 706c   option to compl
+00012820: 6574 656c 7920 736b 6970 2073 6f6d 6520  etely skip some 
+00012830: 7468 696e 6773 2028 616e 6f6d 616c 6965  things (anomalie
+00012840: 732c 2068 6f6c 6964 6179 2064 6574 6563  s, holiday detec
+00012850: 746f 722c 2061 7220 6c61 6773 290d 0a20  tor, ar lags).. 
+00012860: 2020 2020 2020 2023 2072 756e 2063 726f         # run cro
+00012870: 7373 2076 616c 6964 6174 696f 6e20 746f  ss validation to
+00012880: 2063 686f 6f73 650d 0a20 2020 2020 2020   choose..       
+00012890: 2023 2072 6574 7572 6e20 6d65 7472 6963   # return metric
+000128a0: 7320 6f66 2062 6573 7420 6d6f 6465 6c2c  s of best model,
+000128b0: 2073 6574 2062 6173 6520 7061 7261 6d73   set base params
+000128c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+000128d0: 7461 7274 696e 675f 7061 7261 6d73 203d  tarting_params =
+000128e0: 2073 656c 662e 6765 745f 7061 7261 6d73   self.get_params
+000128f0: 2829 0d0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00012900: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
+00012910: 640d 0a0d 0a20 2020 2064 6566 206e 6578  d....    def nex
+00012920: 745f 6669 7428 7365 6c66 293a 0d0a 2020  t_fit(self):..  
+00012930: 2020 2020 2020 2320 6f70 7469 6f6e 2074        # option t
+00012940: 6f20 7072 696e 7420 6120 6772 6170 6820  o print a graph 
+00012950: 6f66 2065 6163 6820 7768 696c 6520 676f  of each while go
+00012960: 696e 6720 2872 756e 2061 6761 696e 2075  ing (run again u
+00012970: 6e74 696c 2079 6f75 2073 6565 206f 6e65  ntil you see one
+00012980: 2079 6f75 206c 696b 6529 0d0a 2020 2020   you like)..    
+00012990: 2020 2020 2320 6170 7065 6e64 2074 6f20      # append to 
+000129a0: 616e 2069 6e74 6572 6e61 6c20 7265 636f  an internal reco
+000129b0: 7264 2c20 7072 696e 7420 6e65 7720 7061  rd, print new pa
+000129c0: 7261 6d73 0d0a 2020 2020 2020 2020 2320  rams..        # 
+000129d0: 706c 6f74 3a20 3320 7374 6163 6b65 642c  plot: 3 stacked,
+000129e0: 2069 6e20 7361 6d70 6c65 2c20 7468 656e   in sample, then
+000129f0: 2065 6163 6820 7661 6c69 6461 7469 6f6e   each validation
+00012a00: 0d0a 2020 2020 2020 2020 2320 6d61 7962  ..        # mayb
+00012a10: 6520 7573 6520 6765 6e65 7469 6320 6f70  e use genetic op
+00012a20: 7469 6d69 7a61 7469 6f6e 2069 6620 7468  timization if th
+00012a30: 6973 2075 7365 6420 6166 7465 7220 6175  is used after au
+00012a40: 746f 5f66 6974 0d0a 2020 2020 2020 2020  to_fit..        
+00012a50: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
+00012a60: 656e 7465 640d 0a0d 0a20 2020 2064 6566  ented....    def
+00012a70: 2063 726f 7373 5f76 616c 6964 6174 6528   cross_validate(
+00012a80: 7365 6c66 2c20 6466 2c20 7661 6c69 6461  self, df, valida
+00012a90: 7469 6f6e 5f6d 6574 686f 6429 3a0d 0a20  tion_method):.. 
+00012aa0: 2020 2020 2020 2023 2072 756e 206f 6e65         # run one
+00012ab0: 206d 6f64 656c 2061 6e64 2072 6574 7572   model and retur
+00012ac0: 6e20 7363 6f72 6573 0d0a 2020 2020 2020  n scores..      
+00012ad0: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
+00012ae0: 656d 656e 7465 640d 0a0d 0a20 2020 2064  emented....    d
+00012af0: 6566 2074 7265 6174 6d65 6e74 5f63 6175  ef treatment_cau
+00012b00: 7361 6c5f 696d 7061 6374 280d 0a20 2020  sal_impact(..   
+00012b10: 2020 2020 2073 656c 662c 2064 662c 2069       self, df, i
+00012b20: 6e74 6572 7665 6e74 696f 6e5f 6461 7465  ntervention_date
+00012b30: 730d 0a20 2020 2029 3a20 2023 2061 6c73  s..    ):  # als
+00012b40: 6f20 6164 6420 7265 6772 6573 736f 7220  o add regressor 
+00012b50: 696e 7075 740d 0a20 2020 2020 2020 2023  input..        #
+00012b60: 2072 6567 7265 7373 6f72 7320 696d 706f   regressors impo
+00012b70: 7274 616e 742c 2065 7374 696d 6174 696f  rtant, estimatio
+00012b80: 6e20 6279 206c 696e 6561 7220 666c 6167  n by linear flag
+00012b90: 2028 7265 7475 726e 2073 7461 7473 2920   (return stats) 
+00012ba0: 6f72 2062 7920 2520 7673 2066 6f72 6563  or by % vs forec
+00012bb0: 6173 7420 6672 6f6d 2063 7574 6f66 660d  ast from cutoff.
+00012bc0: 0a20 2020 2020 2020 2023 2073 7461 7274  .        # start
+00012bd0: 2061 6e64 2065 6e64 2064 6174 6573 2c20   and end dates, 
+00012be0: 6d75 6c74 6970 6c65 2074 7265 6174 6d65  multiple treatme
+00012bf0: 6e74 732c 2076 6172 7920 6279 2073 6572  nts, vary by ser
+00012c00: 6965 730d 0a20 2020 2020 2020 2023 206f  ies..        # o
+00012c10: 7220 6d61 7962 6520 696e 7374 6561 642c  r maybe instead,
+00012c20: 206a 7573 7420 7265 7475 726e 2074 6865   just return the
+00012c30: 2073 7461 7473 2066 6f72 2061 6c6c 2069   stats for all i
+00012c40: 6e70 7574 2072 6567 7265 7373 6f72 730d  nput regressors.
+00012c50: 0a20 2020 2020 2020 2023 2073 7469 6c6c  .        # still
+00012c60: 2077 6f72 6b69 6e67 206f 6e20 7468 6973   working on this
+00012c70: 2c20 706f 7373 6962 6c79 206a 7573 7420  , possibly just 
+00012c80: 6874 7470 733a 2f2f 6d61 7468 2e73 7461  https://math.sta
+00012c90: 636b 6578 6368 616e 6765 2e63 6f6d 2f71  ckexchange.com/q
+00012ca0: 7565 7374 696f 6e73 2f32 3131 3235 3533  uestions/2112553
+00012cb0: 2f73 7461 7469 7374 6963 616c 2d73 6967  /statistical-sig
+00012cc0: 6e69 6669 6361 6e63 652d 6f66 2d6c 696e  nificance-of-lin
+00012cd0: 6561 722d 6c65 6173 742d 7371 7561 7265  ear-least-square
+00012ce0: 730d 0a20 2020 2020 2020 2023 2061 6e64  s..        # and
+00012cf0: 206f 7468 6572 2066 6561 7475 7265 7320   other features 
+00012d00: 616c 6120 5374 6174 736d 6f64 656c 7320  ala Statsmodels 
+00012d10: 4f4c 532c 2056 6172 28ce b25e 293d cf83  OLS, Var(..^)=..
+00012d20: 3228 58e2 80b2 5829 e288 9231 2077 6865  2(X...X)...1 whe
+00012d30: 7265 20cf 8332 3e30 2069 7320 7468 6520  re ..2>0 is the 
+00012d40: 636f 6d6d 6f6e 2076 6172 6961 6e63 6520  common variance 
+00012d50: 6f66 2065 6163 6820 656c 656d 656e 7420  of each element 
+00012d60: 6f66 2074 6865 2065 7272 6f72 2076 6563  of the error vec
+00012d70: 746f 720d 0a20 2020 2020 2020 2072 6574  tor..        ret
+00012d80: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
+00012d90: 6564 0d0a 0d0a 2020 2020 6465 6620 7072  ed....    def pr
+00012da0: 6564 6963 745f 6e65 775f 7072 6f64 7563  edict_new_produc
+00012db0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+00012dc0: 2020 2320 626f 7272 6f77 2074 6865 206c    # borrow the l
+00012dd0: 696e 6561 7220 636f 6d70 6f6e 656e 7473  inear components
+00012de0: 2066 726f 6d20 6120 7265 6c61 7465 6420   from a related 
+00012df0: 7072 6f64 7563 7420 286f 7220 6176 672f  product (or avg/
+00012e00: 6d6f 6465 2069 6620 6e6f 7420 6769 7665  mode if not give
+00012e10: 6e29 0d0a 2020 2020 2020 2020 2320 6861  n)..        # ha
+00012e20: 7665 2074 6865 2074 7265 6e64 2073 7461  ve the trend sta
+00012e30: 7274 2061 7420 7a65 726f 2074 6865 6e20  rt at zero then 
+00012e40: 7570 2c20 6c69 6b65 2072 6576 6572 7365  up, like reverse
+00012e50: 2070 6869 0d0a 2020 2020 2020 2020 2320   phi..        # 
+00012e60: 706f 7373 6962 6c79 2062 6f72 726f 7720  possibly borrow 
+00012e70: 7761 726d 7570 2066 726f 6d20 616e 7920  warmup from any 
+00012e80: 7365 7269 6573 2074 6861 7420 6861 7665  series that have
+00012e90: 2061 206c 6f67 6973 7469 632d 6c69 6b65   a logistic-like
+00012ea0: 2074 7265 6e64 0d0a 2020 2020 2020 2020   trend..        
+00012eb0: 2320 636c 7573 7465 7220 616e 6420 6368  # cluster and ch
+00012ec0: 6f6f 7365 2074 6865 2062 6967 6765 7374  oose the biggest
+00012ed0: 2063 6c75 7374 6572 2028 6173 2061 7667   cluster (as avg
+00012ee0: 2076 616c 7565 206e 6169 7665 206d 6574   value naive met
+00012ef0: 686f 642c 206d 6179 6265 2072 6f75 6e64  hod, maybe round
+00012f00: 206f 7220 6669 6c74 6572 2066 6972 7374   or filter first
+00012f10: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00012f20: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
+00012f30: 0d0a 0d0a 2020 2020 6465 6620 6665 6174  ....    def feat
+00012f40: 7572 655f 696d 706f 7274 616e 6365 2873  ure_importance(s
+00012f50: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
+00012f60: 2072 616e 6b20 636f 6566 6669 6369 656e   rank coefficien
+00012f70: 7473 2062 7920 696d 706f 7274 616e 6365  ts by importance
+00012f80: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00012f90: 204e 6f74 496d 706c 656d 656e 7465 640d   NotImplemented.
+00012fa0: 0a0d 0a20 2020 2064 6566 2063 6f6d 7061  ...    def compa
+00012fb0: 7265 5f61 6374 7561 6c5f 636f 6d70 6f6e  re_actual_compon
+00012fc0: 656e 7473 2873 656c 6629 3a0d 0a20 2020  ents(self):..   
+00012fd0: 2020 2020 2072 6574 7572 6e20 4e6f 7449       return NotI
+00012fe0: 6d70 6c65 6d65 6e74 6564 0d0a 0d0a 2020  mplemented....  
+00012ff0: 2020 6465 6620 6765 745f 6e65 775f 7061    def get_new_pa
+00013000: 7261 6d73 2873 656c 662c 206d 6574 686f  rams(self, metho
+00013010: 643d 2766 6173 7427 293a 0d0a 2020 2020  d='fast'):..    
+00013020: 2020 2020 2320 6861 7665 2066 6173 7420      # have fast 
+00013030: 6f70 7469 6f6e 2074 6861 7420 6176 6f69  option that avoi
+00013040: 6473 2061 6e79 206f 6620 7468 6520 6c6f  ds any of the lo
+00013050: 6f70 2061 7070 726f 6163 6865 730d 0a20  op approaches.. 
+00013060: 2020 2020 2020 2073 6361 6c69 6e67 203d         scaling =
+00013070: 2072 616e 646f 6d2e 6368 6f69 6365 7328   random.choices(
+00013080: 5b27 4261 7365 5363 616c 6572 272c 2027  ['BaseScaler', '
+00013090: 6f74 6865 7227 5d2c 205b 302e 382c 2030  other'], [0.8, 0
+000130a0: 2e32 5d29 5b30 5d0d 0a20 2020 2020 2020  .2])[0]..       
+000130b0: 2069 6620 7363 616c 696e 6720 3d3d 2022   if scaling == "
+000130c0: 6f74 6865 7222 3a0d 0a20 2020 2020 2020  other":..       
+000130d0: 2020 2020 2073 6361 6c69 6e67 203d 2052       scaling = R
+000130e0: 616e 646f 6d54 7261 6e73 666f 726d 280d  andomTransform(.
+000130f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013100: 2074 7261 6e73 666f 726d 6572 5f6c 6973   transformer_lis
+00013110: 743d 7363 616c 6572 732c 0d0a 2020 2020  t=scalers,..    
+00013120: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+00013130: 7366 6f72 6d65 725f 6d61 785f 6465 7074  sformer_max_dept
+00013140: 683d 312c 0d0a 2020 2020 2020 2020 2020  h=1,..          
+00013150: 2020 2020 2020 616c 6c6f 775f 6e6f 6e65        allow_none
+00013160: 3d46 616c 7365 2c0d 0a20 2020 2020 2020  =False,..       
+00013170: 2020 2020 2020 2020 206e 6f5f 6e61 6e5f           no_nan_
+00013180: 6669 6c6c 3d54 7275 652c 0d0a 2020 2020  fill=True,..    
+00013190: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000131a0: 2020 2068 6f6c 6964 6179 5f70 6172 616d     holiday_param
+000131b0: 7320 3d20 7261 6e64 6f6d 2e63 686f 6963  s = random.choic
+000131c0: 6573 285b 4e6f 6e65 2c20 2761 6e79 275d  es([None, 'any']
+000131d0: 2c20 5b30 2e35 2c20 302e 355d 295b 305d  , [0.5, 0.5])[0]
+000131e0: 0d0a 2020 2020 2020 2020 2320 686f 6c69  ..        # holi
+000131f0: 6461 795f 696e 7465 7276 656e 7469 6f6e  day_intervention
+00013200: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00013210: 2069 6620 686f 6c69 6461 795f 7061 7261   if holiday_para
+00013220: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ms is not None:.
+00013230: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
+00013240: 6f6c 6964 6179 5f69 6e74 6572 7665 6e74  oliday_intervent
+00013250: 696f 6e20 3d20 7261 6e64 6f6d 2e63 686f  ion = random.cho
+00013260: 6963 6528 5b27 6372 6561 7465 5f66 6561  ice(['create_fea
+00013270: 7475 7265 272c 2027 7573 655f 696d 7061  ture', 'use_impa
+00013280: 6374 275d 290d 0a20 2020 2020 2020 2020  ct'])..         
 00013290: 2020 2068 6f6c 6964 6179 5f70 6172 616d     holiday_param
-000132a0: 735b 276f 7574 7075 7427 5d20 3d20 7261  s['output'] = ra
-000132b0: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
-000132c0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000132d0: 276d 756c 7469 7661 7269 6174 6527 2c20  'multivariate', 
-000132e0: 2775 6e69 7661 7269 6174 6527 5d2c 205b  'univariate'], [
-000132f0: 302e 392c 2030 2e31 5d0d 0a20 2020 2020  0.9, 0.1]..     
-00013300: 2020 2020 2020 2029 5b30 5d0d 0a20 2020         )[0]..   
-00013310: 2020 2020 2061 6e6f 6d61 6c79 5f69 6e74       anomaly_int
-00013320: 6572 7665 6e74 696f 6e20 3d20 7261 6e64  ervention = rand
-00013330: 6f6d 2e63 686f 6963 6573 280d 0a20 2020  om.choices(..   
-00013340: 2020 2020 2020 2020 205b 4e6f 6e65 2c20           [None, 
-00013350: 2772 656d 6f76 6527 2c20 2764 6574 6563  'remove', 'detec
-00013360: 745f 6f6e 6c79 272c 2027 6d6f 6465 6c27  t_only', 'model'
-00013370: 5d2c 205b 302e 392c 2030 2e33 2c20 302e  ], [0.9, 0.3, 0.
-00013380: 3035 2c20 302e 3035 5d0d 0a20 2020 2020  05, 0.05]..     
-00013390: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
-000133a0: 2069 6620 616e 6f6d 616c 795f 696e 7465   if anomaly_inte
-000133b0: 7276 656e 7469 6f6e 2069 7320 6e6f 7420  rvention is not 
-000133c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000133d0: 2020 2061 6e6f 6d61 6c79 5f64 6574 6563     anomaly_detec
-000133e0: 746f 725f 7061 7261 6d73 203d 2041 6e6f  tor_params = Ano
-000133f0: 6d61 6c79 5265 6d6f 7661 6c2e 6765 745f  malyRemoval.get_
-00013400: 6e65 775f 7061 7261 6d73 286d 6574 686f  new_params(metho
-00013410: 643d 6d65 7468 6f64 290d 0a20 2020 2020  d=method)..     
-00013420: 2020 2020 2020 2069 6620 616e 6f6d 616c         if anomal
-00013430: 795f 696e 7465 7276 656e 7469 6f6e 203d  y_intervention =
-00013440: 3d20 226d 6f64 656c 223a 0d0a 2020 2020  = "model":..    
-00013450: 2020 2020 2020 2020 2020 2020 616e 6f6d              anom
-00013460: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
-00013470: 203d 2067 656e 6572 616c 5f74 656d 706c   = general_templ
-00013480: 6174 652e 7361 6d70 6c65 2831 292e 746f  ate.sample(1).to
-00013490: 5f64 6963 7428 2272 6563 6f72 6473 2229  _dict("records")
-000134a0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-000134b0: 2020 2020 2020 2030 0d0a 2020 2020 2020         0..      
-000134c0: 2020 2020 2020 2020 2020 5d20 2023 2070            ]  # p
-000134d0: 6c61 6365 686f 6c64 6572 2c20 7072 6f62  laceholder, prob
-000134e0: 6162 6c79 0d0a 2020 2020 2020 2020 656c  ably..        el
-000134f0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00013500: 2061 6e6f 6d61 6c79 5f64 6574 6563 746f   anomaly_detecto
-00013510: 725f 7061 7261 6d73 203d 204e 6f6e 650d  r_params = None.
-00013520: 0a0d 0a20 2020 2020 2020 2023 2072 616e  ...        # ran
-00013530: 646f 6d20 6f72 2070 7265 7465 7374 6564  dom or pretested
-00013540: 2064 6566 6175 6c74 730d 0a20 2020 2020   defaults..     
-00013550: 2020 2074 7265 6e64 5f62 6173 6520 3d20     trend_base = 
-00013560: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
-00013570: 0a20 2020 2020 2020 2020 2020 205b 2770  .            ['p
-00013580: 6231 272c 2027 7062 3227 2c20 2770 6233  b1', 'pb2', 'pb3
-00013590: 272c 2027 7261 6e64 6f6d 275d 2c20 5b30  ', 'random'], [0
-000135a0: 2e31 2c20 302e 312c 2030 2e30 2c20 302e  .1, 0.1, 0.0, 0.
-000135b0: 385d 0d0a 2020 2020 2020 2020 295b 305d  8]..        )[0]
-000135c0: 0d0a 2020 2020 2020 2020 6966 2074 7265  ..        if tre
-000135d0: 6e64 5f62 6173 6520 3d3d 2022 7261 6e64  nd_base == "rand
-000135e0: 6f6d 223a 0d0a 2020 2020 2020 2020 2020  om":..          
-000135f0: 2020 6d6f 6465 6c5f 7374 7220 3d20 7261    model_str = ra
-00013600: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
-00013610: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00013620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013630: 2020 2020 2020 2741 7665 7261 6765 5661        'AverageVa
-00013640: 6c75 654e 6169 7665 272c 0d0a 2020 2020  lueNaive',..    
-00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013660: 274d 6574 7269 634d 6f74 6966 272c 0d0a  'MetricMotif',..
-00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 2020 2020 224c 6173 7456 616c 7565 4e61      "LastValueNa
-00013690: 6976 6522 2c0d 0a20 2020 2020 2020 2020  ive",..         
-000136a0: 2020 2020 2020 2020 2020 2027 5365 6173             'Seas
-000136b0: 6f6e 616c 6974 794d 6f74 6966 272c 0d0a  onalityMotif',..
-000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136d0: 2020 2020 2757 696e 646f 7752 6567 7265      'WindowRegre
-000136e0: 7373 696f 6e27 2c0d 0a20 2020 2020 2020  ssion',..       
-000136f0: 2020 2020 2020 2020 2020 2020 2027 4152               'AR
-00013700: 444c 272c 0d0a 2020 2020 2020 2020 2020  DL',..          
-00013710: 2020 2020 2020 2020 2020 2756 4152 272c            'VAR',
-00013720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013730: 2020 2020 2020 2755 6e69 7661 7269 6174        'Univariat
-00013740: 654d 6f74 6966 272c 0d0a 2020 2020 2020  eMotif',..      
-00013750: 2020 2020 2020 2020 2020 2020 2020 2755                'U
-00013760: 6e6f 6273 6572 7665 6443 6f6d 706f 6e65  nobservedCompone
-00013770: 6e74 7327 2c0d 0a20 2020 2020 2020 2020  nts',..         
-00013780: 2020 2020 2020 2020 2020 2022 4b61 6c6d             "Kalm
-00013790: 616e 5374 6174 6553 7061 6365 222c 0d0a  anStateSpace",..
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137b0: 2020 2020 2752 5256 4152 272c 0d0a 2020      'RRVAR',..  
-000137c0: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
-000137d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000137e0: 2020 5b30 2e30 352c 2030 2e30 352c 2030    [0.05, 0.05, 0
-000137f0: 2e31 2c20 302e 3035 2c20 302e 3035 2c20  .1, 0.05, 0.05, 
-00013800: 302e 3135 2c20 302e 3035 2c20 302e 3035  0.15, 0.05, 0.05
-00013810: 2c20 302e 3035 2c20 302e 3035 2c20 302e  , 0.05, 0.05, 0.
-00013820: 3035 5d2c 0d0a 2020 2020 2020 2020 2020  05],..          
-00013830: 2020 2020 2020 6b3d 312c 0d0a 2020 2020        k=1,..    
-00013840: 2020 2020 2020 2020 295b 305d 0d0a 2020          )[0]..  
-00013850: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
-00013860: 6d6f 6465 6c20 3d20 7b27 4d6f 6465 6c27  model = {'Model'
-00013870: 3a20 6d6f 6465 6c5f 7374 727d 0d0a 2020  : model_str}..  
-00013880: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
-00013890: 6d6f 6465 6c5b 274d 6f64 656c 5061 7261  model['ModelPara
-000138a0: 6d65 7465 7273 275d 203d 204d 6f64 656c  meters'] = Model
-000138b0: 4d6f 6e73 7465 7228 6d6f 6465 6c5f 7374  Monster(model_st
-000138c0: 7229 2e67 6574 5f6e 6577 5f70 6172 616d  r).get_new_param
-000138d0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
-000138e0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-000138f0: 640d 0a20 2020 2020 2020 2020 2020 2029  d..            )
-00013900: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00013910: 656e 645f 7472 616e 7366 6f72 6d61 7469  end_transformati
-00013920: 6f6e 203d 2052 616e 646f 6d54 7261 6e73  on = RandomTrans
-00013930: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
-00013940: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00013950: 6572 5f6c 6973 743d 2266 6173 7422 2c0d  er_list="fast",.
-00013960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013970: 2074 7261 6e73 666f 726d 6572 5f6d 6178   transformer_max
-00013980: 5f64 6570 7468 3d33 2c20 2023 2070 726f  _depth=3,  # pro
-00013990: 6261 626c 7920 7761 6e74 2073 6f6d 6520  bably want some 
-000139a0: 6d6f 7265 2075 7361 626c 6520 6465 6661  more usable defa
-000139b0: 756c 7473 2066 6972 7374 2061 7320 6d61  ults first as ma
-000139c0: 6e79 2072 616e 646f 6d20 6172 6520 7365  ny random are se
-000139d0: 6e73 656c 6573 730d 0a20 2020 2020 2020  nseless..       
-000139e0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000139f0: 656c 6966 2074 7265 6e64 5f62 6173 6520  elif trend_base 
-00013a00: 3d3d 2027 7062 3127 3a0d 0a20 2020 2020  == 'pb1':..     
-00013a10: 2020 2020 2020 2074 7265 6e64 5f6d 6f64         trend_mod
-00013a20: 656c 203d 207b 274d 6f64 656c 273a 2027  el = {'Model': '
-00013a30: 4152 444c 277d 0d0a 2020 2020 2020 2020  ARDL'}..        
-00013a40: 2020 2020 7472 656e 645f 6d6f 6465 6c5b      trend_model[
-00013a50: 274d 6f64 656c 5061 7261 6d65 7465 7273  'ModelParameters
-00013a60: 275d 203d 207b 0d0a 2020 2020 2020 2020  '] = {..        
-00013a70: 2020 2020 2020 2020 226c 6167 7322 3a20          "lags": 
-00013a80: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
-00013a90: 2020 2020 2274 7265 6e64 223a 2022 6e22      "trend": "n"
-00013aa0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013ab0: 2020 2022 6f72 6465 7222 3a20 302c 0d0a     "order": 0,..
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ad0: 2263 6175 7361 6c22 3a20 4661 6c73 652c  "causal": False,
-00013ae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013af0: 2020 2272 6567 7265 7373 696f 6e5f 7479    "regression_ty
-00013b00: 7065 223a 2022 7369 6d70 6c65 222c 0d0a  pe": "simple",..
-00013b10: 2020 2020 2020 2020 2020 2020 7d0d 0a20              }.. 
-00013b20: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-00013b30: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
-00013b40: 3d20 7b0d 0a20 2020 2020 2020 2020 2020  = {..           
-00013b50: 2020 2020 2022 6669 6c6c 6e61 223a 2022       "fillna": "
-00013b60: 6e65 6172 6573 7422 2c0d 0a20 2020 2020  nearest",..     
-00013b70: 2020 2020 2020 2020 2020 2022 7472 616e             "tran
-00013b80: 7366 6f72 6d61 7469 6f6e 7322 3a20 7b22  sformations": {"
-00013b90: 3022 3a20 2253 7461 6e64 6172 6453 6361  0": "StandardSca
-00013ba0: 6c65 7222 2c20 2231 223a 2022 416e 6f6d  ler", "1": "Anom
-00013bb0: 616c 7952 656d 6f76 616c 227d 2c0d 0a20  alyRemoval"},.. 
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013bd0: 7472 616e 7366 6f72 6d61 7469 6f6e 5f70  transformation_p
-00013be0: 6172 616d 7322 3a20 7b0d 0a20 2020 2020  arams": {..     
-00013bf0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013c00: 3022 3a20 7b7d 2c0d 0a20 2020 2020 2020  0": {},..       
-00013c10: 2020 2020 2020 2020 2020 2020 2022 3122               "1"
-00013c20: 3a20 7b0d 0a20 2020 2020 2020 2020 2020  : {..           
-00013c30: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
-00013c40: 7468 6f64 223a 2022 4951 5222 2c0d 0a20  thod": "IQR",.. 
-00013c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c60: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
-00013c70: 6d5f 6469 6374 223a 207b 0d0a 2020 2020  m_dict": {..    
-00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c90: 2020 2020 2020 2020 2266 696c 6c6e 6122          "fillna"
-00013ca0: 3a20 4e6f 6e65 2c0d 0a20 2020 2020 2020  : None,..       
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 2020 2020 2022 7472 616e 7366 6f72 6d61       "transforma
-00013cd0: 7469 6f6e 7322 3a20 7b22 3022 3a20 2243  tions": {"0": "C
-00013ce0: 6c69 704f 7574 6c69 6572 7322 7d2c 0d0a  lipOutliers"},..
-00013cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d00: 2020 2020 2020 2020 2020 2020 2274 7261              "tra
-00013d10: 6e73 666f 726d 6174 696f 6e5f 7061 7261  nsformation_para
-00013d20: 6d73 223a 207b 0d0a 2020 2020 2020 2020  ms": {..        
-00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d40: 2020 2020 2020 2020 2230 223a 207b 226d          "0": {"m
-00013d50: 6574 686f 6422 3a20 2263 6c69 7022 2c20  ethod": "clip", 
-00013d60: 2273 7464 5f74 6872 6573 686f 6c64 223a  "std_threshold":
-00013d70: 2036 7d0d 0a20 2020 2020 2020 2020 2020   6}..           
-00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d90: 207d 2c0d 0a20 2020 2020 2020 2020 2020   },..           
-00013da0: 2020 2020 2020 2020 2020 2020 207d 2c0d               },.
-00013db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013dc0: 2020 2020 2020 2020 2022 6d65 7468 6f64           "method
-00013dd0: 5f70 6172 616d 7322 3a20 7b0d 0a20 2020  _params": {..   
-00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013df0: 2020 2020 2020 2020 2022 6971 725f 7468           "iqr_th
-00013e00: 7265 7368 6f6c 6422 3a20 322e 352c 0d0a  reshold": 2.5,..
-00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e20: 2020 2020 2020 2020 2020 2020 2269 7172              "iqr
-00013e30: 5f71 7561 6e74 696c 6573 223a 205b 302e  _quantiles": [0.
-00013e40: 3235 2c20 302e 3735 5d2c 0d0a 2020 2020  25, 0.75],..    
+000132a0: 7320 3d20 486f 6c69 6461 7954 7261 6e73  s = HolidayTrans
+000132b0: 666f 726d 6572 2e67 6574 5f6e 6577 5f70  former.get_new_p
+000132c0: 6172 616d 7328 6d65 7468 6f64 3d6d 6574  arams(method=met
+000132d0: 686f 6429 0d0a 2020 2020 2020 2020 2020  hod)..          
+000132e0: 2020 686f 6c69 6461 795f 7061 7261 6d73    holiday_params
+000132f0: 5b27 696d 7061 6374 275d 203d 204e 6f6e  ['impact'] = Non
+00013300: 650d 0a20 2020 2020 2020 2020 2020 2068  e..            h
+00013310: 6f6c 6964 6179 5f70 6172 616d 735b 2772  oliday_params['r
+00013320: 6567 7265 7373 696f 6e5f 7061 7261 6d73  egression_params
+00013330: 275d 203d 204e 6f6e 650d 0a20 2020 2020  '] = None..     
+00013340: 2020 2020 2020 2068 6f6c 6964 6179 5f70         holiday_p
+00013350: 6172 616d 735b 2772 656d 6f76 655f 6578  arams['remove_ex
+00013360: 6365 7373 5f61 6e6f 6d61 6c69 6573 275d  cess_anomalies']
+00013370: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
+00013380: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+00013390: 2020 2020 5b54 7275 652c 2046 616c 7365      [True, False
+000133a0: 5d2c 205b 302e 3035 2c20 302e 3935 5d0d  ], [0.05, 0.95].
+000133b0: 0a20 2020 2020 2020 2020 2020 2029 5b30  .            )[0
+000133c0: 5d0d 0a20 2020 2020 2020 2020 2020 2068  ]..            h
+000133d0: 6f6c 6964 6179 5f70 6172 616d 735b 276f  oliday_params['o
+000133e0: 7574 7075 7427 5d20 3d20 7261 6e64 6f6d  utput'] = random
+000133f0: 2e63 686f 6963 6573 280d 0a20 2020 2020  .choices(..     
+00013400: 2020 2020 2020 2020 2020 205b 276d 756c             ['mul
+00013410: 7469 7661 7269 6174 6527 2c20 2775 6e69  tivariate', 'uni
+00013420: 7661 7269 6174 6527 5d2c 205b 302e 392c  variate'], [0.9,
+00013430: 2030 2e31 5d0d 0a20 2020 2020 2020 2020   0.1]..         
+00013440: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
+00013450: 2061 6e6f 6d61 6c79 5f69 6e74 6572 7665   anomaly_interve
+00013460: 6e74 696f 6e20 3d20 7261 6e64 6f6d 2e63  ntion = random.c
+00013470: 686f 6963 6573 280d 0a20 2020 2020 2020  hoices(..       
+00013480: 2020 2020 205b 4e6f 6e65 2c20 2772 656d       [None, 'rem
+00013490: 6f76 6527 2c20 2764 6574 6563 745f 6f6e  ove', 'detect_on
+000134a0: 6c79 272c 2027 6d6f 6465 6c27 5d2c 205b  ly', 'model'], [
+000134b0: 302e 392c 2030 2e33 2c20 302e 3035 2c20  0.9, 0.3, 0.05, 
+000134c0: 302e 3035 5d0d 0a20 2020 2020 2020 2029  0.05]..        )
+000134d0: 5b30 5d0d 0a20 2020 2020 2020 2069 6620  [0]..        if 
+000134e0: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
+000134f0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
+00013500: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
+00013510: 6e6f 6d61 6c79 5f64 6574 6563 746f 725f  nomaly_detector_
+00013520: 7061 7261 6d73 203d 2041 6e6f 6d61 6c79  params = Anomaly
+00013530: 5265 6d6f 7661 6c2e 6765 745f 6e65 775f  Removal.get_new_
+00013540: 7061 7261 6d73 286d 6574 686f 643d 6d65  params(method=me
+00013550: 7468 6f64 290d 0a20 2020 2020 2020 2020  thod)..         
+00013560: 2020 2069 6620 616e 6f6d 616c 795f 696e     if anomaly_in
+00013570: 7465 7276 656e 7469 6f6e 203d 3d20 226d  tervention == "m
+00013580: 6f64 656c 223a 0d0a 2020 2020 2020 2020  odel":..        
+00013590: 2020 2020 2020 2020 616e 6f6d 616c 795f          anomaly_
+000135a0: 696e 7465 7276 656e 7469 6f6e 203d 2067  intervention = g
+000135b0: 656e 6572 616c 5f74 656d 706c 6174 652e  eneral_template.
+000135c0: 7361 6d70 6c65 2831 292e 746f 5f64 6963  sample(1).to_dic
+000135d0: 7428 2272 6563 6f72 6473 2229 5b0d 0a20  t("records")[.. 
+000135e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135f0: 2020 2030 0d0a 2020 2020 2020 2020 2020     0..          
+00013600: 2020 2020 2020 5d20 2023 2070 6c61 6365        ]  # place
+00013610: 686f 6c64 6572 2c20 7072 6f62 6162 6c79  holder, probably
+00013620: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00013630: 0a20 2020 2020 2020 2020 2020 2061 6e6f  .            ano
+00013640: 6d61 6c79 5f64 6574 6563 746f 725f 7061  maly_detector_pa
+00013650: 7261 6d73 203d 204e 6f6e 650d 0a0d 0a20  rams = None.... 
+00013660: 2020 2020 2020 2023 2072 616e 646f 6d20         # random 
+00013670: 6f72 2070 7265 7465 7374 6564 2064 6566  or pretested def
+00013680: 6175 6c74 730d 0a20 2020 2020 2020 2069  aults..        i
+00013690: 6620 6d65 7468 6f64 2069 6e20 5b27 6465  f method in ['de
+000136a0: 6570 272c 2027 616c 6c27 5d3a 0d0a 2020  ep', 'all']:..  
+000136b0: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+000136c0: 6261 7365 203d 2027 6465 6570 270d 0a20  base = 'deep'.. 
+000136d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000136e0: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+000136f0: 6261 7365 203d 2072 616e 646f 6d2e 6368  base = random.ch
+00013700: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
+00013710: 2020 2020 2020 2020 5b27 7062 3127 2c20          ['pb1', 
+00013720: 2770 6232 272c 2027 7062 3327 2c20 2772  'pb2', 'pb3', 'r
+00013730: 616e 646f 6d27 5d2c 205b 302e 312c 2030  andom'], [0.1, 0
+00013740: 2e31 2c20 302e 302c 2030 2e38 5d0d 0a20  .1, 0.0, 0.8].. 
+00013750: 2020 2020 2020 2020 2020 2029 5b30 5d0d             )[0].
+00013760: 0a20 2020 2020 2020 2069 6620 7472 656e  .        if tren
+00013770: 645f 6261 7365 203d 3d20 2272 616e 646f  d_base == "rando
+00013780: 6d22 3a0d 0a20 2020 2020 2020 2020 2020  m":..           
+00013790: 206d 6f64 656c 5f73 7472 203d 2072 616e   model_str = ran
+000137a0: 646f 6d2e 6368 6f69 6365 7328 0d0a 2020  dom.choices(..  
+000137b0: 2020 2020 2020 2020 2020 2020 2020 5b0d                [.
+000137c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000137d0: 2020 2020 2027 4176 6572 6167 6556 616c       'AverageVal
+000137e0: 7565 4e61 6976 6527 2c0d 0a20 2020 2020  ueNaive',..     
+000137f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00013800: 4d65 7472 6963 4d6f 7469 6627 2c0d 0a20  MetricMotif',.. 
+00013810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013820: 2020 2022 4c61 7374 5661 6c75 654e 6169     "LastValueNai
+00013830: 7665 222c 0d0a 2020 2020 2020 2020 2020  ve",..          
+00013840: 2020 2020 2020 2020 2020 2753 6561 736f            'Seaso
+00013850: 6e61 6c69 7479 4d6f 7469 6627 2c0d 0a20  nalityMotif',.. 
+00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013870: 2020 2027 5769 6e64 6f77 5265 6772 6573     'WindowRegres
+00013880: 7369 6f6e 272c 0d0a 2020 2020 2020 2020  sion',..        
+00013890: 2020 2020 2020 2020 2020 2020 2741 5244              'ARD
+000138a0: 4c27 2c0d 0a20 2020 2020 2020 2020 2020  L',..           
+000138b0: 2020 2020 2020 2020 2027 5641 5227 2c0d           'VAR',.
+000138c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000138d0: 2020 2020 2027 556e 6976 6172 6961 7465       'Univariate
+000138e0: 4d6f 7469 6627 2c0d 0a20 2020 2020 2020  Motif',..       
+000138f0: 2020 2020 2020 2020 2020 2020 2027 556e               'Un
+00013900: 6f62 7365 7276 6564 436f 6d70 6f6e 656e  observedComponen
+00013910: 7473 272c 0d0a 2020 2020 2020 2020 2020  ts',..          
+00013920: 2020 2020 2020 2020 2020 224b 616c 6d61            "Kalma
+00013930: 6e53 7461 7465 5370 6163 6522 2c0d 0a20  nStateSpace",.. 
+00013940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013950: 2020 2027 5252 5641 5227 2c0d 0a20 2020     'RRVAR',..   
+00013960: 2020 2020 2020 2020 2020 2020 205d 2c0d               ],.
+00013970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013980: 205b 302e 3035 2c20 302e 3035 2c20 302e   [0.05, 0.05, 0.
+00013990: 312c 2030 2e30 352c 2030 2e30 352c 2030  1, 0.05, 0.05, 0
+000139a0: 2e31 352c 2030 2e30 352c 2030 2e30 352c  .15, 0.05, 0.05,
+000139b0: 2030 2e30 352c 2030 2e30 352c 2030 2e30   0.05, 0.05, 0.0
+000139c0: 355d 2c0d 0a20 2020 2020 2020 2020 2020  5],..           
+000139d0: 2020 2020 206b 3d31 2c0d 0a20 2020 2020       k=1,..     
+000139e0: 2020 2020 2020 2029 5b30 5d0d 0a20 2020         )[0]..   
+000139f0: 2020 2020 2020 2020 2074 7265 6e64 5f6d           trend_m
+00013a00: 6f64 656c 203d 207b 274d 6f64 656c 273a  odel = {'Model':
+00013a10: 206d 6f64 656c 5f73 7472 7d0d 0a20 2020   model_str}..   
+00013a20: 2020 2020 2020 2020 2074 7265 6e64 5f6d           trend_m
+00013a30: 6f64 656c 5b27 4d6f 6465 6c50 6172 616d  odel['ModelParam
+00013a40: 6574 6572 7327 5d20 3d20 4d6f 6465 6c4d  eters'] = ModelM
+00013a50: 6f6e 7374 6572 286d 6f64 656c 5f73 7472  onster(model_str
+00013a60: 292e 6765 745f 6e65 775f 7061 7261 6d73  ).get_new_params
+00013a70: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00013a80: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00013a90: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00013aa0: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
+00013ab0: 6e64 5f74 7261 6e73 666f 726d 6174 696f  nd_transformatio
+00013ac0: 6e20 3d20 5261 6e64 6f6d 5472 616e 7366  n = RandomTransf
+00013ad0: 6f72 6d28 0d0a 2020 2020 2020 2020 2020  orm(..          
+00013ae0: 2020 2020 2020 7472 616e 7366 6f72 6d65        transforme
+00013af0: 725f 6c69 7374 3d22 6661 7374 222c 0d0a  r_list="fast",..
+00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b10: 7472 616e 7366 6f72 6d65 725f 6d61 785f  transformer_max_
+00013b20: 6465 7074 683d 332c 2020 2320 7072 6f62  depth=3,  # prob
+00013b30: 6162 6c79 2077 616e 7420 736f 6d65 206d  ably want some m
+00013b40: 6f72 6520 7573 6162 6c65 2064 6566 6175  ore usable defau
+00013b50: 6c74 7320 6669 7273 7420 6173 206d 616e  lts first as man
+00013b60: 7920 7261 6e64 6f6d 2061 7265 2073 656e  y random are sen
+00013b70: 7365 6c65 7373 0d0a 2020 2020 2020 2020  seless..        
+00013b80: 2020 2020 290d 0a20 2020 2020 2020 2065      )..        e
+00013b90: 6c69 6620 7472 656e 645f 6261 7365 203d  lif trend_base =
+00013ba0: 3d20 2770 6231 273a 0d0a 2020 2020 2020  = 'pb1':..      
+00013bb0: 2020 2020 2020 7472 656e 645f 6d6f 6465        trend_mode
+00013bc0: 6c20 3d20 7b27 4d6f 6465 6c27 3a20 2741  l = {'Model': 'A
+00013bd0: 5244 4c27 7d0d 0a20 2020 2020 2020 2020  RDL'}..         
+00013be0: 2020 2074 7265 6e64 5f6d 6f64 656c 5b27     trend_model['
+00013bf0: 4d6f 6465 6c50 6172 616d 6574 6572 7327  ModelParameters'
+00013c00: 5d20 3d20 7b0d 0a20 2020 2020 2020 2020  ] = {..         
+00013c10: 2020 2020 2020 2022 6c61 6773 223a 2031         "lags": 1
+00013c20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013c30: 2020 2022 7472 656e 6422 3a20 226e 222c     "trend": "n",
+00013c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013c50: 2020 226f 7264 6572 223a 2030 2c0d 0a20    "order": 0,.. 
+00013c60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013c70: 6361 7573 616c 223a 2046 616c 7365 2c0d  causal": False,.
+00013c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013c90: 2022 7265 6772 6573 7369 6f6e 5f74 7970   "regression_typ
+00013ca0: 6522 3a20 2273 696d 706c 6522 2c0d 0a20  e": "simple",.. 
+00013cb0: 2020 2020 2020 2020 2020 207d 0d0a 2020             }..  
+00013cc0: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+00013cd0: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
+00013ce0: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+00013cf0: 2020 2020 2266 696c 6c6e 6122 3a20 226e      "fillna": "n
+00013d00: 6561 7265 7374 222c 0d0a 2020 2020 2020  earest",..      
+00013d10: 2020 2020 2020 2020 2020 2274 7261 6e73            "trans
+00013d20: 666f 726d 6174 696f 6e73 223a 207b 2230  formations": {"0
+00013d30: 223a 2022 5374 616e 6461 7264 5363 616c  ": "StandardScal
+00013d40: 6572 222c 2022 3122 3a20 2241 6e6f 6d61  er", "1": "Anoma
+00013d50: 6c79 5265 6d6f 7661 6c22 7d2c 0d0a 2020  lyRemoval"},..  
+00013d60: 2020 2020 2020 2020 2020 2020 2020 2274                "t
+00013d70: 7261 6e73 666f 726d 6174 696f 6e5f 7061  ransformation_pa
+00013d80: 7261 6d73 223a 207b 0d0a 2020 2020 2020  rams": {..      
+00013d90: 2020 2020 2020 2020 2020 2020 2020 2230                "0
+00013da0: 223a 207b 7d2c 0d0a 2020 2020 2020 2020  ": {},..        
+00013db0: 2020 2020 2020 2020 2020 2020 2231 223a              "1":
+00013dc0: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+00013dd0: 2020 2020 2020 2020 2020 2020 226d 6574              "met
+00013de0: 686f 6422 3a20 2249 5152 222c 0d0a 2020  hod": "IQR",..  
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 2274 7261 6e73 666f 726d        "transform
+00013e10: 5f64 6963 7422 3a20 7b0d 0a20 2020 2020  _dict": {..     
+00013e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e30: 2020 2020 2020 2022 6669 6c6c 6e61 223a         "fillna":
+00013e40: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
 00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e60: 2020 2020 7d2c 0d0a 2020 2020 2020 2020      },..        
-00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e80: 2266 696c 6c6e 6122 3a20 2266 6669 6c6c  "fillna": "ffill
-00013e90: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00013ea0: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
-00013eb0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
-00013ec0: 2020 2020 2020 2020 2020 2020 7d0d 0a20              }.. 
-00013ed0: 2020 2020 2020 2065 6c69 6620 7472 656e         elif tren
-00013ee0: 645f 6261 7365 203d 3d20 2770 6232 273a  d_base == 'pb2':
-00013ef0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00013f00: 656e 645f 6d6f 6465 6c20 3d20 7b27 4d6f  end_model = {'Mo
-00013f10: 6465 6c27 3a20 2757 696e 646f 7752 6567  del': 'WindowReg
-00013f20: 7265 7373 696f 6e27 7d0d 0a20 2020 2020  ression'}..     
-00013f30: 2020 2020 2020 2074 7265 6e64 5f6d 6f64         trend_mod
-00013f40: 656c 5b27 4d6f 6465 6c50 6172 616d 6574  el['ModelParamet
-00013f50: 6572 7327 5d20 3d20 7b0d 0a20 2020 2020  ers'] = {..     
-00013f60: 2020 2020 2020 2020 2020 2022 7769 6e64             "wind
-00013f70: 6f77 5f73 697a 6522 3a20 3132 2c0d 0a20  ow_size": 12,.. 
-00013f80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013f90: 696e 7075 745f 6469 6d22 3a20 2275 6e69  input_dim": "uni
-00013fa0: 7661 7269 6174 6522 2c0d 0a20 2020 2020  variate",..     
-00013fb0: 2020 2020 2020 2020 2020 2022 6f75 7470             "outp
-00013fc0: 7574 5f64 696d 223a 2022 3173 7465 7022  ut_dim": "1step"
-00013fd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013fe0: 2020 2022 6e6f 726d 616c 697a 655f 7769     "normalize_wi
-00013ff0: 6e64 6f77 223a 2046 616c 7365 2c0d 0a20  ndow": False,.. 
-00014000: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014010: 6d61 785f 7769 6e64 6f77 7322 3a20 3830  max_windows": 80
-00014020: 3030 2c0d 0a20 2020 2020 2020 2020 2020  00,..           
-00014030: 2020 2020 2022 7265 6772 6573 7369 6f6e       "regression
-00014040: 5f74 7970 6522 3a20 4e6f 6e65 2c0d 0a20  _type": None,.. 
-00014050: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014060: 7265 6772 6573 7369 6f6e 5f6d 6f64 656c  regression_model
-00014070: 223a 207b 0d0a 2020 2020 2020 2020 2020  ": {..          
-00014080: 2020 2020 2020 2020 2020 226d 6f64 656c            "model
-00014090: 223a 2022 4578 7472 6154 7265 6573 222c  ": "ExtraTrees",
-000140a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000140b0: 2020 2020 2020 226d 6f64 656c 5f70 6172        "model_par
-000140c0: 616d 7322 3a20 7b0d 0a20 2020 2020 2020  ams": {..       
-000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140e0: 2022 6e5f 6573 7469 6d61 746f 7273 223a   "n_estimators":
-000140f0: 2031 3030 2c0d 0a20 2020 2020 2020 2020   100,..         
-00014100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014110: 6d69 6e5f 7361 6d70 6c65 735f 6c65 6166  min_samples_leaf
-00014120: 223a 2031 2c0d 0a20 2020 2020 2020 2020  ": 1,..         
-00014130: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014140: 6d61 785f 6465 7074 6822 3a20 3230 2c0d  max_depth": 20,.
-00014150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014160: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
-00014170: 2020 2020 2020 2020 207d 2c0d 0a20 2020           },..   
-00014180: 2020 2020 2020 2020 207d 0d0a 2020 2020           }..    
-00014190: 2020 2020 2020 2020 7472 656e 645f 7472          trend_tr
-000141a0: 616e 7366 6f72 6d61 7469 6f6e 203d 207b  ansformation = {
-000141b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000141c0: 2020 2266 696c 6c6e 6122 3a20 2266 6669    "fillna": "ffi
-000141d0: 6c6c 222c 0d0a 2020 2020 2020 2020 2020  ll",..          
-000141e0: 2020 2020 2020 2274 7261 6e73 666f 726d        "transform
-000141f0: 6174 696f 6e73 223a 207b 2230 223a 2022  ations": {"0": "
-00014200: 416e 6f6d 616c 7952 656d 6f76 616c 222c  AnomalyRemoval",
-00014210: 2022 3122 3a20 2252 6f62 7573 7453 6361   "1": "RobustSca
-00014220: 6c65 7222 7d2c 0d0a 2020 2020 2020 2020  ler"},..        
-00014230: 2020 2020 2020 2020 2274 7261 6e73 666f          "transfo
-00014240: 726d 6174 696f 6e5f 7061 7261 6d73 223a  rmation_params":
-00014250: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
-00014260: 2020 2020 2020 2020 2230 223a 207b 0d0a          "0": {..
+00013e60: 2020 2020 2274 7261 6e73 666f 726d 6174      "transformat
+00013e70: 696f 6e73 223a 207b 2230 223a 2022 436c  ions": {"0": "Cl
+00013e80: 6970 4f75 746c 6965 7273 227d 2c0d 0a20  ipOutliers"},.. 
+00013e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ea0: 2020 2020 2020 2020 2020 2022 7472 616e             "tran
+00013eb0: 7366 6f72 6d61 7469 6f6e 5f70 6172 616d  sformation_param
+00013ec0: 7322 3a20 7b0d 0a20 2020 2020 2020 2020  s": {..         
+00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ee0: 2020 2020 2020 2022 3022 3a20 7b22 6d65         "0": {"me
+00013ef0: 7468 6f64 223a 2022 636c 6970 222c 2022  thod": "clip", "
+00013f00: 7374 645f 7468 7265 7368 6f6c 6422 3a20  std_threshold": 
+00013f10: 367d 0d0a 2020 2020 2020 2020 2020 2020  6}..            
+00013f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f30: 7d2c 0d0a 2020 2020 2020 2020 2020 2020  },..            
+00013f40: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f60: 2020 2020 2020 2020 226d 6574 686f 645f          "method_
+00013f70: 7061 7261 6d73 223a 207b 0d0a 2020 2020  params": {..    
+00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f90: 2020 2020 2020 2020 2269 7172 5f74 6872          "iqr_thr
+00013fa0: 6573 686f 6c64 223a 2032 2e35 2c0d 0a20  eshold": 2.5,.. 
+00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fc0: 2020 2020 2020 2020 2020 2022 6971 725f             "iqr_
+00013fd0: 7175 616e 7469 6c65 7322 3a20 5b30 2e32  quantiles": [0.2
+00013fe0: 352c 2030 2e37 355d 2c0d 0a20 2020 2020  5, 0.75],..     
+00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014000: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
+00014010: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014020: 6669 6c6c 6e61 223a 2022 6666 696c 6c22  fillna": "ffill"
+00014030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00014040: 2020 2020 2020 207d 2c0d 0a20 2020 2020         },..     
+00014050: 2020 2020 2020 2020 2020 207d 2c0d 0a20             },.. 
+00014060: 2020 2020 2020 2020 2020 207d 0d0a 2020             }..  
+00014070: 2020 2020 2020 656c 6966 2074 7265 6e64        elif trend
+00014080: 5f62 6173 6520 3d3d 2027 7062 3227 3a0d  _base == 'pb2':.
+00014090: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
+000140a0: 6e64 5f6d 6f64 656c 203d 207b 274d 6f64  nd_model = {'Mod
+000140b0: 656c 273a 2027 5769 6e64 6f77 5265 6772  el': 'WindowRegr
+000140c0: 6573 7369 6f6e 277d 0d0a 2020 2020 2020  ession'}..      
+000140d0: 2020 2020 2020 7472 656e 645f 6d6f 6465        trend_mode
+000140e0: 6c5b 274d 6f64 656c 5061 7261 6d65 7465  l['ModelParamete
+000140f0: 7273 275d 203d 207b 0d0a 2020 2020 2020  rs'] = {..      
+00014100: 2020 2020 2020 2020 2020 2277 696e 646f            "windo
+00014110: 775f 7369 7a65 223a 2031 322c 0d0a 2020  w_size": 12,..  
+00014120: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+00014130: 6e70 7574 5f64 696d 223a 2022 756e 6976  nput_dim": "univ
+00014140: 6172 6961 7465 222c 0d0a 2020 2020 2020  ariate",..      
+00014150: 2020 2020 2020 2020 2020 226f 7574 7075            "outpu
+00014160: 745f 6469 6d22 3a20 2231 7374 6570 222c  t_dim": "1step",
+00014170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014180: 2020 226e 6f72 6d61 6c69 7a65 5f77 696e    "normalize_win
+00014190: 646f 7722 3a20 4661 6c73 652c 0d0a 2020  dow": False,..  
+000141a0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+000141b0: 6178 5f77 696e 646f 7773 223a 2038 3030  ax_windows": 800
+000141c0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+000141d0: 2020 2020 2272 6567 7265 7373 696f 6e5f      "regression_
+000141e0: 7479 7065 223a 204e 6f6e 652c 0d0a 2020  type": None,..  
+000141f0: 2020 2020 2020 2020 2020 2020 2020 2272                "r
+00014200: 6567 7265 7373 696f 6e5f 6d6f 6465 6c22  egression_model"
+00014210: 3a20 7b0d 0a20 2020 2020 2020 2020 2020  : {..           
+00014220: 2020 2020 2020 2020 2022 6d6f 6465 6c22           "model"
+00014230: 3a20 2245 7874 7261 5472 6565 7322 2c0d  : "ExtraTrees",.
+00014240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014250: 2020 2020 2022 6d6f 6465 6c5f 7061 7261       "model_para
+00014260: 6d73 223a 207b 0d0a 2020 2020 2020 2020  ms": {..        
 00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014280: 2020 2020 2020 2020 226d 6574 686f 6422          "method"
-00014290: 3a20 2249 5152 222c 0d0a 2020 2020 2020  : "IQR",..      
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 2020 2274 7261 6e73 666f 726d 5f64 6963    "transform_dic
-000142c0: 7422 3a20 7b0d 0a20 2020 2020 2020 2020  t": {..         
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142e0: 2020 2022 6669 6c6c 6e61 223a 204e 6f6e     "fillna": Non
-000142f0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014310: 2274 7261 6e73 666f 726d 6174 696f 6e73  "transformations
-00014320: 223a 207b 2230 223a 2022 436c 6970 4f75  ": {"0": "ClipOu
-00014330: 746c 6965 7273 227d 2c0d 0a20 2020 2020  tliers"},..     
-00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
-00014360: 6d61 7469 6f6e 5f70 6172 616d 7322 3a20  mation_params": 
-00014370: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014390: 2020 2022 3022 3a20 7b22 6d65 7468 6f64     "0": {"method
-000143a0: 223a 2022 636c 6970 222c 2022 7374 645f  ": "clip", "std_
-000143b0: 7468 7265 7368 6f6c 6422 3a20 367d 0d0a  threshold": 6}..
-000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143d0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143f0: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 2020 2020 226d 6574 686f 645f 7061 7261      "method_para
-00014420: 6d73 223a 207b 0d0a 2020 2020 2020 2020  ms": {..        
-00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014440: 2020 2020 2269 7172 5f74 6872 6573 686f      "iqr_thresho
-00014450: 6c64 223a 2032 2e35 2c0d 0a20 2020 2020  ld": 2.5,..     
-00014460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014470: 2020 2020 2020 2022 6971 725f 7175 616e         "iqr_quan
-00014480: 7469 6c65 7322 3a20 5b30 2e32 352c 2030  tiles": [0.25, 0
-00014490: 2e37 355d 2c0d 0a20 2020 2020 2020 2020  .75],..         
-000144a0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000144b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000144c0: 2020 2020 2020 2020 2020 2022 6669 6c6c             "fill
-000144d0: 6e61 223a 2022 6666 696c 6c22 2c0d 0a20  na": "ffill",.. 
+00014280: 226e 5f65 7374 696d 6174 6f72 7322 3a20  "n_estimators": 
+00014290: 3130 302c 0d0a 2020 2020 2020 2020 2020  100,..          
+000142a0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+000142b0: 696e 5f73 616d 706c 6573 5f6c 6561 6622  in_samples_leaf"
+000142c0: 3a20 312c 0d0a 2020 2020 2020 2020 2020  : 1,..          
+000142d0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+000142e0: 6178 5f64 6570 7468 223a 2032 302c 0d0a  ax_depth": 20,..
+000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014300: 2020 2020 7d2c 0d0a 2020 2020 2020 2020      },..        
+00014310: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
+00014320: 2020 2020 2020 2020 7d0d 0a20 2020 2020          }..     
+00014330: 2020 2020 2020 2074 7265 6e64 5f74 7261         trend_tra
+00014340: 6e73 666f 726d 6174 696f 6e20 3d20 7b0d  nsformation = {.
+00014350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014360: 2022 6669 6c6c 6e61 223a 2022 6666 696c   "fillna": "ffil
+00014370: 6c22 2c0d 0a20 2020 2020 2020 2020 2020  l",..           
+00014380: 2020 2020 2022 7472 616e 7366 6f72 6d61       "transforma
+00014390: 7469 6f6e 7322 3a20 7b22 3022 3a20 2241  tions": {"0": "A
+000143a0: 6e6f 6d61 6c79 5265 6d6f 7661 6c22 2c20  nomalyRemoval", 
+000143b0: 2231 223a 2022 526f 6275 7374 5363 616c  "1": "RobustScal
+000143c0: 6572 227d 2c0d 0a20 2020 2020 2020 2020  er"},..         
+000143d0: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
+000143e0: 6d61 7469 6f6e 5f70 6172 616d 7322 3a20  mation_params": 
+000143f0: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
+00014400: 2020 2020 2020 2022 3022 3a20 7b0d 0a20         "0": {.. 
+00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014420: 2020 2020 2020 2022 6d65 7468 6f64 223a         "method":
+00014430: 2022 4951 5222 2c0d 0a20 2020 2020 2020   "IQR",..       
+00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014450: 2022 7472 616e 7366 6f72 6d5f 6469 6374   "transform_dict
+00014460: 223a 207b 0d0a 2020 2020 2020 2020 2020  ": {..          
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 2020 2266 696c 6c6e 6122 3a20 4e6f 6e65    "fillna": None
+00014490: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000144a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000144b0: 7472 616e 7366 6f72 6d61 7469 6f6e 7322  transformations"
+000144c0: 3a20 7b22 3022 3a20 2243 6c69 704f 7574  : {"0": "ClipOut
+000144d0: 6c69 6572 7322 7d2c 0d0a 2020 2020 2020  liers"},..      
 000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
-00014500: 2020 2020 2020 2020 2020 2022 3122 3a20             "1": 
-00014510: 7b7d 2c0d 0a20 2020 2020 2020 2020 2020  {},..           
-00014520: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
-00014530: 2020 2020 207d 0d0a 0d0a 2020 2020 2020       }....      
-00014540: 2020 7472 656e 645f 616e 6f6d 616c 795f    trend_anomaly_
-00014550: 696e 7465 7276 656e 7469 6f6e 203d 2072  intervention = r
-00014560: 616e 646f 6d2e 6368 6f69 6365 7328 5b4e  andom.choices([N
-00014570: 6f6e 652c 2027 6465 7465 6374 5f6f 6e6c  one, 'detect_onl
-00014580: 7927 5d2c 205b 302e 352c 2030 2e35 5d29  y'], [0.5, 0.5])
-00014590: 5b0d 0a20 2020 2020 2020 2020 2020 2030  [..            0
-000145a0: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
-000145b0: 2020 2020 2069 6620 7472 656e 645f 616e       if trend_an
-000145c0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-000145d0: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0d  on is not None:.
-000145e0: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
-000145f0: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-00014600: 746f 725f 7061 7261 6d73 203d 2041 6e6f  tor_params = Ano
-00014610: 6d61 6c79 5265 6d6f 7661 6c2e 6765 745f  malyRemoval.get_
-00014620: 6e65 775f 7061 7261 6d73 286d 6574 686f  new_params(metho
-00014630: 643d 6d65 7468 6f64 290d 0a20 2020 2020  d=method)..     
-00014640: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00014650: 2020 2020 2020 7472 656e 645f 616e 6f6d        trend_anom
-00014660: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
-00014670: 616d 7320 3d20 4e6f 6e65 0d0a 2020 2020  ams = None..    
-00014680: 2020 2020 6c69 6e65 6172 5f6d 6f64 656c      linear_model
-00014690: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
-000146a0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
-000146b0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-000146c0: 2020 2027 6c73 7473 7127 2c0d 0a20 2020     'lstsq',..   
-000146d0: 2020 2020 2020 2020 2020 2020 2027 6c69               'li
-000146e0: 6e61 6c67 5f73 6f6c 7665 272c 0d0a 2020  nalg_solve',..  
-000146f0: 2020 2020 2020 2020 2020 2020 2020 276c                'l
-00014700: 315f 6e6f 726d 272c 0d0a 2020 2020 2020  1_norm',..      
-00014710: 2020 2020 2020 2020 2020 2764 7761 655f            'dwae_
-00014720: 6e6f 726d 272c 0d0a 2020 2020 2020 2020  norm',..        
-00014730: 2020 2020 2020 2020 2771 7561 6e74 696c          'quantil
-00014740: 655f 6e6f 726d 272c 0d0a 2020 2020 2020  e_norm',..      
-00014750: 2020 2020 2020 2020 2020 276c 315f 706f            'l1_po
-00014760: 7369 7469 7665 272c 0d0a 2020 2020 2020  sitive',..      
-00014770: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
-00014780: 2020 2020 2020 5b30 2e36 2c20 302e 322c        [0.6, 0.2,
-00014790: 2030 2e31 2c20 302e 3035 2c20 302e 3032   0.1, 0.05, 0.02
-000147a0: 2c20 302e 3033 5d2c 0d0a 2020 2020 2020  , 0.03],..      
-000147b0: 2020 295b 305d 0d0a 2020 2020 2020 2020    )[0]..        
-000147c0: 7265 6365 6e63 795f 7765 6967 6874 696e  recency_weightin
-000147d0: 6720 3d20 7261 6e64 6f6d 2e63 686f 6963  g = random.choic
-000147e0: 6573 280d 0a20 2020 2020 2020 2020 2020  es(..           
-000147f0: 205b 4e6f 6e65 2c20 302e 3035 2c20 302e   [None, 0.05, 0.
-00014800: 312c 2030 2e32 352c 2030 2e35 5d2c 205b  1, 0.25, 0.5], [
-00014810: 302e 372c 2030 2e31 2c20 302e 312c 2030  0.7, 0.1, 0.1, 0
-00014820: 2e31 2c20 302e 3035 5d0d 0a20 2020 2020  .1, 0.05]..     
-00014830: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
-00014840: 2069 6620 6c69 6e65 6172 5f6d 6f64 656c   if linear_model
-00014850: 2069 6e20 5b27 6c73 7473 7127 5d3a 0d0a   in ['lstsq']:..
-00014860: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00014870: 6172 5f6d 6f64 656c 203d 207b 0d0a 2020  ar_model = {..  
-00014880: 2020 2020 2020 2020 2020 2020 2020 276d                'm
-00014890: 6f64 656c 273a 206c 696e 6561 725f 6d6f  odel': linear_mo
-000148a0: 6465 6c2c 0d0a 2020 2020 2020 2020 2020  del,..          
-000148b0: 2020 2020 2020 276c 616d 6264 6127 3a20        'lambda': 
-000148c0: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
-000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000148e0: 2020 2020 205b 4e6f 6e65 2c20 302e 312c       [None, 0.1,
-000148f0: 2031 2c20 3130 2c20 3130 305d 2c20 5b30   1, 10, 100], [0
-00014900: 2e37 2c20 302e 312c 2030 2e31 2c20 302e  .7, 0.1, 0.1, 0.
-00014910: 312c 2030 2e30 355d 0d0a 2020 2020 2020  1, 0.05]..      
-00014920: 2020 2020 2020 2020 2020 295b 305d 2c0d            )[0],.
-00014930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014940: 2027 7265 6365 6e63 795f 7765 6967 6874   'recency_weight
-00014950: 696e 6727 3a20 7265 6365 6e63 795f 7765  ing': recency_we
-00014960: 6967 6874 696e 672c 0d0a 2020 2020 2020  ighting,..      
-00014970: 2020 2020 2020 7d0d 0a20 2020 2020 2020        }..       
-00014980: 2069 6620 6c69 6e65 6172 5f6d 6f64 656c   if linear_model
-00014990: 2069 6e20 5b27 6c69 6e61 6c67 5f73 6f6c   in ['linalg_sol
-000149a0: 7665 275d 3a0d 0a20 2020 2020 2020 2020  ve']:..         
-000149b0: 2020 206c 696e 6561 725f 6d6f 6465 6c20     linear_model 
-000149c0: 3d20 7b0d 0a20 2020 2020 2020 2020 2020  = {..           
-000149d0: 2020 2020 2027 6d6f 6465 6c27 3a20 6c69       'model': li
-000149e0: 6e65 6172 5f6d 6f64 656c 2c0d 0a20 2020  near_model,..   
-000149f0: 2020 2020 2020 2020 2020 2020 2027 6c61               'la
-00014a00: 6d62 6461 273a 2072 616e 646f 6d2e 6368  mbda': random.ch
-00014a10: 6f69 6365 7328 5b30 2c20 302e 312c 2031  oices([0, 0.1, 1
-00014a20: 2c20 3130 5d2c 205b 302e 342c 2030 2e32  , 10], [0.4, 0.2
-00014a30: 2c20 302e 322c 2030 2e32 5d29 5b30 5d2c  , 0.2, 0.2])[0],
-00014a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014a50: 2020 2772 6563 656e 6379 5f77 6569 6768    'recency_weigh
-00014a60: 7469 6e67 273a 2072 6563 656e 6379 5f77  ting': recency_w
-00014a70: 6569 6768 7469 6e67 2c0d 0a20 2020 2020  eighting,..     
-00014a80: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
-00014a90: 2020 656c 6966 206c 696e 6561 725f 6d6f    elif linear_mo
-00014aa0: 6465 6c20 696e 205b 276c 315f 6e6f 726d  del in ['l1_norm
-00014ab0: 272c 2027 6477 6165 5f6e 6f72 6d27 2c20  ', 'dwae_norm', 
-00014ac0: 2771 7561 6e74 696c 655f 6e6f 726d 272c  'quantile_norm',
-00014ad0: 2027 6c31 5f70 6f73 6974 6976 6527 5d3a   'l1_positive']:
-00014ae0: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-00014af0: 6e65 6172 5f6d 6f64 656c 203d 207b 0d0a  near_model = {..
-00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b10: 276d 6f64 656c 273a 206c 696e 6561 725f  'model': linear_
-00014b20: 6d6f 6465 6c2c 0d0a 2020 2020 2020 2020  model,..        
-00014b30: 2020 2020 2020 2020 2772 6563 656e 6379          'recency
-00014b40: 5f77 6569 6768 7469 6e67 273a 2072 6563  _weighting': rec
-00014b50: 656e 6379 5f77 6569 6768 7469 6e67 2c0d  ency_weighting,.
-00014b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014b70: 2027 6d61 7869 7465 7227 3a20 7261 6e64   'maxiter': rand
-00014b80: 6f6d 2e63 686f 6963 6573 285b 3235 302c  om.choices([250,
-00014b90: 2031 3530 3030 2c20 3235 3030 305d 2c20   15000, 25000], 
-00014ba0: 5b30 2e32 2c20 302e 362c 2030 2e32 5d29  [0.2, 0.6, 0.2])
-00014bb0: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-00014bc0: 2020 7d0d 0a20 2020 2020 2020 2069 6620    }..        if 
-00014bd0: 6d65 7468 6f64 203d 3d20 2272 6567 7265  method == "regre
-00014be0: 7373 6f72 223a 0d0a 2020 2020 2020 2020  ssor":..        
-00014bf0: 2020 2020 7265 6772 6573 736f 7273 5f75      regressors_u
-00014c00: 7365 6420 3d20 5472 7565 0d0a 2020 2020  sed = True..    
-00014c10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00014c20: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
-00014c30: 735f 7573 6564 203d 2072 616e 646f 6d2e  s_used = random.
-00014c40: 6368 6f69 6365 7328 5b54 7275 652c 2046  choices([True, F
-00014c50: 616c 7365 5d2c 205b 302e 352c 2030 2e35  alse], [0.5, 0.5
-00014c60: 5d29 5b30 5d0d 0a20 2020 2020 2020 2061  ])[0]..        a
-00014c70: 725f 6c61 6773 203d 2072 616e 646f 6d2e  r_lags = random.
-00014c80: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
-00014c90: 2020 2020 2020 5b4e 6f6e 652c 205b 315d        [None, [1]
-00014ca0: 2c20 5b31 2c20 375d 2c20 5b37 5d2c 205b  , [1, 7], [7], [
-00014cb0: 7365 6173 6f6e 616c 5f69 6e74 2873 6d61  seasonal_int(sma
-00014cc0: 6c6c 3d54 7275 6529 5d5d 2c0d 0a20 2020  ll=True)]],..   
-00014cd0: 2020 2020 2020 2020 205b 302e 392c 2030           [0.9, 0
-00014ce0: 2e30 3235 2c20 302e 3032 352c 2030 2e30  .025, 0.025, 0.0
-00014cf0: 352c 2030 2e30 355d 2c0d 0a20 2020 2020  5, 0.05],..     
-00014d00: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
-00014d10: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
-00014d20: 7365 6173 6f6e 616c 6974 7920 3d20 4e6f  seasonality = No
-00014d30: 6e65 0d0a 2020 2020 2020 2020 6966 2061  ne..        if a
-00014d40: 725f 6c61 6773 2069 7320 6e6f 7420 4e6f  r_lags is not No
-00014d50: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00014d60: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
-00014d70: 7365 6173 6f6e 616c 6974 7920 3d20 7261  seasonality = ra
-00014d80: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
-00014d90: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00014da0: 4e6f 6e65 2c20 372c 2027 6461 796f 6677  None, 7, 'dayofw
-00014db0: 6565 6b27 2c20 2763 6f6d 6d6f 6e5f 666f  eek', 'common_fo
-00014dc0: 7572 6965 7227 5d2c 205b 302e 342c 2030  urier'], [0.4, 0
-00014dd0: 2e32 2c20 302e 322c 2030 2e32 5d0d 0a20  .2, 0.2, 0.2].. 
-00014de0: 2020 2020 2020 2020 2020 2029 5b30 5d0d             )[0].
-00014df0: 0a20 2020 2020 2020 2073 6561 736f 6e61  .        seasona
-00014e00: 6c69 7469 6573 203d 2072 616e 646f 6d2e  lities = random.
-00014e10: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
-00014e20: 2020 2020 2020 5b0d 0a20 2020 2020 2020        [..       
-00014e30: 2020 2020 2020 2020 205b 372c 2033 3635           [7, 365
-00014e40: 2e32 355d 2c0d 0a20 2020 2020 2020 2020  .25],..         
-00014e50: 2020 2020 2020 205b 2264 6179 6f66 7765         ["dayofwe
-00014e60: 656b 222c 2033 3635 2e32 355d 2c0d 0a20  ek", 365.25],.. 
-00014e70: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00014e80: 226d 6f6e 7468 222c 2022 6461 796f 6677  "month", "dayofw
-00014e90: 6565 6b22 2c20 2277 6565 6b64 6179 6f66  eek", "weekdayof
-00014ea0: 6d6f 6e74 6822 5d2c 0d0a 2020 2020 2020  month"],..      
-00014eb0: 2020 2020 2020 2020 2020 5b27 7765 656b            ['week
-00014ec0: 6461 796f 666d 6f6e 7468 272c 2027 636f  dayofmonth', 'co
-00014ed0: 6d6d 6f6e 5f66 6f75 7269 6572 275d 2c0d  mmon_fourier'],.
-00014ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ef0: 2022 6f74 6865 7222 2c0d 0a20 2020 2020   "other",..     
-00014f00: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
-00014f10: 2020 2020 2020 205b 302e 312c 2030 2e31         [0.1, 0.1
-00014f20: 2c20 302e 312c 2030 2e30 352c 2030 2e31  , 0.1, 0.05, 0.1
-00014f30: 5d2c 0d0a 2020 2020 2020 2020 295b 305d  ],..        )[0]
-00014f40: 0d0a 2020 2020 2020 2020 6966 2073 6561  ..        if sea
-00014f50: 736f 6e61 6c69 7469 6573 203d 3d20 226f  sonalities == "o
-00014f60: 7468 6572 223a 0d0a 2020 2020 2020 2020  ther":..        
-00014f70: 2020 2020 7072 6564 6566 696e 6564 203d      predefined =
-00014f80: 2072 616e 646f 6d2e 6368 6f69 6365 7328   random.choices(
-00014f90: 5b54 7275 652c 2046 616c 7365 5d2c 205b  [True, False], [
-00014fa0: 302e 352c 2030 2e35 5d29 5b30 5d0d 0a20  0.5, 0.5])[0].. 
-00014fb0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00014fc0: 6564 6566 696e 6564 3a0d 0a20 2020 2020  edefined:..     
-00014fd0: 2020 2020 2020 2020 2020 2073 6561 736f             seaso
-00014fe0: 6e61 6c69 7469 6573 203d 2072 616e 646f  nalities = rando
-00014ff0: 6d2e 6368 6f69 6365 2864 6174 655f 7061  m.choice(date_pa
-00015000: 7274 5f6d 6574 686f 6473 290d 0a20 2020  rt_methods)..   
-00015010: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015030: 636f 6d70 5f6f 7074 7320 3d20 6461 7465  comp_opts = date
-00015040: 7061 7274 5f63 6f6d 706f 6e65 6e74 7320  part_components 
-00015050: 2b20 5b37 2c20 3336 352e 3235 2c20 3132  + [7, 365.25, 12
-00015060: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00015070: 2020 2073 6561 736f 6e61 6c69 7469 6573     seasonalities
-00015080: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
-00015090: 7328 636f 6d70 5f6f 7074 732c 206b 3d32  s(comp_opts, k=2
-000150a0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000150b0: 6e20 7b0d 0a20 2020 2020 2020 2020 2020  n {..           
-000150c0: 2022 7072 6570 726f 6365 7373 696e 675f   "preprocessing_
-000150d0: 7472 616e 7366 6f72 6d61 7469 6f6e 223a  transformation":
-000150e0: 2052 616e 646f 6d54 7261 6e73 666f 726d   RandomTransform
-000150f0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00015100: 2020 2074 7261 6e73 666f 726d 6572 5f6c     transformer_l
-00015110: 6973 743d 6669 6c74 6572 732c 2074 7261  ist=filters, tra
-00015120: 6e73 666f 726d 6572 5f6d 6178 5f64 6570  nsformer_max_dep
-00015130: 7468 3d32 2c20 616c 6c6f 775f 6e6f 6e65  th=2, allow_none
-00015140: 3d54 7275 650d 0a20 2020 2020 2020 2020  =True..         
-00015150: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
-00015160: 2020 2022 7363 616c 696e 6722 3a20 7363     "scaling": sc
-00015170: 616c 696e 672c 0d0a 2020 2020 2020 2020  aling,..        
-00015180: 2020 2020 2320 2270 6173 745f 696d 7061      # "past_impa
-00015190: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
-000151a0: 223a 2073 656c 662e 7061 7374 5f69 6d70  ": self.past_imp
-000151b0: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
-000151c0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-000151d0: 2273 6561 736f 6e61 6c69 7469 6573 223a  "seasonalities":
-000151e0: 2073 6561 736f 6e61 6c69 7469 6573 2c0d   seasonalities,.
-000151f0: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
-00015200: 5f6c 6167 7322 3a20 6172 5f6c 6167 732c  _lags": ar_lags,
-00015210: 0d0a 2020 2020 2020 2020 2020 2020 2261  ..            "a
-00015220: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
-00015230: 6173 6f6e 616c 6974 7922 3a20 6172 5f69  asonality": ar_i
-00015240: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
-00015250: 6e61 6c69 7479 2c0d 0a20 2020 2020 2020  nality,..       
-00015260: 2020 2020 2022 616e 6f6d 616c 795f 6465       "anomaly_de
-00015270: 7465 6374 6f72 5f70 6172 616d 7322 3a20  tector_params": 
-00015280: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00015290: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
-000152a0: 2020 2020 2020 2261 6e6f 6d61 6c79 5f69        "anomaly_i
-000152b0: 6e74 6572 7665 6e74 696f 6e22 3a20 616e  ntervention": an
-000152c0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
-000152d0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-000152e0: 2022 686f 6c69 6461 795f 6465 7465 6374   "holiday_detect
-000152f0: 6f72 5f70 6172 616d 7322 3a20 686f 6c69  or_params": holi
-00015300: 6461 795f 7061 7261 6d73 2c0d 0a20 2020  day_params,..   
-00015310: 2020 2020 2020 2020 2023 2022 686f 6c69           # "holi
-00015320: 6461 795f 636f 756e 7472 6965 7322 3a20  day_countries": 
-00015330: 7365 6c66 2e68 6f6c 6964 6179 5f63 6f75  self.holiday_cou
-00015340: 6e74 7269 6573 2c0d 0a20 2020 2020 2020  ntries,..       
-00015350: 2020 2020 2022 686f 6c69 6461 795f 636f       "holiday_co
-00015360: 756e 7472 6965 735f 7573 6564 223a 2072  untries_used": r
-00015370: 616e 646f 6d2e 6368 6f69 6365 7328 5b54  andom.choices([T
-00015380: 7275 652c 2046 616c 7365 5d2c 205b 302e  rue, False], [0.
-00015390: 352c 2030 2e35 5d29 5b30 5d2c 0d0a 2020  5, 0.5])[0],..  
-000153a0: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
-000153b0: 7661 7269 6174 655f 6665 6174 7572 6522  variate_feature"
-000153c0: 3a20 7261 6e64 6f6d 2e63 686f 6963 6573  : random.choices
-000153d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000153e0: 2020 205b 4e6f 6e65 2c20 2266 6561 7475     [None, "featu
-000153f0: 7265 5f61 6767 6c6f 6d65 7261 7469 6f6e  re_agglomeration
-00015400: 222c 2027 6772 6f75 705f 6176 6572 6167  ", 'group_averag
-00015410: 6527 2c20 276f 7363 696c 6c61 746f 7227  e', 'oscillator'
-00015420: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00015430: 2020 2020 5b30 2e39 2c20 302e 312c 2030      [0.9, 0.1, 0
-00015440: 2e31 2c20 302e 305d 2c0d 0a20 2020 2020  .1, 0.0],..     
-00015450: 2020 2020 2020 2029 5b30 5d2c 0d0a 2020         )[0],..  
-00015460: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
-00015470: 7661 7269 6174 655f 7472 616e 7366 6f72  variate_transfor
-00015480: 6d61 7469 6f6e 223a 2052 616e 646f 6d54  mation": RandomT
-00015490: 7261 6e73 666f 726d 280d 0a20 2020 2020  ransform(..     
-000154a0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-000154b0: 666f 726d 6572 5f6c 6973 743d 2266 6173  former_list="fas
-000154c0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000154d0: 2020 2020 2074 7261 6e73 666f 726d 6572       transformer
-000154e0: 5f6d 6178 5f64 6570 7468 3d33 2c20 2023  _max_depth=3,  #
-000154f0: 2070 726f 6261 626c 7920 7761 6e74 2073   probably want s
-00015500: 6f6d 6520 6d6f 7265 2075 7361 626c 6520  ome more usable 
-00015510: 6465 6661 756c 7473 2066 6972 7374 2061  defaults first a
-00015520: 7320 6d61 6e79 2072 616e 646f 6d20 6172  s many random ar
-00015530: 6520 7365 6e73 656c 6573 730d 0a20 2020  e senseless..   
-00015540: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
-00015550: 2020 2020 2020 2020 2022 7265 6772 6573           "regres
-00015560: 736f 725f 7472 616e 7366 6f72 6d61 7469  sor_transformati
-00015570: 6f6e 223a 2052 616e 646f 6d54 7261 6e73  on": RandomTrans
-00015580: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
-00015590: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-000155a0: 6572 5f6c 6973 743d 7b2a 2a73 6361 6c65  er_list={**scale
-000155b0: 7273 2c20 2a2a 6465 636f 6d70 6f73 6974  rs, **decomposit
-000155c0: 696f 6e73 7d2c 0d0a 2020 2020 2020 2020  ions},..        
-000155d0: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
-000155e0: 6d65 725f 6d61 785f 6465 7074 683d 312c  mer_max_depth=1,
-000155f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00015600: 2020 616c 6c6f 775f 6e6f 6e65 3d46 616c    allow_none=Fal
-00015610: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
-00015620: 2020 2020 206e 6f5f 6e61 6e5f 6669 6c6c       no_nan_fill
-00015630: 3d46 616c 7365 2c20 2023 2070 726f 6261  =False,  # proba
-00015640: 626c 7920 7761 6e74 2073 6f6d 6520 6d6f  bly want some mo
-00015650: 7265 2075 7361 626c 6520 6465 6661 756c  re usable defaul
-00015660: 7473 2066 6972 7374 2061 7320 6d61 6e79  ts first as many
-00015670: 2072 616e 646f 6d20 6172 6520 7365 6e73   random are sens
-00015680: 656c 6573 730d 0a20 2020 2020 2020 2020  eless..         
-00015690: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
-000156a0: 2020 2022 7265 6772 6573 736f 7273 5f75     "regressors_u
-000156b0: 7365 6422 3a20 7265 6772 6573 736f 7273  sed": regressors
-000156c0: 5f75 7365 642c 0d0a 2020 2020 2020 2020  _used,..        
-000156d0: 2020 2020 226c 696e 6561 725f 6d6f 6465      "linear_mode
-000156e0: 6c22 3a20 6c69 6e65 6172 5f6d 6f64 656c  l": linear_model
-000156f0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00015700: 7261 6e64 6f6d 7761 6c6b 5f6e 223a 2072  randomwalk_n": r
-00015710: 616e 646f 6d2e 6368 6f69 6365 7328 5b4e  andom.choices([N
-00015720: 6f6e 652c 2031 305d 2c20 5b30 2e35 2c20  one, 10], [0.5, 
-00015730: 302e 355d 295b 305d 2c0d 0a20 2020 2020  0.5])[0],..     
-00015740: 2020 2020 2020 2022 7472 656e 645f 7769         "trend_wi
-00015750: 6e64 6f77 223a 2072 616e 646f 6d2e 6368  ndow": random.ch
-00015760: 6f69 6365 7328 5b33 2c20 3135 2c20 3930  oices([3, 15, 90
-00015770: 2c20 3336 355d 2c20 5b30 2e32 2c20 302e  , 365], [0.2, 0.
-00015780: 322c 2030 2e32 2c20 302e 325d 295b 305d  2, 0.2, 0.2])[0]
-00015790: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000157a0: 7472 656e 645f 7374 616e 6469 6e22 3a20  trend_standin": 
-000157b0: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
-000157c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000157d0: 205b 4e6f 6e65 2c20 2772 616e 646f 6d5f   [None, 'random_
-000157e0: 6e6f 726d 616c 272c 2027 726f 6c6c 696e  normal', 'rollin
-000157f0: 675f 7472 656e 6427 5d2c 0d0a 2020 2020  g_trend'],..    
-00015800: 2020 2020 2020 2020 2020 2020 5b30 2e35              [0.5
-00015810: 2c20 302e 342c 2030 2e31 5d2c 0d0a 2020  , 0.4, 0.1],..  
-00015820: 2020 2020 2020 2020 2020 295b 305d 2c0d            )[0],.
-00015830: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
-00015840: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
-00015850: 6374 6f72 5f70 6172 616d 7322 3a20 7472  ctor_params": tr
-00015860: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
-00015870: 6374 6f72 5f70 6172 616d 732c 0d0a 2020  ctor_params,..  
-00015880: 2020 2020 2020 2020 2020 2320 2274 7265            # "tre
-00015890: 6e64 5f61 6e6f 6d61 6c79 5f69 6e74 6572  nd_anomaly_inter
-000158a0: 7665 6e74 696f 6e22 3a20 7472 656e 645f  vention": trend_
-000158b0: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
-000158c0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
-000158d0: 2020 2022 7472 656e 645f 7472 616e 7366     "trend_transf
-000158e0: 6f72 6d61 7469 6f6e 223a 2074 7265 6e64  ormation": trend
-000158f0: 5f74 7261 6e73 666f 726d 6174 696f 6e2c  _transformation,
-00015900: 0d0a 2020 2020 2020 2020 2020 2020 2274  ..            "t
-00015910: 7265 6e64 5f6d 6f64 656c 223a 2074 7265  rend_model": tre
-00015920: 6e64 5f6d 6f64 656c 2c0d 0a20 2020 2020  nd_model,..     
-00015930: 2020 2020 2020 2022 7472 656e 645f 7068         "trend_ph
-00015940: 6922 3a20 7261 6e64 6f6d 2e63 686f 6963  i": random.choic
-00015950: 6573 285b 4e6f 6e65 2c20 302e 3938 5d2c  es([None, 0.98],
-00015960: 205b 302e 392c 2030 2e31 5d29 5b30 5d2c   [0.9, 0.1])[0],
-00015970: 0d0a 2020 2020 2020 2020 7d0d 0a0d 0a20  ..        }.... 
-00015980: 2020 2064 6566 2067 6574 5f70 6172 616d     def get_param
-00015990: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-000159a0: 2020 7265 7475 726e 207b 0d0a 2020 2020    return {..    
-000159b0: 2020 2020 2020 2020 2270 7265 7072 6f63          "preproc
-000159c0: 6573 7369 6e67 5f74 7261 6e73 666f 726d  essing_transform
-000159d0: 6174 696f 6e22 3a20 7365 6c66 2e70 7265  ation": self.pre
-000159e0: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
-000159f0: 666f 726d 6174 696f 6e2c 0d0a 2020 2020  formation,..    
-00015a00: 2020 2020 2020 2020 2273 6361 6c69 6e67          "scaling
-00015a10: 223a 2073 656c 662e 7363 616c 696e 672c  ": self.scaling,
-00015a20: 0d0a 2020 2020 2020 2020 2020 2020 2270  ..            "p
-00015a30: 6173 745f 696d 7061 6374 735f 696e 7465  ast_impacts_inte
-00015a40: 7276 656e 7469 6f6e 223a 2073 656c 662e  rvention": self.
-00015a50: 7061 7374 5f69 6d70 6163 7473 5f69 6e74  past_impacts_int
-00015a60: 6572 7665 6e74 696f 6e2c 2020 2320 6e6f  ervention,  # no
-00015a70: 7420 696e 206e 6577 0d0a 2020 2020 2020  t in new..      
-00015a80: 2020 2020 2020 2273 6561 736f 6e61 6c69        "seasonali
-00015a90: 7469 6573 223a 2073 656c 662e 7365 6173  ties": self.seas
-00015aa0: 6f6e 616c 6974 6965 732c 0d0a 2020 2020  onalities,..    
-00015ab0: 2020 2020 2020 2020 2261 725f 6c61 6773          "ar_lags
-00015ac0: 223a 2073 656c 662e 6172 5f6c 6167 732c  ": self.ar_lags,
-00015ad0: 0d0a 2020 2020 2020 2020 2020 2020 2261  ..            "a
-00015ae0: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
-00015af0: 6173 6f6e 616c 6974 7922 3a20 7365 6c66  asonality": self
-00015b00: 2e61 725f 696e 7465 7261 6374 696f 6e5f  .ar_interaction_
-00015b10: 7365 6173 6f6e 616c 6974 790d 0a20 2020  seasonality..   
-00015b20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00015b30: 2e61 725f 6c61 6773 2069 7320 6e6f 7420  .ar_lags is not 
-00015b40: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00015b50: 2020 656c 7365 204e 6f6e 652c 0d0a 2020    else None,..  
-00015b60: 2020 2020 2020 2020 2020 2261 6e6f 6d61            "anoma
-00015b70: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00015b80: 6d73 223a 2073 656c 662e 616e 6f6d 616c  ms": self.anomal
-00015b90: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
-00015ba0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00015bb0: 2261 6e6f 6d61 6c79 5f69 6e74 6572 7665  "anomaly_interve
-00015bc0: 6e74 696f 6e22 3a20 7365 6c66 2e61 6e6f  ntion": self.ano
-00015bd0: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
-00015be0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00015bf0: 2268 6f6c 6964 6179 5f64 6574 6563 746f  "holiday_detecto
-00015c00: 725f 7061 7261 6d73 223a 2073 656c 662e  r_params": self.
-00015c10: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
-00015c20: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
-00015c30: 2020 2020 2020 2320 2268 6f6c 6964 6179        # "holiday
-00015c40: 5f69 6e74 6572 7665 6e74 696f 6e22 3a20  _intervention": 
-00015c50: 7365 6c66 2e68 6f6c 6964 6179 5f69 6e74  self.holiday_int
-00015c60: 6572 7665 6e74 696f 6e2c 0d0a 2020 2020  ervention,..    
-00015c70: 2020 2020 2020 2020 2320 2268 6f6c 6964          # "holid
-00015c80: 6179 5f63 6f75 6e74 7269 6573 223a 2073  ay_countries": s
-00015c90: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-00015ca0: 7472 6965 732c 0d0a 2020 2020 2020 2020  tries,..        
-00015cb0: 2020 2020 2268 6f6c 6964 6179 5f63 6f75      "holiday_cou
-00015cc0: 6e74 7269 6573 5f75 7365 6422 3a20 7365  ntries_used": se
-00015cd0: 6c66 2e68 6f6c 6964 6179 5f63 6f75 6e74  lf.holiday_count
-00015ce0: 7269 6573 5f75 7365 642c 0d0a 2020 2020  ries_used,..    
-00015cf0: 2020 2020 2020 2020 226d 756c 7469 7661          "multiva
-00015d00: 7269 6174 655f 6665 6174 7572 6522 3a20  riate_feature": 
-00015d10: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
-00015d20: 655f 6665 6174 7572 652c 0d0a 2020 2020  e_feature,..    
-00015d30: 2020 2020 2020 2020 226d 756c 7469 7661          "multiva
-00015d40: 7269 6174 655f 7472 616e 7366 6f72 6d61  riate_transforma
-00015d50: 7469 6f6e 223a 2073 656c 662e 6d75 6c74  tion": self.mult
-00015d60: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
-00015d70: 726d 6174 696f 6e0d 0a20 2020 2020 2020  rmation..       
-00015d80: 2020 2020 2069 6620 7365 6c66 2e6d 756c       if self.mul
-00015d90: 7469 7661 7269 6174 655f 6665 6174 7572  tivariate_featur
-00015da0: 6520 6973 206e 6f74 204e 6f6e 650d 0a20  e is not None.. 
-00015db0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00015dc0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-00015dd0: 2020 2022 7265 6772 6573 736f 725f 7472     "regressor_tr
-00015de0: 616e 7366 6f72 6d61 7469 6f6e 223a 2073  ansformation": s
-00015df0: 656c 662e 7265 6772 6573 736f 725f 7472  elf.regressor_tr
-00015e00: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
-00015e10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00015e20: 662e 7265 6772 6573 736f 7273 5f75 7365  f.regressors_use
-00015e30: 640d 0a20 2020 2020 2020 2020 2020 2065  d..            e
-00015e40: 6c73 6520 4e6f 6e65 2c0d 0a20 2020 2020  lse None,..     
-00015e50: 2020 2020 2020 2022 7265 6772 6573 736f         "regresso
-00015e60: 7273 5f75 7365 6422 3a20 7365 6c66 2e72  rs_used": self.r
-00015e70: 6567 7265 7373 6f72 735f 7573 6564 2c0d  egressors_used,.
-00015e80: 0a20 2020 2020 2020 2020 2020 2022 6c69  .            "li
-00015e90: 6e65 6172 5f6d 6f64 656c 223a 2073 656c  near_model": sel
-00015ea0: 662e 6c69 6e65 6172 5f6d 6f64 656c 2c0d  f.linear_model,.
-00015eb0: 0a20 2020 2020 2020 2020 2020 2022 7261  .            "ra
-00015ec0: 6e64 6f6d 7761 6c6b 5f6e 223a 2073 656c  ndomwalk_n": sel
-00015ed0: 662e 7261 6e64 6f6d 7761 6c6b 5f6e 2c0d  f.randomwalk_n,.
-00015ee0: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
-00015ef0: 656e 645f 7769 6e64 6f77 223a 2073 656c  end_window": sel
-00015f00: 662e 7472 656e 645f 7769 6e64 6f77 2c0d  f.trend_window,.
-00015f10: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
-00015f20: 656e 645f 7374 616e 6469 6e22 3a20 7365  end_standin": se
-00015f30: 6c66 2e74 7265 6e64 5f73 7461 6e64 696e  lf.trend_standin
-00015f40: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00015f50: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
-00015f60: 7465 6374 6f72 5f70 6172 616d 7322 3a20  tector_params": 
-00015f70: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
-00015f80: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00015f90: 6d73 2c0d 0a20 2020 2020 2020 2020 2020  ms,..           
-00015fa0: 2023 2022 7472 656e 645f 616e 6f6d 616c   # "trend_anomal
-00015fb0: 795f 696e 7465 7276 656e 7469 6f6e 223a  y_intervention":
-00015fc0: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
-00015fd0: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
-00015fe0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00015ff0: 7472 656e 645f 7472 616e 7366 6f72 6d61  trend_transforma
-00016000: 7469 6f6e 223a 2073 656c 662e 7472 656e  tion": self.tren
-00016010: 645f 7472 616e 7366 6f72 6d61 7469 6f6e  d_transformation
-00016020: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00016030: 7472 656e 645f 6d6f 6465 6c22 3a20 7365  trend_model": se
-00016040: 6c66 2e74 7265 6e64 5f6d 6f64 656c 2c0d  lf.trend_model,.
-00016050: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
-00016060: 656e 645f 7068 6922 3a20 7365 6c66 2e74  end_phi": self.t
-00016070: 7265 6e64 5f70 6869 2c0d 0a20 2020 2020  rend_phi,..     
-00016080: 2020 2020 2020 2023 2022 636f 6e73 7472         # "constr
-00016090: 6169 6e74 223a 2073 656c 662e 636f 6e73  aint": self.cons
-000160a0: 7472 6169 6e74 2c0d 0a20 2020 2020 2020  traint,..       
-000160b0: 207d 0d0a 0d0a 2020 2020 6465 6620 706c   }....    def pl
-000160c0: 6f74 5f63 6f6d 706f 6e65 6e74 7328 0d0a  ot_components(..
-000160d0: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-000160e0: 2020 2020 2020 2070 7265 6469 6374 696f         predictio
-000160f0: 6e3d 4e6f 6e65 2c0d 0a20 2020 2020 2020  n=None,..       
-00016100: 2073 6572 6965 733d 4e6f 6e65 2c0d 0a20   series=None,.. 
-00016110: 2020 2020 2020 2066 6967 7369 7a65 3d28         figsize=(
-00016120: 3136 2c20 3929 2c0d 0a20 2020 2020 2020  16, 9),..       
-00016130: 2074 6f5f 6f72 6967 696e 5f73 7061 6365   to_origin_space
-00016140: 3d54 7275 652c 0d0a 2020 2020 2020 2020  =True,..        
-00016150: 7469 746c 653d 4e6f 6e65 2c0d 0a20 2020  title=None,..   
-00016160: 2020 2020 2073 7461 7274 5f64 6174 653d       start_date=
-00016170: 4e6f 6e65 2c0d 0a20 2020 2029 3a0d 0a20  None,..    ):.. 
-00016180: 2020 2020 2020 2069 6620 7365 7269 6573         if series
-00016190: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000161a0: 2020 2020 2020 2073 6572 6965 7320 3d20         series = 
-000161b0: 7261 6e64 6f6d 2e63 686f 6963 6528 7365  random.choice(se
-000161c0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 7329  lf.column_names)
-000161d0: 0d0a 2020 2020 2020 2020 6966 2074 6974  ..        if tit
-000161e0: 6c65 2069 7320 4e6f 6e65 3a0d 0a20 2020  le is None:..   
-000161f0: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
-00016200: 2066 224d 6f64 656c 2043 6f6d 706f 6e65   f"Model Compone
-00016210: 6e74 7320 666f 7220 7b73 6572 6965 737d  nts for {series}
-00016220: 220d 0a20 2020 2020 2020 2070 6c6f 745f  "..        plot_
-00016230: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
-00016240: 2020 2069 6620 7072 6564 6963 7469 6f6e     if prediction
-00016250: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00016260: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
-00016270: 6c69 7374 2e61 7070 656e 6428 7072 6564  list.append(pred
-00016280: 6963 7469 6f6e 2e66 6f72 6563 6173 745b  iction.forecast[
-00016290: 7365 7269 6573 5d2e 7265 6e61 6d65 2822  series].rename("
-000162a0: 666f 7265 6361 7374 2229 290d 0a20 2020  forecast"))..   
-000162b0: 2020 2020 2020 2020 2070 6c74 5f69 6478           plt_idx
-000162c0: 203d 2070 7265 6469 6374 696f 6e2e 666f   = prediction.fo
-000162d0: 7265 6361 7374 2e69 6e64 6578 0d0a 2020  recast.index..  
-000162e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000162f0: 2020 2020 2020 2020 2070 6c74 5f69 6478           plt_idx
-00016300: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-00016310: 2070 6c6f 745f 6c69 7374 2e61 7070 656e   plot_list.appen
-00016320: 6428 7365 6c66 2e70 7265 6469 6374 6564  d(self.predicted
-00016330: 5f74 7265 6e64 5b73 6572 6965 735d 2e72  _trend[series].r
-00016340: 656e 616d 6528 2274 7265 6e64 2229 290d  ename("trend")).
-00016350: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00016360: 2e69 6d70 6163 7473 2069 7320 6e6f 7420  .impacts is not 
-00016370: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00016380: 2020 2070 6c6f 745f 6c69 7374 2e61 7070     plot_list.app
-00016390: 656e 6428 2873 656c 662e 696d 7061 6374  end((self.impact
-000163a0: 735b 7365 7269 6573 5d2e 7265 6e61 6d65  s[series].rename
-000163b0: 2822 696d 7061 6374 2025 2229 202d 2031  ("impact %") - 1
-000163c0: 2e30 2920 2a20 3130 3029 0d0a 2020 2020  .0) * 100)..    
-000163d0: 2020 2020 6966 2070 6c74 5f69 6478 2069      if plt_idx i
-000163e0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-000163f0: 2020 2020 2070 6c6f 745f 6c69 7374 2e61       plot_list.a
-00016400: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
-00016410: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00016420: 6365 7373 5f63 6f6d 706f 6e65 6e74 7328  cess_components(
-00016430: 746f 5f6f 7269 6769 6e5f 7370 6163 653d  to_origin_space=
-00016440: 746f 5f6f 7269 6769 6e5f 7370 6163 6529  to_origin_space)
-00016450: 5b73 6572 6965 735d 0d0a 2020 2020 2020  [series]..      
-00016460: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00016470: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00016480: 2020 2020 706c 6f74 5f6c 6973 742e 6170      plot_list.ap
-00016490: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
-000164a0: 2020 2020 2020 2073 656c 662e 7072 6f63         self.proc
-000164b0: 6573 735f 636f 6d70 6f6e 656e 7473 2874  ess_components(t
-000164c0: 6f5f 6f72 6967 696e 5f73 7061 6365 3d74  o_origin_space=t
-000164d0: 6f5f 6f72 6967 696e 5f73 7061 6365 295b  o_origin_space)[
-000164e0: 7365 7269 6573 5d2e 6c6f 635b 0d0a 2020  series].loc[..  
-000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016500: 2020 706c 745f 6964 780d 0a20 2020 2020    plt_idx..     
-00016510: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00016520: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00016530: 2020 2020 2070 6c6f 745f 6466 203d 2070       plot_df = p
-00016540: 642e 636f 6e63 6174 2870 6c6f 745f 6c69  d.concat(plot_li
-00016550: 7374 2c20 6178 6973 3d31 290d 0a20 2020  st, axis=1)..   
-00016560: 2020 2020 2069 6620 7374 6172 745f 6461       if start_da
-00016570: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
-00016580: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
-00016590: 745f 6466 203d 2070 6c6f 745f 6466 5b70  t_df = plot_df[p
-000165a0: 6c6f 745f 6466 2e69 6e64 6578 203e 3d20  lot_df.index >= 
-000165b0: 7374 6172 745f 6461 7465 5d0d 0a20 2020  start_date]..   
-000165c0: 2020 2020 2072 6574 7572 6e20 706c 6f74       return plot
-000165d0: 5f64 662e 706c 6f74 2873 7562 706c 6f74  _df.plot(subplot
-000165e0: 733d 5472 7565 2c20 6669 6773 697a 653d  s=True, figsize=
-000165f0: 6669 6773 697a 652c 2074 6974 6c65 3d74  figsize, title=t
-00016600: 6974 6c65 290d 0a0d 0a20 2020 2064 6566  itle)....    def
-00016610: 2072 6574 7572 6e5f 636f 6d70 6f6e 656e   return_componen
-00016620: 7473 2873 656c 662c 2074 6f5f 6f72 6967  ts(self, to_orig
-00016630: 696e 5f73 7061 6365 3d54 7275 652c 2069  in_space=True, i
-00016640: 6e63 6c75 6465 5f69 6d70 6163 7473 3d46  nclude_impacts=F
-00016650: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
-00016660: 2222 2252 6574 7572 6e20 6164 6469 7469  """Return additi
-00016670: 7665 2065 6c65 6d65 6e74 7320 6f66 2066  ve elements of f
-00016680: 6f72 6563 6173 742c 206c 696e 6561 7220  orecast, linear 
-00016690: 616e 6420 7472 656e 642e 2049 6620 696d  and trend. If im
-000166a0: 7061 6374 7320 696e 636c 7564 6564 2c20  pacts included, 
-000166b0: 6974 2069 7320 6120 6d75 6c74 6970 6c69  it is a multipli
-000166c0: 6361 7469 7665 2074 6572 6d2e 0d0a 0d0a  cative term.....
-000166d0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
-000166e0: 2020 2020 2020 2020 2020 2074 6f5f 6f72             to_or
-000166f0: 6967 696e 5f73 7061 6365 2028 626f 6f6c  igin_space (bool
-00016700: 2920 6966 2046 616c 7365 2c20 7769 6c6c  ) if False, will
-00016710: 206e 6f74 2072 6576 6572 7365 2074 7261   not reverse tra
-00016720: 6e73 666f 726d 206c 696e 6561 7220 636f  nsform linear co
-00016730: 6d70 6f6e 656e 7473 0d0a 2020 2020 2020  mponents..      
-00016740: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
-00016750: 7061 6374 7320 2862 6f6f 6c29 2069 6620  pacts (bool) if 
-00016760: 5472 7565 2c20 696d 7061 6374 7320 6172  True, impacts ar
-00016770: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
-00016780: 6520 7265 7475 726e 6564 2064 6174 6166  e returned dataf
-00016790: 7261 6d65 0d0a 2020 2020 2020 2020 2222  rame..        ""
-000167a0: 220d 0a20 2020 2020 2020 2070 6c6f 745f  "..        plot_
-000167b0: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
-000167c0: 2020 2070 6c6f 745f 6c69 7374 2e61 7070     plot_list.app
-000167d0: 656e 6428 7365 6c66 2e70 726f 6365 7373  end(self.process
-000167e0: 5f63 6f6d 706f 6e65 6e74 7328 746f 5f6f  _components(to_o
-000167f0: 7269 6769 6e5f 7370 6163 653d 746f 5f6f  rigin_space=to_o
-00016800: 7269 6769 6e5f 7370 6163 6529 290d 0a20  rigin_space)).. 
-00016810: 2020 2020 2020 2074 7265 6e64 203d 2073         trend = s
-00016820: 656c 662e 7072 6564 6963 7465 645f 7472  elf.predicted_tr
-00016830: 656e 642e 636f 7079 2829 0d0a 2020 2020  end.copy()..    
-00016840: 2020 2020 7472 656e 642e 636f 6c75 6d6e      trend.column
-00016850: 7320 3d20 7064 2e4d 756c 7469 496e 6465  s = pd.MultiInde
-00016860: 782e 6672 6f6d 5f61 7272 6179 7328 0d0a  x.from_arrays(..
-00016870: 2020 2020 2020 2020 2020 2020 5b74 7265              [tre
-00016880: 6e64 2e63 6f6c 756d 6e73 2c20 5b27 7472  nd.columns, ['tr
-00016890: 656e 6427 5d20 2a20 6c65 6e28 7472 656e  end'] * len(tren
-000168a0: 642e 636f 6c75 6d6e 7329 5d0d 0a20 2020  d.columns)]..   
-000168b0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000168c0: 706c 6f74 5f6c 6973 742e 6170 7065 6e64  plot_list.append
-000168d0: 2874 7265 6e64 290d 0a20 2020 2020 2020  (trend)..       
-000168e0: 2069 6620 7365 6c66 2e69 6d70 6163 7473   if self.impacts
-000168f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00016900: 2069 6e63 6c75 6465 5f69 6d70 6163 7473   include_impacts
-00016910: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00016920: 6d70 6163 7473 203d 2073 656c 662e 696d  mpacts = self.im
-00016930: 7061 6374 732e 636f 7079 2829 0d0a 2020  pacts.copy()..  
-00016940: 2020 2020 2020 2020 2020 696d 7061 6374            impact
-00016950: 732e 636f 6c75 6d6e 7320 3d20 7064 2e4d  s.columns = pd.M
-00016960: 756c 7469 496e 6465 782e 6672 6f6d 5f61  ultiIndex.from_a
-00016970: 7272 6179 7328 0d0a 2020 2020 2020 2020  rrays(..        
-00016980: 2020 2020 2020 2020 5b69 6d70 6163 7473          [impacts
-00016990: 2e63 6f6c 756d 6e73 2c20 5b27 696d 7061  .columns, ['impa
-000169a0: 6374 7327 5d20 2a20 6c65 6e28 696d 7061  cts'] * len(impa
-000169b0: 6374 732e 636f 6c75 6d6e 7329 5d0d 0a20  cts.columns)].. 
-000169c0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000169d0: 2020 2020 2020 2020 2020 706c 6f74 5f6c            plot_l
-000169e0: 6973 742e 6170 7065 6e64 2869 6d70 6163  ist.append(impac
-000169f0: 7473 290d 0a20 2020 2020 2020 2072 6574  ts)..        ret
-00016a00: 7572 6e20 7064 2e63 6f6e 6361 7428 706c  urn pd.concat(pl
-00016a10: 6f74 5f6c 6973 742c 2061 7869 733d 3129  ot_list, axis=1)
-00016a20: 0d0a 0d0a 2020 2020 6465 6620 706c 6f74  ....    def plot
-00016a30: 5f74 7265 6e64 280d 0a20 2020 2020 2020  _trend(..       
-00016a40: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
-00016a50: 7365 7269 6573 3d4e 6f6e 652c 0d0a 2020  series=None,..  
-00016a60: 2020 2020 2020 766c 696e 653d 4e6f 6e65        vline=None
-00016a70: 2c0d 0a20 2020 2020 2020 2063 6f6c 6f72  ,..        color
-00016a80: 733d 5b22 2364 3466 3734 6622 2c20 2223  s=["#d4f74f", "#
-00016a90: 3832 6162 3561 222c 2022 2366 6636 6330  82ab5a", "#ff6c0
-00016aa0: 3522 2c20 2223 6331 3236 3030 225d 2c0d  5", "#c12600"],.
-00016ab0: 0a20 2020 2020 2020 2074 6974 6c65 3d4e  .        title=N
-00016ac0: 6f6e 652c 0d0a 2020 2020 2020 2020 7374  one,..        st
-00016ad0: 6172 745f 6461 7465 3d4e 6f6e 652c 0d0a  art_date=None,..
-00016ae0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00016af0: 2c0d 0a20 2020 2029 3a0d 0a20 2020 2020  ,..    ):..     
-00016b00: 2020 2023 2059 4d41 5820 6672 6f6d 2050     # YMAX from P
-00016b10: 4c4f 5420 4f4e 4c59 0d0a 2020 2020 2020  LOT ONLY..      
-00016b20: 2020 6966 2073 6572 6965 7320 6973 204e    if series is N
-00016b30: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00016b40: 2020 7365 7269 6573 203d 2072 616e 646f    series = rando
-00016b50: 6d2e 6368 6f69 6365 2873 656c 662e 636f  m.choice(self.co
-00016b60: 6c75 6d6e 5f6e 616d 6573 290d 0a20 2020  lumn_names)..   
-00016b70: 2020 2020 2069 6620 7469 746c 6520 6973       if title is
-00016b80: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00016b90: 2020 2020 7469 746c 6520 3d20 6622 5472      title = f"Tr
-00016ba0: 656e 6420 4272 6561 6b64 6f77 6e20 666f  end Breakdown fo
-00016bb0: 7220 7b73 6572 6965 737d 220d 0a20 2020  r {series}"..   
-00016bc0: 2020 2020 2070 5f69 6e64 7820 3d20 7365       p_indx = se
-00016bd0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 732e  lf.column_names.
-00016be0: 6765 745f 6c6f 6328 7365 7269 6573 290d  get_loc(series).
-00016bf0: 0a20 2020 2020 2020 2063 7572 5f74 7265  .        cur_tre
-00016c00: 6e64 203d 2073 656c 662e 7072 6564 6963  nd = self.predic
-00016c10: 7465 645f 7472 656e 645b 7365 7269 6573  ted_trend[series
-00016c20: 5d2e 636f 7079 2829 0d0a 2020 2020 2020  ].copy()..      
-00016c30: 2020 746c 7320 3d20 6c65 6e28 6375 725f    tls = len(cur_
-00016c40: 7472 656e 6429 0d0a 2020 2020 2020 2020  trend)..        
-00016c50: 706c 6f74 5f64 6620 3d20 7064 2e44 6174  plot_df = pd.Dat
-00016c60: 6146 7261 6d65 280d 0a20 2020 2020 2020  aFrame(..       
-00016c70: 2020 2020 207b 0d0a 2020 2020 2020 2020       {..        
-00016c80: 2020 2020 2020 2020 2764 6563 6c69 6e65          'decline
-00016c90: 5f61 6363 656c 6572 6174 696e 6727 3a20  _accelerating': 
-00016ca0: 6375 725f 7472 656e 645b 0d0a 2020 2020  cur_trend[..    
-00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cc0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00016cd0: 2020 2020 2020 2020 2020 206e 702e 6873             np.hs
-00016ce0: 7461 636b 2828 6e70 2e73 6967 6e62 6974  tack((np.signbit
-00016cf0: 2873 656c 662e 6163 6365 6c5b 3a2c 2070  (self.accel[:, p
-00016d00: 5f69 6e64 785d 292c 2046 616c 7365 2929  _indx]), False))
-00016d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016d20: 2020 2020 2020 2020 2020 2620 7365 6c66            & self
-00016d30: 2e73 6c6f 7065 5f73 6967 6e5b 3a2c 2070  .slope_sign[:, p
-00016d40: 5f69 6e64 785d 0d0a 2020 2020 2020 2020  _indx]..        
-00016d50: 2020 2020 2020 2020 2020 2020 295b 2d74              )[-t
-00016d60: 6c73 3a5d 0d0a 2020 2020 2020 2020 2020  ls:]..          
-00016d70: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
-00016d80: 2020 2020 2020 2020 2020 2764 6563 6c69            'decli
-00016d90: 6e65 5f64 6563 656c 6572 6174 696e 6727  ne_decelerating'
-00016da0: 3a20 6375 725f 7472 656e 645b 0d0a 2020  : cur_trend[..  
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016dc0: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
-00016dd0: 2020 2020 2020 2020 2020 2020 2028 7e6e               (~n
-00016de0: 702e 6873 7461 636b 2828 6e70 2e73 6967  p.hstack((np.sig
-00016df0: 6e62 6974 2873 656c 662e 6163 6365 6c5b  nbit(self.accel[
-00016e00: 3a2c 2070 5f69 6e64 785d 292c 2046 616c  :, p_indx]), Fal
-00016e10: 7365 2929 290d 0a20 2020 2020 2020 2020  se)))..         
-00016e20: 2020 2020 2020 2020 2020 2020 2020 2026                 &
-00016e30: 2073 656c 662e 736c 6f70 655f 7369 676e   self.slope_sign
-00016e40: 5b3a 2c20 705f 696e 6478 5d0d 0a20 2020  [:, p_indx]..   
-00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e60: 2029 5b2d 746c 733a 5d0d 0a20 2020 2020   )[-tls:]..     
-00016e70: 2020 2020 2020 2020 2020 205d 2c0d 0a20             ],.. 
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00016e90: 6772 6f77 7468 5f64 6563 656c 6572 6174  growth_decelerat
-00016ea0: 696e 6727 3a20 6375 725f 7472 656e 645b  ing': cur_trend[
-00016eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016ec0: 2020 2020 2020 280d 0a20 2020 2020 2020        (..       
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 206e 702e 6873 7461 636b 2828 6e70 2e73   np.hstack((np.s
-00016ef0: 6967 6e62 6974 2873 656c 662e 6163 6365  ignbit(self.acce
-00016f00: 6c5b 3a2c 2070 5f69 6e64 785d 292c 2046  l[:, p_indx]), F
-00016f10: 616c 7365 2929 0d0a 2020 2020 2020 2020  alse))..        
-00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f30: 2620 287e 7365 6c66 2e73 6c6f 7065 5f73  & (~self.slope_s
-00016f40: 6967 6e5b 3a2c 2070 5f69 6e64 785d 290d  ign[:, p_indx]).
-00016f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f60: 2020 2020 2029 5b2d 746c 733a 5d0d 0a20       )[-tls:].. 
-00016f70: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00016f80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00016f90: 2020 2027 6772 6f77 7468 5f61 6363 656c     'growth_accel
-00016fa0: 6572 6174 696e 6727 3a20 6375 725f 7472  erating': cur_tr
-00016fb0: 656e 645b 0d0a 2020 2020 2020 2020 2020  end[..          
-00016fc0: 2020 2020 2020 2020 2020 280d 0a20 2020            (..   
-00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fe0: 2020 2020 2028 7e6e 702e 6873 7461 636b       (~np.hstack
-00016ff0: 2828 6e70 2e73 6967 6e62 6974 2873 656c  ((np.signbit(sel
-00017000: 662e 6163 6365 6c5b 3a2c 2070 5f69 6e64  f.accel[:, p_ind
-00017010: 785d 292c 2046 616c 7365 2929 290d 0a20  x]), False))).. 
-00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017030: 2020 2020 2020 2026 2028 7e73 656c 662e         & (~self.
-00017040: 736c 6f70 655f 7369 676e 5b3a 2c20 705f  slope_sign[:, p_
-00017050: 696e 6478 5d29 0d0a 2020 2020 2020 2020  indx])..        
-00017060: 2020 2020 2020 2020 2020 2020 295b 2d74              )[-t
-00017070: 6c73 3a5d 0d0a 2020 2020 2020 2020 2020  ls:]..          
-00017080: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
-00017090: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
-000170a0: 2020 2020 2020 696e 6465 783d 6375 725f        index=cur_
-000170b0: 7472 656e 642e 696e 6465 782c 0d0a 2020  trend.index,..  
-000170c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000170d0: 2069 6620 7374 6172 745f 6461 7465 2069   if start_date i
-000170e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000170f0: 2020 2020 2020 2020 2070 6c6f 745f 6466           plot_df
-00017100: 203d 2070 6c6f 745f 6466 5b70 6c6f 745f   = plot_df[plot_
-00017110: 6466 2e69 6e64 6578 203e 3d20 7374 6172  df.index >= star
-00017120: 745f 6461 7465 5d0d 0a20 2020 2020 2020  t_date]..       
-00017130: 2061 7820 3d20 706c 6f74 5f64 662e 706c   ax = plot_df.pl
-00017140: 6f74 2874 6974 6c65 3d74 6974 6c65 2c20  ot(title=title, 
-00017150: 636f 6c6f 723d 636f 6c6f 7273 2c20 2a2a  color=colors, **
-00017160: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
-00017170: 2068 616e 646c 6573 2c20 6c61 6265 6c73   handles, labels
-00017180: 203d 2061 782e 6765 745f 6c65 6765 6e64   = ax.get_legend
-00017190: 5f68 616e 646c 6573 5f6c 6162 656c 7328  _handles_labels(
-000171a0: 290d 0a20 2020 2020 2020 2023 2061 782e  )..        # ax.
-000171b0: 7363 6174 7465 7228 6375 725f 7472 656e  scatter(cur_tren
-000171c0: 642e 696e 6465 785b 7365 6c66 2e63 6861  d.index[self.cha
-000171d0: 6e67 6570 6f69 6e74 735b 3a2c 2070 5f69  ngepoints[:, p_i
-000171e0: 6e64 785d 5d2c 2063 7572 5f74 7265 6e64  ndx]], cur_trend
-000171f0: 5b73 656c 662e 6368 616e 6765 706f 696e  [self.changepoin
-00017200: 7473 5b3a 2c20 705f 696e 6478 5d5d 2c20  ts[:, p_indx]], 
-00017210: 633d 2723 6664 6363 3039 272c 2073 3d34  c='#fdcc09', s=4
-00017220: 2e30 290d 0a20 2020 2020 2020 2023 2061  .0)..        # a
-00017230: 782e 7363 6174 7465 7228 6375 725f 7472  x.scatter(cur_tr
-00017240: 656e 642e 696e 6465 785b 7365 6c66 2e7a  end.index[self.z
-00017250: 6572 6f5f 6372 6f73 7369 6e67 735b 3a2c  ero_crossings[:,
-00017260: 2070 5f69 6e64 785d 5d2c 2063 7572 5f74   p_indx]], cur_t
-00017270: 7265 6e64 5b73 656c 662e 7a65 726f 5f63  rend[self.zero_c
-00017280: 726f 7373 696e 6773 5b3a 2c20 705f 696e  rossings[:, p_in
-00017290: 6478 5d5d 2c20 633d 2723 3531 3266 3734  dx]], c='#512f74
-000172a0: 272c 2073 3d34 2e30 290d 0a20 2020 2020  ', s=4.0)..     
-000172b0: 2020 2069 6620 7365 6c66 2e74 7265 6e64     if self.trend
-000172c0: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
-000172d0: 7220 6973 206e 6f74 204e 6f6e 653a 0d0a  r is not None:..
-000172e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000172f0: 656c 662e 7472 656e 645f 616e 6f6d 616c  elf.trend_anomal
-00017300: 795f 6465 7465 6374 6f72 2e6f 7574 7075  y_detector.outpu
-00017310: 7420 3d3d 2022 756e 6976 6172 6961 7465  t == "univariate
-00017320: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00017330: 2020 2020 695f 616e 6f6d 203d 2073 656c      i_anom = sel
-00017340: 662e 7472 656e 645f 616e 6f6d 616c 795f  f.trend_anomaly_
-00017350: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
-00017360: 6573 2e69 6e64 6578 5b0d 0a20 2020 2020  es.index[..     
-00017370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017380: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
-00017390: 6374 6f72 2e61 6e6f 6d61 6c69 6573 2e69  ctor.anomalies.i
-000173a0: 6c6f 635b 3a2c 2030 5d20 3d3d 202d 310d  loc[:, 0] == -1.
-000173b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000173c0: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
-000173d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000173e0: 2020 2020 2020 2073 6572 6965 735f 616e         series_an
-000173f0: 6f6d 203d 2073 656c 662e 7472 656e 645f  om = self.trend_
-00017400: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00017410: 2e61 6e6f 6d61 6c69 6573 5b73 6572 6965  .anomalies[serie
-00017420: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-00017430: 2020 2020 695f 616e 6f6d 203d 2073 6572      i_anom = ser
-00017440: 6965 735f 616e 6f6d 5b73 6572 6965 735f  ies_anom[series_
-00017450: 616e 6f6d 203d 3d20 2d31 5d2e 696e 6465  anom == -1].inde
-00017460: 780d 0a20 2020 2020 2020 2020 2020 2069  x..            i
-00017470: 6620 7374 6172 745f 6461 7465 2069 7320  f start_date is 
-00017480: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00017490: 2020 2020 2020 2020 2020 2069 5f61 6e6f             i_ano
-000174a0: 6d20 3d20 695f 616e 6f6d 5b69 5f61 6e6f  m = i_anom[i_ano
-000174b0: 6d20 3e3d 2073 7461 7274 5f64 6174 655d  m >= start_date]
-000174c0: 0d0a 2020 2020 2020 2020 2020 2020 695f  ..            i_
-000174d0: 616e 6f6d 203d 2069 5f61 6e6f 6d5b 695f  anom = i_anom[i_
-000174e0: 616e 6f6d 203e 3d20 6375 725f 7472 656e  anom >= cur_tren
-000174f0: 642e 696e 6465 785b 305d 5d0d 0a20 2020  d.index[0]]..   
-00017500: 2020 2020 2020 2020 2023 206f 6e6c 7920           # only 
-00017510: 706c 6f74 2069 6620 736f 6d65 2061 6e6f  plot if some ano
-00017520: 6d61 6c69 6573 2c20 616e 6420 6e6f 7420  malies, and not 
-00017530: 7761 7920 746f 6f20 6d61 6e79 2061 6e6f  way too many ano
-00017540: 6d61 6c69 6573 0d0a 2020 2020 2020 2020  malies..        
-00017550: 2020 2020 6966 206c 656e 2869 5f61 6e6f      if len(i_ano
-00017560: 6d29 203e 2030 2061 6e64 206c 656e 2869  m) > 0 and len(i
-00017570: 5f61 6e6f 6d29 203c 206c 656e 2870 6c6f  _anom) < len(plo
-00017580: 745f 6466 2920 2a20 302e 353a 0d0a 2020  t_df) * 0.5:..  
-00017590: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-000175a0: 6174 3120 3d20 6178 2e73 6361 7474 6572  at1 = ax.scatter
-000175b0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000175c0: 2020 2020 2020 2069 5f61 6e6f 6d2e 746f         i_anom.to
-000175d0: 6c69 7374 2829 2c20 6375 725f 7472 656e  list(), cur_tren
-000175e0: 642e 6c6f 635b 695f 616e 6f6d 5d2c 2063  d.loc[i_anom], c
-000175f0: 3d22 7265 6422 2c20 733d 3136 2e30 0d0a  ="red", s=16.0..
-00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00017620: 2020 2068 616e 646c 6573 202b 3d20 5b73     handles += [s
-00017630: 6361 7431 5d0d 0a20 2020 2020 2020 2020  cat1]..         
-00017640: 2020 2020 2020 206c 6162 656c 7320 2b3d         labels +=
-00017650: 205b 2774 7265 6e64 2061 6e6f 6d61 6c69   ['trend anomali
-00017660: 6573 275d 0d0a 2020 2020 2020 2020 6966  es']..        if
-00017670: 2076 6c69 6e65 2069 7320 6e6f 7420 4e6f   vline is not No
-00017680: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00017690: 2061 782e 766c 696e 6573 280d 0a20 2020   ax.vlines(..   
-000176a0: 2020 2020 2020 2020 2020 2020 2078 3d76               x=v
-000176b0: 6c69 6e65 2c0d 0a20 2020 2020 2020 2020  line,..         
-000176c0: 2020 2020 2020 206c 733d 272d 2d27 2c0d         ls='--',.
-000176d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000176e0: 206c 773d 312c 0d0a 2020 2020 2020 2020   lw=1,..        
-000176f0: 2020 2020 2020 2020 636f 6c6f 7273 3d27          colors='
-00017700: 6461 726b 7265 6427 2c0d 0a20 2020 2020  darkred',..     
-00017710: 2020 2020 2020 2020 2020 2079 6d69 6e3d             ymin=
-00017720: 6375 725f 7472 656e 645b 6375 725f 7472  cur_trend[cur_tr
-00017730: 656e 642e 696e 6465 7820 3e3d 2073 7461  end.index >= sta
-00017740: 7274 5f64 6174 655d 2e6d 696e 2829 2c0d  rt_date].min(),.
-00017750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017760: 2079 6d61 783d 6375 725f 7472 656e 645b   ymax=cur_trend[
-00017770: 6375 725f 7472 656e 642e 696e 6465 7820  cur_trend.index 
-00017780: 3e3d 2073 7461 7274 5f64 6174 655d 2e6d  >= start_date].m
-00017790: 6178 2829 2c0d 0a20 2020 2020 2020 2020  ax(),..         
-000177a0: 2020 2029 0d0a 2020 2020 2020 2020 6178     )..        ax
-000177b0: 2e6c 6567 656e 6428 6861 6e64 6c65 732c  .legend(handles,
-000177c0: 206c 6162 656c 7329 0d0a 2020 2020 2020   labels)..      
-000177d0: 2020 7265 7475 726e 2061 780d 0a0d 0a20    return ax.... 
-000177e0: 2020 2064 6566 2070 6c6f 745f 666f 7265     def plot_fore
-000177f0: 6361 7374 280d 0a20 2020 2020 2020 2073  cast(..        s
-00017800: 656c 662c 0d0a 2020 2020 2020 2020 7072  elf,..        pr
-00017810: 6564 6963 7469 6f6e 2c0d 0a20 2020 2020  ediction,..     
-00017820: 2020 2061 6374 7561 6c73 3d4e 6f6e 652c     actuals=None,
-00017830: 0d0a 2020 2020 2020 2020 7365 7269 6573  ..        series
-00017840: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-00017850: 7374 6172 745f 6461 7465 3d4e 6f6e 652c  start_date=None,
-00017860: 0d0a 2020 2020 2020 2020 616e 6f6d 616c  ..        anomal
-00017870: 795f 636f 6c6f 723d 2264 6172 6b73 6c61  y_color="darksla
-00017880: 7465 626c 7565 222c 0d0a 2020 2020 2020  teblue",..      
-00017890: 2020 686f 6c69 6461 795f 636f 6c6f 723d    holiday_color=
-000178a0: 2264 6172 6b67 7265 656e 222c 0d0a 2020  "darkgreen",..  
-000178b0: 2020 2020 2020 7472 656e 645f 616e 6f6d        trend_anom
-000178c0: 616c 795f 636f 6c6f 723d 2773 6c61 7465  aly_color='slate
-000178d0: 6772 6179 272c 0d0a 2020 2020 2020 2020  gray',..        
-000178e0: 706f 696e 745f 7369 7a65 3d31 322e 302c  point_size=12.0,
-000178f0: 0d0a 2020 2020 293a 0d0a 2020 2020 2020  ..    ):..      
-00017900: 2020 2222 2250 6c6f 7420 6120 666f 7265    """Plot a fore
-00017910: 6361 7374 2074 696d 6520 7365 7269 6573  cast time series
-00017920: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
-00017930: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00017940: 7072 6564 6963 7469 6f6e 2028 6d6f 6465  prediction (mode
-00017950: 6c20 7072 6564 6963 7469 6f6e 206f 626a  l prediction obj
-00017960: 6563 742c 2072 6571 7569 7265 6429 0d0a  ect, required)..
-00017970: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-00017980: 616c 7320 2870 642e 4461 7461 4672 616d  als (pd.DataFram
-00017990: 6529 3a20 7769 6465 2073 7479 6c65 2064  e): wide style d
-000179a0: 662c 206f 6620 6b6e 6f77 2064 6174 6120  f, of know data 
-000179b0: 6966 2061 7661 696c 6162 6c65 0d0a 2020  if available..  
-000179c0: 2020 2020 2020 2020 2020 7365 7269 6573            series
-000179d0: 2028 7374 7229 3a20 6e61 6d65 206f 6620   (str): name of 
-000179e0: 7469 6d65 2073 6572 6965 7320 636f 6c75  time series colu
-000179f0: 6d6e 2074 6f20 706c 6f74 0d0a 2020 2020  mn to plot..    
-00017a00: 2020 2020 2020 2020 7374 6172 745f 6461          start_da
-00017a10: 7465 2028 7374 7220 6f72 2054 696d 6573  te (str or Times
-00017a20: 7461 6d70 293a 2070 6f69 6e74 2061 7420  tamp): point at 
-00017a30: 7768 6963 6820 746f 2062 6567 696e 2058  which to begin X
-00017a40: 2061 7869 730d 0a20 2020 2020 2020 2020   axis..         
-00017a50: 2020 2061 6e6f 6d61 6c79 5f63 6f6c 6f72     anomaly_color
-00017a60: 2028 7374 7229 3a20 6e61 6d65 206f 6620   (str): name of 
-00017a70: 616e 6f6d 616c 7920 706f 696e 7420 636f  anomaly point co
-00017a80: 6c6f 720d 0a20 2020 2020 2020 2020 2020  lor..           
-00017a90: 2068 6f6c 6964 6179 5f63 6f6c 6f72 2028   holiday_color (
-00017aa0: 7374 7229 3a20 6e61 6d65 206f 6620 686f  str): name of ho
-00017ab0: 6c69 6461 7920 706f 696e 7420 636f 6c6f  liday point colo
-00017ac0: 720d 0a20 2020 2020 2020 2020 2020 2074  r..            t
-00017ad0: 7265 6e64 5f61 6e6f 6d61 6c79 5f63 6f6c  rend_anomaly_col
-00017ae0: 6f72 2028 7374 7229 3a20 6e61 6d65 206f  or (str): name o
-00017af0: 6620 7472 656e 6420 616e 6f6d 616c 7920  f trend anomaly 
-00017b00: 706f 696e 7420 636f 6c6f 720d 0a20 2020  point color..   
-00017b10: 2020 2020 2020 2020 2070 6f69 6e74 5f73           point_s
-00017b20: 697a 6520 2873 7472 293a 2070 6f69 6e74  ize (str): point
-00017b30: 2073 697a 6520 666f 7220 616c 6c20 616e   size for all an
-00017b40: 6f6d 616c 6965 730d 0a20 2020 2020 2020  omalies..       
-00017b50: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-00017b60: 2073 6572 6965 7320 6973 204e 6f6e 653a   series is None:
-00017b70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00017b80: 7269 6573 203d 2072 616e 646f 6d2e 6368  ries = random.ch
-00017b90: 6f69 6365 2873 656c 662e 636f 6c75 6d6e  oice(self.column
-00017ba0: 5f6e 616d 6573 290d 0a20 2020 2020 2020  _names)..       
-00017bb0: 2069 6620 6163 7475 616c 7320 6973 204e   if actuals is N
-00017bc0: 6f6e 6520 6f72 206e 6f74 2069 7369 6e73  one or not isins
-00017bd0: 7461 6e63 6528 0d0a 2020 2020 2020 2020  tance(..        
-00017be0: 2020 2020 6163 7475 616c 732c 2028 7064      actuals, (pd
-00017bf0: 2e44 6174 6146 7261 6d65 2c20 6e70 2e61  .DataFrame, np.a
-00017c00: 7272 6179 2c20 7064 2e53 6572 6965 7329  rray, pd.Series)
-00017c10: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
-00017c20: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-00017c30: 735f 7573 6564 203d 2070 7265 6469 6374  s_used = predict
-00017c40: 696f 6e2e 666f 7265 6361 7374 0d0a 2020  ion.forecast..  
-00017c50: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-00017c60: 735f 666c 6167 203d 2046 616c 7365 0d0a  s_flag = False..
-00017c70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00017c80: 2020 2020 2020 2020 2020 2061 6374 7561             actua
-00017c90: 6c73 5f66 6c61 6720 3d20 5472 7565 0d0a  ls_flag = True..
-00017ca0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-00017cb0: 616c 735f 7573 6564 203d 2061 6374 7561  als_used = actua
-00017cc0: 6c73 2e72 6569 6e64 6578 2870 7265 6469  ls.reindex(predi
-00017cd0: 6374 696f 6e2e 666f 7265 6361 7374 2e69  ction.forecast.i
-00017ce0: 6e64 6578 290d 0a20 2020 2020 2020 2076  ndex)..        v
-00017cf0: 6c69 6e65 203d 2028 0d0a 2020 2020 2020  line = (..      
-00017d00: 2020 2020 2020 4e6f 6e65 0d0a 2020 2020        None..    
-00017d10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00017d20: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
-00017d30: 6973 204e 6f6e 650d 0a20 2020 2020 2020  is None..       
-00017d40: 2020 2020 2065 6c73 6520 7072 6564 6963       else predic
-00017d50: 7469 6f6e 2e66 6f72 6563 6173 742e 696e  tion.forecast.in
-00017d60: 6465 785b 2d73 656c 662e 666f 7265 6361  dex[-self.foreca
-00017d70: 7374 5f6c 656e 6774 685d 0d0a 2020 2020  st_length]..    
-00017d80: 2020 2020 290d 0a20 2020 2020 2020 2061      )..        a
-00017d90: 7820 3d20 7072 6564 6963 7469 6f6e 2e70  x = prediction.p
-00017da0: 6c6f 7428 0d0a 2020 2020 2020 2020 2020  lot(..          
-00017db0: 2020 6163 7475 616c 735f 7573 6564 2e6c    actuals_used.l
-00017dc0: 6f63 5b70 7265 6469 6374 696f 6e2e 666f  oc[prediction.fo
-00017dd0: 7265 6361 7374 2e69 6e64 6578 5d0d 0a20  recast.index].. 
-00017de0: 2020 2020 2020 2020 2020 2069 6620 6163             if ac
-00017df0: 7475 616c 735f 666c 6167 2069 7320 6e6f  tuals_flag is no
-00017e00: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-00017e10: 2020 2020 656c 7365 204e 6f6e 652c 0d0a      else None,..
-00017e20: 2020 2020 2020 2020 2020 2020 7365 7269              seri
-00017e30: 6573 3d73 6572 6965 732c 0d0a 2020 2020  es=series,..    
-00017e40: 2020 2020 2020 2020 766c 696e 653d 766c          vline=vl
-00017e50: 696e 652c 0d0a 2020 2020 2020 2020 2020  ine,..          
-00017e60: 2020 7374 6172 745f 6461 7465 3d73 7461    start_date=sta
-00017e70: 7274 5f64 6174 652c 0d0a 2020 2020 2020  rt_date,..      
-00017e80: 2020 290d 0a20 2020 2020 2020 2068 616e    )..        han
-00017e90: 646c 6573 2c20 6c61 6265 6c73 203d 2061  dles, labels = a
-00017ea0: 782e 6765 745f 6c65 6765 6e64 5f68 616e  x.get_legend_han
-00017eb0: 646c 6573 5f6c 6162 656c 7328 290d 0a20  dles_labels().. 
-00017ec0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-00017ed0: 6e6f 6d61 6c79 5f64 6574 6563 746f 723a  nomaly_detector:
-00017ee0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00017ef0: 2073 656c 662e 616e 6f6d 616c 795f 6465   self.anomaly_de
-00017f00: 7465 6374 6f72 2e6f 7574 7075 7420 3d3d  tector.output ==
-00017f10: 2022 756e 6976 6172 6961 7465 223a 0d0a   "univariate":..
-00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f30: 695f 616e 6f6d 203d 2073 656c 662e 616e  i_anom = self.an
-00017f40: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
-00017f50: 6e6f 6d61 6c69 6573 2e69 6e64 6578 5b0d  nomalies.index[.
-00017f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017f70: 2020 2020 2073 656c 662e 616e 6f6d 616c       self.anomal
-00017f80: 795f 6465 7465 6374 6f72 2e61 6e6f 6d61  y_detector.anoma
-00017f90: 6c69 6573 2e69 6c6f 635b 3a2c 2030 5d20  lies.iloc[:, 0] 
-00017fa0: 3d3d 202d 310d 0a20 2020 2020 2020 2020  == -1..         
-00017fb0: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
-00017fc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00017fd0: 2020 2020 2020 2020 2020 2020 2073 6572               ser
-00017fe0: 6965 735f 616e 6f6d 203d 2073 656c 662e  ies_anom = self.
-00017ff0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00018000: 2e61 6e6f 6d61 6c69 6573 5b73 6572 6965  .anomalies[serie
-00018010: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-00018020: 2020 2020 695f 616e 6f6d 203d 2073 6572      i_anom = ser
-00018030: 6965 735f 616e 6f6d 5b73 6572 6965 735f  ies_anom[series_
-00018040: 616e 6f6d 203d 3d20 2d31 5d2e 696e 6465  anom == -1].inde
-00018050: 780d 0a20 2020 2020 2020 2020 2020 2069  x..            i
-00018060: 6620 7374 6172 745f 6461 7465 2069 7320  f start_date is 
-00018070: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00018080: 2020 2020 2020 2020 2020 2069 5f61 6e6f             i_ano
-00018090: 6d20 3d20 695f 616e 6f6d 5b69 5f61 6e6f  m = i_anom[i_ano
-000180a0: 6d20 3e3d 2073 7461 7274 5f64 6174 655d  m >= start_date]
-000180b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000180c0: 2061 6374 7561 6c73 5f66 6c61 673a 0d0a   actuals_flag:..
-000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180e0: 695f 616e 6f6d 203d 2069 5f61 6e6f 6d5b  i_anom = i_anom[
-000180f0: 695f 616e 6f6d 203e 3d20 6163 7475 616c  i_anom >= actual
-00018100: 732e 696e 6465 785b 305d 5d0d 0a20 2020  s.index[0]]..   
-00018110: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00018120: 695f 616e 6f6d 2920 3e20 3020 616e 6420  i_anom) > 0 and 
-00018130: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00018140: 2020 206e 6f74 2061 6374 7561 6c73 5f66     not actuals_f
-00018150: 6c61 6720 6f72 206c 656e 2869 5f61 6e6f  lag or len(i_ano
-00018160: 6d29 203c 206c 656e 2861 6374 7561 6c73  m) < len(actuals
-00018170: 2920 2a20 302e 350d 0a20 2020 2020 2020  ) * 0.5..       
-00018180: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-00018190: 2020 2020 2020 2020 2073 6361 7431 203d           scat1 =
-000181a0: 2061 782e 7363 6174 7465 7228 0d0a 2020   ax.scatter(..  
-000181b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181c0: 2020 695f 616e 6f6d 2e74 6f6c 6973 7428    i_anom.tolist(
-000181d0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-000181e0: 2020 2020 2020 2020 6163 7475 616c 735f          actuals_
-000181f0: 7573 6564 2e72 6569 6e64 6578 2869 5f61  used.reindex(i_a
-00018200: 6e6f 6d29 5b73 6572 6965 735d 2c0d 0a20  nom)[series],.. 
-00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018220: 2020 2063 3d61 6e6f 6d61 6c79 5f63 6f6c     c=anomaly_col
-00018230: 6f72 2c0d 0a20 2020 2020 2020 2020 2020  or,..           
-00018240: 2020 2020 2020 2020 2073 3d70 6f69 6e74           s=point
-00018250: 5f73 697a 652c 0d0a 2020 2020 2020 2020  _size,..        
-00018260: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00018270: 2020 2020 2020 2020 2020 2068 616e 646c             handl
-00018280: 6573 202b 3d20 5b73 6361 7431 5d0d 0a20  es += [scat1].. 
-00018290: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000182a0: 6162 656c 7320 2b3d 205b 2261 6e6f 6d61  abels += ["anoma
-000182b0: 6c69 6573 225d 0d0a 2020 2020 2020 2020  lies"]..        
-000182c0: 6966 2073 656c 662e 686f 6c69 6461 795f  if self.holiday_
-000182d0: 6465 7465 6374 6f72 3a0d 0a20 2020 2020  detector:..     
-000182e0: 2020 2020 2020 2069 5f61 6e6f 6d20 3d20         i_anom = 
-000182f0: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
-00018300: 6563 746f 722e 6461 7465 735f 746f 5f68  ector.dates_to_h
-00018310: 6f6c 6964 6179 7328 0d0a 2020 2020 2020  olidays(..      
-00018320: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00018330: 662e 696e 6465 782c 2073 7479 6c65 3d22  f.index, style="
-00018340: 7365 7269 6573 5f66 6c61 6722 0d0a 2020  series_flag"..  
-00018350: 2020 2020 2020 2020 2020 295b 7365 7269            )[seri
-00018360: 6573 5d0d 0a20 2020 2020 2020 2020 2020  es]..           
-00018370: 2069 5f61 6e6f 6d20 3d20 695f 616e 6f6d   i_anom = i_anom
-00018380: 2e69 6e64 6578 5b69 5f61 6e6f 6d20 3d3d  .index[i_anom ==
-00018390: 2031 5d0d 0a20 2020 2020 2020 2020 2020   1]..           
-000183a0: 2069 6620 6163 7475 616c 735f 666c 6167   if actuals_flag
-000183b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000183c0: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
-000183d0: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2061 6374  om[i_anom >= act
-000183e0: 7561 6c73 2e69 6e64 6578 5b30 5d5d 0d0a  uals.index[0]]..
-000183f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00018400: 656e 2869 5f61 6e6f 6d29 203e 2030 2061  en(i_anom) > 0 a
-00018410: 6e64 2028 0d0a 2020 2020 2020 2020 2020  nd (..          
-00018420: 2020 2020 2020 6e6f 7420 6163 7475 616c        not actual
-00018430: 735f 666c 6167 206f 7220 6c65 6e28 695f  s_flag or len(i_
-00018440: 616e 6f6d 2920 3c20 6c65 6e28 6163 7475  anom) < len(actu
-00018450: 616c 7329 202a 2030 2e35 0d0a 2020 2020  als) * 0.5..    
-00018460: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
-00018470: 2020 2020 2020 2020 2020 2020 7363 6174              scat
-00018480: 3220 3d20 6178 2e73 6361 7474 6572 280d  2 = ax.scatter(.
-00018490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000184a0: 2020 2020 2069 5f61 6e6f 6d2e 746f 6c69       i_anom.toli
-000184b0: 7374 2829 2c0d 0a20 2020 2020 2020 2020  st(),..         
-000184c0: 2020 2020 2020 2020 2020 2061 6374 7561             actua
-000184d0: 6c73 5f75 7365 642e 7265 696e 6465 7828  ls_used.reindex(
-000184e0: 695f 616e 6f6d 295b 7365 7269 6573 5d2c  i_anom)[series],
-000184f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018500: 2020 2020 2020 633d 686f 6c69 6461 795f        c=holiday_
-00018510: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
-00018520: 2020 2020 2020 2020 2020 2020 733d 706f              s=po
-00018530: 696e 745f 7369 7a65 2c0d 0a20 2020 2020  int_size,..     
-00018540: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00018550: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00018560: 6e64 6c65 7320 2b3d 205b 7363 6174 325d  ndles += [scat2]
-00018570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018580: 2020 6c61 6265 6c73 202b 3d20 5b22 6465    labels += ["de
-00018590: 7465 6374 6564 2068 6f6c 6964 6179 7322  tected holidays"
-000185a0: 5d0d 0a20 2020 2020 2020 2069 6620 7365  ]..        if se
-000185b0: 6c66 2e74 7265 6e64 5f61 6e6f 6d61 6c79  lf.trend_anomaly
-000185c0: 5f64 6574 6563 746f 7220 6973 206e 6f74  _detector is not
-000185d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000185e0: 2020 2020 6966 2073 656c 662e 7472 656e      if self.tren
-000185f0: 645f 616e 6f6d 616c 795f 6465 7465 6374  d_anomaly_detect
-00018600: 6f72 2e6f 7574 7075 7420 3d3d 2022 756e  or.output == "un
-00018610: 6976 6172 6961 7465 223a 0d0a 2020 2020  ivariate":..    
-00018620: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
-00018630: 6f6d 203d 2073 656c 662e 7472 656e 645f  om = self.trend_
-00018640: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00018650: 2e61 6e6f 6d61 6c69 6573 2e69 6e64 6578  .anomalies.index
-00018660: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-00018670: 2020 2020 2020 2073 656c 662e 616e 6f6d         self.anom
-00018680: 616c 795f 6465 7465 6374 6f72 2e61 6e6f  aly_detector.ano
-00018690: 6d61 6c69 6573 2e69 6c6f 635b 3a2c 2030  malies.iloc[:, 0
-000186a0: 5d20 3d3d 202d 310d 0a20 2020 2020 2020  ] == -1..       
-000186b0: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-000186c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-000186d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000186e0: 6572 6965 735f 616e 6f6d 203d 2073 656c  eries_anom = sel
-000186f0: 662e 7472 656e 645f 616e 6f6d 616c 795f  f.trend_anomaly_
-00018700: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
-00018710: 6573 5b73 6572 6965 735d 0d0a 2020 2020  es[series]..    
-00018720: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
-00018730: 6f6d 203d 2073 6572 6965 735f 616e 6f6d  om = series_anom
-00018740: 5b73 6572 6965 735f 616e 6f6d 203d 3d20  [series_anom == 
-00018750: 2d31 5d2e 696e 6465 780d 0a20 2020 2020  -1].index..     
-00018760: 2020 2020 2020 2069 6620 7374 6172 745f         if start_
-00018770: 6461 7465 2069 7320 6e6f 7420 4e6f 6e65  date is not None
-00018780: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00018790: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
-000187a0: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2073 7461  om[i_anom >= sta
-000187b0: 7274 5f64 6174 655d 0d0a 2020 2020 2020  rt_date]..      
-000187c0: 2020 2020 2020 6966 2061 6374 7561 6c73        if actuals
-000187d0: 5f66 6c61 673a 0d0a 2020 2020 2020 2020  _flag:..        
-000187e0: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
-000187f0: 2069 5f61 6e6f 6d5b 695f 616e 6f6d 203e   i_anom[i_anom >
-00018800: 3d20 6163 7475 616c 732e 696e 6465 785b  = actuals.index[
-00018810: 305d 5d0d 0a20 2020 2020 2020 2020 2020  0]]..           
-00018820: 2069 6620 6c65 6e28 695f 616e 6f6d 2920   if len(i_anom) 
-00018830: 3e20 3020 616e 6420 280d 0a20 2020 2020  > 0 and (..     
-00018840: 2020 2020 2020 2020 2020 206e 6f74 2061             not a
-00018850: 6374 7561 6c73 5f66 6c61 6720 6f72 206c  ctuals_flag or l
-00018860: 656e 2869 5f61 6e6f 6d29 203c 206c 656e  en(i_anom) < len
-00018870: 2861 6374 7561 6c73 2920 2a20 302e 350d  (actuals) * 0.5.
-00018880: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
-00018890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000188a0: 2073 6361 7433 203d 2061 782e 7363 6174   scat3 = ax.scat
-000188b0: 7465 7228 0d0a 2020 2020 2020 2020 2020  ter(..          
-000188c0: 2020 2020 2020 2020 2020 695f 616e 6f6d            i_anom
-000188d0: 2e74 6f6c 6973 7428 292c 0d0a 2020 2020  .tolist(),..    
-000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 6163 7475 616c 735f 7573 6564 2e72 6569  actuals_used.rei
-00018900: 6e64 6578 2869 5f61 6e6f 6d29 5b73 6572  ndex(i_anom)[ser
-00018910: 6965 735d 2c0d 0a20 2020 2020 2020 2020  ies],..         
-00018920: 2020 2020 2020 2020 2020 2063 3d74 7265             c=tre
-00018930: 6e64 5f61 6e6f 6d61 6c79 5f63 6f6c 6f72  nd_anomaly_color
-00018940: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00018950: 2020 2020 2020 2073 3d70 6f69 6e74 5f73         s=point_s
-00018960: 697a 652c 0d0a 2020 2020 2020 2020 2020  ize,..          
-00018970: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00018980: 2020 2020 2020 2020 2068 616e 646c 6573           handles
-00018990: 202b 3d20 5b73 6361 7433 5d0d 0a20 2020   += [scat3]..   
-000189a0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-000189b0: 656c 7320 2b3d 205b 2274 7265 6e64 2061  els += ["trend a
-000189c0: 6e6f 6d61 6c69 6573 225d 0d0a 2020 2020  nomalies"]..    
-000189d0: 2020 2020 6178 2e6c 6567 656e 6428 6861      ax.legend(ha
-000189e0: 6e64 6c65 732c 206c 6162 656c 7329 0d0a  ndles, labels)..
-000189f0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00018a00: 780d 0a0d 0a20 2020 2064 6566 2070 6c6f  x....    def plo
-00018a10: 745f 7468 696e 6773 2829 3a20 2023 2070  t_things():  # p
-00018a20: 6c61 6365 686f 6c64 6572 2066 6f72 206c  laceholder for l
-00018a30: 6174 6572 2070 6c6f 7474 696e 6720 6675  ater plotting fu
-00018a40: 6e63 7469 6f6e 730d 0a20 2020 2020 2020  nctions..       
-00018a50: 2023 2070 6c6f 7420 636f 6d70 6f6e 656e   # plot componen
-00018a60: 7473 0d0a 2020 2020 2020 2020 2320 706c  ts..        # pl
-00018a70: 6f74 2074 7261 6e73 666f 726d 6564 2064  ot transformed d
-00018a80: 6620 6966 2070 7265 7072 6f63 6573 7320  f if preprocess 
-00018a90: 6f72 2061 6e6f 6d61 6c79 2072 656d 6f76  or anomaly remov
-00018aa0: 616c 0d0a 2020 2020 2020 2020 2320 706c  al..        # pl
-00018ab0: 6f74 2070 6173 7420 696d 7061 6374 730d  ot past impacts.
-00018ac0: 0a20 2020 2020 2020 2023 2070 6c6f 7420  .        # plot 
-00018ad0: 2520 636f 6e74 7269 6275 7469 6f6e 206f  % contribution o
-00018ae0: 6620 636f 6d70 6f6e 656e 7473 0d0a 2020  f components..  
-00018af0: 2020 2020 2020 2320 706c 6f74 2065 7661        # plot eva
-00018b00: 6c20 2873 686f 7720 6163 7475 616c 732c  l (show actuals,
-00018b10: 2061 6c6f 6e67 7369 6465 2066 756c 6c20   alongside full 
-00018b20: 616e 6420 636f 6d70 6f6e 656e 7473 2074  and components t
-00018b30: 6f20 6469 6167 6e6f 7365 290d 0a20 2020  o diagnose)..   
-00018b40: 2020 2020 2023 2070 6c6f 7420 7265 7369       # plot resi
-00018b50: 6475 616c 2064 6973 7472 6962 7574 696f  dual distributio
-00018b60: 6e2f 5041 4346 0d0a 2020 2020 2020 2020  n/PACF..        
-00018b70: 2320 706c 6f74 2069 6e66 6c65 6374 696f  # plot inflectio
-00018b80: 6e20 706f 696e 7473 2028 6669 6c74 6572  n points (filter
-00018b90: 696e 6720 6f72 2073 6d6f 6f74 6869 6e67  ing or smoothing
-00018ba0: 2066 6972 7374 290d 0a20 2020 2020 2020   first)..       
-00018bb0: 2023 2070 6c6f 7420 6869 6768 6573 7420   # plot highest 
-00018bc0: 6572 726f 7220 7365 7269 6573 2c20 706c  error series, pl
-00018bd0: 6f74 2068 6967 6865 7374 2f6c 6f77 6573  ot highest/lowes
-00018be0: 7420 6772 6f77 7468 0d0a 2020 2020 2020  t growth..      
-00018bf0: 2020 2320 7472 656e 643a 206f 6e65 2063    # trend: one c
-00018c00: 6f6c 6f72 2066 6f72 2067 726f 7774 682c  olor for growth,
-00018c10: 2061 6e6f 7468 6572 2066 6f72 2064 6563   another for dec
-00018c20: 6c69 6e65 2028 6461 726b 6572 2061 7320  line (darker as 
-00018c30: 6163 6365 6c65 7261 7469 6e67 2c20 6c69  accelerating, li
-00018c40: 6768 6572 2061 7320 736c 6f77 696e 6729  gher as slowing)
-00018c50: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00018c60: 204e 6f74 496d 706c 656d 656e 7465 640d   NotImplemented.
-00018c70: 0a0d 0a0d 0a64 6566 2063 6c65 616e 5f72  .....def clean_r
-00018c80: 6567 7265 7373 6f72 2869 6e5f 642c 2070  egressor(in_d, p
-00018c90: 7265 6669 783d 2272 6567 725f 2229 3a0d  refix="regr_"):.
-00018ca0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
-00018cb0: 7374 616e 6365 2869 6e5f 642c 2070 642e  stance(in_d, pd.
-00018cc0: 4461 7461 4672 616d 6529 3a0d 0a20 2020  DataFrame):..   
-00018cd0: 2020 2020 2064 6620 3d20 7064 2e44 6174       df = pd.Dat
-00018ce0: 6146 7261 6d65 2869 6e5f 6429 0d0a 2020  aFrame(in_d)..  
-00018cf0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00018d00: 2064 6620 3d20 696e 5f64 2e63 6f70 7928   df = in_d.copy(
-00018d10: 290d 0a20 2020 2064 662e 636f 6c75 6d6e  )..    df.column
-00018d20: 7320 3d20 5b70 7265 6669 7820 2b20 636f  s = [prefix + co
-00018d30: 6c20 666f 7220 636f 6c20 696e 2064 662e  l for col in df.
-00018d40: 636f 6c75 6d6e 735d 0d0a 2020 2020 7265  columns]..    re
-00018d50: 7475 726e 2064 660d 0a0d 0a0d 0a64 6566  turn df......def
-00018d60: 2063 7265 6174 655f 7428 6473 293a 0d0a   create_t(ds):..
-00018d70: 2020 2020 7265 7475 726e 2028 6473 202d      return (ds -
-00018d80: 2064 732e 6d69 6e28 2929 202f 2028 6473   ds.min()) / (ds
-00018d90: 2e6d 6178 2829 202d 2064 732e 6d69 6e28  .max() - ds.min(
-00018da0: 2929 0d0a 0d0a 0d0a 2323 2323 2323 2323  ))......########
-00018db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018dc0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-00018dd0: 204a 5553 5420 4c45 4153 5420 5351 5541   JUST LEAST SQUA
-00018de0: 5245 5320 554e 4956 4152 4941 5445 0d0a  RES UNIVARIATE..
-00018df0: 2320 6874 7470 733a 2f2f 7374 6163 6b6f  # https://stacko
-00018e00: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
-00018e10: 7469 6f6e 732f 3137 3637 3931 3430 2f6d  tions/17679140/m
-00018e20: 756c 7469 706c 652d 6c69 6e65 6172 2d72  ultiple-linear-r
-00018e30: 6567 7265 7373 696f 6e2d 7769 7468 2d70  egression-with-p
-00018e40: 7974 686f 6e0d 0a0d 0a0d 0a64 6566 206c  ython......def l
-00018e50: 7374 7371 5f73 6f6c 7665 2858 2c20 792c  stsq_solve(X, y,
-00018e60: 206c 616d 623d 312c 2069 6465 6e74 6974   lamb=1, identit
-00018e70: 795f 6d61 7472 6978 3d4e 6f6e 6529 3a0d  y_matrix=None):.
-00018e80: 0a20 2020 2069 6620 6964 656e 7469 7479  .    if identity
-00018e90: 5f6d 6174 7269 7820 6973 204e 6f6e 653a  _matrix is None:
-00018ea0: 0d0a 2020 2020 2020 2020 6964 656e 7469  ..        identi
-00018eb0: 7479 5f6d 6174 7269 7820 3d20 6e70 2e7a  ty_matrix = np.z
-00018ec0: 6572 6f73 2828 582e 7368 6170 655b 315d  eros((X.shape[1]
-00018ed0: 2c20 582e 7368 6170 655b 315d 2929 0d0a  , X.shape[1]))..
-00018ee0: 2020 2020 2020 2020 6e70 2e66 696c 6c5f          np.fill_
-00018ef0: 6469 6167 6f6e 616c 2869 6465 6e74 6974  diagonal(identit
-00018f00: 795f 6d61 7472 6978 2c20 3129 0d0a 2020  y_matrix, 1)..  
-00018f10: 2020 2020 2020 6964 656e 7469 7479 5f6d        identity_m
-00018f20: 6174 7269 785b 302c 2030 5d20 3d20 300d  atrix[0, 0] = 0.
-00018f30: 0a20 2020 2058 7458 5f6c 616d 6220 3d20  .    XtX_lamb = 
-00018f40: 582e 542e 646f 7428 5829 202b 206c 616d  X.T.dot(X) + lam
-00018f50: 6220 2a20 6964 656e 7469 7479 5f6d 6174  b * identity_mat
-00018f60: 7269 780d 0a20 2020 2058 7459 203d 2058  rix..    XtY = X
-00018f70: 2e54 2e64 6f74 2879 290d 0a20 2020 2072  .T.dot(y)..    r
-00018f80: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
-00018f90: 736f 6c76 6528 5874 585f 6c61 6d62 2c20  solve(XtX_lamb, 
-00018fa0: 5874 5929 0d0a 0d0a 0d0a 6465 6620 636f  XtY)......def co
-00018fb0: 7374 5f66 756e 6374 696f 6e5f 6c31 2870  st_function_l1(p
-00018fc0: 6172 616d 732c 2058 2c20 7929 3a0d 0a20  arams, X, y):.. 
-00018fd0: 2020 2072 6574 7572 6e20 6e70 2e73 756d     return np.sum
-00018fe0: 286e 702e 6162 7328 7920 2d20 6e70 2e64  (np.abs(y - np.d
-00018ff0: 6f74 2858 2c20 7061 7261 6d73 2e72 6573  ot(X, params.res
-00019000: 6861 7065 2858 2e73 6861 7065 5b31 5d2c  hape(X.shape[1],
-00019010: 2079 2e73 6861 7065 5b31 5d29 2929 290d   y.shape[1])))).
-00019020: 0a0d 0a0d 0a64 6566 2063 6f73 745f 6675  .....def cost_fu
-00019030: 6e63 7469 6f6e 5f6c 315f 706f 7369 7469  nction_l1_positi
-00019040: 7665 2870 6172 616d 732c 2058 2c20 7929  ve(params, X, y)
-00019050: 3a0d 0a20 2020 2072 6574 7572 6e20 6e70  :..    return np
-00019060: 2e73 756d 280d 0a20 2020 2020 2020 206e  .sum(..        n
-00019070: 702e 6162 7328 0d0a 2020 2020 2020 2020  p.abs(..        
-00019080: 2020 2020 790d 0a20 2020 2020 2020 2020      y..         
-00019090: 2020 202d 206e 702e 646f 7428 582c 206e     - np.dot(X, n
-000190a0: 702e 7768 6572 6528 7061 7261 6d73 203c  p.where(params <
-000190b0: 2030 2c20 302c 2070 6172 616d 7329 2e72   0, 0, params).r
-000190c0: 6573 6861 7065 2858 2e73 6861 7065 5b31  eshape(X.shape[1
-000190d0: 5d2c 2079 2e73 6861 7065 5b31 5d29 290d  ], y.shape[1])).
-000190e0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-000190f0: 290d 0a0d 0a0d 0a23 2061 6374 7561 6c6c  )......# actuall
-00019100: 7920 7468 6973 2069 7320 6d6f 7265 206c  y this is more l
-00019110: 696b 6520 4d41 4445 0d0a 6465 6620 636f  ike MADE..def co
-00019120: 7374 5f66 756e 6374 696f 6e5f 6477 6165  st_function_dwae
-00019130: 2870 6172 616d 732c 2058 2c20 7929 3a0d  (params, X, y):.
-00019140: 0a20 2020 2041 203d 2079 0d0a 2020 2020  .    A = y..    
-00019150: 4620 3d20 6e70 2e64 6f74 2858 2c20 7061  F = np.dot(X, pa
-00019160: 7261 6d73 2e72 6573 6861 7065 2858 2e73  rams.reshape(X.s
-00019170: 6861 7065 5b31 5d2c 2079 2e73 6861 7065  hape[1], y.shape
-00019180: 5b31 5d29 290d 0a20 2020 206c 6173 745f  [1]))..    last_
-00019190: 6f66 5f61 7272 6179 203d 2079 5b5b 305d  of_array = y[[0]
-000191a0: 202b 206c 6973 7428 7261 6e67 6528 6c65   + list(range(le
-000191b0: 6e28 7929 202d 2031 2929 5d0d 0a20 2020  n(y) - 1))]..   
-000191c0: 2072 6574 7572 6e20 6e70 2e73 756d 280d   return np.sum(.
-000191d0: 0a20 2020 2020 2020 206e 702e 6e61 6e6d  .        np.nanm
-000191e0: 6561 6e28 0d0a 2020 2020 2020 2020 2020  ean(..          
-000191f0: 2020 6e70 2e77 6865 7265 280d 0a20 2020    np.where(..   
-00019200: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-00019210: 7369 676e 2846 202d 206c 6173 745f 6f66  sign(F - last_of
-00019220: 5f61 7272 6179 2920 3d3d 206e 702e 7369  _array) == np.si
-00019230: 676e 2841 202d 206c 6173 745f 6f66 5f61  gn(A - last_of_a
-00019240: 7272 6179 292c 0d0a 2020 2020 2020 2020  rray),..        
-00019250: 2020 2020 2020 2020 6e70 2e61 6273 2841          np.abs(A
-00019260: 202d 2046 292c 0d0a 2020 2020 2020 2020   - F),..        
-00019270: 2020 2020 2020 2020 286e 702e 6162 7328          (np.abs(
-00019280: 4120 2d20 4629 202b 2031 2920 2a2a 2032  A - F) + 1) ** 2
-00019290: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-000192a0: 2c0d 0a20 2020 2020 2020 2020 2020 2061  ,..            a
-000192b0: 7869 733d 302c 0d0a 2020 2020 2020 2020  xis=0,..        
-000192c0: 290d 0a20 2020 2029 0d0a 0d0a 0d0a 6465  )..    )......de
-000192d0: 6620 636f 7374 5f66 756e 6374 696f 6e5f  f cost_function_
-000192e0: 7175 616e 7469 6c65 2870 6172 616d 732c  quantile(params,
-000192f0: 2058 2c20 792c 2071 3d30 2e39 293a 0d0a   X, y, q=0.9):..
-00019300: 2020 2020 6375 7420 3d20 696e 7428 792e      cut = int(y.
-00019310: 7368 6170 655b 305d 202a 2071 290d 0a20  shape[0] * q).. 
-00019320: 2020 2072 6574 7572 6e20 6e70 2e73 756d     return np.sum
-00019330: 280d 0a20 2020 2020 2020 206e 702e 7061  (..        np.pa
-00019340: 7274 6974 696f 6e28 0d0a 2020 2020 2020  rtition(..      
-00019350: 2020 2020 2020 6e70 2e61 6273 2879 202d        np.abs(y -
-00019360: 206e 702e 646f 7428 582c 2070 6172 616d   np.dot(X, param
-00019370: 732e 7265 7368 6170 6528 582e 7368 6170  s.reshape(X.shap
-00019380: 655b 315d 2c20 792e 7368 6170 655b 315d  e[1], y.shape[1]
-00019390: 2929 292c 2063 7574 2c20 6178 6973 3d30  ))), cut, axis=0
-000193a0: 0d0a 2020 2020 2020 2020 295b 303a 6375  ..        )[0:cu
-000193b0: 745d 0d0a 2020 2020 290d 0a0d 0a0d 0a64  t]..    )......d
-000193c0: 6566 2063 6f73 745f 6675 6e63 7469 6f6e  ef cost_function
-000193d0: 5f6c 3228 7061 7261 6d73 2c20 582c 2079  _l2(params, X, y
-000193e0: 293a 0d0a 2020 2020 7265 7475 726e 206e  ):..    return n
-000193f0: 702e 6c69 6e61 6c67 2e6e 6f72 6d28 7920  p.linalg.norm(y 
-00019400: 2d20 6e70 2e64 6f74 2858 2c20 7061 7261  - np.dot(X, para
-00019410: 6d73 2e72 6573 6861 7065 2858 2e73 6861  ms.reshape(X.sha
-00019420: 7065 5b31 5d2c 2079 2e73 6861 7065 5b31  pe[1], y.shape[1
-00019430: 5d29 2929 0d0a 0d0a 0d0a 2320 636f 756c  ])))......# coul
-00019440: 6420 646f 2070 6172 7469 616c 2070 6f6f  d do partial poo
-00019450: 6c69 6e67 2062 7920 6d69 6e69 6d69 7a69  ling by minimizi
-00019460: 6e67 2061 2066 756e 6374 696f 6e20 7468  ng a function th
-00019470: 6174 206d 6978 6573 2073 6861 7265 6420  at mixes shared 
-00019480: 616e 6420 756e 7368 6172 6564 2063 6f65  and unshared coe
-00019490: 6666 6963 6965 6e74 7320 286d 756c 7469  fficients (multi
-000194a0: 706c 6963 6174 6976 6529 0d0a 6465 6620  plicative)..def 
-000194b0: 6c73 7473 715f 6d69 6e69 6d69 7a65 2858  lstsq_minimize(X
-000194c0: 2c20 792c 206d 6178 6974 6572 3d31 3530  , y, maxiter=150
-000194d0: 3030 2c20 636f 7374 5f66 756e 6374 696f  00, cost_functio
-000194e0: 6e3d 226c 3122 293a 0d0a 2020 2020 2222  n="l1"):..    ""
-000194f0: 2241 6e79 2063 6f73 7420 6675 6e63 7469  "Any cost functi
-00019500: 6f6e 2076 6572 7369 6f6e 206f 6620 6c69  on version of li
-00019510: 6e20 7265 672e 2222 220d 0a20 2020 2023  n reg."""..    #
-00019520: 2073 7461 7274 2077 6974 6820 6c73 7473   start with lsts
-00019530: 7120 6669 7420 6173 2065 7374 696d 6174  q fit as estimat
-00019540: 6564 2070 6f69 6e74 0d0a 2020 2020 7830  ed point..    x0
-00019550: 203d 206c 7374 7371 5f73 6f6c 7665 2858   = lstsq_solve(X
-00019560: 2c20 7929 2e66 6c61 7474 656e 2829 0d0a  , y).flatten()..
-00019570: 2020 2020 2320 6173 7375 6d69 6e67 2073      # assuming s
-00019580: 6361 6c65 642c 2074 6865 7365 2073 686f  caled, these sho
-00019590: 756c 6420 6265 2072 6561 736f 6e61 626c  uld be reasonabl
-000195a0: 6520 626f 756e 6473 0d0a 2020 2020 626f  e bounds..    bo
-000195b0: 756e 6473 203d 205b 282d 3130 2c20 3130  unds = [(-10, 10
-000195c0: 2920 666f 7220 7820 696e 2078 305d 0d0a  ) for x in x0]..
-000195d0: 2020 2020 6966 2063 6f73 745f 6675 6e63      if cost_func
-000195e0: 7469 6f6e 203d 3d20 2264 7761 6522 3a0d  tion == "dwae":.
-000195f0: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
-00019600: 3d20 5b28 2d30 2e35 2c20 3130 2920 666f  = [(-0.5, 10) fo
-00019610: 7220 7820 696e 2078 305d 0d0a 2020 2020  r x in x0]..    
-00019620: 2020 2020 636f 7374 5f66 756e 6320 3d20      cost_func = 
-00019630: 636f 7374 5f66 756e 6374 696f 6e5f 6477  cost_function_dw
-00019640: 6165 0d0a 2020 2020 656c 6966 2063 6f73  ae..    elif cos
-00019650: 745f 6675 6e63 7469 6f6e 203d 3d20 2271  t_function == "q
-00019660: 7561 6e74 696c 6522 3a0d 0a20 2020 2020  uantile":..     
-00019670: 2020 2063 6f73 745f 6675 6e63 203d 2063     cost_func = c
-00019680: 6f73 745f 6675 6e63 7469 6f6e 5f71 7561  ost_function_qua
-00019690: 6e74 696c 650d 0a20 2020 2065 6c69 6620  ntile..    elif 
-000196a0: 636f 7374 5f66 756e 6374 696f 6e20 3d3d  cost_function ==
-000196b0: 2022 6c31 5f70 6f73 6974 6976 6522 3a0d   "l1_positive":.
-000196c0: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
-000196d0: 3d20 5b28 302c 2031 3029 2066 6f72 2078  = [(0, 10) for x
-000196e0: 2069 6e20 7830 5d0d 0a20 2020 2020 2020   in x0]..       
-000196f0: 2063 6f73 745f 6675 6e63 203d 2063 6f73   cost_func = cos
-00019700: 745f 6675 6e63 7469 6f6e 5f6c 310d 0a20  t_function_l1.. 
-00019710: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00019720: 2020 636f 7374 5f66 756e 6320 3d20 636f    cost_func = co
-00019730: 7374 5f66 756e 6374 696f 6e5f 6c31 0d0a  st_function_l1..
-00019740: 2020 2020 7265 7475 726e 206d 696e 696d      return minim
-00019750: 697a 6528 0d0a 2020 2020 2020 2020 636f  ize(..        co
-00019760: 7374 5f66 756e 632c 2078 302c 2061 7267  st_func, x0, arg
-00019770: 733d 2858 2c20 7929 2c20 626f 756e 6473  s=(X, y), bounds
-00019780: 3d62 6f75 6e64 732c 206f 7074 696f 6e73  =bounds, options
-00019790: 3d7b 276d 6178 6974 6572 273a 206d 6178  ={'maxiter': max
-000197a0: 6974 6572 7d0d 0a20 2020 2029 2e78 2e72  iter}..    ).x.r
-000197b0: 6573 6861 7065 2858 2e73 6861 7065 5b31  eshape(X.shape[1
-000197c0: 5d2c 2079 2e73 6861 7065 5b31 5d29 0d0a  ], y.shape[1])..
-000197d0: 0d0a 0d0a 6465 6620 6c69 6e65 6172 5f6d  ....def linear_m
-000197e0: 6f64 656c 2878 2c20 792c 2070 6172 616d  odel(x, y, param
-000197f0: 7329 3a0d 0a20 2020 206d 6f64 656c 5f74  s):..    model_t
-00019800: 7970 6520 3d20 7061 7261 6d73 2e67 6574  ype = params.get
-00019810: 2822 6d6f 6465 6c22 2c20 226c 7374 7371  ("model", "lstsq
-00019820: 2229 0d0a 2020 2020 6c61 6d62 6420 3d20  ")..    lambd = 
-00019830: 7061 7261 6d73 2e67 6574 2822 6c61 6d62  params.get("lamb
-00019840: 6461 222c 204e 6f6e 6529 0d0a 2020 2020  da", None)..    
-00019850: 7265 6320 3d20 7061 7261 6d73 2e67 6574  rec = params.get
-00019860: 2822 7265 6365 6e63 795f 7765 6967 6874  ("recency_weight
-00019870: 696e 6722 2c20 4e6f 6e65 290d 0a20 2020  ing", None)..   
-00019880: 2069 6620 6c61 6d62 6420 6973 206e 6f74   if lambd is not
-00019890: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000198a0: 6964 5f6d 6174 203d 206e 702e 7a65 726f  id_mat = np.zero
-000198b0: 7328 2878 2e73 6861 7065 5b31 5d2c 2078  s((x.shape[1], x
-000198c0: 2e73 6861 7065 5b31 5d29 290d 0a20 2020  .shape[1]))..   
-000198d0: 2020 2020 206e 702e 6669 6c6c 5f64 6961       np.fill_dia
-000198e0: 676f 6e61 6c28 6964 5f6d 6174 2c20 3129  gonal(id_mat, 1)
-000198f0: 0d0a 2020 2020 2020 2020 6964 5f6d 6174  ..        id_mat
-00019900: 5b30 2c20 305d 203d 2030 0d0a 2020 2020  [0, 0] = 0..    
-00019910: 6966 2072 6563 2069 7320 6e6f 7420 4e6f  if rec is not No
-00019920: 6e65 3a0d 0a20 2020 2020 2020 2077 6569  ne:..        wei
-00019930: 6768 7473 203d 2028 6e70 2e61 7261 6e67  ghts = (np.arang
-00019940: 6528 6c65 6e28 7829 2920 2b20 3129 202a  e(len(x)) + 1) *
-00019950: 2a20 7265 6320 2023 2030 2e30 3520 2d20  * rec  # 0.05 - 
-00019960: 302e 3235 0d0a 2020 2020 2020 2020 7820  0.25..        x 
-00019970: 3d20 7820 2a20 7765 6967 6874 735b 2e2e  = x * weights[..
-00019980: 2e2c 204e 6f6e 655d 0d0a 2020 2020 2020  ., None]..      
-00019990: 2020 7920 3d20 6e70 2e61 7361 7272 6179    y = np.asarray
-000199a0: 2879 2920 2a20 7765 6967 6874 735b 2e2e  (y) * weights[..
-000199b0: 2e2c 204e 6f6e 655d 0d0a 2020 2020 6966  ., None]..    if
-000199c0: 206d 6f64 656c 5f74 7970 6520 3d3d 2022   model_type == "
-000199d0: 6c73 7473 7122 3a0d 0a20 2020 2020 2020  lstsq":..       
-000199e0: 2069 6620 6c61 6d62 6420 6973 206e 6f74   if lambd is not
-000199f0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00019a00: 2020 2020 7265 7475 726e 206e 702e 6c69      return np.li
-00019a10: 6e61 6c67 2e6c 7374 7371 2878 2e54 2e64  nalg.lstsq(x.T.d
-00019a20: 6f74 2878 2920 2b20 6c61 6d62 6420 2a20  ot(x) + lambd * 
-00019a30: 6964 5f6d 6174 2c20 782e 542e 646f 7428  id_mat, x.T.dot(
-00019a40: 7929 2c20 7263 6f6e 643d 4e6f 6e65 295b  y), rcond=None)[
-00019a50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019a60: 2020 300d 0a20 2020 2020 2020 2020 2020    0..           
-00019a70: 205d 0d0a 2020 2020 2020 2020 656c 7365   ]..        else
-00019a80: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00019a90: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
-00019aa0: 6c73 7473 7128 782c 2079 2c20 7263 6f6e  lstsq(x, y, rcon
-00019ab0: 643d 4e6f 6e65 295b 305d 0d0a 2020 2020  d=None)[0]..    
-00019ac0: 656c 6966 206d 6f64 656c 5f74 7970 6520  elif model_type 
-00019ad0: 3d3d 2022 6c69 6e61 6c67 5f73 6f6c 7665  == "linalg_solve
-00019ae0: 223a 0d0a 2020 2020 2020 2020 7265 7475  ":..        retu
-00019af0: 726e 206c 7374 7371 5f73 6f6c 7665 2878  rn lstsq_solve(x
-00019b00: 2c20 792c 206c 616d 623d 6c61 6d62 642c  , y, lamb=lambd,
-00019b10: 2069 6465 6e74 6974 795f 6d61 7472 6978   identity_matrix
-00019b20: 3d69 645f 6d61 7429 0d0a 2020 2020 656c  =id_mat)..    el
-00019b30: 6966 206d 6f64 656c 5f74 7970 6520 3d3d  if model_type ==
-00019b40: 2022 6c31 5f6e 6f72 6d22 3a0d 0a20 2020   "l1_norm":..   
-00019b50: 2020 2020 2072 6574 7572 6e20 6c73 7473       return lsts
-00019b60: 715f 6d69 6e69 6d69 7a65 280d 0a20 2020  q_minimize(..   
-00019b70: 2020 2020 2020 2020 206e 702e 6173 6172           np.asar
-00019b80: 7261 7928 7829 2c0d 0a20 2020 2020 2020  ray(x),..       
-00019b90: 2020 2020 206e 702e 6173 6172 7261 7928       np.asarray(
-00019ba0: 7929 2c0d 0a20 2020 2020 2020 2020 2020  y),..           
-00019bb0: 206d 6178 6974 6572 3d70 6172 616d 732e   maxiter=params.
-00019bc0: 6765 7428 226d 6178 6974 6572 222c 2031  get("maxiter", 1
-00019bd0: 3530 3030 292c 0d0a 2020 2020 2020 2020  5000),..        
-00019be0: 2020 2020 636f 7374 5f66 756e 6374 696f      cost_functio
-00019bf0: 6e3d 226c 3122 2c0d 0a20 2020 2020 2020  n="l1",..       
-00019c00: 2029 0d0a 2020 2020 656c 6966 206d 6f64   )..    elif mod
-00019c10: 656c 5f74 7970 6520 3d3d 2022 7175 616e  el_type == "quan
-00019c20: 7469 6c65 5f6e 6f72 6d22 3a0d 0a20 2020  tile_norm":..   
-00019c30: 2020 2020 2072 6574 7572 6e20 6c73 7473       return lsts
-00019c40: 715f 6d69 6e69 6d69 7a65 280d 0a20 2020  q_minimize(..   
-00019c50: 2020 2020 2020 2020 206e 702e 6173 6172           np.asar
-00019c60: 7261 7928 7829 2c0d 0a20 2020 2020 2020  ray(x),..       
-00019c70: 2020 2020 206e 702e 6173 6172 7261 7928       np.asarray(
-00019c80: 7929 2c0d 0a20 2020 2020 2020 2020 2020  y),..           
-00019c90: 206d 6178 6974 6572 3d70 6172 616d 732e   maxiter=params.
-00019ca0: 6765 7428 226d 6178 6974 6572 222c 2031  get("maxiter", 1
-00019cb0: 3530 3030 292c 0d0a 2020 2020 2020 2020  5000),..        
-00019cc0: 2020 2020 636f 7374 5f66 756e 6374 696f      cost_functio
-00019cd0: 6e3d 2271 7561 6e74 696c 6522 2c0d 0a20  n="quantile",.. 
-00019ce0: 2020 2020 2020 2029 0d0a 2020 2020 656c         )..    el
-00019cf0: 6966 206d 6f64 656c 5f74 7970 6520 3d3d  if model_type ==
-00019d00: 2022 6477 6165 5f6e 6f72 6d22 3a0d 0a20   "dwae_norm":.. 
-00019d10: 2020 2020 2020 2072 6574 7572 6e20 6c73         return ls
-00019d20: 7473 715f 6d69 6e69 6d69 7a65 280d 0a20  tsq_minimize(.. 
-00019d30: 2020 2020 2020 2020 2020 206e 702e 6173             np.as
-00019d40: 6172 7261 7928 7829 2c0d 0a20 2020 2020  array(x),..     
-00019d50: 2020 2020 2020 206e 702e 6173 6172 7261         np.asarra
-00019d60: 7928 7929 2c0d 0a20 2020 2020 2020 2020  y(y),..         
-00019d70: 2020 206d 6178 6974 6572 3d70 6172 616d     maxiter=param
-00019d80: 732e 6765 7428 226d 6178 6974 6572 222c  s.get("maxiter",
-00019d90: 2031 3530 3030 292c 0d0a 2020 2020 2020   15000),..      
-00019da0: 2020 2020 2020 636f 7374 5f66 756e 6374        cost_funct
-00019db0: 696f 6e3d 2264 7761 6522 2c0d 0a20 2020  ion="dwae",..   
-00019dc0: 2020 2020 2029 0d0a 2020 2020 656c 6966       )..    elif
-00019dd0: 206d 6f64 656c 5f74 7970 6520 3d3d 2022   model_type == "
-00019de0: 6c31 5f70 6f73 6974 6976 6522 3a0d 0a20  l1_positive":.. 
-00019df0: 2020 2020 2020 2072 6574 7572 6e20 6c73         return ls
-00019e00: 7473 715f 6d69 6e69 6d69 7a65 280d 0a20  tsq_minimize(.. 
-00019e10: 2020 2020 2020 2020 2020 206e 702e 6173             np.as
-00019e20: 6172 7261 7928 7829 2c0d 0a20 2020 2020  array(x),..     
-00019e30: 2020 2020 2020 206e 702e 6173 6172 7261         np.asarra
-00019e40: 7928 7929 2c0d 0a20 2020 2020 2020 2020  y(y),..         
-00019e50: 2020 206d 6178 6974 6572 3d70 6172 616d     maxiter=param
-00019e60: 732e 6765 7428 226d 6178 6974 6572 222c  s.get("maxiter",
-00019e70: 2031 3530 3030 292c 0d0a 2020 2020 2020   15000),..      
-00019e80: 2020 2020 2020 636f 7374 5f66 756e 6374        cost_funct
-00019e90: 696f 6e3d 226c 315f 706f 7369 7469 7665  ion="l1_positive
-00019ea0: 222c 0d0a 2020 2020 2020 2020 290d 0a20  ",..        ).. 
-00019eb0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00019ec0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00019ed0: 6f72 2822 6c69 6e65 6172 206d 6f64 656c  or("linear model
-00019ee0: 206e 6f74 2072 6563 6f67 6e69 7a65 6422   not recognized"
-00019ef0: 290d 0a0d 0a0d 0a23 2053 6561 736f 6e61  )......# Seasona
-00019f00: 6c69 7469 6573 0d0a 2320 696e 7465 7261  lities..# intera
-00019f10: 6374 696f 6e20 6566 6665 6374 206f 6e6c  ction effect onl
-00019f20: 7920 6f6e 2066 6972 7374 2074 776f 2073  y on first two s
-00019f30: 6561 736f 6e61 6c69 7469 6573 2069 6620  easonalities if 
-00019f40: 6f72 6465 7220 6d61 7463 6865 730d 0a0d  order matches...
-00019f50: 0a23 2043 6174 6567 6f72 6963 616c 2046  .# Categorical F
-00019f60: 6561 7475 7265 730d 0a23 2028 6d75 6c74  eatures..# (mult
-00019f70: 6976 6172 6961 7465 2073 756d 6d61 7269  ivariate summari
-00019f80: 6573 2062 7920 6772 6f75 7029 0d0a 0d0a  es by group)....
-00019f90: 2320 7061 7374 2069 6d70 6163 7473 2028  # past impacts (
-00019fa0: 6f70 7469 6f6e 2074 6f20 6e6f 7420 656e  option to not en
-00019fb0: 666f 7263 652c 206f 6e6c 7920 7368 6f77  force, only show
-00019fc0: 290d 0a0d 0a23 2077 6861 7420 6973 2073  )....# what is s
-00019fd0: 7469 6c6c 206e 6565 6465 643a 0d0a 2320  till needed:..# 
-00019fe0: 6261 7965 7369 616e 206c 696e 6561 7220  bayesian linear 
-00019ff0: 6d6f 6465 6c20 6f70 7469 6f6e 730d 0a23  model options..#
-0001a000: 206d 6f72 6520 6d75 6c74 6976 6172 6961   more multivaria
-0001a010: 7465 2073 756d 6d61 7269 6573 0d0a 2320  te summaries..# 
-0001a020: 6164 6420 616e 6f6d 616c 7920 636c 6173  add anomaly clas
-0001a030: 7369 6669 6572 2074 6f20 666f 7265 6361  sifier to foreca
-0001a040: 7374 0d0a 2320 7265 6669 6e65 2074 7261  st..# refine tra
-0001a050: 6e73 666f 726d 6174 696f 6e73 2061 6e64  nsformations and
-0001a060: 206d 6f64 656c 7320 6765 6e65 7261 7465   models generate
-0001a070: 6420 6279 2067 6574 5f6e 6577 5f70 6172  d by get_new_par
-0001a080: 616d 730d 0a23 2072 6577 6569 6768 7420  ams..# reweight 
-0001a090: 736f 206c 6f6f 7020 6973 206e 6f74 2072  so loop is not r
-0001a0a0: 6571 7569 7265 6420 736f 206f 6674 656e  equired so often
-0001a0b0: 0d0a 2320 7465 7374 2061 6e64 2062 7567  ..# test and bug
-0001a0c0: 2066 6978 2065 7665 7279 7468 696e 670d   fix everything.
-0001a0d0: 0a23 206c 315f 6e6f 726d 2069 736e 2774  .# l1_norm isn't
-0001a0e0: 2077 6f72 6b69 6e67 0d0a 2320 756e 6974   working..# unit
-0001a0f0: 7465 7374 730d 0a0d 0a23 2054 4553 540d  tests....# TEST.
-0001a100: 0a23 206e 6577 5f64 660d 0a0d 0a23 2063  .# new_df....# c
-0001a110: 6f75 6c64 2064 6f20 7061 7274 6961 6c20  ould do partial 
-0001a120: 706f 6f6c 696e 6720 6279 206d 696e 696d  pooling by minim
-0001a130: 697a 696e 6720 6120 6675 6e63 7469 6f6e  izing a function
-0001a140: 2074 6861 7420 6d69 7865 7320 7368 6172   that mixes shar
-0001a150: 6564 2061 6e64 2075 6e73 6861 7265 6420  ed and unshared 
-0001a160: 636f 6566 6669 6369 656e 7473 2028 6d75  coefficients (mu
-0001a170: 6c74 6970 6c69 6361 7469 7665 290d 0a0d  ltiplicative)...
-0001a180: 0a23 2073 6561 7263 6820 7370 6163 653a  .# search space:
-0001a190: 0d0a 2320 6661 7374 206f 6e20 6c73 7473  ..# fast on lsts
-0001a1a0: 7173 206d 6f64 656c 0d0a 2320 6675 6c6c  qs model..# full
-0001a1b0: 2073 6561 7263 6820 6f66 2070 7265 6465   search of prede
-0001a1c0: 6669 6e65 6420 6f70 7469 6f6e 730d 0a23  fined options..#
-0001a1d0: 2073 6369 7079 206d 696e 696d 697a 6520   scipy minimize 
-0001a1e0: 666f 7220 636f 6e74 696e 756f 7573 2070  for continuous p
-0001a1f0: 6172 616d 732c 206f 7220 6d61 7962 6520  arams, or maybe 
-0001a200: 696e 7428 7061 7261 6d29 2066 6f72 2064  int(param) for d
-0001a210: 6973 6372 6574 6520 746f 6f0d 0a23 206d  iscrete too..# m
-0001a220: 696e 696d 697a 6520 776f 726b 696e 6720  inimize working 
-0001a230: 666f 7220 726f 6c6c 696e 6720 7769 6e64  for rolling wind
-0001a240: 6f77 2073 697a 6520 6275 7420 6e6f 7420  ow size but not 
-0001a250: 666f 7220 7365 6173 6f6e 616c 6974 7920  for seasonality 
-0001a260: 2861 6374 7561 6c6c 7920 7072 6f62 6162  (actually probab
-0001a270: 6c79 2077 696e 646f 7720 6973 206f 7665  ly window is ove
-0001a280: 7266 6974 290d 0a23 2064 6f20 6974 2073  rfit)..# do it s
-0001a290: 7465 7077 6973 653a 0d0a 2320 6669 7273  tepwise:..# firs
-0001a2a0: 7420 6669 7420 7365 6173 6f6e 616c 6974  t fit seasonalit
-0001a2b0: 7920 2877 6974 6820 666c 6167 2072 6567  y (with flag reg
-0001a2c0: 7265 7373 6f72 7320 6275 7420 6e6f 7420  ressors but not 
-0001a2d0: 6f74 6865 7273 290d 0a23 2073 6563 6f6e  others)..# secon
-0001a2e0: 646c 7920 7363 616c 6572 7320 616e 6420  dly scalers and 
-0001a2f0: 7072 6570 726f 6365 7373 696e 6720 414e  preprocessing AN
-0001a300: 4420 616e 6f6d 616c 7920 6465 7465 6374  D anomaly detect
-0001a310: 696f 6e20 414e 4420 686f 6c69 6461 7920  ion AND holiday 
-0001a320: 6465 7465 6374 696f 6e0d 0a23 2070 6f73  detection..# pos
-0001a330: 7369 626c 7920 6164 6420 3372 6420 7365  sibly add 3rd se
-0001a340: 6173 6f6e 616c 6974 7920 6166 7465 7220  asonality after 
-0001a350: 7072 6570 726f 6365 7373 696e 670d 0a23  preprocessing..#
-0001a360: 2074 6869 7264 6c79 2072 6f6c 6c69 6e67   thirdly rolling
-0001a370: 2077 696e 646f 7720 7369 7a65 2028 696e   window size (in
-0001a380: 636c 7564 6520 726f 6c6c 696e 6720 7769  clude rolling wi
-0001a390: 6e64 6f77 2069 6e20 696e 6974 6961 6c20  ndow in initial 
-0001a3a0: 5820 6166 7465 7220 7468 6973 290d 0a23  X after this)..#
-0001a3b0: 2074 6865 6e20 7465 7374 2075 7365 7220   then test user 
-0001a3c0: 7265 6772 6573 736f 7220 616e 6420 7072  regressor and pr
-0001a3d0: 6570 726f 6365 7373 696e 670d 0a23 2074  eprocessing..# t
-0001a3e0: 6865 6e20 7465 7374 2041 5220 6c61 6773  hen test AR lags
-0001a3f0: 2028 646f 6e27 7420 7573 6520 6966 2025   (don't use if %
-0001a400: 2067 6169 6e20 6973 203c 2078 2025 290d   gain is < x %).
-0001a410: 0a23 206f 7220 6d61 7962 6520 7573 6520  .# or maybe use 
-0001a420: 6120 7275 6e74 696d 6520 7765 6967 6874  a runtime weight
-0001a430: 696e 670d 0a23 2074 6865 6e20 6d75 6c74  ing..# then mult
-0001a440: 6976 6172 6961 7465 2073 756d 6d61 7269  ivariate summari
-0001a450: 6573 0d0a 2320 4649 4e41 4c4c 5920 636f  es..# FINALLY co
-0001a460: 7661 7269 6174 6520 6c61 6773 2028 6665  variate lags (fe
-0001a470: 6174 7572 6520 7365 6c65 6374 696f 6e20  ature selection 
-0001a480: 6465 6669 6e69 7465 6c79 206e 6565 6465  definitely neede
-0001a490: 6429 0d0a 0d0a 0d0a 6966 2046 616c 7365  d)......if False
-0001a4a0: 3a0d 0a20 2020 2023 2074 6573 7420 686f  :..    # test ho
-0001a4b0: 6c69 6461 7920 636f 756e 7472 6965 732c  liday countries,
-0001a4c0: 2072 6567 7265 7373 6f72 732c 2069 6d70   regressors, imp
-0001a4d0: 6163 7473 0d0a 2020 2020 6672 6f6d 2061  acts..    from a
-0001a4e0: 7574 6f74 7320 696d 706f 7274 206c 6f61  utots import loa
-0001a4f0: 645f 6461 696c 790d 0a20 2020 2069 6d70  d_daily..    imp
-0001a500: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-0001a510: 7970 6c6f 7420 6173 2070 6c74 0d0a 0d0a  yplot as plt....
-0001a520: 2020 2020 6361 7465 676f 7269 6361 6c5f      categorical_
-0001a530: 6772 6f75 7073 203d 207b 0d0a 2020 2020  groups = {..    
-0001a540: 2020 2020 2277 696b 695f 556e 6974 6564      "wiki_United
-0001a550: 5f53 7461 7465 7322 3a20 2763 6f75 6e74  _States": 'count
-0001a560: 7279 272c 0d0a 2020 2020 2020 2020 2277  ry',..        "w
-0001a570: 696b 695f 4765 726d 616e 7922 3a20 2763  iki_Germany": 'c
-0001a580: 6f75 6e74 7279 272c 0d0a 2020 2020 2020  ountry',..      
-0001a590: 2020 2277 696b 695f 4a65 7375 7322 3a20    "wiki_Jesus": 
-0001a5a0: 2768 6f6c 6964 6179 272c 0d0a 2020 2020  'holiday',..    
-0001a5b0: 2020 2020 2277 696b 695f 4d69 6368 6165      "wiki_Michae
-0001a5c0: 6c5f 4a61 636b 736f 6e22 3a20 2770 6572  l_Jackson": 'per
-0001a5d0: 736f 6e27 2c0d 0a20 2020 2020 2020 2022  son',..        "
-0001a5e0: 7769 6b69 5f45 6173 7465 7222 3a20 2768  wiki_Easter": 'h
-0001a5f0: 6f6c 6964 6179 272c 0d0a 2020 2020 2020  oliday',..      
-0001a600: 2020 2277 696b 695f 4368 7269 7374 6d61    "wiki_Christma
-0001a610: 7322 3a20 2768 6f6c 6964 6179 272c 0d0a  s": 'holiday',..
-0001a620: 2020 2020 2020 2020 2277 696b 695f 4368          "wiki_Ch
-0001a630: 696e 6573 655f 4e65 775f 5965 6172 223a  inese_New_Year":
-0001a640: 2027 686f 6c69 6461 7927 2c0d 0a20 2020   'holiday',..   
-0001a650: 2020 2020 2022 7769 6b69 5f54 6861 6e6b       "wiki_Thank
-0001a660: 7367 6976 696e 6722 3a20 2768 6f6c 6964  sgiving": 'holid
-0001a670: 6179 272c 0d0a 2020 2020 2020 2020 2277  ay',..        "w
-0001a680: 696b 695f 456c 697a 6162 6574 685f 4949  iki_Elizabeth_II
-0001a690: 223a 2027 7065 7273 6f6e 272c 0d0a 2020  ": 'person',..  
-0001a6a0: 2020 2020 2020 2277 696b 695f 5769 6c6c        "wiki_Will
-0001a6b0: 6961 6d5f 5368 616b 6573 7065 6172 6522  iam_Shakespeare"
-0001a6c0: 3a20 2770 6572 736f 6e27 2c0d 0a20 2020  : 'person',..   
-0001a6d0: 2020 2020 2022 7769 6b69 5f47 656f 7267       "wiki_Georg
-0001a6e0: 655f 5761 7368 696e 6774 6f6e 223a 2027  e_Washington": '
-0001a6f0: 7065 7273 6f6e 272c 0d0a 2020 2020 2020  person',..      
-0001a700: 2020 2277 696b 695f 436c 656f 7061 7472    "wiki_Cleopatr
-0001a710: 6122 3a20 2770 6572 736f 6e27 2c0d 0a20  a": 'person',.. 
-0001a720: 2020 207d 0d0a 2020 2020 686f 6c69 6461     }..    holida
-0001a730: 795f 636f 756e 7472 6965 7320 3d20 7b0d  y_countries = {.
-0001a740: 0a20 2020 2020 2020 2027 7769 6b69 5f45  .        'wiki_E
-0001a750: 6c69 7a61 6265 7468 5f49 4927 3a20 2775  lizabeth_II': 'u
-0001a760: 6b27 2c0d 0a20 2020 2020 2020 2027 7769  k',..        'wi
-0001a770: 6b69 5f55 6e69 7465 645f 5374 6174 6573  ki_United_States
-0001a780: 273a 2027 7573 272c 0d0a 2020 2020 2020  ': 'us',..      
-0001a790: 2020 2777 696b 695f 4765 726d 616e 7927    'wiki_Germany'
-0001a7a0: 3a20 2764 6527 2c0d 0a20 2020 207d 0d0a  : 'de',..    }..
-0001a7b0: 2020 2020 6466 5f64 6169 6c79 203d 206c      df_daily = l
-0001a7c0: 6f61 645f 6461 696c 7928 6c6f 6e67 3d46  oad_daily(long=F
-0001a7d0: 616c 7365 290d 0a20 2020 2023 2061 6464  alse)..    # add
-0001a7e0: 206e 616e 0d0a 2020 2020 6466 5f64 6169   nan..    df_dai
-0001a7f0: 6c79 2e69 6c6f 635b 3130 302c 203a 5d20  ly.iloc[100, :] 
-0001a800: 3d20 6e70 2e6e 616e 0d0a 2020 2020 666f  = np.nan..    fo
-0001a810: 7265 6361 7374 5f6c 656e 6774 6820 3d20  recast_length = 
-0001a820: 3138 300d 0a20 2020 2069 6e63 6c75 6465  180..    include
-0001a830: 5f68 6973 746f 7279 203d 2054 7275 650d  _history = True.
-0001a840: 0a20 2020 2064 665f 7472 6169 6e20 3d20  .    df_train = 
-0001a850: 6466 5f64 6169 6c79 5b3a 2d66 6f72 6563  df_daily[:-forec
-0001a860: 6173 745f 6c65 6e67 7468 5d2e 696c 6f63  ast_length].iloc
-0001a870: 5b3a 2c20 313a 5d0d 0a20 2020 2064 665f  [:, 1:]..    df_
-0001a880: 7465 7374 203d 2064 665f 6461 696c 795b  test = df_daily[
-0001a890: 2d66 6f72 6563 6173 745f 6c65 6e67 7468  -forecast_length
-0001a8a0: 3a5d 2e69 6c6f 635b 3a2c 2031 3a5d 0d0a  :].iloc[:, 1:]..
-0001a8b0: 2020 2020 6661 6b65 5f72 6567 7220 3d20      fake_regr = 
-0001a8c0: 6466 5f64 6169 6c79 5b3a 2d66 6f72 6563  df_daily[:-forec
-0001a8d0: 6173 745f 6c65 6e67 7468 5d2e 696c 6f63  ast_length].iloc
-0001a8e0: 5b3a 2c20 303a 315d 0d0a 2020 2020 6661  [:, 0:1]..    fa
-0001a8f0: 6b65 5f72 6567 725f 6663 7374 203d 2028  ke_regr_fcst = (
-0001a900: 0d0a 2020 2020 2020 2020 6466 5f64 6169  ..        df_dai
-0001a910: 6c79 2e69 6c6f 635b 3a2c 2030 3a31 5d0d  ly.iloc[:, 0:1].
-0001a920: 0a20 2020 2020 2020 2069 6620 696e 636c  .        if incl
-0001a930: 7564 655f 6869 7374 6f72 790d 0a20 2020  ude_history..   
-0001a940: 2020 2020 2065 6c73 6520 6466 5f64 6169       else df_dai
-0001a950: 6c79 5b2d 666f 7265 6361 7374 5f6c 656e  ly[-forecast_len
-0001a960: 6774 683a 5d2e 696c 6f63 5b3a 2c20 303a  gth:].iloc[:, 0:
-0001a970: 315d 0d0a 2020 2020 290d 0a20 2020 2066  1]..    )..    f
-0001a980: 6c61 675f 7265 6772 6573 736f 7220 3d20  lag_regressor = 
-0001a990: 7064 2e44 6174 6146 7261 6d65 2831 2c20  pd.DataFrame(1, 
-0001a9a0: 696e 6465 783d 6661 6b65 5f72 6567 722e  index=fake_regr.
-0001a9b0: 696e 6465 782c 2063 6f6c 756d 6e73 3d5b  index, columns=[
-0001a9c0: 2266 6c61 675f 7465 7374 225d 290d 0a20  "flag_test"]).. 
-0001a9d0: 2020 2066 6c61 675f 7265 6772 6573 736f     flag_regresso
-0001a9e0: 725f 6663 7374 203d 2070 642e 4461 7461  r_fcst = pd.Data
-0001a9f0: 4672 616d 6528 0d0a 2020 2020 2020 2020  Frame(..        
-0001aa00: 312c 2069 6e64 6578 3d66 616b 655f 7265  1, index=fake_re
-0001aa10: 6772 5f66 6373 742e 696e 6465 782c 2063  gr_fcst.index, c
-0001aa20: 6f6c 756d 6e73 3d5b 2266 6c61 675f 7465  olumns=["flag_te
-0001aa30: 7374 225d 0d0a 2020 2020 290d 0a20 2020  st"]..    )..   
-0001aa40: 2072 6567 725f 7065 725f 7365 7269 6573   regr_per_series
-0001aa50: 203d 207b 0d0a 2020 2020 2020 2020 7374   = {..        st
-0001aa60: 7228 6466 5f74 7261 696e 2e63 6f6c 756d  r(df_train.colum
-0001aa70: 6e73 5b30 5d29 3a20 7064 2e44 6174 6146  ns[0]): pd.DataF
-0001aa80: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
-0001aa90: 2020 206e 702e 7261 6e64 6f6d 2e6e 6f72     np.random.nor
-0001aaa0: 6d61 6c28 7369 7a65 3d28 6c65 6e28 6466  mal(size=(len(df
-0001aab0: 5f74 7261 696e 292c 2031 2929 2c20 696e  _train), 1)), in
-0001aac0: 6465 783d 6466 5f74 7261 696e 2e69 6e64  dex=df_train.ind
-0001aad0: 6578 0d0a 2020 2020 2020 2020 290d 0a20  ex..        ).. 
-0001aae0: 2020 207d 0d0a 2020 2020 7265 6772 5f70     }..    regr_p
-0001aaf0: 6572 5f73 6572 6965 735f 6663 7374 203d  er_series_fcst =
-0001ab00: 207b 0d0a 2020 2020 2020 2020 7374 7228   {..        str(
-0001ab10: 6466 5f74 7261 696e 2e63 6f6c 756d 6e73  df_train.columns
-0001ab20: 5b30 5d29 3a20 7064 2e44 6174 6146 7261  [0]): pd.DataFra
-0001ab30: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
-0001ab40: 206e 702e 7261 6e64 6f6d 2e6e 6f72 6d61   np.random.norma
-0001ab50: 6c28 7369 7a65 3d28 666f 7265 6361 7374  l(size=(forecast
-0001ab60: 5f6c 656e 6774 682c 2031 2929 2c20 696e  _length, 1)), in
-0001ab70: 6465 783d 6466 5f74 6573 742e 696e 6465  dex=df_test.inde
-0001ab80: 780d 0a20 2020 2020 2020 2029 0d0a 2020  x..        )..  
-0001ab90: 2020 7d0d 0a20 2020 2063 6f6e 7374 7261    }..    constra
-0001aba0: 696e 7420 3d20 7b0d 0a20 2020 2020 2020  int = {..       
-0001abb0: 2027 636f 6e73 7472 6169 6e74 5f6d 6574   'constraint_met
-0001abc0: 686f 6427 3a20 2771 7561 6e74 696c 6527  hod': 'quantile'
-0001abd0: 2c0d 0a20 2020 2020 2020 2027 6c6f 7765  ,..        'lowe
-0001abe0: 725f 636f 6e73 7472 6169 6e74 273a 2030  r_constraint': 0
-0001abf0: 2c0d 0a20 2020 2020 2020 2027 7570 7065  ,..        'uppe
-0001ac00: 725f 636f 6e73 7472 6169 6e74 273a 204e  r_constraint': N
-0001ac10: 6f6e 652c 0d0a 2020 2020 2020 2020 2262  one,..        "b
-0001ac20: 6f75 6e64 7322 3a20 5472 7565 2c0d 0a20  ounds": True,.. 
-0001ac30: 2020 207d 0d0a 2020 2020 7061 7374 5f69     }..    past_i
-0001ac40: 6d70 6163 7473 203d 2070 642e 4461 7461  mpacts = pd.Data
-0001ac50: 4672 616d 6528 302c 2069 6e64 6578 3d64  Frame(0, index=d
-0001ac60: 665f 7472 6169 6e2e 696e 6465 782c 2063  f_train.index, c
-0001ac70: 6f6c 756d 6e73 3d64 665f 7472 6169 6e2e  olumns=df_train.
-0001ac80: 636f 6c75 6d6e 7329 0d0a 2020 2020 7061  columns)..    pa
-0001ac90: 7374 5f69 6d70 6163 7473 2e69 6c6f 635b  st_impacts.iloc[
-0001aca0: 2d31 303a 2c20 305d 203d 206e 702e 6765  -10:, 0] = np.ge
-0001acb0: 6f6d 7370 6163 6528 312c 2031 3029 5b30  omspace(1, 10)[0
-0001acc0: 3a31 305d 202f 2031 3030 0d0a 2020 2020  :10] / 100..    
-0001acd0: 7061 7374 5f69 6d70 6163 7473 2e69 6c6f  past_impacts.ilo
-0001ace0: 635b 2d33 303a 2c20 2d31 5d20 3d20 6e70  c[-30:, -1] = np
-0001acf0: 2e6c 696e 7370 6163 6528 312c 2031 3029  .linspace(1, 10)
-0001ad00: 5b30 3a33 305d 202f 202d 3130 300d 0a20  [0:30] / -100.. 
-0001ad10: 2020 2066 7574 7572 655f 696d 7061 6374     future_impact
-0001ad20: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
-0001ad30: 2830 2c20 696e 6465 783d 6466 5f74 6573  (0, index=df_tes
-0001ad40: 742e 696e 6465 782c 2063 6f6c 756d 6e73  t.index, columns
-0001ad50: 3d64 665f 7465 7374 2e63 6f6c 756d 6e73  =df_test.columns
-0001ad60: 290d 0a20 2020 2066 7574 7572 655f 696d  )..    future_im
-0001ad70: 7061 6374 732e 696c 6f63 5b30 3a31 302c  pacts.iloc[0:10,
-0001ad80: 2030 5d20 3d20 286e 702e 6c69 6e73 7061   0] = (np.linspa
-0001ad90: 6365 2831 2c20 3130 295b 303a 3130 5d20  ce(1, 10)[0:10] 
-0001ada0: 2b20 3130 2920 2f20 3130 300d 0a0d 0a20  + 10) / 100.... 
-0001adb0: 2020 2063 5f70 6172 616d 7320 3d20 4361     c_params = Ca
-0001adc0: 7373 616e 6472 6128 292e 6765 745f 6e65  ssandra().get_ne
-0001add0: 775f 7061 7261 6d73 2829 0d0a 0d0a 2020  w_params()....  
-0001ade0: 2020 6d6f 6420 3d20 4361 7373 616e 6472    mod = Cassandr
-0001adf0: 6128 0d0a 2020 2020 2020 2020 6e5f 6a6f  a(..        n_jo
-0001ae00: 6273 3d31 2c0d 0a20 2020 2020 2020 202a  bs=1,..        *
-0001ae10: 2a63 5f70 6172 616d 732c 0d0a 2020 2020  *c_params,..    
-0001ae20: 2020 2020 636f 6e73 7472 6169 6e74 3d63      constraint=c
-0001ae30: 6f6e 7374 7261 696e 742c 0d0a 2020 2020  onstraint,..    
-0001ae40: 2020 2020 686f 6c69 6461 795f 636f 756e      holiday_coun
-0001ae50: 7472 6965 733d 686f 6c69 6461 795f 636f  tries=holiday_co
-0001ae60: 756e 7472 6965 732c 0d0a 2020 2020 2020  untries,..      
-0001ae70: 2020 6d61 785f 6d75 6c74 6963 6f6c 696e    max_multicolin
-0001ae80: 6561 7269 7479 3d30 2e30 3030 312c 0d0a  earity=0.0001,..
-0001ae90: 2020 2020 290d 0a20 2020 206d 6f64 2e66      )..    mod.f
-0001aea0: 6974 280d 0a20 2020 2020 2020 2064 665f  it(..        df_
-0001aeb0: 7472 6169 6e2c 0d0a 2020 2020 2020 2020  train,..        
-0001aec0: 6361 7465 676f 7269 6361 6c5f 6772 6f75  categorical_grou
-0001aed0: 7073 3d63 6174 6567 6f72 6963 616c 5f67  ps=categorical_g
-0001aee0: 726f 7570 732c 0d0a 2020 2020 2020 2020  roups,..        
-0001aef0: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
-0001af00: 3d66 616b 655f 7265 6772 2c0d 0a20 2020  =fake_regr,..   
-0001af10: 2020 2020 2072 6567 7265 7373 6f72 5f70       regressor_p
-0001af20: 6572 5f73 6572 6965 733d 7265 6772 5f70  er_series=regr_p
-0001af30: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
-0001af40: 2020 2020 7061 7374 5f69 6d70 6163 7473      past_impacts
-0001af50: 3d70 6173 745f 696d 7061 6374 732c 0d0a  =past_impacts,..
-0001af60: 2020 2020 2020 2020 666c 6167 5f72 6567          flag_reg
-0001af70: 7265 7373 6f72 733d 666c 6167 5f72 6567  ressors=flag_reg
-0001af80: 7265 7373 6f72 2c0d 0a20 2020 2029 0d0a  ressor,..    )..
-0001af90: 2020 2020 7072 6564 203d 206d 6f64 2e70      pred = mod.p
-0001afa0: 7265 6469 6374 280d 0a20 2020 2020 2020  redict(..       
-0001afb0: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
-0001afc0: 3d66 6f72 6563 6173 745f 6c65 6e67 7468  =forecast_length
-0001afd0: 2c0d 0a20 2020 2020 2020 2069 6e63 6c75  ,..        inclu
-0001afe0: 6465 5f68 6973 746f 7279 3d69 6e63 6c75  de_history=inclu
-0001aff0: 6465 5f68 6973 746f 7279 2c0d 0a20 2020  de_history,..   
-0001b000: 2020 2020 2066 7574 7572 655f 7265 6772       future_regr
-0001b010: 6573 736f 723d 6661 6b65 5f72 6567 725f  essor=fake_regr_
-0001b020: 6663 7374 2c0d 0a20 2020 2020 2020 2072  fcst,..        r
-0001b030: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
-0001b040: 6965 733d 7265 6772 5f70 6572 5f73 6572  ies=regr_per_ser
-0001b050: 6965 735f 6663 7374 2c0d 0a20 2020 2020  ies_fcst,..     
-0001b060: 2020 2066 7574 7572 655f 696d 7061 6374     future_impact
-0001b070: 733d 6675 7475 7265 5f69 6d70 6163 7473  s=future_impacts
-0001b080: 2c0d 0a20 2020 2020 2020 2066 6c61 675f  ,..        flag_
-0001b090: 7265 6772 6573 736f 7273 3d66 6c61 675f  regressors=flag_
-0001b0a0: 7265 6772 6573 736f 725f 6663 7374 2c0d  regressor_fcst,.
-0001b0b0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-0001b0c0: 5f6f 7267 616e 6963 3d54 7275 652c 0d0a  _organic=True,..
-0001b0d0: 2020 2020 290d 0a20 2020 2072 6573 756c      )..    resul
-0001b0e0: 7420 3d20 7072 6564 2e66 6f72 6563 6173  t = pred.forecas
-0001b0f0: 740d 0a20 2020 2073 6572 6965 7320 3d20  t..    series = 
-0001b100: 7261 6e64 6f6d 2e63 686f 6963 6528 6d6f  random.choice(mo
-0001b110: 642e 636f 6c75 6d6e 5f6e 616d 6573 290d  d.column_names).
-0001b120: 0a20 2020 2023 2073 6572 6965 7320 3d20  .    # series = 
-0001b130: 2277 696b 695f 5065 7269 6f64 6963 5f74  "wiki_Periodic_t
-0001b140: 6162 6c65 220d 0a20 2020 2073 6572 6965  able"..    serie
-0001b150: 7320 3d20 2777 696b 695f 616c 6c27 0d0a  s = 'wiki_all'..
-0001b160: 2020 2020 6d6f 642e 7265 6772 6573 736f      mod.regresso
-0001b170: 7273 5f75 7365 640d 0a20 2020 206d 6f64  rs_used..    mod
-0001b180: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
-0001b190: 6573 5f75 7365 640d 0a20 2020 2077 6974  es_used..    wit
-0001b1a0: 6820 706c 742e 7374 796c 652e 636f 6e74  h plt.style.cont
-0001b1b0: 6578 7428 2273 6561 626f 726e 2d77 6869  ext("seaborn-whi
-0001b1c0: 7465 2229 3a0d 0a20 2020 2020 2020 2073  te"):..        s
-0001b1d0: 7461 7274 5f64 6174 6520 3d20 2232 3031  tart_date = "201
-0001b1e0: 392d 3037 2d30 3122 0d0a 2020 2020 2020  9-07-01"..      
-0001b1f0: 2020 6d6f 642e 706c 6f74 5f66 6f72 6563    mod.plot_forec
-0001b200: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
-0001b210: 2020 7072 6564 2c0d 0a20 2020 2020 2020    pred,..       
-0001b220: 2020 2020 2061 6374 7561 6c73 3d64 665f       actuals=df_
-0001b230: 6461 696c 7920 6966 2069 6e63 6c75 6465  daily if include
-0001b240: 5f68 6973 746f 7279 2065 6c73 6520 6466  _history else df
-0001b250: 5f74 6573 742c 0d0a 2020 2020 2020 2020  _test,..        
-0001b260: 2020 2020 7365 7269 6573 3d73 6572 6965      series=serie
-0001b270: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0001b280: 7374 6172 745f 6461 7465 3d73 7461 7274  start_date=start
-0001b290: 5f64 6174 652c 0d0a 2020 2020 2020 2020  _date,..        
-0001b2a0: 290d 0a0d 0a20 2020 2020 2020 2023 2070  )....        # p
-0001b2b0: 6c74 2e73 686f 7728 290d 0a20 2020 2020  lt.show()..     
-0001b2c0: 2020 2023 2070 6c74 2e73 6176 6566 6967     # plt.savefig
-0001b2d0: 2822 4361 7373 616e 6472 615f 666f 7265  ("Cassandra_fore
-0001b2e0: 6361 7374 2e70 6e67 222c 2064 7069 3d33  cast.png", dpi=3
-0001b2f0: 3030 290d 0a20 2020 2020 2020 2023 206d  00)..        # m
-0001b300: 6f64 2e70 6c6f 745f 636f 6d70 6f6e 656e  od.plot_componen
-0001b310: 7473 2870 7265 642c 2073 6572 6965 733d  ts(pred, series=
-0001b320: 7365 7269 6573 2c20 746f 5f6f 7269 6769  series, to_origi
-0001b330: 6e5f 7370 6163 653d 4661 6c73 6529 0d0a  n_space=False)..
-0001b340: 2020 2020 2020 2020 2320 706c 742e 7368          # plt.sh
-0001b350: 6f77 2829 0d0a 2020 2020 2020 2020 6d6f  ow()..        mo
-0001b360: 642e 706c 6f74 5f63 6f6d 706f 6e65 6e74  d.plot_component
-0001b370: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
-0001b380: 7072 6564 2c20 7365 7269 6573 3d73 6572  pred, series=ser
-0001b390: 6965 732c 2074 6f5f 6f72 6967 696e 5f73  ies, to_origin_s
-0001b3a0: 7061 6365 3d54 7275 652c 2073 7461 7274  pace=True, start
-0001b3b0: 5f64 6174 653d 7374 6172 745f 6461 7465  _date=start_date
-0001b3c0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
-0001b3d0: 2020 2020 2023 2070 6c74 2e73 6176 6566       # plt.savef
-0001b3e0: 6967 2822 4361 7373 616e 6472 615f 636f  ig("Cassandra_co
-0001b3f0: 6d70 6f6e 656e 7473 332e 706e 6722 2c20  mponents3.png", 
-0001b400: 6470 693d 3330 302c 2062 626f 785f 696e  dpi=300, bbox_in
-0001b410: 6368 6573 3d22 7469 6768 7422 290d 0a20  ches="tight").. 
-0001b420: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
-0001b430: 290d 0a20 2020 2020 2020 206d 6f64 2e70  )..        mod.p
-0001b440: 6c6f 745f 7472 656e 6428 0d0a 2020 2020  lot_trend(..    
-0001b450: 2020 2020 2020 2020 7365 7269 6573 3d73          series=s
-0001b460: 6572 6965 732c 2076 6c69 6e65 3d72 6573  eries, vline=res
-0001b470: 756c 742e 696e 6465 785b 2d66 6f72 6563  ult.index[-forec
-0001b480: 6173 745f 6c65 6e67 7468 5d2c 2073 7461  ast_length], sta
-0001b490: 7274 5f64 6174 653d 7374 6172 745f 6461  rt_date=start_da
-0001b4a0: 7465 0d0a 2020 2020 2020 2020 290d 0a20  te..        ).. 
-0001b4b0: 2020 2020 2020 2023 2070 6c74 2e73 6176         # plt.sav
-0001b4c0: 6566 6967 2822 4361 7373 616e 6472 615f  efig("Cassandra_
-0001b4d0: 7472 656e 642e 706e 6722 2c20 6470 693d  trend.png", dpi=
-0001b4e0: 3330 302c 2062 626f 785f 696e 6368 6573  300, bbox_inches
-0001b4f0: 3d22 7469 6768 7422 290d 0a20 2020 2070  ="tight")..    p
-0001b500: 7265 642e 6576 616c 7561 7465 280d 0a20  red.evaluate(.. 
-0001b510: 2020 2020 2020 2064 665f 6461 696c 792e         df_daily.
-0001b520: 7265 696e 6465 7828 7265 7375 6c74 2e69  reindex(result.i
-0001b530: 6e64 6578 295b 6466 5f74 7261 696e 2e63  ndex)[df_train.c
-0001b540: 6f6c 756d 6e73 5d0d 0a20 2020 2020 2020  olumns]..       
-0001b550: 2069 6620 696e 636c 7564 655f 6869 7374   if include_hist
-0001b560: 6f72 790d 0a20 2020 2020 2020 2065 6c73  ory..        els
-0001b570: 6520 6466 5f74 6573 745b 6466 5f74 7261  e df_test[df_tra
-0001b580: 696e 2e63 6f6c 756d 6e73 5d0d 0a20 2020  in.columns]..   
-0001b590: 2029 0d0a 2020 2020 7072 696e 7428 7072   )..    print(pr
-0001b5a0: 6564 2e61 7667 5f6d 6574 7269 6373 2e72  ed.avg_metrics.r
-0001b5b0: 6f75 6e64 2831 2929 0d0a 0d0a 2020 2020  ound(1))....    
-0001b5c0: 2320 6966 206e 6f74 206d 6f64 2e72 6567  # if not mod.reg
-0001b5d0: 7265 7373 6f72 735f 7573 6564 3a0d 0a20  ressors_used:.. 
-0001b5e0: 2020 2064 6174 6573 203d 2064 665f 6461     dates = df_da
-0001b5f0: 696c 792e 696e 6465 782e 756e 696f 6e28  ily.index.union(
-0001b600: 0d0a 2020 2020 2020 2020 6d6f 642e 6372  ..        mod.cr
-0001b610: 6561 7465 5f66 6f72 6563 6173 745f 696e  eate_forecast_in
-0001b620: 6465 7828 666f 7265 6361 7374 5f6c 656e  dex(forecast_len
-0001b630: 6774 682c 206c 6173 745f 6461 7465 3d64  gth, last_date=d
-0001b640: 665f 6461 696c 792e 696e 6465 785b 2d31  f_daily.index[-1
-0001b650: 5d29 0d0a 2020 2020 290d 0a20 2020 2072  ])..    )..    r
-0001b660: 6567 725f 7073 203d 207b 0d0a 2020 2020  egr_ps = {..    
-0001b670: 2020 2020 2777 696b 695f 4765 726d 616e      'wiki_German
-0001b680: 7927 3a20 7265 6772 5f70 6572 5f73 6572  y': regr_per_ser
-0001b690: 6965 735f 6663 7374 5b27 7769 6b69 5f47  ies_fcst['wiki_G
-0001b6a0: 6572 6d61 6e79 275d 2e72 6569 6e64 6578  ermany'].reindex
-0001b6b0: 280d 0a20 2020 2020 2020 2020 2020 2064  (..            d
-0001b6c0: 6174 6573 2c20 6669 6c6c 5f76 616c 7565  ates, fill_value
-0001b6d0: 3d30 0d0a 2020 2020 2020 2020 290d 0a20  =0..        ).. 
-0001b6e0: 2020 207d 0d0a 2020 2020 7072 6564 3220     }..    pred2 
-0001b6f0: 3d20 6d6f 642e 7072 6564 6963 7428 0d0a  = mod.predict(..
-0001b700: 2020 2020 2020 2020 666f 7265 6361 7374          forecast
-0001b710: 5f6c 656e 6774 683d 666f 7265 6361 7374  _length=forecast
-0001b720: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
-0001b730: 2020 696e 636c 7564 655f 6869 7374 6f72    include_histor
-0001b740: 793d 5472 7565 2c0d 0a20 2020 2020 2020  y=True,..       
-0001b750: 206e 6577 5f64 663d 6466 5f64 6169 6c79   new_df=df_daily
-0001b760: 5b64 665f 7472 6169 6e2e 636f 6c75 6d6e  [df_train.column
-0001b770: 735d 2c0d 0a20 2020 2020 2020 2066 6c61  s],..        fla
-0001b780: 675f 7265 6772 6573 736f 7273 3d66 6c61  g_regressors=fla
-0001b790: 675f 7265 6772 6573 736f 725f 6663 7374  g_regressor_fcst
-0001b7a0: 2e72 6569 6e64 6578 2864 6174 6573 2c20  .reindex(dates, 
-0001b7b0: 6669 6c6c 5f76 616c 7565 3d30 292c 0d0a  fill_value=0),..
-0001b7c0: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-0001b7d0: 6567 7265 7373 6f72 3d66 616b 655f 7265  egressor=fake_re
-0001b7e0: 6772 5f66 6373 742e 7265 696e 6465 7828  gr_fcst.reindex(
-0001b7f0: 6461 7465 732c 2066 696c 6c5f 7661 6c75  dates, fill_valu
-0001b800: 653d 3029 2c0d 0a20 2020 2020 2020 2072  e=0),..        r
-0001b810: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
-0001b820: 6965 733d 7265 6772 5f70 732c 0d0a 2020  ies=regr_ps,..  
-0001b830: 2020 290d 0a20 2020 206d 6f64 2e70 6c6f    )..    mod.plo
-0001b840: 745f 666f 7265 6361 7374 2870 7265 6432  t_forecast(pred2
-0001b850: 2c20 6163 7475 616c 733d 6466 5f64 6169  , actuals=df_dai
-0001b860: 6c79 2c20 7365 7269 6573 3d73 6572 6965  ly, series=serie
-0001b870: 732c 2073 7461 7274 5f64 6174 653d 7374  s, start_date=st
-0001b880: 6172 745f 6461 7465 290d 0a20 2020 206d  art_date)..    m
-0001b890: 6f64 2e72 6574 7572 6e5f 636f 6d70 6f6e  od.return_compon
-0001b8a0: 656e 7473 2829 0d0a 2020 2020 7072 696e  ents()..    prin
-0001b8b0: 7428 635f 7061 7261 6d73 5b27 7472 656e  t(c_params['tren
-0001b8c0: 645f 6d6f 6465 6c27 5d29 0d0a 0d0a 2320  d_model'])....# 
-0001b8d0: 4d55 4c54 4950 4c49 4341 5449 5645 2053  MULTIPLICATIVE S
-0001b8e0: 4541 534f 4e41 4c49 5459 2041 4e44 2048  EASONALITY AND H
-0001b8f0: 4f4c 4944 4159 530d 0a0d 0a23 206c 6f77  OLIDAYS....# low
-0001b900: 206d 656d 6f72 7920 6f70 7469 6f6e 2074   memory option t
-0001b910: 6f20 6465 6c65 7465 2073 746f 7265 6420  o delete stored 
-0001b920: 6466 7320 616e 6420 6172 7261 7973 2061  dfs and arrays a
-0001b930: 7320 736f 6f6e 2061 7320 706f 7373 6962  s soon as possib
-0001b940: 6c65 0d0a 0d0a 2320 4d61 6b65 2073 7572  le....# Make sur
-0001b950: 6520 7820 6665 6174 7572 6573 2061 7265  e x features are
-0001b960: 2061 6c6c 2073 6361 6c65 640d 0a23 2052   all scaled..# R
-0001b970: 656d 6f76 6520 7365 6173 6f6e 616c 6974  emove seasonalit
-0001b980: 7920 6672 6f6d 2072 6567 7265 7373 6f72  y from regressor
-0001b990: 730d 0a0d 0a23 2074 7261 6e73 6665 7220  s....# transfer 
-0001b9a0: 6c65 6172 6e69 6e67 0d0a 2320 6772 6170  learning..# grap
-0001b9b0: 6869 6373 2028 414d 464d 2077 6174 6572  hics (AMFM water
-0001b9c0: 6d61 726b 290d 0a23 2063 6f6d 7061 7265  mark)..# compare
-0001b9d0: 2061 6372 6f73 7320 7061 7374 2066 6f72   across past for
-0001b9e0: 6563 6173 7473 0d0a 2320 7374 6162 696c  ecasts..# stabil
-0001b9f0: 6974 790d 0a23 206d 616b 6520 6974 206d  ity..# make it m
-0001ba00: 6f72 6520 6d6f 6475 6c61 7220 2873 6570  ore modular (sep
-0001ba10: 6172 6174 6520 7573 6162 6c65 2066 756e  arate usable fun
-0001ba20: 6374 696f 6e73 290d 0a0d 0a23 2041 7574  ctions)....# Aut
-0001ba30: 6f6d 6174 696f 6e0d 0a23 2061 6c6c 6f77  omation..# allow
-0001ba40: 2073 6f6d 6520 636f 6e66 6967 2069 6e70   some config inp
-0001ba50: 7574 732c 206f 7220 6175 746f 6d61 7465  uts, or automate
-0001ba60: 6420 6669 740d 0a23 206f 7574 7075 7420  d fit..# output 
-0001ba70: 746f 2074 6162 6c65 0d0a 2320 636f 6d70  to table..# comp
-0001ba80: 6172 6520 636f 6566 6669 6369 656e 7473  are coefficients
-0001ba90: 2063 6861 6e67 6520 6f76 6572 2074 696d   change over tim
-0001baa0: 652c 2061 6363 7572 6163 7920 6f76 6572  e, accuracy over
-0001bab0: 2074 696d 650d 0a23 2063 6f6d 7061 7269   time..# compari
-0001bac0: 6e67 2064 6966 6665 7265 6e74 2073 6f75  ng different sou
-0001bad0: 7263 6573 3f20 616e 642f 6f72 2061 6c6c  rces? and/or all
-0001bae0: 6f77 696e 6720 6f6e 6520 666f 7265 6361  owing one foreca
-0001baf0: 7374 2074 6f20 6265 2075 7365 6420 6173  st to be used as
-0001bb00: 2061 2072 6567 7265 7373 6f72 2066 6f72   a regressor for
-0001bb10: 2061 6e6f 7468 6572 0d0a 2320 776f 756c   another..# woul
-0001bb20: 6420 616c 6c6f 7720 666f 7220 6561 726c  d allow for earl
-0001bb30: 6965 7220 6465 7465 6374 696f 6e20 6f66  ier detection of
-0001bb40: 2062 726f 6b65 6e20 636f 6e6e 6563 7469   broken connecti
-0001bb50: 6f6e 730d 0a0d 0a22 2222 0d0a 6178 203d  ons...."""..ax =
-0001bb60: 2070 7265 642e 706c 6f74 2864 665f 6461   pred.plot(df_da
-0001bb70: 696c 7920 6966 2069 6e63 6c75 6465 5f68  ily if include_h
-0001bb80: 6973 746f 7279 2065 6c73 6520 6466 5f74  istory else df_t
-0001bb90: 6573 742c 2073 6572 6965 733d 7365 7269  est, series=seri
-0001bba0: 6573 2c20 766c 696e 653d 6466 5f74 6573  es, vline=df_tes
-0001bbb0: 742e 696e 6465 785b 305d 2c20 7374 6172  t.index[0], star
-0001bbc0: 745f 6461 7465 3d73 7461 7274 5f64 6174  t_date=start_dat
-0001bbd0: 6529 0d0a 6861 6e64 6c65 732c 206c 6162  e)..handles, lab
-0001bbe0: 656c 7320 3d20 6178 2e67 6574 5f6c 6567  els = ax.get_leg
-0001bbf0: 656e 645f 6861 6e64 6c65 735f 6c61 6265  end_handles_labe
-0001bc00: 6c73 2829 0d0a 6966 206d 6f64 2e61 6e6f  ls()..if mod.ano
-0001bc10: 6d61 6c79 5f64 6574 6563 746f 723a 0d0a  maly_detector:..
-0001bc20: 2020 2020 6966 206d 6f64 2e61 6e6f 6d61      if mod.anoma
-0001bc30: 6c79 5f64 6574 6563 746f 722e 6f75 7470  ly_detector.outp
-0001bc40: 7574 203d 3d20 2275 6e69 7661 7269 6174  ut == "univariat
-0001bc50: 6522 3a0d 0a20 2020 2020 2020 2069 5f61  e":..        i_a
-0001bc60: 6e6f 6d20 3d20 6d6f 642e 616e 6f6d 616c  nom = mod.anomal
-0001bc70: 795f 6465 7465 6374 6f72 2e61 6e6f 6d61  y_detector.anoma
-0001bc80: 6c69 6573 2e69 6e64 6578 5b6d 6f64 2e61  lies.index[mod.a
-0001bc90: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
-0001bca0: 616e 6f6d 616c 6965 732e 696c 6f63 5b3a  anomalies.iloc[:
-0001bcb0: 2c20 305d 203d 3d20 2d31 5d0d 0a20 2020  , 0] == -1]..   
-0001bcc0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0001bcd0: 7365 7269 6573 5f61 6e6f 6d20 3d20 6d6f  series_anom = mo
-0001bce0: 642e 616e 6f6d 616c 795f 6465 7465 6374  d.anomaly_detect
-0001bcf0: 6f72 2e61 6e6f 6d61 6c69 6573 5b73 6572  or.anomalies[ser
-0001bd00: 6965 735d 0d0a 2020 2020 2020 2020 695f  ies]..        i_
-0001bd10: 616e 6f6d 203d 2073 6572 6965 735f 616e  anom = series_an
-0001bd20: 6f6d 5b73 6572 6965 735f 616e 6f6d 203d  om[series_anom =
-0001bd30: 3d20 2d31 5d2e 696e 6465 780d 0a20 2020  = -1].index..   
-0001bd40: 2020 2020 2069 5f61 6e6f 6d20 3d20 695f       i_anom = i_
-0001bd50: 616e 6f6d 5b69 5f61 6e6f 6d20 3e3d 2073  anom[i_anom >= s
-0001bd60: 7461 7274 5f64 6174 655d 0d0a 2020 2020  tart_date]..    
-0001bd70: 6966 206c 656e 2869 5f61 6e6f 6d29 203e  if len(i_anom) >
-0001bd80: 2030 2061 6e64 206c 656e 2869 5f61 6e6f   0 and len(i_ano
-0001bd90: 6d29 203c 206c 656e 2864 665f 6461 696c  m) < len(df_dail
-0001bda0: 7929 202a 2030 2e35 3a0d 0a20 2020 2020  y) * 0.5:..     
-0001bdb0: 2020 2073 6361 7431 203d 2061 782e 7363     scat1 = ax.sc
-0001bdc0: 6174 7465 7228 695f 616e 6f6d 2e74 6f6c  atter(i_anom.tol
-0001bdd0: 6973 7428 292c 2064 665f 6461 696c 792e  ist(), df_daily.
-0001bde0: 6c6f 635b 695f 616e 6f6d 2c20 3a5d 5b73  loc[i_anom, :][s
-0001bdf0: 6572 6965 735d 2c20 633d 2264 6172 6b73  eries], c="darks
-0001be00: 6c61 7465 626c 7565 222c 2073 3d31 322e  lateblue", s=12.
-0001be10: 3029 0d0a 2020 2020 2020 2020 6861 6e64  0)..        hand
-0001be20: 6c65 7320 2b3d 205b 7363 6174 315d 0d0a  les += [scat1]..
-0001be30: 2020 2020 2020 2020 6c61 6265 6c73 202b          labels +
-0001be40: 3d20 5b22 616e 6f6d 616c 6965 7322 5d0d  = ["anomalies"].
-0001be50: 0a69 6620 6d6f 642e 686f 6c69 6461 795f  .if mod.holiday_
-0001be60: 6465 7465 6374 6f72 3a0d 0a20 2020 2069  detector:..    i
-0001be70: 5f61 6e6f 6d20 3d20 6d6f 642e 686f 6c69  _anom = mod.holi
-0001be80: 6461 795f 6465 7465 6374 6f72 2e64 6174  day_detector.dat
-0001be90: 6573 5f74 6f5f 686f 6c69 6461 7973 286d  es_to_holidays(m
-0001bea0: 6f64 2e64 662e 696e 6465 782c 2073 7479  od.df.index, sty
-0001beb0: 6c65 3d22 7365 7269 6573 5f66 6c61 6722  le="series_flag"
-0001bec0: 295b 7365 7269 6573 5d0d 0a20 2020 2069  )[series]..    i
-0001bed0: 5f61 6e6f 6d20 3d20 695f 616e 6f6d 2e69  _anom = i_anom.i
-0001bee0: 6e64 6578 5b69 5f61 6e6f 6d20 3d3d 2031  ndex[i_anom == 1
-0001bef0: 5d0d 0a20 2020 2069 6620 6c65 6e28 695f  ]..    if len(i_
-0001bf00: 616e 6f6d 2920 3e20 3020 616e 6420 6c65  anom) > 0 and le
-0001bf10: 6e28 695f 616e 6f6d 2920 3c20 6c65 6e28  n(i_anom) < len(
-0001bf20: 6466 5f64 6169 6c79 2920 2a20 302e 353a  df_daily) * 0.5:
-0001bf30: 0d0a 2020 2020 2020 2020 7363 6174 3220  ..        scat2 
-0001bf40: 3d20 6178 2e73 6361 7474 6572 2869 5f61  = ax.scatter(i_a
-0001bf50: 6e6f 6d2e 746f 6c69 7374 2829 2c20 6466  nom.tolist(), df
-0001bf60: 5f64 6169 6c79 2e6c 6f63 5b69 5f61 6e6f  _daily.loc[i_ano
-0001bf70: 6d2c 203a 5d5b 7365 7269 6573 5d2c 2063  m, :][series], c
-0001bf80: 3d22 6461 726b 6772 6565 6e22 2c20 733d  ="darkgreen", s=
-0001bf90: 3132 2e30 290d 0a20 2020 2020 2020 2068  12.0)..        h
-0001bfa0: 616e 646c 6573 202b 3d20 5b73 6361 7432  andles += [scat2
-0001bfb0: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
-0001bfc0: 7320 2b3d 205b 2264 6574 6563 7465 6420  s += ["detected 
-0001bfd0: 686f 6c69 6461 7973 225d 0d0a 6966 206d  holidays"]..if m
-0001bfe0: 6f64 2e74 7265 6e64 5f61 6e6f 6d61 6c79  od.trend_anomaly
-0001bff0: 5f64 6574 6563 746f 7220 6973 206e 6f74  _detector is not
-0001c000: 204e 6f6e 653a 0d0a 2020 2020 6966 206d   None:..    if m
-0001c010: 6f64 2e74 7265 6e64 5f61 6e6f 6d61 6c79  od.trend_anomaly
-0001c020: 5f64 6574 6563 746f 722e 6f75 7470 7574  _detector.output
-0001c030: 203d 3d20 2275 6e69 7661 7269 6174 6522   == "univariate"
-0001c040: 3a0d 0a20 2020 2020 2020 2069 5f61 6e6f  :..        i_ano
-0001c050: 6d20 3d20 6d6f 642e 7472 656e 645f 616e  m = mod.trend_an
-0001c060: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
-0001c070: 6e6f 6d61 6c69 6573 2e69 6e64 6578 5b6d  nomalies.index[m
-0001c080: 6f64 2e61 6e6f 6d61 6c79 5f64 6574 6563  od.anomaly_detec
-0001c090: 746f 722e 616e 6f6d 616c 6965 732e 696c  tor.anomalies.il
-0001c0a0: 6f63 5b3a 2c20 305d 203d 3d20 2d31 5d0d  oc[:, 0] == -1].
-0001c0b0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-0001c0c0: 2020 2020 7365 7269 6573 5f61 6e6f 6d20      series_anom 
-0001c0d0: 3d20 6d6f 642e 7472 656e 645f 616e 6f6d  = mod.trend_anom
-0001c0e0: 616c 795f 6465 7465 6374 6f72 2e61 6e6f  aly_detector.ano
-0001c0f0: 6d61 6c69 6573 5b73 6572 6965 735d 0d0a  malies[series]..
-0001c100: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
-0001c110: 2073 6572 6965 735f 616e 6f6d 5b73 6572   series_anom[ser
-0001c120: 6965 735f 616e 6f6d 203d 3d20 2d31 5d2e  ies_anom == -1].
-0001c130: 696e 6465 780d 0a20 2020 2069 6620 7374  index..    if st
-0001c140: 6172 745f 6461 7465 2069 7320 6e6f 7420  art_date is not 
-0001c150: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2069  None:..        i
-0001c160: 5f61 6e6f 6d20 3d20 695f 616e 6f6d 5b69  _anom = i_anom[i
-0001c170: 5f61 6e6f 6d20 3e3d 2073 7461 7274 5f64  _anom >= start_d
-0001c180: 6174 655d 0d0a 2020 2020 6966 206c 656e  ate]..    if len
-0001c190: 2869 5f61 6e6f 6d29 203e 2030 2061 6e64  (i_anom) > 0 and
-0001c1a0: 206c 656e 2869 5f61 6e6f 6d29 203c 206c   len(i_anom) < l
-0001c1b0: 656e 2864 665f 6461 696c 7929 202a 2030  en(df_daily) * 0
-0001c1c0: 2e35 3a0d 0a20 2020 2020 2020 2073 6361  .5:..        sca
-0001c1d0: 7433 203d 2061 782e 7363 6174 7465 7228  t3 = ax.scatter(
-0001c1e0: 695f 616e 6f6d 2e74 6f6c 6973 7428 292c  i_anom.tolist(),
-0001c1f0: 2064 665f 6461 696c 792e 6c6f 635b 695f   df_daily.loc[i_
-0001c200: 616e 6f6d 5d5b 7365 7269 6573 5d2c 2063  anom][series], c
-0001c210: 3d22 736c 6174 6567 7261 7922 2c20 733d  ="slategray", s=
+000144f0: 2020 2020 2020 2274 7261 6e73 666f 726d        "transform
+00014500: 6174 696f 6e5f 7061 7261 6d73 223a 207b  ation_params": {
+00014510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014530: 2020 2230 223a 207b 226d 6574 686f 6422    "0": {"method"
+00014540: 3a20 2263 6c69 7022 2c20 2273 7464 5f74  : "clip", "std_t
+00014550: 6872 6573 686f 6c64 223a 2036 7d0d 0a20  hreshold": 6}.. 
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 2020 2020 2020 2020 2020 207d 2c0d 0a20             },.. 
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2020 207d 2c0d 0a20 2020 2020         },..     
+000145a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145b0: 2020 2022 6d65 7468 6f64 5f70 6172 616d     "method_param
+000145c0: 7322 3a20 7b0d 0a20 2020 2020 2020 2020  s": {..         
+000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145e0: 2020 2022 6971 725f 7468 7265 7368 6f6c     "iqr_threshol
+000145f0: 6422 3a20 322e 352c 0d0a 2020 2020 2020  d": 2.5,..      
+00014600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014610: 2020 2020 2020 2269 7172 5f71 7561 6e74        "iqr_quant
+00014620: 696c 6573 223a 205b 302e 3235 2c20 302e  iles": [0.25, 0.
+00014630: 3735 5d2c 0d0a 2020 2020 2020 2020 2020  75],..          
+00014640: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
+00014650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014660: 2020 2020 2020 2020 2020 2266 696c 6c6e            "filln
+00014670: 6122 3a20 2266 6669 6c6c 222c 0d0a 2020  a": "ffill",..  
+00014680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014690: 2020 7d2c 0d0a 2020 2020 2020 2020 2020    },..          
+000146a0: 2020 2020 2020 2020 2020 2231 223a 207b            "1": {
+000146b0: 7d2c 0d0a 2020 2020 2020 2020 2020 2020  },..            
+000146c0: 2020 2020 7d2c 0d0a 2020 2020 2020 2020      },..        
+000146d0: 2020 2020 7d0d 0a20 2020 2020 2020 2065      }..        e
+000146e0: 6c69 6620 7472 656e 645f 6261 7365 203d  lif trend_base =
+000146f0: 3d20 2264 6565 7022 3a0d 0a20 2020 2020  = "deep":..     
+00014700: 2020 2020 2020 206d 6f64 656c 5f6c 6973         model_lis
+00014710: 7420 3d20 2261 6c6c 5f70 7261 676d 6174  t = "all_pragmat
+00014720: 6963 220d 0a20 2020 2020 2020 2020 2020  ic"..           
+00014730: 206d 6f64 656c 5f6c 6973 742c 206d 6f64   model_list, mod
+00014740: 656c 5f70 726f 6220 3d20 6d6f 6465 6c5f  el_prob = model_
+00014750: 6c69 7374 5f74 6f5f 6469 6374 286d 6f64  list_to_dict(mod
+00014760: 656c 5f6c 6973 7429 0d0a 2020 2020 2020  el_list)..      
+00014770: 2020 2020 2020 6d6f 6465 6c5f 7374 7220        model_str 
+00014780: 3d20 7261 6e64 6f6d 2e63 686f 6963 6573  = random.choices
+00014790: 286d 6f64 656c 5f6c 6973 742c 206d 6f64  (model_list, mod
+000147a0: 656c 5f70 726f 622c 206b 3d31 295b 305d  el_prob, k=1)[0]
+000147b0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+000147c0: 656e 645f 6d6f 6465 6c20 3d20 7b27 4d6f  end_model = {'Mo
+000147d0: 6465 6c27 3a20 6d6f 6465 6c5f 7374 727d  del': model_str}
+000147e0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+000147f0: 656e 645f 6d6f 6465 6c5b 274d 6f64 656c  end_model['Model
+00014800: 5061 7261 6d65 7465 7273 275d 203d 204d  Parameters'] = M
+00014810: 6f64 656c 4d6f 6e73 7465 7228 6d6f 6465  odelMonster(mode
+00014820: 6c5f 7374 7229 2e67 6574 5f6e 6577 5f70  l_str).get_new_p
+00014830: 6172 616d 7328 0d0a 2020 2020 2020 2020  arams(..        
+00014840: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
+00014850: 6574 686f 640d 0a20 2020 2020 2020 2020  ethod..         
+00014860: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00014870: 2020 7472 656e 645f 7472 616e 7366 6f72    trend_transfor
+00014880: 6d61 7469 6f6e 203d 2052 616e 646f 6d54  mation = RandomT
+00014890: 7261 6e73 666f 726d 280d 0a20 2020 2020  ransform(..     
+000148a0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+000148b0: 666f 726d 6572 5f6c 6973 743d 2261 6c6c  former_list="all
+000148c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000148d0: 2020 2020 7472 616e 7366 6f72 6d65 725f      transformer_
+000148e0: 6d61 785f 6465 7074 683d 332c 2020 2320  max_depth=3,  # 
+000148f0: 7072 6f62 6162 6c79 2077 616e 7420 736f  probably want so
+00014900: 6d65 206d 6f72 6520 7573 6162 6c65 2064  me more usable d
+00014910: 6566 6175 6c74 7320 6669 7273 7420 6173  efaults first as
+00014920: 206d 616e 7920 7261 6e64 6f6d 2061 7265   many random are
+00014930: 2073 656e 7365 6c65 7373 0d0a 2020 2020   senseless..    
+00014940: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+00014950: 2020 2020 2074 7265 6e64 5f61 6e6f 6d61       trend_anoma
+00014960: 6c79 5f69 6e74 6572 7665 6e74 696f 6e20  ly_intervention 
+00014970: 3d20 7261 6e64 6f6d 2e63 686f 6963 6573  = random.choices
+00014980: 285b 4e6f 6e65 2c20 2764 6574 6563 745f  ([None, 'detect_
+00014990: 6f6e 6c79 275d 2c20 5b30 2e35 2c20 302e  only'], [0.5, 0.
+000149a0: 355d 295b 0d0a 2020 2020 2020 2020 2020  5])[..          
+000149b0: 2020 300d 0a20 2020 2020 2020 205d 0d0a    0..        ]..
+000149c0: 2020 2020 2020 2020 6966 2074 7265 6e64          if trend
+000149d0: 5f61 6e6f 6d61 6c79 5f69 6e74 6572 7665  _anomaly_interve
+000149e0: 6e74 696f 6e20 6973 206e 6f74 204e 6f6e  ntion is not Non
+000149f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00014a00: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
+00014a10: 7465 6374 6f72 5f70 6172 616d 7320 3d20  tector_params = 
+00014a20: 416e 6f6d 616c 7952 656d 6f76 616c 2e67  AnomalyRemoval.g
+00014a30: 6574 5f6e 6577 5f70 6172 616d 7328 6d65  et_new_params(me
+00014a40: 7468 6f64 3d6d 6574 686f 6429 0d0a 2020  thod=method)..  
+00014a50: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00014a60: 2020 2020 2020 2020 2074 7265 6e64 5f61           trend_a
+00014a70: 6e6f 6d61 6c79 5f64 6574 6563 746f 725f  nomaly_detector_
+00014a80: 7061 7261 6d73 203d 204e 6f6e 650d 0a20  params = None.. 
+00014a90: 2020 2020 2020 206c 696e 6561 725f 6d6f         linear_mo
+00014aa0: 6465 6c20 3d20 7261 6e64 6f6d 2e63 686f  del = random.cho
+00014ab0: 6963 6573 280d 0a20 2020 2020 2020 2020  ices(..         
+00014ac0: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
+00014ad0: 2020 2020 2020 276c 7374 7371 272c 0d0a        'lstsq',..
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014af0: 276c 696e 616c 675f 736f 6c76 6527 2c0d  'linalg_solve',.
+00014b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014b10: 2027 6c31 5f6e 6f72 6d27 2c0d 0a20 2020   'l1_norm',..   
+00014b20: 2020 2020 2020 2020 2020 2020 2027 6477               'dw
+00014b30: 6165 5f6e 6f72 6d27 2c0d 0a20 2020 2020  ae_norm',..     
+00014b40: 2020 2020 2020 2020 2020 2027 7175 616e             'quan
+00014b50: 7469 6c65 5f6e 6f72 6d27 2c0d 0a20 2020  tile_norm',..   
+00014b60: 2020 2020 2020 2020 2020 2020 2027 6c31               'l1
+00014b70: 5f70 6f73 6974 6976 6527 2c0d 0a20 2020  _positive',..   
+00014b80: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
+00014b90: 2020 2020 2020 2020 205b 302e 362c 2030           [0.6, 0
+00014ba0: 2e32 2c20 302e 312c 2030 2e30 352c 2030  .2, 0.1, 0.05, 0
+00014bb0: 2e30 322c 2030 2e30 335d 2c0d 0a20 2020  .02, 0.03],..   
+00014bc0: 2020 2020 2029 5b30 5d0d 0a20 2020 2020       )[0]..     
+00014bd0: 2020 2072 6563 656e 6379 5f77 6569 6768     recency_weigh
+00014be0: 7469 6e67 203d 2072 616e 646f 6d2e 6368  ting = random.ch
+00014bf0: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
+00014c00: 2020 2020 5b4e 6f6e 652c 2030 2e30 352c      [None, 0.05,
+00014c10: 2030 2e31 2c20 302e 3235 2c20 302e 355d   0.1, 0.25, 0.5]
+00014c20: 2c20 5b30 2e37 2c20 302e 312c 2030 2e31  , [0.7, 0.1, 0.1
+00014c30: 2c20 302e 312c 2030 2e30 355d 0d0a 2020  , 0.1, 0.05]..  
+00014c40: 2020 2020 2020 295b 305d 0d0a 2020 2020        )[0]..    
+00014c50: 2020 2020 6966 206c 696e 6561 725f 6d6f      if linear_mo
+00014c60: 6465 6c20 696e 205b 276c 7374 7371 275d  del in ['lstsq']
+00014c70: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
+00014c80: 696e 6561 725f 6d6f 6465 6c20 3d20 7b0d  inear_model = {.
+00014c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ca0: 2027 6d6f 6465 6c27 3a20 6c69 6e65 6172   'model': linear
+00014cb0: 5f6d 6f64 656c 2c0d 0a20 2020 2020 2020  _model,..       
+00014cc0: 2020 2020 2020 2020 2027 6c61 6d62 6461           'lambda
+00014cd0: 273a 2072 616e 646f 6d2e 6368 6f69 6365  ': random.choice
+00014ce0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+00014cf0: 2020 2020 2020 2020 5b4e 6f6e 652c 2030          [None, 0
+00014d00: 2e31 2c20 312c 2031 302c 2031 3030 5d2c  .1, 1, 10, 100],
+00014d10: 205b 302e 372c 2030 2e31 2c20 302e 312c   [0.7, 0.1, 0.1,
+00014d20: 2030 2e31 2c20 302e 3035 5d0d 0a20 2020   0.1, 0.05]..   
+00014d30: 2020 2020 2020 2020 2020 2020 2029 5b30               )[0
+00014d40: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00014d50: 2020 2020 2772 6563 656e 6379 5f77 6569      'recency_wei
+00014d60: 6768 7469 6e67 273a 2072 6563 656e 6379  ghting': recency
+00014d70: 5f77 6569 6768 7469 6e67 2c0d 0a20 2020  _weighting,..   
+00014d80: 2020 2020 2020 2020 207d 0d0a 2020 2020           }..    
+00014d90: 2020 2020 6966 206c 696e 6561 725f 6d6f      if linear_mo
+00014da0: 6465 6c20 696e 205b 276c 696e 616c 675f  del in ['linalg_
+00014db0: 736f 6c76 6527 5d3a 0d0a 2020 2020 2020  solve']:..      
+00014dc0: 2020 2020 2020 6c69 6e65 6172 5f6d 6f64        linear_mod
+00014dd0: 656c 203d 207b 0d0a 2020 2020 2020 2020  el = {..        
+00014de0: 2020 2020 2020 2020 276d 6f64 656c 273a          'model':
+00014df0: 206c 696e 6561 725f 6d6f 6465 6c2c 0d0a   linear_model,..
+00014e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e10: 276c 616d 6264 6127 3a20 7261 6e64 6f6d  'lambda': random
+00014e20: 2e63 686f 6963 6573 285b 302c 2030 2e31  .choices([0, 0.1
+00014e30: 2c20 312c 2031 305d 2c20 5b30 2e34 2c20  , 1, 10], [0.4, 
+00014e40: 302e 322c 2030 2e32 2c20 302e 325d 295b  0.2, 0.2, 0.2])[
+00014e50: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
+00014e60: 2020 2020 2027 7265 6365 6e63 795f 7765       'recency_we
+00014e70: 6967 6874 696e 6727 3a20 7265 6365 6e63  ighting': recenc
+00014e80: 795f 7765 6967 6874 696e 672c 0d0a 2020  y_weighting,..  
+00014e90: 2020 2020 2020 2020 2020 7d0d 0a20 2020            }..   
+00014ea0: 2020 2020 2065 6c69 6620 6c69 6e65 6172       elif linear
+00014eb0: 5f6d 6f64 656c 2069 6e20 5b27 6c31 5f6e  _model in ['l1_n
+00014ec0: 6f72 6d27 2c20 2764 7761 655f 6e6f 726d  orm', 'dwae_norm
+00014ed0: 272c 2027 7175 616e 7469 6c65 5f6e 6f72  ', 'quantile_nor
+00014ee0: 6d27 2c20 276c 315f 706f 7369 7469 7665  m', 'l1_positive
+00014ef0: 275d 3a0d 0a20 2020 2020 2020 2020 2020  ']:..           
+00014f00: 206c 696e 6561 725f 6d6f 6465 6c20 3d20   linear_model = 
+00014f10: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
+00014f20: 2020 2027 6d6f 6465 6c27 3a20 6c69 6e65     'model': line
+00014f30: 6172 5f6d 6f64 656c 2c0d 0a20 2020 2020  ar_model,..     
+00014f40: 2020 2020 2020 2020 2020 2027 7265 6365             'rece
+00014f50: 6e63 795f 7765 6967 6874 696e 6727 3a20  ncy_weighting': 
+00014f60: 7265 6365 6e63 795f 7765 6967 6874 696e  recency_weightin
+00014f70: 672c 0d0a 2020 2020 2020 2020 2020 2020  g,..            
+00014f80: 2020 2020 276d 6178 6974 6572 273a 2072      'maxiter': r
+00014f90: 616e 646f 6d2e 6368 6f69 6365 7328 5b32  andom.choices([2
+00014fa0: 3530 2c20 3135 3030 302c 2032 3530 3030  50, 15000, 25000
+00014fb0: 5d2c 205b 302e 322c 2030 2e36 2c20 302e  ], [0.2, 0.6, 0.
+00014fc0: 325d 295b 305d 2c0d 0a20 2020 2020 2020  2])[0],..       
+00014fd0: 2020 2020 207d 0d0a 2020 2020 2020 2020       }..        
+00014fe0: 6966 206d 6574 686f 6420 3d3d 2022 7265  if method == "re
+00014ff0: 6772 6573 736f 7222 3a0d 0a20 2020 2020  gressor":..     
+00015000: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
+00015010: 735f 7573 6564 203d 2054 7275 650d 0a20  s_used = True.. 
+00015020: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00015030: 2020 2020 2020 2020 2020 7265 6772 6573            regres
+00015040: 736f 7273 5f75 7365 6420 3d20 7261 6e64  sors_used = rand
+00015050: 6f6d 2e63 686f 6963 6573 285b 5472 7565  om.choices([True
+00015060: 2c20 4661 6c73 655d 2c20 5b30 2e35 2c20  , False], [0.5, 
+00015070: 302e 355d 295b 305d 0d0a 2020 2020 2020  0.5])[0]..      
+00015080: 2020 6172 5f6c 6167 7320 3d20 7261 6e64    ar_lags = rand
+00015090: 6f6d 2e63 686f 6963 6573 280d 0a20 2020  om.choices(..   
+000150a0: 2020 2020 2020 2020 205b 4e6f 6e65 2c20           [None, 
+000150b0: 5b31 5d2c 205b 312c 2037 5d2c 205b 375d  [1], [1, 7], [7]
+000150c0: 2c20 5b73 6561 736f 6e61 6c5f 696e 7428  , [seasonal_int(
+000150d0: 736d 616c 6c3d 5472 7565 295d 5d2c 0d0a  small=True)]],..
+000150e0: 2020 2020 2020 2020 2020 2020 5b30 2e39              [0.9
+000150f0: 2c20 302e 3032 352c 2030 2e30 3235 2c20  , 0.025, 0.025, 
+00015100: 302e 3035 2c20 302e 3035 5d2c 0d0a 2020  0.05, 0.05],..  
+00015110: 2020 2020 2020 295b 305d 0d0a 2020 2020        )[0]..    
+00015120: 2020 2020 6172 5f69 6e74 6572 6163 7469      ar_interacti
+00015130: 6f6e 5f73 6561 736f 6e61 6c69 7479 203d  on_seasonality =
+00015140: 204e 6f6e 650d 0a20 2020 2020 2020 2069   None..        i
+00015150: 6620 6172 5f6c 6167 7320 6973 206e 6f74  f ar_lags is not
+00015160: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00015170: 2020 2020 6172 5f69 6e74 6572 6163 7469      ar_interacti
+00015180: 6f6e 5f73 6561 736f 6e61 6c69 7479 203d  on_seasonality =
+00015190: 2072 616e 646f 6d2e 6368 6f69 6365 7328   random.choices(
+000151a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000151b0: 2020 5b4e 6f6e 652c 2037 2c20 2764 6179    [None, 7, 'day
+000151c0: 6f66 7765 656b 272c 2027 636f 6d6d 6f6e  ofweek', 'common
+000151d0: 5f66 6f75 7269 6572 275d 2c20 5b30 2e34  _fourier'], [0.4
+000151e0: 2c20 302e 322c 2030 2e32 2c20 302e 325d  , 0.2, 0.2, 0.2]
+000151f0: 0d0a 2020 2020 2020 2020 2020 2020 295b  ..            )[
+00015200: 305d 0d0a 2020 2020 2020 2020 7365 6173  0]..        seas
+00015210: 6f6e 616c 6974 6965 7320 3d20 7261 6e64  onalities = rand
+00015220: 6f6d 2e63 686f 6963 6573 280d 0a20 2020  om.choices(..   
+00015230: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
+00015240: 2020 2020 2020 2020 2020 2020 5b37 2c20              [7, 
+00015250: 3336 352e 3235 5d2c 0d0a 2020 2020 2020  365.25],..      
+00015260: 2020 2020 2020 2020 2020 5b22 6461 796f            ["dayo
+00015270: 6677 6565 6b22 2c20 3336 352e 3235 5d2c  fweek", 365.25],
+00015280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015290: 2020 5b22 6d6f 6e74 6822 2c20 2264 6179    ["month", "day
+000152a0: 6f66 7765 656b 222c 2022 7765 656b 6461  ofweek", "weekda
+000152b0: 796f 666d 6f6e 7468 225d 2c0d 0a20 2020  yofmonth"],..   
+000152c0: 2020 2020 2020 2020 2020 2020 205b 2777               ['w
+000152d0: 6565 6b64 6179 6f66 6d6f 6e74 6827 2c20  eekdayofmonth', 
+000152e0: 2763 6f6d 6d6f 6e5f 666f 7572 6965 7227  'common_fourier'
+000152f0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00015300: 2020 2020 226f 7468 6572 222c 0d0a 2020      "other",..  
+00015310: 2020 2020 2020 2020 2020 5d2c 0d0a 2020            ],..  
+00015320: 2020 2020 2020 2020 2020 5b30 2e31 2c20            [0.1, 
+00015330: 302e 312c 2030 2e31 2c20 302e 3035 2c20  0.1, 0.1, 0.05, 
+00015340: 302e 315d 2c0d 0a20 2020 2020 2020 2029  0.1],..        )
+00015350: 5b30 5d0d 0a20 2020 2020 2020 2069 6620  [0]..        if 
+00015360: 7365 6173 6f6e 616c 6974 6965 7320 3d3d  seasonalities ==
+00015370: 2022 6f74 6865 7222 3a0d 0a20 2020 2020   "other":..     
+00015380: 2020 2020 2020 2070 7265 6465 6669 6e65         predefine
+00015390: 6420 3d20 7261 6e64 6f6d 2e63 686f 6963  d = random.choic
+000153a0: 6573 285b 5472 7565 2c20 4661 6c73 655d  es([True, False]
+000153b0: 2c20 5b30 2e35 2c20 302e 355d 295b 305d  , [0.5, 0.5])[0]
+000153c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000153d0: 2070 7265 6465 6669 6e65 643a 0d0a 2020   predefined:..  
+000153e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000153f0: 6173 6f6e 616c 6974 6965 7320 3d20 7261  asonalities = ra
+00015400: 6e64 6f6d 2e63 686f 6963 6528 6461 7465  ndom.choice(date
+00015410: 5f70 6172 745f 6d65 7468 6f64 7329 0d0a  _part_methods)..
+00015420: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00015430: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00015440: 2020 2063 6f6d 705f 6f70 7473 203d 2064     comp_opts = d
+00015450: 6174 6570 6172 745f 636f 6d70 6f6e 656e  atepart_componen
+00015460: 7473 202b 205b 372c 2033 3635 2e32 352c  ts + [7, 365.25,
+00015470: 2031 325d 0d0a 2020 2020 2020 2020 2020   12]..          
+00015480: 2020 2020 2020 7365 6173 6f6e 616c 6974        seasonalit
+00015490: 6965 7320 3d20 7261 6e64 6f6d 2e63 686f  ies = random.cho
+000154a0: 6963 6573 2863 6f6d 705f 6f70 7473 2c20  ices(comp_opts, 
+000154b0: 6b3d 3229 0d0a 2020 2020 2020 2020 7265  k=2)..        re
+000154c0: 7475 726e 207b 0d0a 2020 2020 2020 2020  turn {..        
+000154d0: 2020 2020 2270 7265 7072 6f63 6573 7369      "preprocessi
+000154e0: 6e67 5f74 7261 6e73 666f 726d 6174 696f  ng_transformatio
+000154f0: 6e22 3a20 5261 6e64 6f6d 5472 616e 7366  n": RandomTransf
+00015500: 6f72 6d28 0d0a 2020 2020 2020 2020 2020  orm(..          
+00015510: 2020 2020 2020 7472 616e 7366 6f72 6d65        transforme
+00015520: 725f 6c69 7374 3d66 696c 7465 7273 2c20  r_list=filters, 
+00015530: 7472 616e 7366 6f72 6d65 725f 6d61 785f  transformer_max_
+00015540: 6465 7074 683d 322c 2061 6c6c 6f77 5f6e  depth=2, allow_n
+00015550: 6f6e 653d 5472 7565 0d0a 2020 2020 2020  one=True..      
+00015560: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+00015570: 2020 2020 2020 2273 6361 6c69 6e67 223a        "scaling":
+00015580: 2073 6361 6c69 6e67 2c0d 0a20 2020 2020   scaling,..     
+00015590: 2020 2020 2020 2023 2022 7061 7374 5f69         # "past_i
+000155a0: 6d70 6163 7473 5f69 6e74 6572 7665 6e74  mpacts_intervent
+000155b0: 696f 6e22 3a20 7365 6c66 2e70 6173 745f  ion": self.past_
+000155c0: 696d 7061 6374 735f 696e 7465 7276 656e  impacts_interven
+000155d0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
+000155e0: 2020 2022 7365 6173 6f6e 616c 6974 6965     "seasonalitie
+000155f0: 7322 3a20 7365 6173 6f6e 616c 6974 6965  s": seasonalitie
+00015600: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00015610: 2261 725f 6c61 6773 223a 2061 725f 6c61  "ar_lags": ar_la
+00015620: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
+00015630: 2022 6172 5f69 6e74 6572 6163 7469 6f6e   "ar_interaction
+00015640: 5f73 6561 736f 6e61 6c69 7479 223a 2061  _seasonality": a
+00015650: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
+00015660: 6173 6f6e 616c 6974 792c 0d0a 2020 2020  asonality,..    
+00015670: 2020 2020 2020 2020 2261 6e6f 6d61 6c79          "anomaly
+00015680: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00015690: 223a 2061 6e6f 6d61 6c79 5f64 6574 6563  ": anomaly_detec
+000156a0: 746f 725f 7061 7261 6d73 2c0d 0a20 2020  tor_params,..   
+000156b0: 2020 2020 2020 2020 2022 616e 6f6d 616c           "anomal
+000156c0: 795f 696e 7465 7276 656e 7469 6f6e 223a  y_intervention":
+000156d0: 2061 6e6f 6d61 6c79 5f69 6e74 6572 7665   anomaly_interve
+000156e0: 6e74 696f 6e2c 0d0a 2020 2020 2020 2020  ntion,..        
+000156f0: 2020 2020 2268 6f6c 6964 6179 5f64 6574      "holiday_det
+00015700: 6563 746f 725f 7061 7261 6d73 223a 2068  ector_params": h
+00015710: 6f6c 6964 6179 5f70 6172 616d 732c 0d0a  oliday_params,..
+00015720: 2020 2020 2020 2020 2020 2020 2320 2268              # "h
+00015730: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
+00015740: 223a 2073 656c 662e 686f 6c69 6461 795f  ": self.holiday_
+00015750: 636f 756e 7472 6965 732c 0d0a 2020 2020  countries,..    
+00015760: 2020 2020 2020 2020 2268 6f6c 6964 6179          "holiday
+00015770: 5f63 6f75 6e74 7269 6573 5f75 7365 6422  _countries_used"
+00015780: 3a20 7261 6e64 6f6d 2e63 686f 6963 6573  : random.choices
+00015790: 285b 5472 7565 2c20 4661 6c73 655d 2c20  ([True, False], 
+000157a0: 5b30 2e35 2c20 302e 355d 295b 305d 2c0d  [0.5, 0.5])[0],.
+000157b0: 0a20 2020 2020 2020 2020 2020 2022 6d75  .            "mu
+000157c0: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
+000157d0: 7265 223a 2072 616e 646f 6d2e 6368 6f69  re": random.choi
+000157e0: 6365 7328 0d0a 2020 2020 2020 2020 2020  ces(..          
+000157f0: 2020 2020 2020 5b4e 6f6e 652c 2022 6665        [None, "fe
+00015800: 6174 7572 655f 6167 676c 6f6d 6572 6174  ature_agglomerat
+00015810: 696f 6e22 2c20 2767 726f 7570 5f61 7665  ion", 'group_ave
+00015820: 7261 6765 272c 2027 6f73 6369 6c6c 6174  rage', 'oscillat
+00015830: 6f72 275d 2c0d 0a20 2020 2020 2020 2020  or'],..         
+00015840: 2020 2020 2020 205b 302e 392c 2030 2e31         [0.9, 0.1
+00015850: 2c20 302e 312c 2030 2e30 5d2c 0d0a 2020  , 0.1, 0.0],..  
+00015860: 2020 2020 2020 2020 2020 295b 305d 2c0d            )[0],.
+00015870: 0a20 2020 2020 2020 2020 2020 2022 6d75  .            "mu
+00015880: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
+00015890: 666f 726d 6174 696f 6e22 3a20 5261 6e64  formation": Rand
+000158a0: 6f6d 5472 616e 7366 6f72 6d28 0d0a 2020  omTransform(..  
+000158b0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000158c0: 616e 7366 6f72 6d65 725f 6c69 7374 3d22  ansformer_list="
+000158d0: 6661 7374 222c 0d0a 2020 2020 2020 2020  fast",..        
+000158e0: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
+000158f0: 6d65 725f 6d61 785f 6465 7074 683d 332c  mer_max_depth=3,
+00015900: 2020 2320 7072 6f62 6162 6c79 2077 616e    # probably wan
+00015910: 7420 736f 6d65 206d 6f72 6520 7573 6162  t some more usab
+00015920: 6c65 2064 6566 6175 6c74 7320 6669 7273  le defaults firs
+00015930: 7420 6173 206d 616e 7920 7261 6e64 6f6d  t as many random
+00015940: 2061 7265 2073 656e 7365 6c65 7373 0d0a   are senseless..
+00015950: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
+00015960: 2020 2020 2020 2020 2020 2020 2272 6567              "reg
+00015970: 7265 7373 6f72 5f74 7261 6e73 666f 726d  ressor_transform
+00015980: 6174 696f 6e22 3a20 5261 6e64 6f6d 5472  ation": RandomTr
+00015990: 616e 7366 6f72 6d28 0d0a 2020 2020 2020  ansform(..      
+000159a0: 2020 2020 2020 2020 2020 7472 616e 7366            transf
+000159b0: 6f72 6d65 725f 6c69 7374 3d7b 2a2a 7363  ormer_list={**sc
+000159c0: 616c 6572 732c 202a 2a64 6563 6f6d 706f  alers, **decompo
+000159d0: 7369 7469 6f6e 737d 2c0d 0a20 2020 2020  sitions},..     
+000159e0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+000159f0: 666f 726d 6572 5f6d 6178 5f64 6570 7468  former_max_depth
+00015a00: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+00015a10: 2020 2020 2061 6c6c 6f77 5f6e 6f6e 653d       allow_none=
+00015a20: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+00015a30: 2020 2020 2020 2020 6e6f 5f6e 616e 5f66          no_nan_f
+00015a40: 696c 6c3d 4661 6c73 652c 2020 2320 7072  ill=False,  # pr
+00015a50: 6f62 6162 6c79 2077 616e 7420 736f 6d65  obably want some
+00015a60: 206d 6f72 6520 7573 6162 6c65 2064 6566   more usable def
+00015a70: 6175 6c74 7320 6669 7273 7420 6173 206d  aults first as m
+00015a80: 616e 7920 7261 6e64 6f6d 2061 7265 2073  any random are s
+00015a90: 656e 7365 6c65 7373 0d0a 2020 2020 2020  enseless..      
+00015aa0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+00015ab0: 2020 2020 2020 2272 6567 7265 7373 6f72        "regressor
+00015ac0: 735f 7573 6564 223a 2072 6567 7265 7373  s_used": regress
+00015ad0: 6f72 735f 7573 6564 2c0d 0a20 2020 2020  ors_used,..     
+00015ae0: 2020 2020 2020 2022 6c69 6e65 6172 5f6d         "linear_m
+00015af0: 6f64 656c 223a 206c 696e 6561 725f 6d6f  odel": linear_mo
+00015b00: 6465 6c2c 0d0a 2020 2020 2020 2020 2020  del,..          
+00015b10: 2020 2272 616e 646f 6d77 616c 6b5f 6e22    "randomwalk_n"
+00015b20: 3a20 7261 6e64 6f6d 2e63 686f 6963 6573  : random.choices
+00015b30: 285b 4e6f 6e65 2c20 3130 5d2c 205b 302e  ([None, 10], [0.
+00015b40: 352c 2030 2e35 5d29 5b30 5d2c 0d0a 2020  5, 0.5])[0],..  
+00015b50: 2020 2020 2020 2020 2020 2274 7265 6e64            "trend
+00015b60: 5f77 696e 646f 7722 3a20 7261 6e64 6f6d  _window": random
+00015b70: 2e63 686f 6963 6573 285b 332c 2031 352c  .choices([3, 15,
+00015b80: 2039 302c 2033 3635 5d2c 205b 302e 322c   90, 365], [0.2,
+00015b90: 2030 2e32 2c20 302e 322c 2030 2e32 5d29   0.2, 0.2, 0.2])
+00015ba0: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
+00015bb0: 2020 2274 7265 6e64 5f73 7461 6e64 696e    "trend_standin
+00015bc0: 223a 2072 616e 646f 6d2e 6368 6f69 6365  ": random.choice
+00015bd0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+00015be0: 2020 2020 5b4e 6f6e 652c 2027 7261 6e64      [None, 'rand
+00015bf0: 6f6d 5f6e 6f72 6d61 6c27 2c20 2772 6f6c  om_normal', 'rol
+00015c00: 6c69 6e67 5f74 7265 6e64 275d 2c0d 0a20  ling_trend'],.. 
+00015c10: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00015c20: 302e 352c 2030 2e34 2c20 302e 315d 2c0d  0.5, 0.4, 0.1],.
+00015c30: 0a20 2020 2020 2020 2020 2020 2029 5b30  .            )[0
+00015c40: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00015c50: 2274 7265 6e64 5f61 6e6f 6d61 6c79 5f64  "trend_anomaly_d
+00015c60: 6574 6563 746f 725f 7061 7261 6d73 223a  etector_params":
+00015c70: 2074 7265 6e64 5f61 6e6f 6d61 6c79 5f64   trend_anomaly_d
+00015c80: 6574 6563 746f 725f 7061 7261 6d73 2c0d  etector_params,.
+00015c90: 0a20 2020 2020 2020 2020 2020 2023 2022  .            # "
+00015ca0: 7472 656e 645f 616e 6f6d 616c 795f 696e  trend_anomaly_in
+00015cb0: 7465 7276 656e 7469 6f6e 223a 2074 7265  tervention": tre
+00015cc0: 6e64 5f61 6e6f 6d61 6c79 5f69 6e74 6572  nd_anomaly_inter
+00015cd0: 7665 6e74 696f 6e2c 0d0a 2020 2020 2020  vention,..      
+00015ce0: 2020 2020 2020 2274 7265 6e64 5f74 7261        "trend_tra
+00015cf0: 6e73 666f 726d 6174 696f 6e22 3a20 7472  nsformation": tr
+00015d00: 656e 645f 7472 616e 7366 6f72 6d61 7469  end_transformati
+00015d10: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00015d20: 2022 7472 656e 645f 6d6f 6465 6c22 3a20   "trend_model": 
+00015d30: 7472 656e 645f 6d6f 6465 6c2c 0d0a 2020  trend_model,..  
+00015d40: 2020 2020 2020 2020 2020 2274 7265 6e64            "trend
+00015d50: 5f70 6869 223a 2072 616e 646f 6d2e 6368  _phi": random.ch
+00015d60: 6f69 6365 7328 5b4e 6f6e 652c 2030 2e39  oices([None, 0.9
+00015d70: 385d 2c20 5b30 2e39 2c20 302e 315d 295b  8], [0.9, 0.1])[
+00015d80: 305d 2c0d 0a20 2020 2020 2020 207d 0d0a  0],..        }..
+00015d90: 0d0a 2020 2020 6465 6620 6765 745f 7061  ..    def get_pa
+00015da0: 7261 6d73 2873 656c 6629 3a0d 0a20 2020  rams(self):..   
+00015db0: 2020 2020 2072 6574 7572 6e20 7b0d 0a20       return {.. 
+00015dc0: 2020 2020 2020 2020 2020 2022 7072 6570             "prep
+00015dd0: 726f 6365 7373 696e 675f 7472 616e 7366  rocessing_transf
+00015de0: 6f72 6d61 7469 6f6e 223a 2073 656c 662e  ormation": self.
+00015df0: 7072 6570 726f 6365 7373 696e 675f 7472  preprocessing_tr
+00015e00: 616e 7366 6f72 6d61 7469 6f6e 2c0d 0a20  ansformation,.. 
+00015e10: 2020 2020 2020 2020 2020 2022 7363 616c             "scal
+00015e20: 696e 6722 3a20 7365 6c66 2e73 6361 6c69  ing": self.scali
+00015e30: 6e67 2c0d 0a20 2020 2020 2020 2020 2020  ng,..           
+00015e40: 2022 7061 7374 5f69 6d70 6163 7473 5f69   "past_impacts_i
+00015e50: 6e74 6572 7665 6e74 696f 6e22 3a20 7365  ntervention": se
+00015e60: 6c66 2e70 6173 745f 696d 7061 6374 735f  lf.past_impacts_
+00015e70: 696e 7465 7276 656e 7469 6f6e 2c20 2023  intervention,  #
+00015e80: 206e 6f74 2069 6e20 6e65 770d 0a20 2020   not in new..   
+00015e90: 2020 2020 2020 2020 2022 7365 6173 6f6e           "season
+00015ea0: 616c 6974 6965 7322 3a20 7365 6c66 2e73  alities": self.s
+00015eb0: 6561 736f 6e61 6c69 7469 6573 2c0d 0a20  easonalities,.. 
+00015ec0: 2020 2020 2020 2020 2020 2022 6172 5f6c             "ar_l
+00015ed0: 6167 7322 3a20 7365 6c66 2e61 725f 6c61  ags": self.ar_la
+00015ee0: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
+00015ef0: 2022 6172 5f69 6e74 6572 6163 7469 6f6e   "ar_interaction
+00015f00: 5f73 6561 736f 6e61 6c69 7479 223a 2073  _seasonality": s
+00015f10: 656c 662e 6172 5f69 6e74 6572 6163 7469  elf.ar_interacti
+00015f20: 6f6e 5f73 6561 736f 6e61 6c69 7479 0d0a  on_seasonality..
+00015f30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00015f40: 656c 662e 6172 5f6c 6167 7320 6973 206e  elf.ar_lags is n
+00015f50: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+00015f60: 2020 2020 2065 6c73 6520 4e6f 6e65 2c0d       else None,.
+00015f70: 0a20 2020 2020 2020 2020 2020 2022 616e  .            "an
+00015f80: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
+00015f90: 6172 616d 7322 3a20 7365 6c66 2e61 6e6f  arams": self.ano
+00015fa0: 6d61 6c79 5f64 6574 6563 746f 725f 7061  maly_detector_pa
+00015fb0: 7261 6d73 2c0d 0a20 2020 2020 2020 2020  rams,..         
+00015fc0: 2020 2022 616e 6f6d 616c 795f 696e 7465     "anomaly_inte
+00015fd0: 7276 656e 7469 6f6e 223a 2073 656c 662e  rvention": self.
+00015fe0: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
+00015ff0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
+00016000: 2020 2022 686f 6c69 6461 795f 6465 7465     "holiday_dete
+00016010: 6374 6f72 5f70 6172 616d 7322 3a20 7365  ctor_params": se
+00016020: 6c66 2e68 6f6c 6964 6179 5f64 6574 6563  lf.holiday_detec
+00016030: 746f 725f 7061 7261 6d73 2c0d 0a20 2020  tor_params,..   
+00016040: 2020 2020 2020 2020 2023 2022 686f 6c69           # "holi
+00016050: 6461 795f 696e 7465 7276 656e 7469 6f6e  day_intervention
+00016060: 223a 2073 656c 662e 686f 6c69 6461 795f  ": self.holiday_
+00016070: 696e 7465 7276 656e 7469 6f6e 2c0d 0a20  intervention,.. 
+00016080: 2020 2020 2020 2020 2020 2023 2022 686f             # "ho
+00016090: 6c69 6461 795f 636f 756e 7472 6965 7322  liday_countries"
+000160a0: 3a20 7365 6c66 2e68 6f6c 6964 6179 5f63  : self.holiday_c
+000160b0: 6f75 6e74 7269 6573 2c0d 0a20 2020 2020  ountries,..     
+000160c0: 2020 2020 2020 2022 686f 6c69 6461 795f         "holiday_
+000160d0: 636f 756e 7472 6965 735f 7573 6564 223a  countries_used":
+000160e0: 2073 656c 662e 686f 6c69 6461 795f 636f   self.holiday_co
+000160f0: 756e 7472 6965 735f 7573 6564 2c0d 0a20  untries_used,.. 
+00016100: 2020 2020 2020 2020 2020 2022 6d75 6c74             "mult
+00016110: 6976 6172 6961 7465 5f66 6561 7475 7265  ivariate_feature
+00016120: 223a 2073 656c 662e 6d75 6c74 6976 6172  ": self.multivar
+00016130: 6961 7465 5f66 6561 7475 7265 2c0d 0a20  iate_feature,.. 
+00016140: 2020 2020 2020 2020 2020 2022 6d75 6c74             "mult
+00016150: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
+00016160: 726d 6174 696f 6e22 3a20 7365 6c66 2e6d  rmation": self.m
+00016170: 756c 7469 7661 7269 6174 655f 7472 616e  ultivariate_tran
+00016180: 7366 6f72 6d61 7469 6f6e 0d0a 2020 2020  sformation..    
+00016190: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000161a0: 6d75 6c74 6976 6172 6961 7465 5f66 6561  multivariate_fea
+000161b0: 7475 7265 2069 7320 6e6f 7420 4e6f 6e65  ture is not None
+000161c0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000161d0: 7365 204e 6f6e 652c 0d0a 2020 2020 2020  se None,..      
+000161e0: 2020 2020 2020 2272 6567 7265 7373 6f72        "regressor
+000161f0: 5f74 7261 6e73 666f 726d 6174 696f 6e22  _transformation"
+00016200: 3a20 7365 6c66 2e72 6567 7265 7373 6f72  : self.regressor
+00016210: 5f74 7261 6e73 666f 726d 6174 696f 6e0d  _transformation.
+00016220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016230: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
+00016240: 7573 6564 0d0a 2020 2020 2020 2020 2020  used..          
+00016250: 2020 656c 7365 204e 6f6e 652c 0d0a 2020    else None,..  
+00016260: 2020 2020 2020 2020 2020 2272 6567 7265            "regre
+00016270: 7373 6f72 735f 7573 6564 223a 2073 656c  ssors_used": sel
+00016280: 662e 7265 6772 6573 736f 7273 5f75 7365  f.regressors_use
+00016290: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+000162a0: 226c 696e 6561 725f 6d6f 6465 6c22 3a20  "linear_model": 
+000162b0: 7365 6c66 2e6c 696e 6561 725f 6d6f 6465  self.linear_mode
+000162c0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+000162d0: 2272 616e 646f 6d77 616c 6b5f 6e22 3a20  "randomwalk_n": 
+000162e0: 7365 6c66 2e72 616e 646f 6d77 616c 6b5f  self.randomwalk_
+000162f0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00016300: 2274 7265 6e64 5f77 696e 646f 7722 3a20  "trend_window": 
+00016310: 7365 6c66 2e74 7265 6e64 5f77 696e 646f  self.trend_windo
+00016320: 772c 0d0a 2020 2020 2020 2020 2020 2020  w,..            
+00016330: 2274 7265 6e64 5f73 7461 6e64 696e 223a  "trend_standin":
+00016340: 2073 656c 662e 7472 656e 645f 7374 616e   self.trend_stan
+00016350: 6469 6e2c 0d0a 2020 2020 2020 2020 2020  din,..          
+00016360: 2020 2274 7265 6e64 5f61 6e6f 6d61 6c79    "trend_anomaly
+00016370: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00016380: 223a 2073 656c 662e 7472 656e 645f 616e  ": self.trend_an
+00016390: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
+000163a0: 6172 616d 732c 0d0a 2020 2020 2020 2020  arams,..        
+000163b0: 2020 2020 2320 2274 7265 6e64 5f61 6e6f      # "trend_ano
+000163c0: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
+000163d0: 6e22 3a20 7365 6c66 2e74 7265 6e64 5f61  n": self.trend_a
+000163e0: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
+000163f0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+00016400: 2020 2274 7265 6e64 5f74 7261 6e73 666f    "trend_transfo
+00016410: 726d 6174 696f 6e22 3a20 7365 6c66 2e74  rmation": self.t
+00016420: 7265 6e64 5f74 7261 6e73 666f 726d 6174  rend_transformat
+00016430: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+00016440: 2020 2274 7265 6e64 5f6d 6f64 656c 223a    "trend_model":
+00016450: 2073 656c 662e 7472 656e 645f 6d6f 6465   self.trend_mode
+00016460: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+00016470: 2274 7265 6e64 5f70 6869 223a 2073 656c  "trend_phi": sel
+00016480: 662e 7472 656e 645f 7068 692c 0d0a 2020  f.trend_phi,..  
+00016490: 2020 2020 2020 2020 2020 2320 2263 6f6e            # "con
+000164a0: 7374 7261 696e 7422 3a20 7365 6c66 2e63  straint": self.c
+000164b0: 6f6e 7374 7261 696e 742c 0d0a 2020 2020  onstraint,..    
+000164c0: 2020 2020 7d0d 0a0d 0a20 2020 2064 6566      }....    def
+000164d0: 2070 6c6f 745f 636f 6d70 6f6e 656e 7473   plot_components
+000164e0: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
+000164f0: 0d0a 2020 2020 2020 2020 7072 6564 6963  ..        predic
+00016500: 7469 6f6e 3d4e 6f6e 652c 0d0a 2020 2020  tion=None,..    
+00016510: 2020 2020 7365 7269 6573 3d4e 6f6e 652c      series=None,
+00016520: 0d0a 2020 2020 2020 2020 6669 6773 697a  ..        figsiz
+00016530: 653d 2831 362c 2039 292c 0d0a 2020 2020  e=(16, 9),..    
+00016540: 2020 2020 746f 5f6f 7269 6769 6e5f 7370      to_origin_sp
+00016550: 6163 653d 5472 7565 2c0d 0a20 2020 2020  ace=True,..     
+00016560: 2020 2074 6974 6c65 3d4e 6f6e 652c 0d0a     title=None,..
+00016570: 2020 2020 2020 2020 7374 6172 745f 6461          start_da
+00016580: 7465 3d4e 6f6e 652c 0d0a 2020 2020 293a  te=None,..    ):
+00016590: 0d0a 2020 2020 2020 2020 6966 2073 6572  ..        if ser
+000165a0: 6965 7320 6973 204e 6f6e 653a 0d0a 2020  ies is None:..  
+000165b0: 2020 2020 2020 2020 2020 7365 7269 6573            series
+000165c0: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
+000165d0: 2873 656c 662e 636f 6c75 6d6e 5f6e 616d  (self.column_nam
+000165e0: 6573 290d 0a20 2020 2020 2020 2069 6620  es)..        if 
+000165f0: 7469 746c 6520 6973 204e 6f6e 653a 0d0a  title is None:..
+00016600: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+00016610: 6520 3d20 6622 4d6f 6465 6c20 436f 6d70  e = f"Model Comp
+00016620: 6f6e 656e 7473 2066 6f72 207b 7365 7269  onents for {seri
+00016630: 6573 7d22 0d0a 2020 2020 2020 2020 706c  es}"..        pl
+00016640: 6f74 5f6c 6973 7420 3d20 5b5d 0d0a 2020  ot_list = []..  
+00016650: 2020 2020 2020 6966 2070 7265 6469 6374        if predict
+00016660: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
+00016670: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
+00016680: 6f74 5f6c 6973 742e 6170 7065 6e64 2870  ot_list.append(p
+00016690: 7265 6469 6374 696f 6e2e 666f 7265 6361  rediction.foreca
+000166a0: 7374 5b73 6572 6965 735d 2e72 656e 616d  st[series].renam
+000166b0: 6528 2266 6f72 6563 6173 7422 2929 0d0a  e("forecast"))..
+000166c0: 2020 2020 2020 2020 2020 2020 706c 745f              plt_
+000166d0: 6964 7820 3d20 7072 6564 6963 7469 6f6e  idx = prediction
+000166e0: 2e66 6f72 6563 6173 742e 696e 6465 780d  .forecast.index.
+000166f0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00016700: 2020 2020 2020 2020 2020 2020 706c 745f              plt_
+00016710: 6964 7820 3d20 4e6f 6e65 0d0a 2020 2020  idx = None..    
+00016720: 2020 2020 706c 6f74 5f6c 6973 742e 6170      plot_list.ap
+00016730: 7065 6e64 2873 656c 662e 7072 6564 6963  pend(self.predic
+00016740: 7465 645f 7472 656e 645b 7365 7269 6573  ted_trend[series
+00016750: 5d2e 7265 6e61 6d65 2822 7472 656e 6422  ].rename("trend"
+00016760: 2929 0d0a 2020 2020 2020 2020 6966 2073  ))..        if s
+00016770: 656c 662e 696d 7061 6374 7320 6973 206e  elf.impacts is n
+00016780: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00016790: 2020 2020 2020 706c 6f74 5f6c 6973 742e        plot_list.
+000167a0: 6170 7065 6e64 2828 7365 6c66 2e69 6d70  append((self.imp
+000167b0: 6163 7473 5b73 6572 6965 735d 2e72 656e  acts[series].ren
+000167c0: 616d 6528 2269 6d70 6163 7420 2522 2920  ame("impact %") 
+000167d0: 2d20 312e 3029 202a 2031 3030 290d 0a20  - 1.0) * 100).. 
+000167e0: 2020 2020 2020 2069 6620 706c 745f 6964         if plt_id
+000167f0: 7820 6973 204e 6f6e 653a 0d0a 2020 2020  x is None:..    
+00016800: 2020 2020 2020 2020 706c 6f74 5f6c 6973          plot_lis
+00016810: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
+00016820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00016830: 7072 6f63 6573 735f 636f 6d70 6f6e 656e  process_componen
+00016840: 7473 2874 6f5f 6f72 6967 696e 5f73 7061  ts(to_origin_spa
+00016850: 6365 3d74 6f5f 6f72 6967 696e 5f73 7061  ce=to_origin_spa
+00016860: 6365 295b 7365 7269 6573 5d0d 0a20 2020  ce)[series]..   
+00016870: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00016880: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00016890: 2020 2020 2020 2070 6c6f 745f 6c69 7374         plot_list
+000168a0: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+000168b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000168c0: 726f 6365 7373 5f63 6f6d 706f 6e65 6e74  rocess_component
+000168d0: 7328 746f 5f6f 7269 6769 6e5f 7370 6163  s(to_origin_spac
+000168e0: 653d 746f 5f6f 7269 6769 6e5f 7370 6163  e=to_origin_spac
+000168f0: 6529 5b73 6572 6965 735d 2e6c 6f63 5b0d  e)[series].loc[.
+00016900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016910: 2020 2020 2070 6c74 5f69 6478 0d0a 2020       plt_idx..  
+00016920: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
+00016930: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00016940: 2020 2020 2020 2020 706c 6f74 5f64 6620          plot_df 
+00016950: 3d20 7064 2e63 6f6e 6361 7428 706c 6f74  = pd.concat(plot
+00016960: 5f6c 6973 742c 2061 7869 733d 3129 0d0a  _list, axis=1)..
+00016970: 2020 2020 2020 2020 6966 2073 7461 7274          if start
+00016980: 5f64 6174 6520 6973 206e 6f74 204e 6f6e  _date is not Non
+00016990: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000169a0: 706c 6f74 5f64 6620 3d20 706c 6f74 5f64  plot_df = plot_d
+000169b0: 665b 706c 6f74 5f64 662e 696e 6465 7820  f[plot_df.index 
+000169c0: 3e3d 2073 7461 7274 5f64 6174 655d 0d0a  >= start_date]..
+000169d0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+000169e0: 6c6f 745f 6466 2e70 6c6f 7428 7375 6270  lot_df.plot(subp
+000169f0: 6c6f 7473 3d54 7275 652c 2066 6967 7369  lots=True, figsi
+00016a00: 7a65 3d66 6967 7369 7a65 2c20 7469 746c  ze=figsize, titl
+00016a10: 653d 7469 746c 6529 0d0a 0d0a 2020 2020  e=title)....    
+00016a20: 6465 6620 7265 7475 726e 5f63 6f6d 706f  def return_compo
+00016a30: 6e65 6e74 7328 7365 6c66 2c20 746f 5f6f  nents(self, to_o
+00016a40: 7269 6769 6e5f 7370 6163 653d 5472 7565  rigin_space=True
+00016a50: 2c20 696e 636c 7564 655f 696d 7061 6374  , include_impact
+00016a60: 733d 4661 6c73 6529 3a0d 0a20 2020 2020  s=False):..     
+00016a70: 2020 2022 2222 5265 7475 726e 2061 6464     """Return add
+00016a80: 6974 6976 6520 656c 656d 656e 7473 206f  itive elements o
+00016a90: 6620 666f 7265 6361 7374 2c20 6c69 6e65  f forecast, line
+00016aa0: 6172 2061 6e64 2074 7265 6e64 2e20 4966  ar and trend. If
+00016ab0: 2069 6d70 6163 7473 2069 6e63 6c75 6465   impacts include
+00016ac0: 642c 2069 7420 6973 2061 206d 756c 7469  d, it is a multi
+00016ad0: 706c 6963 6174 6976 6520 7465 726d 2e0d  plicative term..
+00016ae0: 0a0d 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00016af0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00016b00: 5f6f 7269 6769 6e5f 7370 6163 6520 2862  _origin_space (b
+00016b10: 6f6f 6c29 2069 6620 4661 6c73 652c 2077  ool) if False, w
+00016b20: 696c 6c20 6e6f 7420 7265 7665 7273 6520  ill not reverse 
+00016b30: 7472 616e 7366 6f72 6d20 6c69 6e65 6172  transform linear
+00016b40: 2063 6f6d 706f 6e65 6e74 730d 0a20 2020   components..   
+00016b50: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+00016b60: 5f69 6d70 6163 7473 2028 626f 6f6c 2920  _impacts (bool) 
+00016b70: 6966 2054 7275 652c 2069 6d70 6163 7473  if True, impacts
+00016b80: 2061 7265 2069 6e63 6c75 6465 6420 696e   are included in
+00016b90: 2074 6865 2072 6574 7572 6e65 6420 6461   the returned da
+00016ba0: 7461 6672 616d 650d 0a20 2020 2020 2020  taframe..       
+00016bb0: 2022 2222 0d0a 2020 2020 2020 2020 706c   """..        pl
+00016bc0: 6f74 5f6c 6973 7420 3d20 5b5d 0d0a 2020  ot_list = []..  
+00016bd0: 2020 2020 2020 706c 6f74 5f6c 6973 742e        plot_list.
+00016be0: 6170 7065 6e64 2873 656c 662e 7072 6f63  append(self.proc
+00016bf0: 6573 735f 636f 6d70 6f6e 656e 7473 2874  ess_components(t
+00016c00: 6f5f 6f72 6967 696e 5f73 7061 6365 3d74  o_origin_space=t
+00016c10: 6f5f 6f72 6967 696e 5f73 7061 6365 2929  o_origin_space))
+00016c20: 0d0a 2020 2020 2020 2020 7472 656e 6420  ..        trend 
+00016c30: 3d20 7365 6c66 2e70 7265 6469 6374 6564  = self.predicted
+00016c40: 5f74 7265 6e64 2e63 6f70 7928 290d 0a20  _trend.copy().. 
+00016c50: 2020 2020 2020 2074 7265 6e64 2e63 6f6c         trend.col
+00016c60: 756d 6e73 203d 2070 642e 4d75 6c74 6949  umns = pd.MultiI
+00016c70: 6e64 6578 2e66 726f 6d5f 6172 7261 7973  ndex.from_arrays
+00016c80: 280d 0a20 2020 2020 2020 2020 2020 205b  (..            [
+00016c90: 7472 656e 642e 636f 6c75 6d6e 732c 205b  trend.columns, [
+00016ca0: 2774 7265 6e64 275d 202a 206c 656e 2874  'trend'] * len(t
+00016cb0: 7265 6e64 2e63 6f6c 756d 6e73 295d 0d0a  rend.columns)]..
+00016cc0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00016cd0: 2020 2070 6c6f 745f 6c69 7374 2e61 7070     plot_list.app
+00016ce0: 656e 6428 7472 656e 6429 0d0a 2020 2020  end(trend)..    
+00016cf0: 2020 2020 6966 2073 656c 662e 696d 7061      if self.impa
+00016d00: 6374 7320 6973 206e 6f74 204e 6f6e 6520  cts is not None 
+00016d10: 616e 6420 696e 636c 7564 655f 696d 7061  and include_impa
+00016d20: 6374 733a 0d0a 2020 2020 2020 2020 2020  cts:..          
+00016d30: 2020 696d 7061 6374 7320 3d20 7365 6c66    impacts = self
+00016d40: 2e69 6d70 6163 7473 2e63 6f70 7928 290d  .impacts.copy().
+00016d50: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
+00016d60: 6163 7473 2e63 6f6c 756d 6e73 203d 2070  acts.columns = p
+00016d70: 642e 4d75 6c74 6949 6e64 6578 2e66 726f  d.MultiIndex.fro
+00016d80: 6d5f 6172 7261 7973 280d 0a20 2020 2020  m_arrays(..     
+00016d90: 2020 2020 2020 2020 2020 205b 696d 7061             [impa
+00016da0: 6374 732e 636f 6c75 6d6e 732c 205b 2769  cts.columns, ['i
+00016db0: 6d70 6163 7473 275d 202a 206c 656e 2869  mpacts'] * len(i
+00016dc0: 6d70 6163 7473 2e63 6f6c 756d 6e73 295d  mpacts.columns)]
+00016dd0: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00016de0: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
+00016df0: 745f 6c69 7374 2e61 7070 656e 6428 696d  t_list.append(im
+00016e00: 7061 6374 7329 0d0a 2020 2020 2020 2020  pacts)..        
+00016e10: 7265 7475 726e 2070 642e 636f 6e63 6174  return pd.concat
+00016e20: 2870 6c6f 745f 6c69 7374 2c20 6178 6973  (plot_list, axis
+00016e30: 3d31 290d 0a0d 0a20 2020 2064 6566 2070  =1)....    def p
+00016e40: 6c6f 745f 7472 656e 6428 0d0a 2020 2020  lot_trend(..    
+00016e50: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
+00016e60: 2020 2073 6572 6965 733d 4e6f 6e65 2c0d     series=None,.
+00016e70: 0a20 2020 2020 2020 2076 6c69 6e65 3d4e  .        vline=N
+00016e80: 6f6e 652c 0d0a 2020 2020 2020 2020 636f  one,..        co
+00016e90: 6c6f 7273 3d5b 2223 6434 6637 3466 222c  lors=["#d4f74f",
+00016ea0: 2022 2338 3261 6235 6122 2c20 2223 6666   "#82ab5a", "#ff
+00016eb0: 3663 3035 222c 2022 2363 3132 3630 3022  6c05", "#c12600"
+00016ec0: 5d2c 0d0a 2020 2020 2020 2020 7469 746c  ],..        titl
+00016ed0: 653d 4e6f 6e65 2c0d 0a20 2020 2020 2020  e=None,..       
+00016ee0: 2073 7461 7274 5f64 6174 653d 4e6f 6e65   start_date=None
+00016ef0: 2c0d 0a20 2020 2020 2020 202a 2a6b 7761  ,..        **kwa
+00016f00: 7267 732c 0d0a 2020 2020 293a 0d0a 2020  rgs,..    ):..  
+00016f10: 2020 2020 2020 2320 594d 4158 2066 726f        # YMAX fro
+00016f20: 6d20 504c 4f54 204f 4e4c 590d 0a20 2020  m PLOT ONLY..   
+00016f30: 2020 2020 2069 6620 7365 7269 6573 2069       if series i
+00016f40: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00016f50: 2020 2020 2073 6572 6965 7320 3d20 7261       series = ra
+00016f60: 6e64 6f6d 2e63 686f 6963 6528 7365 6c66  ndom.choice(self
+00016f70: 2e63 6f6c 756d 6e5f 6e61 6d65 7329 0d0a  .column_names)..
+00016f80: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
+00016f90: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00016fa0: 2020 2020 2020 2074 6974 6c65 203d 2066         title = f
+00016fb0: 2254 7265 6e64 2042 7265 616b 646f 776e  "Trend Breakdown
+00016fc0: 2066 6f72 207b 7365 7269 6573 7d22 0d0a   for {series}"..
+00016fd0: 2020 2020 2020 2020 705f 696e 6478 203d          p_indx =
+00016fe0: 2073 656c 662e 636f 6c75 6d6e 5f6e 616d   self.column_nam
+00016ff0: 6573 2e67 6574 5f6c 6f63 2873 6572 6965  es.get_loc(serie
+00017000: 7329 0d0a 2020 2020 2020 2020 6375 725f  s)..        cur_
+00017010: 7472 656e 6420 3d20 7365 6c66 2e70 7265  trend = self.pre
+00017020: 6469 6374 6564 5f74 7265 6e64 5b73 6572  dicted_trend[ser
+00017030: 6965 735d 2e63 6f70 7928 290d 0a20 2020  ies].copy()..   
+00017040: 2020 2020 2074 6c73 203d 206c 656e 2863       tls = len(c
+00017050: 7572 5f74 7265 6e64 290d 0a20 2020 2020  ur_trend)..     
+00017060: 2020 2070 6c6f 745f 6466 203d 2070 642e     plot_df = pd.
+00017070: 4461 7461 4672 616d 6528 0d0a 2020 2020  DataFrame(..    
+00017080: 2020 2020 2020 2020 7b0d 0a20 2020 2020          {..     
+00017090: 2020 2020 2020 2020 2020 2027 6465 636c             'decl
+000170a0: 696e 655f 6163 6365 6c65 7261 7469 6e67  ine_accelerating
+000170b0: 273a 2063 7572 5f74 7265 6e64 5b0d 0a20  ': cur_trend[.. 
+000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170d0: 2020 2028 0d0a 2020 2020 2020 2020 2020     (..          
+000170e0: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+000170f0: 2e68 7374 6163 6b28 286e 702e 7369 676e  .hstack((np.sign
+00017100: 6269 7428 7365 6c66 2e61 6363 656c 5b3a  bit(self.accel[:
+00017110: 2c20 705f 696e 6478 5d29 2c20 4661 6c73  , p_indx]), Fals
+00017120: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+00017130: 2020 2020 2020 2020 2020 2020 2026 2073               & s
+00017140: 656c 662e 736c 6f70 655f 7369 676e 5b3a  elf.slope_sign[:
+00017150: 2c20 705f 696e 6478 5d0d 0a20 2020 2020  , p_indx]..     
+00017160: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00017170: 5b2d 746c 733a 5d0d 0a20 2020 2020 2020  [-tls:]..       
+00017180: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
+00017190: 2020 2020 2020 2020 2020 2020 2027 6465               'de
+000171a0: 636c 696e 655f 6465 6365 6c65 7261 7469  cline_decelerati
+000171b0: 6e67 273a 2063 7572 5f74 7265 6e64 5b0d  ng': cur_trend[.
+000171c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000171d0: 2020 2020 2028 0d0a 2020 2020 2020 2020       (..        
+000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171f0: 287e 6e70 2e68 7374 6163 6b28 286e 702e  (~np.hstack((np.
+00017200: 7369 676e 6269 7428 7365 6c66 2e61 6363  signbit(self.acc
+00017210: 656c 5b3a 2c20 705f 696e 6478 5d29 2c20  el[:, p_indx]), 
+00017220: 4661 6c73 6529 2929 0d0a 2020 2020 2020  False)))..      
+00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017240: 2020 2620 7365 6c66 2e73 6c6f 7065 5f73    & self.slope_s
+00017250: 6967 6e5b 3a2c 2070 5f69 6e64 785d 0d0a  ign[:, p_indx]..
+00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017270: 2020 2020 295b 2d74 6c73 3a5d 0d0a 2020      )[-tls:]..  
+00017280: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
+00017290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000172a0: 2020 2767 726f 7774 685f 6465 6365 6c65    'growth_decele
+000172b0: 7261 7469 6e67 273a 2063 7572 5f74 7265  rating': cur_tre
+000172c0: 6e64 5b0d 0a20 2020 2020 2020 2020 2020  nd[..           
+000172d0: 2020 2020 2020 2020 2028 0d0a 2020 2020           (..    
+000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172f0: 2020 2020 6e70 2e68 7374 6163 6b28 286e      np.hstack((n
+00017300: 702e 7369 676e 6269 7428 7365 6c66 2e61  p.signbit(self.a
+00017310: 6363 656c 5b3a 2c20 705f 696e 6478 5d29  ccel[:, p_indx])
+00017320: 2c20 4661 6c73 6529 290d 0a20 2020 2020  , False))..     
+00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017340: 2020 2026 2028 7e73 656c 662e 736c 6f70     & (~self.slop
+00017350: 655f 7369 676e 5b3a 2c20 705f 696e 6478  e_sign[:, p_indx
+00017360: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00017370: 2020 2020 2020 2020 295b 2d74 6c73 3a5d          )[-tls:]
+00017380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017390: 2020 5d2c 0d0a 2020 2020 2020 2020 2020    ],..          
+000173a0: 2020 2020 2020 2767 726f 7774 685f 6163        'growth_ac
+000173b0: 6365 6c65 7261 7469 6e67 273a 2063 7572  celerating': cur
+000173c0: 5f74 7265 6e64 5b0d 0a20 2020 2020 2020  _trend[..       
+000173d0: 2020 2020 2020 2020 2020 2020 2028 0d0a               (..
+000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173f0: 2020 2020 2020 2020 287e 6e70 2e68 7374          (~np.hst
+00017400: 6163 6b28 286e 702e 7369 676e 6269 7428  ack((np.signbit(
+00017410: 7365 6c66 2e61 6363 656c 5b3a 2c20 705f  self.accel[:, p_
+00017420: 696e 6478 5d29 2c20 4661 6c73 6529 2929  indx]), False)))
+00017430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017440: 2020 2020 2020 2020 2020 2620 287e 7365            & (~se
+00017450: 6c66 2e73 6c6f 7065 5f73 6967 6e5b 3a2c  lf.slope_sign[:,
+00017460: 2070 5f69 6e64 785d 290d 0a20 2020 2020   p_indx])..     
+00017470: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00017480: 5b2d 746c 733a 5d0d 0a20 2020 2020 2020  [-tls:]..       
+00017490: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
+000174a0: 2020 2020 2020 2020 207d 2c0d 0a20 2020           },..   
+000174b0: 2020 2020 2020 2020 2069 6e64 6578 3d63           index=c
+000174c0: 7572 5f74 7265 6e64 2e69 6e64 6578 2c0d  ur_trend.index,.
+000174d0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000174e0: 2020 2020 6966 2073 7461 7274 5f64 6174      if start_dat
+000174f0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+00017500: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
+00017510: 5f64 6620 3d20 706c 6f74 5f64 665b 706c  _df = plot_df[pl
+00017520: 6f74 5f64 662e 696e 6465 7820 3e3d 2073  ot_df.index >= s
+00017530: 7461 7274 5f64 6174 655d 0d0a 2020 2020  tart_date]..    
+00017540: 2020 2020 6178 203d 2070 6c6f 745f 6466      ax = plot_df
+00017550: 2e70 6c6f 7428 7469 746c 653d 7469 746c  .plot(title=titl
+00017560: 652c 2063 6f6c 6f72 3d63 6f6c 6f72 732c  e, color=colors,
+00017570: 202a 2a6b 7761 7267 7329 0d0a 2020 2020   **kwargs)..    
+00017580: 2020 2020 6861 6e64 6c65 732c 206c 6162      handles, lab
+00017590: 656c 7320 3d20 6178 2e67 6574 5f6c 6567  els = ax.get_leg
+000175a0: 656e 645f 6861 6e64 6c65 735f 6c61 6265  end_handles_labe
+000175b0: 6c73 2829 0d0a 2020 2020 2020 2020 2320  ls()..        # 
+000175c0: 6178 2e73 6361 7474 6572 2863 7572 5f74  ax.scatter(cur_t
+000175d0: 7265 6e64 2e69 6e64 6578 5b73 656c 662e  rend.index[self.
+000175e0: 6368 616e 6765 706f 696e 7473 5b3a 2c20  changepoints[:, 
+000175f0: 705f 696e 6478 5d5d 2c20 6375 725f 7472  p_indx]], cur_tr
+00017600: 656e 645b 7365 6c66 2e63 6861 6e67 6570  end[self.changep
+00017610: 6f69 6e74 735b 3a2c 2070 5f69 6e64 785d  oints[:, p_indx]
+00017620: 5d2c 2063 3d27 2366 6463 6330 3927 2c20  ], c='#fdcc09', 
+00017630: 733d 342e 3029 0d0a 2020 2020 2020 2020  s=4.0)..        
+00017640: 2320 6178 2e73 6361 7474 6572 2863 7572  # ax.scatter(cur
+00017650: 5f74 7265 6e64 2e69 6e64 6578 5b73 656c  _trend.index[sel
+00017660: 662e 7a65 726f 5f63 726f 7373 696e 6773  f.zero_crossings
+00017670: 5b3a 2c20 705f 696e 6478 5d5d 2c20 6375  [:, p_indx]], cu
+00017680: 725f 7472 656e 645b 7365 6c66 2e7a 6572  r_trend[self.zer
+00017690: 6f5f 6372 6f73 7369 6e67 735b 3a2c 2070  o_crossings[:, p
+000176a0: 5f69 6e64 785d 5d2c 2063 3d27 2335 3132  _indx]], c='#512
+000176b0: 6637 3427 2c20 733d 342e 3029 0d0a 2020  f74', s=4.0)..  
+000176c0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
+000176d0: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+000176e0: 6374 6f72 2069 7320 6e6f 7420 4e6f 6e65  ctor is not None
+000176f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00017700: 6620 7365 6c66 2e74 7265 6e64 5f61 6e6f  f self.trend_ano
+00017710: 6d61 6c79 5f64 6574 6563 746f 722e 6f75  maly_detector.ou
+00017720: 7470 7574 203d 3d20 2275 6e69 7661 7269  tput == "univari
+00017730: 6174 6522 3a0d 0a20 2020 2020 2020 2020  ate":..         
+00017740: 2020 2020 2020 2069 5f61 6e6f 6d20 3d20         i_anom = 
+00017750: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
+00017760: 6c79 5f64 6574 6563 746f 722e 616e 6f6d  ly_detector.anom
+00017770: 616c 6965 732e 696e 6465 785b 0d0a 2020  alies.index[..  
+00017780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017790: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f64    self.anomaly_d
+000177a0: 6574 6563 746f 722e 616e 6f6d 616c 6965  etector.anomalie
+000177b0: 732e 696c 6f63 5b3a 2c20 305d 203d 3d20  s.iloc[:, 0] == 
+000177c0: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
+000177d0: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
+000177e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000177f0: 2020 2020 2020 2020 2020 7365 7269 6573            series
+00017800: 5f61 6e6f 6d20 3d20 7365 6c66 2e74 7265  _anom = self.tre
+00017810: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00017820: 746f 722e 616e 6f6d 616c 6965 735b 7365  tor.anomalies[se
+00017830: 7269 6573 5d0d 0a20 2020 2020 2020 2020  ries]..         
+00017840: 2020 2020 2020 2069 5f61 6e6f 6d20 3d20         i_anom = 
+00017850: 7365 7269 6573 5f61 6e6f 6d5b 7365 7269  series_anom[seri
+00017860: 6573 5f61 6e6f 6d20 3d3d 202d 315d 2e69  es_anom == -1].i
+00017870: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
+00017880: 2020 6966 2073 7461 7274 5f64 6174 6520    if start_date 
+00017890: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000178a0: 2020 2020 2020 2020 2020 2020 2020 695f                i_
+000178b0: 616e 6f6d 203d 2069 5f61 6e6f 6d5b 695f  anom = i_anom[i_
+000178c0: 616e 6f6d 203e 3d20 7374 6172 745f 6461  anom >= start_da
+000178d0: 7465 5d0d 0a20 2020 2020 2020 2020 2020  te]..           
+000178e0: 2069 5f61 6e6f 6d20 3d20 695f 616e 6f6d   i_anom = i_anom
+000178f0: 5b69 5f61 6e6f 6d20 3e3d 2063 7572 5f74  [i_anom >= cur_t
+00017900: 7265 6e64 2e69 6e64 6578 5b30 5d5d 0d0a  rend.index[0]]..
+00017910: 2020 2020 2020 2020 2020 2020 2320 6f6e              # on
+00017920: 6c79 2070 6c6f 7420 6966 2073 6f6d 6520  ly plot if some 
+00017930: 616e 6f6d 616c 6965 732c 2061 6e64 206e  anomalies, and n
+00017940: 6f74 2077 6179 2074 6f6f 206d 616e 7920  ot way too many 
+00017950: 616e 6f6d 616c 6965 730d 0a20 2020 2020  anomalies..     
+00017960: 2020 2020 2020 2069 6620 6c65 6e28 695f         if len(i_
+00017970: 616e 6f6d 2920 3e20 3020 616e 6420 6c65  anom) > 0 and le
+00017980: 6e28 695f 616e 6f6d 2920 3c20 6c65 6e28  n(i_anom) < len(
+00017990: 706c 6f74 5f64 6629 202a 2030 2e35 3a0d  plot_df) * 0.5:.
+000179a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000179b0: 2073 6361 7431 203d 2061 782e 7363 6174   scat1 = ax.scat
+000179c0: 7465 7228 0d0a 2020 2020 2020 2020 2020  ter(..          
+000179d0: 2020 2020 2020 2020 2020 695f 616e 6f6d            i_anom
+000179e0: 2e74 6f6c 6973 7428 292c 2063 7572 5f74  .tolist(), cur_t
+000179f0: 7265 6e64 2e6c 6f63 5b69 5f61 6e6f 6d5d  rend.loc[i_anom]
+00017a00: 2c20 633d 2272 6564 222c 2073 3d31 362e  , c="red", s=16.
+00017a10: 300d 0a20 2020 2020 2020 2020 2020 2020  0..             
+00017a20: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00017a30: 2020 2020 2020 6861 6e64 6c65 7320 2b3d        handles +=
+00017a40: 205b 7363 6174 315d 0d0a 2020 2020 2020   [scat1]..      
+00017a50: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
+00017a60: 202b 3d20 5b27 7472 656e 6420 616e 6f6d   += ['trend anom
+00017a70: 616c 6965 7327 5d0d 0a20 2020 2020 2020  alies']..       
+00017a80: 2069 6620 766c 696e 6520 6973 206e 6f74   if vline is not
+00017a90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00017aa0: 2020 2020 6178 2e76 6c69 6e65 7328 0d0a      ax.vlines(..
+00017ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ac0: 783d 766c 696e 652c 0d0a 2020 2020 2020  x=vline,..      
+00017ad0: 2020 2020 2020 2020 2020 6c73 3d27 2d2d            ls='--
+00017ae0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00017af0: 2020 2020 6c77 3d31 2c0d 0a20 2020 2020      lw=1,..     
+00017b00: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+00017b10: 733d 2764 6172 6b72 6564 272c 0d0a 2020  s='darkred',..  
+00017b20: 2020 2020 2020 2020 2020 2020 2020 796d                ym
+00017b30: 696e 3d63 7572 5f74 7265 6e64 5b63 7572  in=cur_trend[cur
+00017b40: 5f74 7265 6e64 2e69 6e64 6578 203e 3d20  _trend.index >= 
+00017b50: 7374 6172 745f 6461 7465 5d2e 6d69 6e28  start_date].min(
+00017b60: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00017b70: 2020 2020 796d 6178 3d63 7572 5f74 7265      ymax=cur_tre
+00017b80: 6e64 5b63 7572 5f74 7265 6e64 2e69 6e64  nd[cur_trend.ind
+00017b90: 6578 203e 3d20 7374 6172 745f 6461 7465  ex >= start_date
+00017ba0: 5d2e 6d61 7828 292c 0d0a 2020 2020 2020  ].max(),..      
+00017bb0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00017bc0: 2061 782e 6c65 6765 6e64 2868 616e 646c   ax.legend(handl
+00017bd0: 6573 2c20 6c61 6265 6c73 290d 0a20 2020  es, labels)..   
+00017be0: 2020 2020 2072 6574 7572 6e20 6178 0d0a       return ax..
+00017bf0: 0d0a 2020 2020 6465 6620 706c 6f74 5f66  ..    def plot_f
+00017c00: 6f72 6563 6173 7428 0d0a 2020 2020 2020  orecast(..      
+00017c10: 2020 7365 6c66 2c0d 0a20 2020 2020 2020    self,..       
+00017c20: 2070 7265 6469 6374 696f 6e2c 0d0a 2020   prediction,..  
+00017c30: 2020 2020 2020 6163 7475 616c 733d 4e6f        actuals=No
+00017c40: 6e65 2c0d 0a20 2020 2020 2020 2073 6572  ne,..        ser
+00017c50: 6965 733d 4e6f 6e65 2c0d 0a20 2020 2020  ies=None,..     
+00017c60: 2020 2073 7461 7274 5f64 6174 653d 4e6f     start_date=No
+00017c70: 6e65 2c0d 0a20 2020 2020 2020 2061 6e6f  ne,..        ano
+00017c80: 6d61 6c79 5f63 6f6c 6f72 3d22 6461 726b  maly_color="dark
+00017c90: 736c 6174 6562 6c75 6522 2c0d 0a20 2020  slateblue",..   
+00017ca0: 2020 2020 2068 6f6c 6964 6179 5f63 6f6c       holiday_col
+00017cb0: 6f72 3d22 6461 726b 6772 6565 6e22 2c0d  or="darkgreen",.
+00017cc0: 0a20 2020 2020 2020 2074 7265 6e64 5f61  .        trend_a
+00017cd0: 6e6f 6d61 6c79 5f63 6f6c 6f72 3d27 736c  nomaly_color='sl
+00017ce0: 6174 6567 7261 7927 2c0d 0a20 2020 2020  ategray',..     
+00017cf0: 2020 2070 6f69 6e74 5f73 697a 653d 3132     point_size=12
+00017d00: 2e30 2c0d 0a20 2020 2029 3a0d 0a20 2020  .0,..    ):..   
+00017d10: 2020 2020 2022 2222 506c 6f74 2061 2066       """Plot a f
+00017d20: 6f72 6563 6173 7420 7469 6d65 2073 6572  orecast time ser
+00017d30: 6965 732e 0d0a 0d0a 2020 2020 2020 2020  ies.....        
+00017d40: 4172 6773 3a0d 0a20 2020 2020 2020 2020  Args:..         
+00017d50: 2020 2070 7265 6469 6374 696f 6e20 286d     prediction (m
+00017d60: 6f64 656c 2070 7265 6469 6374 696f 6e20  odel prediction 
+00017d70: 6f62 6a65 6374 2c20 7265 7175 6972 6564  object, required
+00017d80: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00017d90: 6374 7561 6c73 2028 7064 2e44 6174 6146  ctuals (pd.DataF
+00017da0: 7261 6d65 293a 2077 6964 6520 7374 796c  rame): wide styl
+00017db0: 6520 6466 2c20 6f66 206b 6e6f 7720 6461  e df, of know da
+00017dc0: 7461 2069 6620 6176 6169 6c61 626c 650d  ta if available.
+00017dd0: 0a20 2020 2020 2020 2020 2020 2073 6572  .            ser
+00017de0: 6965 7320 2873 7472 293a 206e 616d 6520  ies (str): name 
+00017df0: 6f66 2074 696d 6520 7365 7269 6573 2063  of time series c
+00017e00: 6f6c 756d 6e20 746f 2070 6c6f 740d 0a20  olumn to plot.. 
+00017e10: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00017e20: 5f64 6174 6520 2873 7472 206f 7220 5469  _date (str or Ti
+00017e30: 6d65 7374 616d 7029 3a20 706f 696e 7420  mestamp): point 
+00017e40: 6174 2077 6869 6368 2074 6f20 6265 6769  at which to begi
+00017e50: 6e20 5820 6178 6973 0d0a 2020 2020 2020  n X axis..      
+00017e60: 2020 2020 2020 616e 6f6d 616c 795f 636f        anomaly_co
+00017e70: 6c6f 7220 2873 7472 293a 206e 616d 6520  lor (str): name 
+00017e80: 6f66 2061 6e6f 6d61 6c79 2070 6f69 6e74  of anomaly point
+00017e90: 2063 6f6c 6f72 0d0a 2020 2020 2020 2020   color..        
+00017ea0: 2020 2020 686f 6c69 6461 795f 636f 6c6f      holiday_colo
+00017eb0: 7220 2873 7472 293a 206e 616d 6520 6f66  r (str): name of
+00017ec0: 2068 6f6c 6964 6179 2070 6f69 6e74 2063   holiday point c
+00017ed0: 6f6c 6f72 0d0a 2020 2020 2020 2020 2020  olor..          
+00017ee0: 2020 7472 656e 645f 616e 6f6d 616c 795f    trend_anomaly_
+00017ef0: 636f 6c6f 7220 2873 7472 293a 206e 616d  color (str): nam
+00017f00: 6520 6f66 2074 7265 6e64 2061 6e6f 6d61  e of trend anoma
+00017f10: 6c79 2070 6f69 6e74 2063 6f6c 6f72 0d0a  ly point color..
+00017f20: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00017f30: 745f 7369 7a65 2028 7374 7229 3a20 706f  t_size (str): po
+00017f40: 696e 7420 7369 7a65 2066 6f72 2061 6c6c  int size for all
+00017f50: 2061 6e6f 6d61 6c69 6573 0d0a 2020 2020   anomalies..    
+00017f60: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00017f70: 2069 6620 7365 7269 6573 2069 7320 4e6f   if series is No
+00017f80: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00017f90: 2073 6572 6965 7320 3d20 7261 6e64 6f6d   series = random
+00017fa0: 2e63 686f 6963 6528 7365 6c66 2e63 6f6c  .choice(self.col
+00017fb0: 756d 6e5f 6e61 6d65 7329 0d0a 2020 2020  umn_names)..    
+00017fc0: 2020 2020 6966 2061 6374 7561 6c73 2069      if actuals i
+00017fd0: 7320 4e6f 6e65 206f 7220 6e6f 7420 6973  s None or not is
+00017fe0: 696e 7374 616e 6365 280d 0a20 2020 2020  instance(..     
+00017ff0: 2020 2020 2020 2061 6374 7561 6c73 2c20         actuals, 
+00018000: 2870 642e 4461 7461 4672 616d 652c 206e  (pd.DataFrame, n
+00018010: 702e 6172 7261 792c 2070 642e 5365 7269  p.array, pd.Seri
+00018020: 6573 290d 0a20 2020 2020 2020 2029 3a0d  es)..        ):.
+00018030: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+00018040: 7561 6c73 5f75 7365 6420 3d20 7072 6564  uals_used = pred
+00018050: 6963 7469 6f6e 2e66 6f72 6563 6173 740d  iction.forecast.
+00018060: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+00018070: 7561 6c73 5f66 6c61 6720 3d20 4661 6c73  uals_flag = Fals
+00018080: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
+00018090: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
+000180a0: 7475 616c 735f 666c 6167 203d 2054 7275  tuals_flag = Tru
+000180b0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+000180c0: 6374 7561 6c73 5f75 7365 6420 3d20 6163  ctuals_used = ac
+000180d0: 7475 616c 732e 7265 696e 6465 7828 7072  tuals.reindex(pr
+000180e0: 6564 6963 7469 6f6e 2e66 6f72 6563 6173  ediction.forecas
+000180f0: 742e 696e 6465 7829 0d0a 2020 2020 2020  t.index)..      
+00018100: 2020 766c 696e 6520 3d20 280d 0a20 2020    vline = (..   
+00018110: 2020 2020 2020 2020 204e 6f6e 650d 0a20           None.. 
+00018120: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00018130: 6c66 2e66 6f72 6563 6173 745f 6c65 6e67  lf.forecast_leng
+00018140: 7468 2069 7320 4e6f 6e65 0d0a 2020 2020  th is None..    
+00018150: 2020 2020 2020 2020 656c 7365 2070 7265          else pre
+00018160: 6469 6374 696f 6e2e 666f 7265 6361 7374  diction.forecast
+00018170: 2e69 6e64 6578 5b2d 7365 6c66 2e66 6f72  .index[-self.for
+00018180: 6563 6173 745f 6c65 6e67 7468 5d0d 0a20  ecast_length].. 
+00018190: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000181a0: 2020 6178 203d 2070 7265 6469 6374 696f    ax = predictio
+000181b0: 6e2e 706c 6f74 280d 0a20 2020 2020 2020  n.plot(..       
+000181c0: 2020 2020 2061 6374 7561 6c73 5f75 7365       actuals_use
+000181d0: 642e 6c6f 635b 7072 6564 6963 7469 6f6e  d.loc[prediction
+000181e0: 2e66 6f72 6563 6173 742e 696e 6465 785d  .forecast.index]
+000181f0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00018200: 2061 6374 7561 6c73 5f66 6c61 6720 6973   actuals_flag is
+00018210: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
+00018220: 2020 2020 2020 2065 6c73 6520 4e6f 6e65         else None
+00018230: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+00018240: 6572 6965 733d 7365 7269 6573 2c0d 0a20  eries=series,.. 
+00018250: 2020 2020 2020 2020 2020 2076 6c69 6e65             vline
+00018260: 3d76 6c69 6e65 2c0d 0a20 2020 2020 2020  =vline,..       
+00018270: 2020 2020 2073 7461 7274 5f64 6174 653d       start_date=
+00018280: 7374 6172 745f 6461 7465 2c0d 0a20 2020  start_date,..   
+00018290: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000182a0: 6861 6e64 6c65 732c 206c 6162 656c 7320  handles, labels 
+000182b0: 3d20 6178 2e67 6574 5f6c 6567 656e 645f  = ax.get_legend_
+000182c0: 6861 6e64 6c65 735f 6c61 6265 6c73 2829  handles_labels()
+000182d0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000182e0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+000182f0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00018300: 2069 6620 7365 6c66 2e61 6e6f 6d61 6c79   if self.anomaly
+00018310: 5f64 6574 6563 746f 722e 6f75 7470 7574  _detector.output
+00018320: 203d 3d20 2275 6e69 7661 7269 6174 6522   == "univariate"
+00018330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00018340: 2020 2069 5f61 6e6f 6d20 3d20 7365 6c66     i_anom = self
+00018350: 2e61 6e6f 6d61 6c79 5f64 6574 6563 746f  .anomaly_detecto
+00018360: 722e 616e 6f6d 616c 6965 732e 696e 6465  r.anomalies.inde
+00018370: 785b 0d0a 2020 2020 2020 2020 2020 2020  x[..            
+00018380: 2020 2020 2020 2020 7365 6c66 2e61 6e6f          self.ano
+00018390: 6d61 6c79 5f64 6574 6563 746f 722e 616e  maly_detector.an
+000183a0: 6f6d 616c 6965 732e 696c 6f63 5b3a 2c20  omalies.iloc[:, 
+000183b0: 305d 203d 3d20 2d31 0d0a 2020 2020 2020  0] == -1..      
+000183c0: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
+000183d0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183f0: 7365 7269 6573 5f61 6e6f 6d20 3d20 7365  series_anom = se
+00018400: 6c66 2e61 6e6f 6d61 6c79 5f64 6574 6563  lf.anomaly_detec
+00018410: 746f 722e 616e 6f6d 616c 6965 735b 7365  tor.anomalies[se
+00018420: 7269 6573 5d0d 0a20 2020 2020 2020 2020  ries]..         
+00018430: 2020 2020 2020 2069 5f61 6e6f 6d20 3d20         i_anom = 
+00018440: 7365 7269 6573 5f61 6e6f 6d5b 7365 7269  series_anom[seri
+00018450: 6573 5f61 6e6f 6d20 3d3d 202d 315d 2e69  es_anom == -1].i
+00018460: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
+00018470: 2020 6966 2073 7461 7274 5f64 6174 6520    if start_date 
+00018480: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00018490: 2020 2020 2020 2020 2020 2020 2020 695f                i_
+000184a0: 616e 6f6d 203d 2069 5f61 6e6f 6d5b 695f  anom = i_anom[i_
+000184b0: 616e 6f6d 203e 3d20 7374 6172 745f 6461  anom >= start_da
+000184c0: 7465 5d0d 0a20 2020 2020 2020 2020 2020  te]..           
+000184d0: 2069 6620 6163 7475 616c 735f 666c 6167   if actuals_flag
+000184e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000184f0: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
+00018500: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2061 6374  om[i_anom >= act
+00018510: 7561 6c73 2e69 6e64 6578 5b30 5d5d 0d0a  uals.index[0]]..
+00018520: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00018530: 656e 2869 5f61 6e6f 6d29 203e 2030 2061  en(i_anom) > 0 a
+00018540: 6e64 2028 0d0a 2020 2020 2020 2020 2020  nd (..          
+00018550: 2020 2020 2020 6e6f 7420 6163 7475 616c        not actual
+00018560: 735f 666c 6167 206f 7220 6c65 6e28 695f  s_flag or len(i_
+00018570: 616e 6f6d 2920 3c20 6c65 6e28 6163 7475  anom) < len(actu
+00018580: 616c 7329 202a 2030 2e35 0d0a 2020 2020  als) * 0.5..    
+00018590: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+000185a0: 2020 2020 2020 2020 2020 2020 7363 6174              scat
+000185b0: 3120 3d20 6178 2e73 6361 7474 6572 280d  1 = ax.scatter(.
+000185c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000185d0: 2020 2020 2069 5f61 6e6f 6d2e 746f 6c69       i_anom.toli
+000185e0: 7374 2829 2c0d 0a20 2020 2020 2020 2020  st(),..         
+000185f0: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+00018600: 6c73 5f75 7365 642e 7265 696e 6465 7828  ls_used.reindex(
+00018610: 695f 616e 6f6d 295b 7365 7269 6573 5d2c  i_anom)[series],
+00018620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018630: 2020 2020 2020 633d 616e 6f6d 616c 795f        c=anomaly_
+00018640: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
+00018650: 2020 2020 2020 2020 2020 2020 733d 706f              s=po
+00018660: 696e 745f 7369 7a65 2c0d 0a20 2020 2020  int_size,..     
+00018670: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00018680: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00018690: 6e64 6c65 7320 2b3d 205b 7363 6174 315d  ndles += [scat1]
+000186a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000186b0: 2020 6c61 6265 6c73 202b 3d20 5b22 616e    labels += ["an
+000186c0: 6f6d 616c 6965 7322 5d0d 0a20 2020 2020  omalies"]..     
+000186d0: 2020 2069 6620 7365 6c66 2e68 6f6c 6964     if self.holid
+000186e0: 6179 5f64 6574 6563 746f 723a 0d0a 2020  ay_detector:..  
+000186f0: 2020 2020 2020 2020 2020 695f 616e 6f6d            i_anom
+00018700: 203d 2073 656c 662e 686f 6c69 6461 795f   = self.holiday_
+00018710: 6465 7465 6374 6f72 2e64 6174 6573 5f74  detector.dates_t
+00018720: 6f5f 686f 6c69 6461 7973 280d 0a20 2020  o_holidays(..   
+00018730: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00018740: 662e 6466 2e69 6e64 6578 2c20 7374 796c  f.df.index, styl
+00018750: 653d 2273 6572 6965 735f 666c 6167 220d  e="series_flag".
+00018760: 0a20 2020 2020 2020 2020 2020 2029 5b73  .            )[s
+00018770: 6572 6965 735d 0d0a 2020 2020 2020 2020  eries]..        
+00018780: 2020 2020 695f 616e 6f6d 203d 2069 5f61      i_anom = i_a
+00018790: 6e6f 6d2e 696e 6465 785b 695f 616e 6f6d  nom.index[i_anom
+000187a0: 203d 3d20 315d 0d0a 2020 2020 2020 2020   == 1]..        
+000187b0: 2020 2020 6966 2061 6374 7561 6c73 5f66      if actuals_f
+000187c0: 6c61 673a 0d0a 2020 2020 2020 2020 2020  lag:..          
+000187d0: 2020 2020 2020 695f 616e 6f6d 203d 2069        i_anom = i
+000187e0: 5f61 6e6f 6d5b 695f 616e 6f6d 203e 3d20  _anom[i_anom >= 
+000187f0: 6163 7475 616c 732e 696e 6465 785b 305d  actuals.index[0]
+00018800: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+00018810: 6620 6c65 6e28 695f 616e 6f6d 2920 3e20  f len(i_anom) > 
+00018820: 3020 616e 6420 280d 0a20 2020 2020 2020  0 and (..       
+00018830: 2020 2020 2020 2020 206e 6f74 2061 6374           not act
+00018840: 7561 6c73 5f66 6c61 6720 6f72 206c 656e  uals_flag or len
+00018850: 2869 5f61 6e6f 6d29 203c 206c 656e 2861  (i_anom) < len(a
+00018860: 6374 7561 6c73 2920 2a20 302e 350d 0a20  ctuals) * 0.5.. 
+00018870: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
+00018880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018890: 6361 7432 203d 2061 782e 7363 6174 7465  cat2 = ax.scatte
+000188a0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+000188b0: 2020 2020 2020 2020 695f 616e 6f6d 2e74          i_anom.t
+000188c0: 6f6c 6973 7428 292c 0d0a 2020 2020 2020  olist(),..      
+000188d0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+000188e0: 7475 616c 735f 7573 6564 2e72 6569 6e64  tuals_used.reind
+000188f0: 6578 2869 5f61 6e6f 6d29 5b73 6572 6965  ex(i_anom)[serie
+00018900: 735d 2c0d 0a20 2020 2020 2020 2020 2020  s],..           
+00018910: 2020 2020 2020 2020 2063 3d68 6f6c 6964           c=holid
+00018920: 6179 5f63 6f6c 6f72 2c0d 0a20 2020 2020  ay_color,..     
+00018930: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018940: 3d70 6f69 6e74 5f73 697a 652c 0d0a 2020  =point_size,..  
+00018950: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00018960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018970: 2068 616e 646c 6573 202b 3d20 5b73 6361   handles += [sca
+00018980: 7432 5d0d 0a20 2020 2020 2020 2020 2020  t2]..           
+00018990: 2020 2020 206c 6162 656c 7320 2b3d 205b       labels += [
+000189a0: 2264 6574 6563 7465 6420 686f 6c69 6461  "detected holida
+000189b0: 7973 225d 0d0a 2020 2020 2020 2020 6966  ys"]..        if
+000189c0: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
+000189d0: 616c 795f 6465 7465 6374 6f72 2069 7320  aly_detector is 
+000189e0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000189f0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00018a00: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
+00018a10: 6563 746f 722e 6f75 7470 7574 203d 3d20  ector.output == 
+00018a20: 2275 6e69 7661 7269 6174 6522 3a0d 0a20  "univariate":.. 
+00018a30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018a40: 5f61 6e6f 6d20 3d20 7365 6c66 2e74 7265  _anom = self.tre
+00018a50: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00018a60: 746f 722e 616e 6f6d 616c 6965 732e 696e  tor.anomalies.in
+00018a70: 6465 785b 0d0a 2020 2020 2020 2020 2020  dex[..          
+00018a80: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00018a90: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
+00018aa0: 616e 6f6d 616c 6965 732e 696c 6f63 5b3a  anomalies.iloc[:
+00018ab0: 2c20 305d 203d 3d20 2d31 0d0a 2020 2020  , 0] == -1..    
+00018ac0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+00018ad0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018ae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018af0: 2020 7365 7269 6573 5f61 6e6f 6d20 3d20    series_anom = 
+00018b00: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
+00018b10: 6c79 5f64 6574 6563 746f 722e 616e 6f6d  ly_detector.anom
+00018b20: 616c 6965 735b 7365 7269 6573 5d0d 0a20  alies[series].. 
+00018b30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018b40: 5f61 6e6f 6d20 3d20 7365 7269 6573 5f61  _anom = series_a
+00018b50: 6e6f 6d5b 7365 7269 6573 5f61 6e6f 6d20  nom[series_anom 
+00018b60: 3d3d 202d 315d 2e69 6e64 6578 0d0a 2020  == -1].index..  
+00018b70: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
+00018b80: 7274 5f64 6174 6520 6973 206e 6f74 204e  rt_date is not N
+00018b90: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00018ba0: 2020 2020 2020 695f 616e 6f6d 203d 2069        i_anom = i
+00018bb0: 5f61 6e6f 6d5b 695f 616e 6f6d 203e 3d20  _anom[i_anom >= 
+00018bc0: 7374 6172 745f 6461 7465 5d0d 0a20 2020  start_date]..   
+00018bd0: 2020 2020 2020 2020 2069 6620 6163 7475           if actu
+00018be0: 616c 735f 666c 6167 3a0d 0a20 2020 2020  als_flag:..     
+00018bf0: 2020 2020 2020 2020 2020 2069 5f61 6e6f             i_ano
+00018c00: 6d20 3d20 695f 616e 6f6d 5b69 5f61 6e6f  m = i_anom[i_ano
+00018c10: 6d20 3e3d 2061 6374 7561 6c73 2e69 6e64  m >= actuals.ind
+00018c20: 6578 5b30 5d5d 0d0a 2020 2020 2020 2020  ex[0]]..        
+00018c30: 2020 2020 6966 206c 656e 2869 5f61 6e6f      if len(i_ano
+00018c40: 6d29 203e 2030 2061 6e64 2028 0d0a 2020  m) > 0 and (..  
+00018c50: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+00018c60: 7420 6163 7475 616c 735f 666c 6167 206f  t actuals_flag o
+00018c70: 7220 6c65 6e28 695f 616e 6f6d 2920 3c20  r len(i_anom) < 
+00018c80: 6c65 6e28 6163 7475 616c 7329 202a 2030  len(actuals) * 0
+00018c90: 2e35 0d0a 2020 2020 2020 2020 2020 2020  .5..            
+00018ca0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00018cb0: 2020 2020 7363 6174 3320 3d20 6178 2e73      scat3 = ax.s
+00018cc0: 6361 7474 6572 280d 0a20 2020 2020 2020  catter(..       
+00018cd0: 2020 2020 2020 2020 2020 2020 2069 5f61               i_a
+00018ce0: 6e6f 6d2e 746f 6c69 7374 2829 2c0d 0a20  nom.tolist(),.. 
+00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d00: 2020 2061 6374 7561 6c73 5f75 7365 642e     actuals_used.
+00018d10: 7265 696e 6465 7828 695f 616e 6f6d 295b  reindex(i_anom)[
+00018d20: 7365 7269 6573 5d2c 0d0a 2020 2020 2020  series],..      
+00018d30: 2020 2020 2020 2020 2020 2020 2020 633d                c=
+00018d40: 7472 656e 645f 616e 6f6d 616c 795f 636f  trend_anomaly_co
+00018d50: 6c6f 722c 0d0a 2020 2020 2020 2020 2020  lor,..          
+00018d60: 2020 2020 2020 2020 2020 733d 706f 696e            s=poin
+00018d70: 745f 7369 7a65 2c0d 0a20 2020 2020 2020  t_size,..       
+00018d80: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00018d90: 2020 2020 2020 2020 2020 2020 6861 6e64              hand
+00018da0: 6c65 7320 2b3d 205b 7363 6174 335d 0d0a  les += [scat3]..
+00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018dc0: 6c61 6265 6c73 202b 3d20 5b22 7472 656e  labels += ["tren
+00018dd0: 6420 616e 6f6d 616c 6965 7322 5d0d 0a20  d anomalies"].. 
+00018de0: 2020 2020 2020 2061 782e 6c65 6765 6e64         ax.legend
+00018df0: 2868 616e 646c 6573 2c20 6c61 6265 6c73  (handles, labels
+00018e00: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00018e10: 6e20 6178 0d0a 0d0a 2020 2020 6465 6620  n ax....    def 
+00018e20: 706c 6f74 5f74 6869 6e67 7328 293a 2020  plot_things():  
+00018e30: 2320 706c 6163 6568 6f6c 6465 7220 666f  # placeholder fo
+00018e40: 7220 6c61 7465 7220 706c 6f74 7469 6e67  r later plotting
+00018e50: 2066 756e 6374 696f 6e73 0d0a 2020 2020   functions..    
+00018e60: 2020 2020 2320 706c 6f74 2063 6f6d 706f      # plot compo
+00018e70: 6e65 6e74 730d 0a20 2020 2020 2020 2023  nents..        #
+00018e80: 2070 6c6f 7420 7472 616e 7366 6f72 6d65   plot transforme
+00018e90: 6420 6466 2069 6620 7072 6570 726f 6365  d df if preproce
+00018ea0: 7373 206f 7220 616e 6f6d 616c 7920 7265  ss or anomaly re
+00018eb0: 6d6f 7661 6c0d 0a20 2020 2020 2020 2023  moval..        #
+00018ec0: 2070 6c6f 7420 7061 7374 2069 6d70 6163   plot past impac
+00018ed0: 7473 0d0a 2020 2020 2020 2020 2320 706c  ts..        # pl
+00018ee0: 6f74 2025 2063 6f6e 7472 6962 7574 696f  ot % contributio
+00018ef0: 6e20 6f66 2063 6f6d 706f 6e65 6e74 730d  n of components.
+00018f00: 0a20 2020 2020 2020 2023 2070 6c6f 7420  .        # plot 
+00018f10: 6576 616c 2028 7368 6f77 2061 6374 7561  eval (show actua
+00018f20: 6c73 2c20 616c 6f6e 6773 6964 6520 6675  ls, alongside fu
+00018f30: 6c6c 2061 6e64 2063 6f6d 706f 6e65 6e74  ll and component
+00018f40: 7320 746f 2064 6961 676e 6f73 6529 0d0a  s to diagnose)..
+00018f50: 2020 2020 2020 2020 2320 706c 6f74 2072          # plot r
+00018f60: 6573 6964 7561 6c20 6469 7374 7269 6275  esidual distribu
+00018f70: 7469 6f6e 2f50 4143 460d 0a20 2020 2020  tion/PACF..     
+00018f80: 2020 2023 2070 6c6f 7420 696e 666c 6563     # plot inflec
+00018f90: 7469 6f6e 2070 6f69 6e74 7320 2866 696c  tion points (fil
+00018fa0: 7465 7269 6e67 206f 7220 736d 6f6f 7468  tering or smooth
+00018fb0: 696e 6720 6669 7273 7429 0d0a 2020 2020  ing first)..    
+00018fc0: 2020 2020 2320 706c 6f74 2068 6967 6865      # plot highe
+00018fd0: 7374 2065 7272 6f72 2073 6572 6965 732c  st error series,
+00018fe0: 2070 6c6f 7420 6869 6768 6573 742f 6c6f   plot highest/lo
+00018ff0: 7765 7374 2067 726f 7774 680d 0a20 2020  west growth..   
+00019000: 2020 2020 2023 2074 7265 6e64 3a20 6f6e       # trend: on
+00019010: 6520 636f 6c6f 7220 666f 7220 6772 6f77  e color for grow
+00019020: 7468 2c20 616e 6f74 6865 7220 666f 7220  th, another for 
+00019030: 6465 636c 696e 6520 2864 6172 6b65 7220  decline (darker 
+00019040: 6173 2061 6363 656c 6572 6174 696e 672c  as accelerating,
+00019050: 206c 6967 6865 7220 6173 2073 6c6f 7769   ligher as slowi
+00019060: 6e67 290d 0a20 2020 2020 2020 2072 6574  ng)..        ret
+00019070: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
+00019080: 6564 0d0a 0d0a 0d0a 6465 6620 636c 6561  ed......def clea
+00019090: 6e5f 7265 6772 6573 736f 7228 696e 5f64  n_regressor(in_d
+000190a0: 2c20 7072 6566 6978 3d22 7265 6772 5f22  , prefix="regr_"
+000190b0: 293a 0d0a 2020 2020 6966 206e 6f74 2069  ):..    if not i
+000190c0: 7369 6e73 7461 6e63 6528 696e 5f64 2c20  sinstance(in_d, 
+000190d0: 7064 2e44 6174 6146 7261 6d65 293a 0d0a  pd.DataFrame):..
+000190e0: 2020 2020 2020 2020 6466 203d 2070 642e          df = pd.
+000190f0: 4461 7461 4672 616d 6528 696e 5f64 290d  DataFrame(in_d).
+00019100: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+00019110: 2020 2020 6466 203d 2069 6e5f 642e 636f      df = in_d.co
+00019120: 7079 2829 0d0a 2020 2020 6466 2e63 6f6c  py()..    df.col
+00019130: 756d 6e73 203d 205b 7072 6566 6978 202b  umns = [prefix +
+00019140: 2063 6f6c 2066 6f72 2063 6f6c 2069 6e20   col for col in 
+00019150: 6466 2e63 6f6c 756d 6e73 5d0d 0a20 2020  df.columns]..   
+00019160: 2072 6574 7572 6e20 6466 0d0a 0d0a 0d0a   return df......
+00019170: 6465 6620 6372 6561 7465 5f74 2864 7329  def create_t(ds)
+00019180: 3a0d 0a20 2020 2072 6574 7572 6e20 2864  :..    return (d
+00019190: 7320 2d20 6473 2e6d 696e 2829 2920 2f20  s - ds.min()) / 
+000191a0: 2864 732e 6d61 7828 2920 2d20 6473 2e6d  (ds.max() - ds.m
+000191b0: 696e 2829 290d 0a0d 0a0d 0a23 2323 2323  in())......#####
+000191c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000191d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000191e0: 0d0a 2320 4a55 5354 204c 4541 5354 2053  ..# JUST LEAST S
+000191f0: 5155 4152 4553 2055 4e49 5641 5249 4154  QUARES UNIVARIAT
+00019200: 450d 0a23 2068 7474 7073 3a2f 2f73 7461  E..# https://sta
+00019210: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
+00019220: 7565 7374 696f 6e73 2f31 3736 3739 3134  uestions/1767914
+00019230: 302f 6d75 6c74 6970 6c65 2d6c 696e 6561  0/multiple-linea
+00019240: 722d 7265 6772 6573 7369 6f6e 2d77 6974  r-regression-wit
+00019250: 682d 7079 7468 6f6e 0d0a 0d0a 0d0a 6465  h-python......de
+00019260: 6620 6c73 7473 715f 736f 6c76 6528 582c  f lstsq_solve(X,
+00019270: 2079 2c20 6c61 6d62 3d31 2c20 6964 656e   y, lamb=1, iden
+00019280: 7469 7479 5f6d 6174 7269 783d 4e6f 6e65  tity_matrix=None
+00019290: 293a 0d0a 2020 2020 6966 2069 6465 6e74  ):..    if ident
+000192a0: 6974 795f 6d61 7472 6978 2069 7320 4e6f  ity_matrix is No
+000192b0: 6e65 3a0d 0a20 2020 2020 2020 2069 6465  ne:..        ide
+000192c0: 6e74 6974 795f 6d61 7472 6978 203d 206e  ntity_matrix = n
+000192d0: 702e 7a65 726f 7328 2858 2e73 6861 7065  p.zeros((X.shape
+000192e0: 5b31 5d2c 2058 2e73 6861 7065 5b31 5d29  [1], X.shape[1])
+000192f0: 290d 0a20 2020 2020 2020 206e 702e 6669  )..        np.fi
+00019300: 6c6c 5f64 6961 676f 6e61 6c28 6964 656e  ll_diagonal(iden
+00019310: 7469 7479 5f6d 6174 7269 782c 2031 290d  tity_matrix, 1).
+00019320: 0a20 2020 2020 2020 2069 6465 6e74 6974  .        identit
+00019330: 795f 6d61 7472 6978 5b30 2c20 305d 203d  y_matrix[0, 0] =
+00019340: 2030 0d0a 2020 2020 5874 585f 6c61 6d62   0..    XtX_lamb
+00019350: 203d 2058 2e54 2e64 6f74 2858 2920 2b20   = X.T.dot(X) + 
+00019360: 6c61 6d62 202a 2069 6465 6e74 6974 795f  lamb * identity_
+00019370: 6d61 7472 6978 0d0a 2020 2020 5874 5920  matrix..    XtY 
+00019380: 3d20 582e 542e 646f 7428 7929 0d0a 2020  = X.T.dot(y)..  
+00019390: 2020 7265 7475 726e 206e 702e 6c69 6e61    return np.lina
+000193a0: 6c67 2e73 6f6c 7665 2858 7458 5f6c 616d  lg.solve(XtX_lam
+000193b0: 622c 2058 7459 290d 0a0d 0a0d 0a64 6566  b, XtY)......def
+000193c0: 2063 6f73 745f 6675 6e63 7469 6f6e 5f6c   cost_function_l
+000193d0: 3128 7061 7261 6d73 2c20 582c 2079 293a  1(params, X, y):
+000193e0: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
+000193f0: 7375 6d28 6e70 2e61 6273 2879 202d 206e  sum(np.abs(y - n
+00019400: 702e 646f 7428 582c 2070 6172 616d 732e  p.dot(X, params.
+00019410: 7265 7368 6170 6528 582e 7368 6170 655b  reshape(X.shape[
+00019420: 315d 2c20 792e 7368 6170 655b 315d 2929  1], y.shape[1]))
+00019430: 2929 0d0a 0d0a 0d0a 6465 6620 636f 7374  ))......def cost
+00019440: 5f66 756e 6374 696f 6e5f 6c31 5f70 6f73  _function_l1_pos
+00019450: 6974 6976 6528 7061 7261 6d73 2c20 582c  itive(params, X,
+00019460: 2079 293a 0d0a 2020 2020 7265 7475 726e   y):..    return
+00019470: 206e 702e 7375 6d28 0d0a 2020 2020 2020   np.sum(..      
+00019480: 2020 6e70 2e61 6273 280d 0a20 2020 2020    np.abs(..     
+00019490: 2020 2020 2020 2079 0d0a 2020 2020 2020         y..      
+000194a0: 2020 2020 2020 2d20 6e70 2e64 6f74 2858        - np.dot(X
+000194b0: 2c20 6e70 2e77 6865 7265 2870 6172 616d  , np.where(param
+000194c0: 7320 3c20 302c 2030 2c20 7061 7261 6d73  s < 0, 0, params
+000194d0: 292e 7265 7368 6170 6528 582e 7368 6170  ).reshape(X.shap
+000194e0: 655b 315d 2c20 792e 7368 6170 655b 315d  e[1], y.shape[1]
+000194f0: 2929 0d0a 2020 2020 2020 2020 290d 0a20  ))..        ).. 
+00019500: 2020 2029 0d0a 0d0a 0d0a 2320 6163 7475     )......# actu
+00019510: 616c 6c79 2074 6869 7320 6973 206d 6f72  ally this is mor
+00019520: 6520 6c69 6b65 204d 4144 450d 0a64 6566  e like MADE..def
+00019530: 2063 6f73 745f 6675 6e63 7469 6f6e 5f64   cost_function_d
+00019540: 7761 6528 7061 7261 6d73 2c20 582c 2079  wae(params, X, y
+00019550: 293a 0d0a 2020 2020 4120 3d20 790d 0a20  ):..    A = y.. 
+00019560: 2020 2046 203d 206e 702e 646f 7428 582c     F = np.dot(X,
+00019570: 2070 6172 616d 732e 7265 7368 6170 6528   params.reshape(
+00019580: 582e 7368 6170 655b 315d 2c20 792e 7368  X.shape[1], y.sh
+00019590: 6170 655b 315d 2929 0d0a 2020 2020 6c61  ape[1]))..    la
+000195a0: 7374 5f6f 665f 6172 7261 7920 3d20 795b  st_of_array = y[
+000195b0: 5b30 5d20 2b20 6c69 7374 2872 616e 6765  [0] + list(range
+000195c0: 286c 656e 2879 2920 2d20 3129 295d 0d0a  (len(y) - 1))]..
+000195d0: 2020 2020 7265 7475 726e 206e 702e 7375      return np.su
+000195e0: 6d28 0d0a 2020 2020 2020 2020 6e70 2e6e  m(..        np.n
+000195f0: 616e 6d65 616e 280d 0a20 2020 2020 2020  anmean(..       
+00019600: 2020 2020 206e 702e 7768 6572 6528 0d0a       np.where(..
+00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019620: 6e70 2e73 6967 6e28 4620 2d20 6c61 7374  np.sign(F - last
+00019630: 5f6f 665f 6172 7261 7929 203d 3d20 6e70  _of_array) == np
+00019640: 2e73 6967 6e28 4120 2d20 6c61 7374 5f6f  .sign(A - last_o
+00019650: 665f 6172 7261 7929 2c0d 0a20 2020 2020  f_array),..     
+00019660: 2020 2020 2020 2020 2020 206e 702e 6162             np.ab
+00019670: 7328 4120 2d20 4629 2c0d 0a20 2020 2020  s(A - F),..     
+00019680: 2020 2020 2020 2020 2020 2028 6e70 2e61             (np.a
+00019690: 6273 2841 202d 2046 2920 2b20 3129 202a  bs(A - F) + 1) *
+000196a0: 2a20 322c 0d0a 2020 2020 2020 2020 2020  * 2,..          
+000196b0: 2020 292c 0d0a 2020 2020 2020 2020 2020    ),..          
+000196c0: 2020 6178 6973 3d30 2c0d 0a20 2020 2020    axis=0,..     
+000196d0: 2020 2029 0d0a 2020 2020 290d 0a0d 0a0d     )..    ).....
+000196e0: 0a64 6566 2063 6f73 745f 6675 6e63 7469  .def cost_functi
+000196f0: 6f6e 5f71 7561 6e74 696c 6528 7061 7261  on_quantile(para
+00019700: 6d73 2c20 582c 2079 2c20 713d 302e 3929  ms, X, y, q=0.9)
+00019710: 3a0d 0a20 2020 2063 7574 203d 2069 6e74  :..    cut = int
+00019720: 2879 2e73 6861 7065 5b30 5d20 2a20 7129  (y.shape[0] * q)
+00019730: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
+00019740: 7375 6d28 0d0a 2020 2020 2020 2020 6e70  sum(..        np
+00019750: 2e70 6172 7469 7469 6f6e 280d 0a20 2020  .partition(..   
+00019760: 2020 2020 2020 2020 206e 702e 6162 7328           np.abs(
+00019770: 7920 2d20 6e70 2e64 6f74 2858 2c20 7061  y - np.dot(X, pa
+00019780: 7261 6d73 2e72 6573 6861 7065 2858 2e73  rams.reshape(X.s
+00019790: 6861 7065 5b31 5d2c 2079 2e73 6861 7065  hape[1], y.shape
+000197a0: 5b31 5d29 2929 2c20 6375 742c 2061 7869  [1]))), cut, axi
+000197b0: 733d 300d 0a20 2020 2020 2020 2029 5b30  s=0..        )[0
+000197c0: 3a63 7574 5d0d 0a20 2020 2029 0d0a 0d0a  :cut]..    )....
+000197d0: 0d0a 6465 6620 636f 7374 5f66 756e 6374  ..def cost_funct
+000197e0: 696f 6e5f 6c32 2870 6172 616d 732c 2058  ion_l2(params, X
+000197f0: 2c20 7929 3a0d 0a20 2020 2072 6574 7572  , y):..    retur
+00019800: 6e20 6e70 2e6c 696e 616c 672e 6e6f 726d  n np.linalg.norm
+00019810: 2879 202d 206e 702e 646f 7428 582c 2070  (y - np.dot(X, p
+00019820: 6172 616d 732e 7265 7368 6170 6528 582e  arams.reshape(X.
+00019830: 7368 6170 655b 315d 2c20 792e 7368 6170  shape[1], y.shap
+00019840: 655b 315d 2929 290d 0a0d 0a0d 0a23 2063  e[1])))......# c
+00019850: 6f75 6c64 2064 6f20 7061 7274 6961 6c20  ould do partial 
+00019860: 706f 6f6c 696e 6720 6279 206d 696e 696d  pooling by minim
+00019870: 697a 696e 6720 6120 6675 6e63 7469 6f6e  izing a function
+00019880: 2074 6861 7420 6d69 7865 7320 7368 6172   that mixes shar
+00019890: 6564 2061 6e64 2075 6e73 6861 7265 6420  ed and unshared 
+000198a0: 636f 6566 6669 6369 656e 7473 2028 6d75  coefficients (mu
+000198b0: 6c74 6970 6c69 6361 7469 7665 290d 0a64  ltiplicative)..d
+000198c0: 6566 206c 7374 7371 5f6d 696e 696d 697a  ef lstsq_minimiz
+000198d0: 6528 582c 2079 2c20 6d61 7869 7465 723d  e(X, y, maxiter=
+000198e0: 3135 3030 302c 2063 6f73 745f 6675 6e63  15000, cost_func
+000198f0: 7469 6f6e 3d22 6c31 2229 3a0d 0a20 2020  tion="l1"):..   
+00019900: 2022 2222 416e 7920 636f 7374 2066 756e   """Any cost fun
+00019910: 6374 696f 6e20 7665 7273 696f 6e20 6f66  ction version of
+00019920: 206c 696e 2072 6567 2e22 2222 0d0a 2020   lin reg."""..  
+00019930: 2020 2320 7374 6172 7420 7769 7468 206c    # start with l
+00019940: 7374 7371 2066 6974 2061 7320 6573 7469  stsq fit as esti
+00019950: 6d61 7465 6420 706f 696e 740d 0a20 2020  mated point..   
+00019960: 2078 3020 3d20 6c73 7473 715f 736f 6c76   x0 = lstsq_solv
+00019970: 6528 582c 2079 292e 666c 6174 7465 6e28  e(X, y).flatten(
+00019980: 290d 0a20 2020 2023 2061 7373 756d 696e  )..    # assumin
+00019990: 6720 7363 616c 6564 2c20 7468 6573 6520  g scaled, these 
+000199a0: 7368 6f75 6c64 2062 6520 7265 6173 6f6e  should be reason
+000199b0: 6162 6c65 2062 6f75 6e64 730d 0a20 2020  able bounds..   
+000199c0: 2062 6f75 6e64 7320 3d20 5b28 2d31 302c   bounds = [(-10,
+000199d0: 2031 3029 2066 6f72 2078 2069 6e20 7830   10) for x in x0
+000199e0: 5d0d 0a20 2020 2069 6620 636f 7374 5f66  ]..    if cost_f
+000199f0: 756e 6374 696f 6e20 3d3d 2022 6477 6165  unction == "dwae
+00019a00: 223a 0d0a 2020 2020 2020 2020 626f 756e  ":..        boun
+00019a10: 6473 203d 205b 282d 302e 352c 2031 3029  ds = [(-0.5, 10)
+00019a20: 2066 6f72 2078 2069 6e20 7830 5d0d 0a20   for x in x0].. 
+00019a30: 2020 2020 2020 2063 6f73 745f 6675 6e63         cost_func
+00019a40: 203d 2063 6f73 745f 6675 6e63 7469 6f6e   = cost_function
+00019a50: 5f64 7761 650d 0a20 2020 2065 6c69 6620  _dwae..    elif 
+00019a60: 636f 7374 5f66 756e 6374 696f 6e20 3d3d  cost_function ==
+00019a70: 2022 7175 616e 7469 6c65 223a 0d0a 2020   "quantile":..  
+00019a80: 2020 2020 2020 636f 7374 5f66 756e 6320        cost_func 
+00019a90: 3d20 636f 7374 5f66 756e 6374 696f 6e5f  = cost_function_
+00019aa0: 7175 616e 7469 6c65 0d0a 2020 2020 656c  quantile..    el
+00019ab0: 6966 2063 6f73 745f 6675 6e63 7469 6f6e  if cost_function
+00019ac0: 203d 3d20 226c 315f 706f 7369 7469 7665   == "l1_positive
+00019ad0: 223a 0d0a 2020 2020 2020 2020 626f 756e  ":..        boun
+00019ae0: 6473 203d 205b 2830 2c20 3130 2920 666f  ds = [(0, 10) fo
+00019af0: 7220 7820 696e 2078 305d 0d0a 2020 2020  r x in x0]..    
+00019b00: 2020 2020 636f 7374 5f66 756e 6320 3d20      cost_func = 
+00019b10: 636f 7374 5f66 756e 6374 696f 6e5f 6c31  cost_function_l1
+00019b20: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+00019b30: 2020 2020 2063 6f73 745f 6675 6e63 203d       cost_func =
+00019b40: 2063 6f73 745f 6675 6e63 7469 6f6e 5f6c   cost_function_l
+00019b50: 310d 0a20 2020 2072 6574 7572 6e20 6d69  1..    return mi
+00019b60: 6e69 6d69 7a65 280d 0a20 2020 2020 2020  nimize(..       
+00019b70: 2063 6f73 745f 6675 6e63 2c20 7830 2c20   cost_func, x0, 
+00019b80: 6172 6773 3d28 582c 2079 292c 2062 6f75  args=(X, y), bou
+00019b90: 6e64 733d 626f 756e 6473 2c20 6f70 7469  nds=bounds, opti
+00019ba0: 6f6e 733d 7b27 6d61 7869 7465 7227 3a20  ons={'maxiter': 
+00019bb0: 6d61 7869 7465 727d 0d0a 2020 2020 292e  maxiter}..    ).
+00019bc0: 782e 7265 7368 6170 6528 582e 7368 6170  x.reshape(X.shap
+00019bd0: 655b 315d 2c20 792e 7368 6170 655b 315d  e[1], y.shape[1]
+00019be0: 290d 0a0d 0a0d 0a64 6566 206c 696e 6561  )......def linea
+00019bf0: 725f 6d6f 6465 6c28 782c 2079 2c20 7061  r_model(x, y, pa
+00019c00: 7261 6d73 293a 0d0a 2020 2020 6d6f 6465  rams):..    mode
+00019c10: 6c5f 7479 7065 203d 2070 6172 616d 732e  l_type = params.
+00019c20: 6765 7428 226d 6f64 656c 222c 2022 6c73  get("model", "ls
+00019c30: 7473 7122 290d 0a20 2020 206c 616d 6264  tsq")..    lambd
+00019c40: 203d 2070 6172 616d 732e 6765 7428 226c   = params.get("l
+00019c50: 616d 6264 6122 2c20 4e6f 6e65 290d 0a20  ambda", None).. 
+00019c60: 2020 2072 6563 203d 2070 6172 616d 732e     rec = params.
+00019c70: 6765 7428 2272 6563 656e 6379 5f77 6569  get("recency_wei
+00019c80: 6768 7469 6e67 222c 204e 6f6e 6529 0d0a  ghting", None)..
+00019c90: 2020 2020 6966 206c 616d 6264 2069 7320      if lambd is 
+00019ca0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00019cb0: 2020 2069 645f 6d61 7420 3d20 6e70 2e7a     id_mat = np.z
+00019cc0: 6572 6f73 2828 782e 7368 6170 655b 315d  eros((x.shape[1]
+00019cd0: 2c20 782e 7368 6170 655b 315d 2929 0d0a  , x.shape[1]))..
+00019ce0: 2020 2020 2020 2020 6e70 2e66 696c 6c5f          np.fill_
+00019cf0: 6469 6167 6f6e 616c 2869 645f 6d61 742c  diagonal(id_mat,
+00019d00: 2031 290d 0a20 2020 2020 2020 2069 645f   1)..        id_
+00019d10: 6d61 745b 302c 2030 5d20 3d20 300d 0a20  mat[0, 0] = 0.. 
+00019d20: 2020 2069 6620 7265 6320 6973 206e 6f74     if rec is not
+00019d30: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00019d40: 7765 6967 6874 7320 3d20 286e 702e 6172  weights = (np.ar
+00019d50: 616e 6765 286c 656e 2878 2929 202b 2031  ange(len(x)) + 1
+00019d60: 2920 2a2a 2072 6563 2020 2320 302e 3035  ) ** rec  # 0.05
+00019d70: 202d 2030 2e32 350d 0a20 2020 2020 2020   - 0.25..       
+00019d80: 2078 203d 2078 202a 2077 6569 6768 7473   x = x * weights
+00019d90: 5b2e 2e2e 2c20 4e6f 6e65 5d0d 0a20 2020  [..., None]..   
+00019da0: 2020 2020 2079 203d 206e 702e 6173 6172       y = np.asar
+00019db0: 7261 7928 7929 202a 2077 6569 6768 7473  ray(y) * weights
+00019dc0: 5b2e 2e2e 2c20 4e6f 6e65 5d0d 0a20 2020  [..., None]..   
+00019dd0: 2069 6620 6d6f 6465 6c5f 7479 7065 203d   if model_type =
+00019de0: 3d20 226c 7374 7371 223a 0d0a 2020 2020  = "lstsq":..    
+00019df0: 2020 2020 6966 206c 616d 6264 2069 7320      if lambd is 
+00019e00: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00019e10: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+00019e20: 2e6c 696e 616c 672e 6c73 7473 7128 782e  .linalg.lstsq(x.
+00019e30: 542e 646f 7428 7829 202b 206c 616d 6264  T.dot(x) + lambd
+00019e40: 202a 2069 645f 6d61 742c 2078 2e54 2e64   * id_mat, x.T.d
+00019e50: 6f74 2879 292c 2072 636f 6e64 3d4e 6f6e  ot(y), rcond=Non
+00019e60: 6529 5b0d 0a20 2020 2020 2020 2020 2020  e)[..           
+00019e70: 2020 2020 2030 0d0a 2020 2020 2020 2020       0..        
+00019e80: 2020 2020 5d0d 0a20 2020 2020 2020 2065      ]..        e
+00019e90: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00019ea0: 2020 7265 7475 726e 206e 702e 6c69 6e61    return np.lina
+00019eb0: 6c67 2e6c 7374 7371 2878 2c20 792c 2072  lg.lstsq(x, y, r
+00019ec0: 636f 6e64 3d4e 6f6e 6529 5b30 5d0d 0a20  cond=None)[0].. 
+00019ed0: 2020 2065 6c69 6620 6d6f 6465 6c5f 7479     elif model_ty
+00019ee0: 7065 203d 3d20 226c 696e 616c 675f 736f  pe == "linalg_so
+00019ef0: 6c76 6522 3a0d 0a20 2020 2020 2020 2072  lve":..        r
+00019f00: 6574 7572 6e20 6c73 7473 715f 736f 6c76  eturn lstsq_solv
+00019f10: 6528 782c 2079 2c20 6c61 6d62 3d6c 616d  e(x, y, lamb=lam
+00019f20: 6264 2c20 6964 656e 7469 7479 5f6d 6174  bd, identity_mat
+00019f30: 7269 783d 6964 5f6d 6174 290d 0a20 2020  rix=id_mat)..   
+00019f40: 2065 6c69 6620 6d6f 6465 6c5f 7479 7065   elif model_type
+00019f50: 203d 3d20 226c 315f 6e6f 726d 223a 0d0a   == "l1_norm":..
+00019f60: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00019f70: 7374 7371 5f6d 696e 696d 697a 6528 0d0a  stsq_minimize(..
+00019f80: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
+00019f90: 7361 7272 6179 2878 292c 0d0a 2020 2020  sarray(x),..    
+00019fa0: 2020 2020 2020 2020 6e70 2e61 7361 7272          np.asarr
+00019fb0: 6179 2879 292c 0d0a 2020 2020 2020 2020  ay(y),..        
+00019fc0: 2020 2020 6d61 7869 7465 723d 7061 7261      maxiter=para
+00019fd0: 6d73 2e67 6574 2822 6d61 7869 7465 7222  ms.get("maxiter"
+00019fe0: 2c20 3135 3030 3029 2c0d 0a20 2020 2020  , 15000),..     
+00019ff0: 2020 2020 2020 2063 6f73 745f 6675 6e63         cost_func
+0001a000: 7469 6f6e 3d22 6c31 222c 0d0a 2020 2020  tion="l1",..    
+0001a010: 2020 2020 290d 0a20 2020 2065 6c69 6620      )..    elif 
+0001a020: 6d6f 6465 6c5f 7479 7065 203d 3d20 2271  model_type == "q
+0001a030: 7561 6e74 696c 655f 6e6f 726d 223a 0d0a  uantile_norm":..
+0001a040: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0001a050: 7374 7371 5f6d 696e 696d 697a 6528 0d0a  stsq_minimize(..
+0001a060: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
+0001a070: 7361 7272 6179 2878 292c 0d0a 2020 2020  sarray(x),..    
+0001a080: 2020 2020 2020 2020 6e70 2e61 7361 7272          np.asarr
+0001a090: 6179 2879 292c 0d0a 2020 2020 2020 2020  ay(y),..        
+0001a0a0: 2020 2020 6d61 7869 7465 723d 7061 7261      maxiter=para
+0001a0b0: 6d73 2e67 6574 2822 6d61 7869 7465 7222  ms.get("maxiter"
+0001a0c0: 2c20 3135 3030 3029 2c0d 0a20 2020 2020  , 15000),..     
+0001a0d0: 2020 2020 2020 2063 6f73 745f 6675 6e63         cost_func
+0001a0e0: 7469 6f6e 3d22 7175 616e 7469 6c65 222c  tion="quantile",
+0001a0f0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0001a100: 2065 6c69 6620 6d6f 6465 6c5f 7479 7065   elif model_type
+0001a110: 203d 3d20 2264 7761 655f 6e6f 726d 223a   == "dwae_norm":
+0001a120: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a130: 206c 7374 7371 5f6d 696e 696d 697a 6528   lstsq_minimize(
+0001a140: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
+0001a150: 2e61 7361 7272 6179 2878 292c 0d0a 2020  .asarray(x),..  
+0001a160: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
+0001a170: 7272 6179 2879 292c 0d0a 2020 2020 2020  rray(y),..      
+0001a180: 2020 2020 2020 6d61 7869 7465 723d 7061        maxiter=pa
+0001a190: 7261 6d73 2e67 6574 2822 6d61 7869 7465  rams.get("maxite
+0001a1a0: 7222 2c20 3135 3030 3029 2c0d 0a20 2020  r", 15000),..   
+0001a1b0: 2020 2020 2020 2020 2063 6f73 745f 6675           cost_fu
+0001a1c0: 6e63 7469 6f6e 3d22 6477 6165 222c 0d0a  nction="dwae",..
+0001a1d0: 2020 2020 2020 2020 290d 0a20 2020 2065          )..    e
+0001a1e0: 6c69 6620 6d6f 6465 6c5f 7479 7065 203d  lif model_type =
+0001a1f0: 3d20 226c 315f 706f 7369 7469 7665 223a  = "l1_positive":
+0001a200: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001a210: 206c 7374 7371 5f6d 696e 696d 697a 6528   lstsq_minimize(
+0001a220: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
+0001a230: 2e61 7361 7272 6179 2878 292c 0d0a 2020  .asarray(x),..  
+0001a240: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
+0001a250: 7272 6179 2879 292c 0d0a 2020 2020 2020  rray(y),..      
+0001a260: 2020 2020 2020 6d61 7869 7465 723d 7061        maxiter=pa
+0001a270: 7261 6d73 2e67 6574 2822 6d61 7869 7465  rams.get("maxite
+0001a280: 7222 2c20 3135 3030 3029 2c0d 0a20 2020  r", 15000),..   
+0001a290: 2020 2020 2020 2020 2063 6f73 745f 6675           cost_fu
+0001a2a0: 6e63 7469 6f6e 3d22 6c31 5f70 6f73 6974  nction="l1_posit
+0001a2b0: 6976 6522 2c0d 0a20 2020 2020 2020 2029  ive",..        )
+0001a2c0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0001a2d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0001a2e0: 4572 726f 7228 226c 696e 6561 7220 6d6f  Error("linear mo
+0001a2f0: 6465 6c20 6e6f 7420 7265 636f 676e 697a  del not recogniz
+0001a300: 6564 2229 0d0a 0d0a 0d0a 2320 5365 6173  ed")......# Seas
+0001a310: 6f6e 616c 6974 6965 730d 0a23 2069 6e74  onalities..# int
+0001a320: 6572 6163 7469 6f6e 2065 6666 6563 7420  eraction effect 
+0001a330: 6f6e 6c79 206f 6e20 6669 7273 7420 7477  only on first tw
+0001a340: 6f20 7365 6173 6f6e 616c 6974 6965 7320  o seasonalities 
+0001a350: 6966 206f 7264 6572 206d 6174 6368 6573  if order matches
+0001a360: 0d0a 0d0a 2320 4361 7465 676f 7269 6361  ....# Categorica
+0001a370: 6c20 4665 6174 7572 6573 0d0a 2320 286d  l Features..# (m
+0001a380: 756c 7469 7661 7269 6174 6520 7375 6d6d  ultivariate summ
+0001a390: 6172 6965 7320 6279 2067 726f 7570 290d  aries by group).
+0001a3a0: 0a0d 0a23 2070 6173 7420 696d 7061 6374  ...# past impact
+0001a3b0: 7320 286f 7074 696f 6e20 746f 206e 6f74  s (option to not
+0001a3c0: 2065 6e66 6f72 6365 2c20 6f6e 6c79 2073   enforce, only s
+0001a3d0: 686f 7729 0d0a 0d0a 2320 7768 6174 2069  how)....# what i
+0001a3e0: 7320 7374 696c 6c20 6e65 6564 6564 3a0d  s still needed:.
+0001a3f0: 0a23 2062 6179 6573 6961 6e20 6c69 6e65  .# bayesian line
+0001a400: 6172 206d 6f64 656c 206f 7074 696f 6e73  ar model options
+0001a410: 0d0a 2320 6d6f 7265 206d 756c 7469 7661  ..# more multiva
+0001a420: 7269 6174 6520 7375 6d6d 6172 6965 730d  riate summaries.
+0001a430: 0a23 2061 6464 2061 6e6f 6d61 6c79 2063  .# add anomaly c
+0001a440: 6c61 7373 6966 6965 7220 746f 2066 6f72  lassifier to for
+0001a450: 6563 6173 740d 0a23 2072 6566 696e 6520  ecast..# refine 
+0001a460: 7472 616e 7366 6f72 6d61 7469 6f6e 7320  transformations 
+0001a470: 616e 6420 6d6f 6465 6c73 2067 656e 6572  and models gener
+0001a480: 6174 6564 2062 7920 6765 745f 6e65 775f  ated by get_new_
+0001a490: 7061 7261 6d73 0d0a 2320 7265 7765 6967  params..# reweig
+0001a4a0: 6874 2073 6f20 6c6f 6f70 2069 7320 6e6f  ht so loop is no
+0001a4b0: 7420 7265 7175 6972 6564 2073 6f20 6f66  t required so of
+0001a4c0: 7465 6e0d 0a23 2074 6573 7420 616e 6420  ten..# test and 
+0001a4d0: 6275 6720 6669 7820 6576 6572 7974 6869  bug fix everythi
+0001a4e0: 6e67 0d0a 2320 6c31 5f6e 6f72 6d20 6973  ng..# l1_norm is
+0001a4f0: 6e27 7420 776f 726b 696e 670d 0a23 2075  n't working..# u
+0001a500: 6e69 7474 6573 7473 0d0a 0d0a 2320 5445  nittests....# TE
+0001a510: 5354 0d0a 2320 6e65 775f 6466 0d0a 0d0a  ST..# new_df....
+0001a520: 2320 636f 756c 6420 646f 2070 6172 7469  # could do parti
+0001a530: 616c 2070 6f6f 6c69 6e67 2062 7920 6d69  al pooling by mi
+0001a540: 6e69 6d69 7a69 6e67 2061 2066 756e 6374  nimizing a funct
+0001a550: 696f 6e20 7468 6174 206d 6978 6573 2073  ion that mixes s
+0001a560: 6861 7265 6420 616e 6420 756e 7368 6172  hared and unshar
+0001a570: 6564 2063 6f65 6666 6963 6965 6e74 7320  ed coefficients 
+0001a580: 286d 756c 7469 706c 6963 6174 6976 6529  (multiplicative)
+0001a590: 0d0a 0d0a 2320 7365 6172 6368 2073 7061  ....# search spa
+0001a5a0: 6365 3a0d 0a23 2066 6173 7420 6f6e 206c  ce:..# fast on l
+0001a5b0: 7374 7371 7320 6d6f 6465 6c0d 0a23 2066  stsqs model..# f
+0001a5c0: 756c 6c20 7365 6172 6368 206f 6620 7072  ull search of pr
+0001a5d0: 6564 6566 696e 6564 206f 7074 696f 6e73  edefined options
+0001a5e0: 0d0a 2320 7363 6970 7920 6d69 6e69 6d69  ..# scipy minimi
+0001a5f0: 7a65 2066 6f72 2063 6f6e 7469 6e75 6f75  ze for continuou
+0001a600: 7320 7061 7261 6d73 2c20 6f72 206d 6179  s params, or may
+0001a610: 6265 2069 6e74 2870 6172 616d 2920 666f  be int(param) fo
+0001a620: 7220 6469 7363 7265 7465 2074 6f6f 0d0a  r discrete too..
+0001a630: 2320 6d69 6e69 6d69 7a65 2077 6f72 6b69  # minimize worki
+0001a640: 6e67 2066 6f72 2072 6f6c 6c69 6e67 2077  ng for rolling w
+0001a650: 696e 646f 7720 7369 7a65 2062 7574 206e  indow size but n
+0001a660: 6f74 2066 6f72 2073 6561 736f 6e61 6c69  ot for seasonali
+0001a670: 7479 2028 6163 7475 616c 6c79 2070 726f  ty (actually pro
+0001a680: 6261 626c 7920 7769 6e64 6f77 2069 7320  bably window is 
+0001a690: 6f76 6572 6669 7429 0d0a 2320 646f 2069  overfit)..# do i
+0001a6a0: 7420 7374 6570 7769 7365 3a0d 0a23 2066  t stepwise:..# f
+0001a6b0: 6972 7374 2066 6974 2073 6561 736f 6e61  irst fit seasona
+0001a6c0: 6c69 7479 2028 7769 7468 2066 6c61 6720  lity (with flag 
+0001a6d0: 7265 6772 6573 736f 7273 2062 7574 206e  regressors but n
+0001a6e0: 6f74 206f 7468 6572 7329 0d0a 2320 7365  ot others)..# se
+0001a6f0: 636f 6e64 6c79 2073 6361 6c65 7273 2061  condly scalers a
+0001a700: 6e64 2070 7265 7072 6f63 6573 7369 6e67  nd preprocessing
+0001a710: 2041 4e44 2061 6e6f 6d61 6c79 2064 6574   AND anomaly det
+0001a720: 6563 7469 6f6e 2041 4e44 2068 6f6c 6964  ection AND holid
+0001a730: 6179 2064 6574 6563 7469 6f6e 0d0a 2320  ay detection..# 
+0001a740: 706f 7373 6962 6c79 2061 6464 2033 7264  possibly add 3rd
+0001a750: 2073 6561 736f 6e61 6c69 7479 2061 6674   seasonality aft
+0001a760: 6572 2070 7265 7072 6f63 6573 7369 6e67  er preprocessing
+0001a770: 0d0a 2320 7468 6972 646c 7920 726f 6c6c  ..# thirdly roll
+0001a780: 696e 6720 7769 6e64 6f77 2073 697a 6520  ing window size 
+0001a790: 2869 6e63 6c75 6465 2072 6f6c 6c69 6e67  (include rolling
+0001a7a0: 2077 696e 646f 7720 696e 2069 6e69 7469   window in initi
+0001a7b0: 616c 2058 2061 6674 6572 2074 6869 7329  al X after this)
+0001a7c0: 0d0a 2320 7468 656e 2074 6573 7420 7573  ..# then test us
+0001a7d0: 6572 2072 6567 7265 7373 6f72 2061 6e64  er regressor and
+0001a7e0: 2070 7265 7072 6f63 6573 7369 6e67 0d0a   preprocessing..
+0001a7f0: 2320 7468 656e 2074 6573 7420 4152 206c  # then test AR l
+0001a800: 6167 7320 2864 6f6e 2774 2075 7365 2069  ags (don't use i
+0001a810: 6620 2520 6761 696e 2069 7320 3c20 7820  f % gain is < x 
+0001a820: 2529 0d0a 2320 6f72 206d 6179 6265 2075  %)..# or maybe u
+0001a830: 7365 2061 2072 756e 7469 6d65 2077 6569  se a runtime wei
+0001a840: 6768 7469 6e67 0d0a 2320 7468 656e 206d  ghting..# then m
+0001a850: 756c 7469 7661 7269 6174 6520 7375 6d6d  ultivariate summ
+0001a860: 6172 6965 730d 0a23 2046 494e 414c 4c59  aries..# FINALLY
+0001a870: 2063 6f76 6172 6961 7465 206c 6167 7320   covariate lags 
+0001a880: 2866 6561 7475 7265 2073 656c 6563 7469  (feature selecti
+0001a890: 6f6e 2064 6566 696e 6974 656c 7920 6e65  on definitely ne
+0001a8a0: 6564 6564 290d 0a0d 0a0d 0a69 6620 4661  eded)......if Fa
+0001a8b0: 6c73 653a 0d0a 2020 2020 2320 7465 7374  lse:..    # test
+0001a8c0: 2068 6f6c 6964 6179 2063 6f75 6e74 7269   holiday countri
+0001a8d0: 6573 2c20 7265 6772 6573 736f 7273 2c20  es, regressors, 
+0001a8e0: 696d 7061 6374 730d 0a20 2020 2066 726f  impacts..    fro
+0001a8f0: 6d20 6175 746f 7473 2069 6d70 6f72 7420  m autots import 
+0001a900: 6c6f 6164 5f64 6169 6c79 0d0a 2020 2020  load_daily..    
+0001a910: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+0001a920: 622e 7079 706c 6f74 2061 7320 706c 740d  b.pyplot as plt.
+0001a930: 0a0d 0a20 2020 2063 6174 6567 6f72 6963  ...    categoric
+0001a940: 616c 5f67 726f 7570 7320 3d20 7b0d 0a20  al_groups = {.. 
+0001a950: 2020 2020 2020 2022 7769 6b69 5f55 6e69         "wiki_Uni
+0001a960: 7465 645f 5374 6174 6573 223a 2027 636f  ted_States": 'co
+0001a970: 756e 7472 7927 2c0d 0a20 2020 2020 2020  untry',..       
+0001a980: 2022 7769 6b69 5f47 6572 6d61 6e79 223a   "wiki_Germany":
+0001a990: 2027 636f 756e 7472 7927 2c0d 0a20 2020   'country',..   
+0001a9a0: 2020 2020 2022 7769 6b69 5f4a 6573 7573       "wiki_Jesus
+0001a9b0: 223a 2027 686f 6c69 6461 7927 2c0d 0a20  ": 'holiday',.. 
+0001a9c0: 2020 2020 2020 2022 7769 6b69 5f4d 6963         "wiki_Mic
+0001a9d0: 6861 656c 5f4a 6163 6b73 6f6e 223a 2027  hael_Jackson": '
+0001a9e0: 7065 7273 6f6e 272c 0d0a 2020 2020 2020  person',..      
+0001a9f0: 2020 2277 696b 695f 4561 7374 6572 223a    "wiki_Easter":
+0001aa00: 2027 686f 6c69 6461 7927 2c0d 0a20 2020   'holiday',..   
+0001aa10: 2020 2020 2022 7769 6b69 5f43 6872 6973       "wiki_Chris
+0001aa20: 746d 6173 223a 2027 686f 6c69 6461 7927  tmas": 'holiday'
+0001aa30: 2c0d 0a20 2020 2020 2020 2022 7769 6b69  ,..        "wiki
+0001aa40: 5f43 6869 6e65 7365 5f4e 6577 5f59 6561  _Chinese_New_Yea
+0001aa50: 7222 3a20 2768 6f6c 6964 6179 272c 0d0a  r": 'holiday',..
+0001aa60: 2020 2020 2020 2020 2277 696b 695f 5468          "wiki_Th
+0001aa70: 616e 6b73 6769 7669 6e67 223a 2027 686f  anksgiving": 'ho
+0001aa80: 6c69 6461 7927 2c0d 0a20 2020 2020 2020  liday',..       
+0001aa90: 2022 7769 6b69 5f45 6c69 7a61 6265 7468   "wiki_Elizabeth
+0001aaa0: 5f49 4922 3a20 2770 6572 736f 6e27 2c0d  _II": 'person',.
+0001aab0: 0a20 2020 2020 2020 2022 7769 6b69 5f57  .        "wiki_W
+0001aac0: 696c 6c69 616d 5f53 6861 6b65 7370 6561  illiam_Shakespea
+0001aad0: 7265 223a 2027 7065 7273 6f6e 272c 0d0a  re": 'person',..
+0001aae0: 2020 2020 2020 2020 2277 696b 695f 4765          "wiki_Ge
+0001aaf0: 6f72 6765 5f57 6173 6869 6e67 746f 6e22  orge_Washington"
+0001ab00: 3a20 2770 6572 736f 6e27 2c0d 0a20 2020  : 'person',..   
+0001ab10: 2020 2020 2022 7769 6b69 5f43 6c65 6f70       "wiki_Cleop
+0001ab20: 6174 7261 223a 2027 7065 7273 6f6e 272c  atra": 'person',
+0001ab30: 0d0a 2020 2020 7d0d 0a20 2020 2068 6f6c  ..    }..    hol
+0001ab40: 6964 6179 5f63 6f75 6e74 7269 6573 203d  iday_countries =
+0001ab50: 207b 0d0a 2020 2020 2020 2020 2777 696b   {..        'wik
+0001ab60: 695f 456c 697a 6162 6574 685f 4949 273a  i_Elizabeth_II':
+0001ab70: 2027 756b 272c 0d0a 2020 2020 2020 2020   'uk',..        
+0001ab80: 2777 696b 695f 556e 6974 6564 5f53 7461  'wiki_United_Sta
+0001ab90: 7465 7327 3a20 2775 7327 2c0d 0a20 2020  tes': 'us',..   
+0001aba0: 2020 2020 2027 7769 6b69 5f47 6572 6d61       'wiki_Germa
+0001abb0: 6e79 273a 2027 6465 272c 0d0a 2020 2020  ny': 'de',..    
+0001abc0: 7d0d 0a20 2020 2064 665f 6461 696c 7920  }..    df_daily 
+0001abd0: 3d20 6c6f 6164 5f64 6169 6c79 286c 6f6e  = load_daily(lon
+0001abe0: 673d 4661 6c73 6529 0d0a 2020 2020 2320  g=False)..    # 
+0001abf0: 6164 6420 6e61 6e0d 0a20 2020 2064 665f  add nan..    df_
+0001ac00: 6461 696c 792e 696c 6f63 5b31 3030 2c20  daily.iloc[100, 
+0001ac10: 3a5d 203d 206e 702e 6e61 6e0d 0a20 2020  :] = np.nan..   
+0001ac20: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
+0001ac30: 203d 2031 3830 0d0a 2020 2020 696e 636c   = 180..    incl
+0001ac40: 7564 655f 6869 7374 6f72 7920 3d20 5472  ude_history = Tr
+0001ac50: 7565 0d0a 2020 2020 6466 5f74 7261 696e  ue..    df_train
+0001ac60: 203d 2064 665f 6461 696c 795b 3a2d 666f   = df_daily[:-fo
+0001ac70: 7265 6361 7374 5f6c 656e 6774 685d 2e69  recast_length].i
+0001ac80: 6c6f 635b 3a2c 2031 3a5d 0d0a 2020 2020  loc[:, 1:]..    
+0001ac90: 6466 5f74 6573 7420 3d20 6466 5f64 6169  df_test = df_dai
+0001aca0: 6c79 5b2d 666f 7265 6361 7374 5f6c 656e  ly[-forecast_len
+0001acb0: 6774 683a 5d2e 696c 6f63 5b3a 2c20 313a  gth:].iloc[:, 1:
+0001acc0: 5d0d 0a20 2020 2066 616b 655f 7265 6772  ]..    fake_regr
+0001acd0: 203d 2064 665f 6461 696c 795b 3a2d 666f   = df_daily[:-fo
+0001ace0: 7265 6361 7374 5f6c 656e 6774 685d 2e69  recast_length].i
+0001acf0: 6c6f 635b 3a2c 2030 3a31 5d0d 0a20 2020  loc[:, 0:1]..   
+0001ad00: 2066 616b 655f 7265 6772 5f66 6373 7420   fake_regr_fcst 
+0001ad10: 3d20 280d 0a20 2020 2020 2020 2064 665f  = (..        df_
+0001ad20: 6461 696c 792e 696c 6f63 5b3a 2c20 303a  daily.iloc[:, 0:
+0001ad30: 315d 0d0a 2020 2020 2020 2020 6966 2069  1]..        if i
+0001ad40: 6e63 6c75 6465 5f68 6973 746f 7279 0d0a  nclude_history..
+0001ad50: 2020 2020 2020 2020 656c 7365 2064 665f          else df_
+0001ad60: 6461 696c 795b 2d66 6f72 6563 6173 745f  daily[-forecast_
+0001ad70: 6c65 6e67 7468 3a5d 2e69 6c6f 635b 3a2c  length:].iloc[:,
+0001ad80: 2030 3a31 5d0d 0a20 2020 2029 0d0a 2020   0:1]..    )..  
+0001ad90: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
+0001ada0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+0001adb0: 312c 2069 6e64 6578 3d66 616b 655f 7265  1, index=fake_re
+0001adc0: 6772 2e69 6e64 6578 2c20 636f 6c75 6d6e  gr.index, column
+0001add0: 733d 5b22 666c 6167 5f74 6573 7422 5d29  s=["flag_test"])
+0001ade0: 0d0a 2020 2020 666c 6167 5f72 6567 7265  ..    flag_regre
+0001adf0: 7373 6f72 5f66 6373 7420 3d20 7064 2e44  ssor_fcst = pd.D
+0001ae00: 6174 6146 7261 6d65 280d 0a20 2020 2020  ataFrame(..     
+0001ae10: 2020 2031 2c20 696e 6465 783d 6661 6b65     1, index=fake
+0001ae20: 5f72 6567 725f 6663 7374 2e69 6e64 6578  _regr_fcst.index
+0001ae30: 2c20 636f 6c75 6d6e 733d 5b22 666c 6167  , columns=["flag
+0001ae40: 5f74 6573 7422 5d0d 0a20 2020 2029 0d0a  _test"]..    )..
+0001ae50: 2020 2020 7265 6772 5f70 6572 5f73 6572      regr_per_ser
+0001ae60: 6965 7320 3d20 7b0d 0a20 2020 2020 2020  ies = {..       
+0001ae70: 2073 7472 2864 665f 7472 6169 6e2e 636f   str(df_train.co
+0001ae80: 6c75 6d6e 735b 305d 293a 2070 642e 4461  lumns[0]): pd.Da
+0001ae90: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
+0001aea0: 2020 2020 2020 6e70 2e72 616e 646f 6d2e        np.random.
+0001aeb0: 6e6f 726d 616c 2873 697a 653d 286c 656e  normal(size=(len
+0001aec0: 2864 665f 7472 6169 6e29 2c20 3129 292c  (df_train), 1)),
+0001aed0: 2069 6e64 6578 3d64 665f 7472 6169 6e2e   index=df_train.
+0001aee0: 696e 6465 780d 0a20 2020 2020 2020 2029  index..        )
+0001aef0: 0d0a 2020 2020 7d0d 0a20 2020 2072 6567  ..    }..    reg
+0001af00: 725f 7065 725f 7365 7269 6573 5f66 6373  r_per_series_fcs
+0001af10: 7420 3d20 7b0d 0a20 2020 2020 2020 2073  t = {..        s
+0001af20: 7472 2864 665f 7472 6169 6e2e 636f 6c75  tr(df_train.colu
+0001af30: 6d6e 735b 305d 293a 2070 642e 4461 7461  mns[0]): pd.Data
+0001af40: 4672 616d 6528 0d0a 2020 2020 2020 2020  Frame(..        
+0001af50: 2020 2020 6e70 2e72 616e 646f 6d2e 6e6f      np.random.no
+0001af60: 726d 616c 2873 697a 653d 2866 6f72 6563  rmal(size=(forec
+0001af70: 6173 745f 6c65 6e67 7468 2c20 3129 292c  ast_length, 1)),
+0001af80: 2069 6e64 6578 3d64 665f 7465 7374 2e69   index=df_test.i
+0001af90: 6e64 6578 0d0a 2020 2020 2020 2020 290d  ndex..        ).
+0001afa0: 0a20 2020 207d 0d0a 2020 2020 636f 6e73  .    }..    cons
+0001afb0: 7472 6169 6e74 203d 207b 0d0a 2020 2020  traint = {..    
+0001afc0: 2020 2020 2763 6f6e 7374 7261 696e 745f      'constraint_
+0001afd0: 6d65 7468 6f64 273a 2027 7175 616e 7469  method': 'quanti
+0001afe0: 6c65 272c 0d0a 2020 2020 2020 2020 276c  le',..        'l
+0001aff0: 6f77 6572 5f63 6f6e 7374 7261 696e 7427  ower_constraint'
+0001b000: 3a20 302c 0d0a 2020 2020 2020 2020 2775  : 0,..        'u
+0001b010: 7070 6572 5f63 6f6e 7374 7261 696e 7427  pper_constraint'
+0001b020: 3a20 4e6f 6e65 2c0d 0a20 2020 2020 2020  : None,..       
+0001b030: 2022 626f 756e 6473 223a 2054 7275 652c   "bounds": True,
+0001b040: 0d0a 2020 2020 7d0d 0a20 2020 2070 6173  ..    }..    pas
+0001b050: 745f 696d 7061 6374 7320 3d20 7064 2e44  t_impacts = pd.D
+0001b060: 6174 6146 7261 6d65 2830 2c20 696e 6465  ataFrame(0, inde
+0001b070: 783d 6466 5f74 7261 696e 2e69 6e64 6578  x=df_train.index
+0001b080: 2c20 636f 6c75 6d6e 733d 6466 5f74 7261  , columns=df_tra
+0001b090: 696e 2e63 6f6c 756d 6e73 290d 0a20 2020  in.columns)..   
+0001b0a0: 2070 6173 745f 696d 7061 6374 732e 696c   past_impacts.il
+0001b0b0: 6f63 5b2d 3130 3a2c 2030 5d20 3d20 6e70  oc[-10:, 0] = np
+0001b0c0: 2e67 656f 6d73 7061 6365 2831 2c20 3130  .geomspace(1, 10
+0001b0d0: 295b 303a 3130 5d20 2f20 3130 300d 0a20  )[0:10] / 100.. 
+0001b0e0: 2020 2070 6173 745f 696d 7061 6374 732e     past_impacts.
+0001b0f0: 696c 6f63 5b2d 3330 3a2c 202d 315d 203d  iloc[-30:, -1] =
+0001b100: 206e 702e 6c69 6e73 7061 6365 2831 2c20   np.linspace(1, 
+0001b110: 3130 295b 303a 3330 5d20 2f20 2d31 3030  10)[0:30] / -100
+0001b120: 0d0a 2020 2020 6675 7475 7265 5f69 6d70  ..    future_imp
+0001b130: 6163 7473 203d 2070 642e 4461 7461 4672  acts = pd.DataFr
+0001b140: 616d 6528 302c 2069 6e64 6578 3d64 665f  ame(0, index=df_
+0001b150: 7465 7374 2e69 6e64 6578 2c20 636f 6c75  test.index, colu
+0001b160: 6d6e 733d 6466 5f74 6573 742e 636f 6c75  mns=df_test.colu
+0001b170: 6d6e 7329 0d0a 2020 2020 6675 7475 7265  mns)..    future
+0001b180: 5f69 6d70 6163 7473 2e69 6c6f 635b 303a  _impacts.iloc[0:
+0001b190: 3130 2c20 305d 203d 2028 6e70 2e6c 696e  10, 0] = (np.lin
+0001b1a0: 7370 6163 6528 312c 2031 3029 5b30 3a31  space(1, 10)[0:1
+0001b1b0: 305d 202b 2031 3029 202f 2031 3030 0d0a  0] + 10) / 100..
+0001b1c0: 0d0a 2020 2020 635f 7061 7261 6d73 203d  ..    c_params =
+0001b1d0: 2043 6173 7361 6e64 7261 2829 2e67 6574   Cassandra().get
+0001b1e0: 5f6e 6577 5f70 6172 616d 7328 290d 0a0d  _new_params()...
+0001b1f0: 0a20 2020 206d 6f64 203d 2043 6173 7361  .    mod = Cassa
+0001b200: 6e64 7261 280d 0a20 2020 2020 2020 206e  ndra(..        n
+0001b210: 5f6a 6f62 733d 312c 0d0a 2020 2020 2020  _jobs=1,..      
+0001b220: 2020 2a2a 635f 7061 7261 6d73 2c0d 0a20    **c_params,.. 
+0001b230: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
+0001b240: 743d 636f 6e73 7472 6169 6e74 2c0d 0a20  t=constraint,.. 
+0001b250: 2020 2020 2020 2068 6f6c 6964 6179 5f63         holiday_c
+0001b260: 6f75 6e74 7269 6573 3d68 6f6c 6964 6179  ountries=holiday
+0001b270: 5f63 6f75 6e74 7269 6573 2c0d 0a20 2020  _countries,..   
+0001b280: 2020 2020 206d 6178 5f6d 756c 7469 636f       max_multico
+0001b290: 6c69 6e65 6172 6974 793d 302e 3030 3031  linearity=0.0001
+0001b2a0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6d6f  ,..    )..    mo
+0001b2b0: 642e 6669 7428 0d0a 2020 2020 2020 2020  d.fit(..        
+0001b2c0: 6466 5f74 7261 696e 2c0d 0a20 2020 2020  df_train,..     
+0001b2d0: 2020 2063 6174 6567 6f72 6963 616c 5f67     categorical_g
+0001b2e0: 726f 7570 733d 6361 7465 676f 7269 6361  roups=categorica
+0001b2f0: 6c5f 6772 6f75 7073 2c0d 0a20 2020 2020  l_groups,..     
+0001b300: 2020 2066 7574 7572 655f 7265 6772 6573     future_regres
+0001b310: 736f 723d 6661 6b65 5f72 6567 722c 0d0a  sor=fake_regr,..
+0001b320: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
+0001b330: 725f 7065 725f 7365 7269 6573 3d72 6567  r_per_series=reg
+0001b340: 725f 7065 725f 7365 7269 6573 2c0d 0a20  r_per_series,.. 
+0001b350: 2020 2020 2020 2070 6173 745f 696d 7061         past_impa
+0001b360: 6374 733d 7061 7374 5f69 6d70 6163 7473  cts=past_impacts
+0001b370: 2c0d 0a20 2020 2020 2020 2066 6c61 675f  ,..        flag_
+0001b380: 7265 6772 6573 736f 7273 3d66 6c61 675f  regressors=flag_
+0001b390: 7265 6772 6573 736f 722c 0d0a 2020 2020  regressor,..    
+0001b3a0: 290d 0a20 2020 2070 7265 6420 3d20 6d6f  )..    pred = mo
+0001b3b0: 642e 7072 6564 6963 7428 0d0a 2020 2020  d.predict(..    
+0001b3c0: 2020 2020 666f 7265 6361 7374 5f6c 656e      forecast_len
+0001b3d0: 6774 683d 666f 7265 6361 7374 5f6c 656e  gth=forecast_len
+0001b3e0: 6774 682c 0d0a 2020 2020 2020 2020 696e  gth,..        in
+0001b3f0: 636c 7564 655f 6869 7374 6f72 793d 696e  clude_history=in
+0001b400: 636c 7564 655f 6869 7374 6f72 792c 0d0a  clude_history,..
+0001b410: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
+0001b420: 6567 7265 7373 6f72 3d66 616b 655f 7265  egressor=fake_re
+0001b430: 6772 5f66 6373 742c 0d0a 2020 2020 2020  gr_fcst,..      
+0001b440: 2020 7265 6772 6573 736f 725f 7065 725f    regressor_per_
+0001b450: 7365 7269 6573 3d72 6567 725f 7065 725f  series=regr_per_
+0001b460: 7365 7269 6573 5f66 6373 742c 0d0a 2020  series_fcst,..  
+0001b470: 2020 2020 2020 6675 7475 7265 5f69 6d70        future_imp
+0001b480: 6163 7473 3d66 7574 7572 655f 696d 7061  acts=future_impa
+0001b490: 6374 732c 0d0a 2020 2020 2020 2020 666c  cts,..        fl
+0001b4a0: 6167 5f72 6567 7265 7373 6f72 733d 666c  ag_regressors=fl
+0001b4b0: 6167 5f72 6567 7265 7373 6f72 5f66 6373  ag_regressor_fcs
+0001b4c0: 742c 0d0a 2020 2020 2020 2020 696e 636c  t,..        incl
+0001b4d0: 7564 655f 6f72 6761 6e69 633d 5472 7565  ude_organic=True
+0001b4e0: 2c0d 0a20 2020 2029 0d0a 2020 2020 7265  ,..    )..    re
+0001b4f0: 7375 6c74 203d 2070 7265 642e 666f 7265  sult = pred.fore
+0001b500: 6361 7374 0d0a 2020 2020 7365 7269 6573  cast..    series
+0001b510: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
+0001b520: 286d 6f64 2e63 6f6c 756d 6e5f 6e61 6d65  (mod.column_name
+0001b530: 7329 0d0a 2020 2020 2320 7365 7269 6573  s)..    # series
+0001b540: 203d 2022 7769 6b69 5f50 6572 696f 6469   = "wiki_Periodi
+0001b550: 635f 7461 626c 6522 0d0a 2020 2020 7365  c_table"..    se
+0001b560: 7269 6573 203d 2027 7769 6b69 5f61 6c6c  ries = 'wiki_all
+0001b570: 270d 0a20 2020 206d 6f64 2e72 6567 7265  '..    mod.regre
+0001b580: 7373 6f72 735f 7573 6564 0d0a 2020 2020  ssors_used..    
+0001b590: 6d6f 642e 686f 6c69 6461 795f 636f 756e  mod.holiday_coun
+0001b5a0: 7472 6965 735f 7573 6564 0d0a 2020 2020  tries_used..    
+0001b5b0: 7769 7468 2070 6c74 2e73 7479 6c65 2e63  with plt.style.c
+0001b5c0: 6f6e 7465 7874 2822 7365 6162 6f72 6e2d  ontext("seaborn-
+0001b5d0: 7768 6974 6522 293a 0d0a 2020 2020 2020  white"):..      
+0001b5e0: 2020 7374 6172 745f 6461 7465 203d 2022    start_date = "
+0001b5f0: 3230 3139 2d30 372d 3031 220d 0a20 2020  2019-07-01"..   
+0001b600: 2020 2020 206d 6f64 2e70 6c6f 745f 666f       mod.plot_fo
+0001b610: 7265 6361 7374 280d 0a20 2020 2020 2020  recast(..       
+0001b620: 2020 2020 2070 7265 642c 0d0a 2020 2020       pred,..    
+0001b630: 2020 2020 2020 2020 6163 7475 616c 733d          actuals=
+0001b640: 6466 5f64 6169 6c79 2069 6620 696e 636c  df_daily if incl
+0001b650: 7564 655f 6869 7374 6f72 7920 656c 7365  ude_history else
+0001b660: 2064 665f 7465 7374 2c0d 0a20 2020 2020   df_test,..     
+0001b670: 2020 2020 2020 2073 6572 6965 733d 7365         series=se
+0001b680: 7269 6573 2c0d 0a20 2020 2020 2020 2020  ries,..         
+0001b690: 2020 2073 7461 7274 5f64 6174 653d 7374     start_date=st
+0001b6a0: 6172 745f 6461 7465 2c0d 0a20 2020 2020  art_date,..     
+0001b6b0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+0001b6c0: 2320 706c 742e 7368 6f77 2829 0d0a 2020  # plt.show()..  
+0001b6d0: 2020 2020 2020 2320 706c 742e 7361 7665        # plt.save
+0001b6e0: 6669 6728 2243 6173 7361 6e64 7261 5f66  fig("Cassandra_f
+0001b6f0: 6f72 6563 6173 742e 706e 6722 2c20 6470  orecast.png", dp
+0001b700: 693d 3330 3029 0d0a 2020 2020 2020 2020  i=300)..        
+0001b710: 2320 6d6f 642e 706c 6f74 5f63 6f6d 706f  # mod.plot_compo
+0001b720: 6e65 6e74 7328 7072 6564 2c20 7365 7269  nents(pred, seri
+0001b730: 6573 3d73 6572 6965 732c 2074 6f5f 6f72  es=series, to_or
+0001b740: 6967 696e 5f73 7061 6365 3d46 616c 7365  igin_space=False
+0001b750: 290d 0a20 2020 2020 2020 2023 2070 6c74  )..        # plt
+0001b760: 2e73 686f 7728 290d 0a20 2020 2020 2020  .show()..       
+0001b770: 206d 6f64 2e70 6c6f 745f 636f 6d70 6f6e   mod.plot_compon
+0001b780: 656e 7473 280d 0a20 2020 2020 2020 2020  ents(..         
+0001b790: 2020 2070 7265 642c 2073 6572 6965 733d     pred, series=
+0001b7a0: 7365 7269 6573 2c20 746f 5f6f 7269 6769  series, to_origi
+0001b7b0: 6e5f 7370 6163 653d 5472 7565 2c20 7374  n_space=True, st
+0001b7c0: 6172 745f 6461 7465 3d73 7461 7274 5f64  art_date=start_d
+0001b7d0: 6174 650d 0a20 2020 2020 2020 2029 0d0a  ate..        )..
+0001b7e0: 2020 2020 2020 2020 2320 706c 742e 7361          # plt.sa
+0001b7f0: 7665 6669 6728 2243 6173 7361 6e64 7261  vefig("Cassandra
+0001b800: 5f63 6f6d 706f 6e65 6e74 7333 2e70 6e67  _components3.png
+0001b810: 222c 2064 7069 3d33 3030 2c20 6262 6f78  ", dpi=300, bbox
+0001b820: 5f69 6e63 6865 733d 2274 6967 6874 2229  _inches="tight")
+0001b830: 0d0a 2020 2020 2020 2020 706c 742e 7368  ..        plt.sh
+0001b840: 6f77 2829 0d0a 2020 2020 2020 2020 6d6f  ow()..        mo
+0001b850: 642e 706c 6f74 5f74 7265 6e64 280d 0a20  d.plot_trend(.. 
+0001b860: 2020 2020 2020 2020 2020 2073 6572 6965             serie
+0001b870: 733d 7365 7269 6573 2c20 766c 696e 653d  s=series, vline=
+0001b880: 7265 7375 6c74 2e69 6e64 6578 5b2d 666f  result.index[-fo
+0001b890: 7265 6361 7374 5f6c 656e 6774 685d 2c20  recast_length], 
+0001b8a0: 7374 6172 745f 6461 7465 3d73 7461 7274  start_date=start
+0001b8b0: 5f64 6174 650d 0a20 2020 2020 2020 2029  _date..        )
+0001b8c0: 0d0a 2020 2020 2020 2020 2320 706c 742e  ..        # plt.
+0001b8d0: 7361 7665 6669 6728 2243 6173 7361 6e64  savefig("Cassand
+0001b8e0: 7261 5f74 7265 6e64 2e70 6e67 222c 2064  ra_trend.png", d
+0001b8f0: 7069 3d33 3030 2c20 6262 6f78 5f69 6e63  pi=300, bbox_inc
+0001b900: 6865 733d 2274 6967 6874 2229 0d0a 2020  hes="tight")..  
+0001b910: 2020 7072 6564 2e65 7661 6c75 6174 6528    pred.evaluate(
+0001b920: 0d0a 2020 2020 2020 2020 6466 5f64 6169  ..        df_dai
+0001b930: 6c79 2e72 6569 6e64 6578 2872 6573 756c  ly.reindex(resul
+0001b940: 742e 696e 6465 7829 5b64 665f 7472 6169  t.index)[df_trai
+0001b950: 6e2e 636f 6c75 6d6e 735d 0d0a 2020 2020  n.columns]..    
+0001b960: 2020 2020 6966 2069 6e63 6c75 6465 5f68      if include_h
+0001b970: 6973 746f 7279 0d0a 2020 2020 2020 2020  istory..        
+0001b980: 656c 7365 2064 665f 7465 7374 5b64 665f  else df_test[df_
+0001b990: 7472 6169 6e2e 636f 6c75 6d6e 735d 0d0a  train.columns]..
+0001b9a0: 2020 2020 290d 0a20 2020 2070 7269 6e74      )..    print
+0001b9b0: 2870 7265 642e 6176 675f 6d65 7472 6963  (pred.avg_metric
+0001b9c0: 732e 726f 756e 6428 3129 290d 0a0d 0a20  s.round(1)).... 
+0001b9d0: 2020 2023 2069 6620 6e6f 7420 6d6f 642e     # if not mod.
+0001b9e0: 7265 6772 6573 736f 7273 5f75 7365 643a  regressors_used:
+0001b9f0: 0d0a 2020 2020 6461 7465 7320 3d20 6466  ..    dates = df
+0001ba00: 5f64 6169 6c79 2e69 6e64 6578 2e75 6e69  _daily.index.uni
+0001ba10: 6f6e 280d 0a20 2020 2020 2020 206d 6f64  on(..        mod
+0001ba20: 2e63 7265 6174 655f 666f 7265 6361 7374  .create_forecast
+0001ba30: 5f69 6e64 6578 2866 6f72 6563 6173 745f  _index(forecast_
+0001ba40: 6c65 6e67 7468 2c20 6c61 7374 5f64 6174  length, last_dat
+0001ba50: 653d 6466 5f64 6169 6c79 2e69 6e64 6578  e=df_daily.index
+0001ba60: 5b2d 315d 290d 0a20 2020 2029 0d0a 2020  [-1])..    )..  
+0001ba70: 2020 7265 6772 5f70 7320 3d20 7b0d 0a20    regr_ps = {.. 
+0001ba80: 2020 2020 2020 2027 7769 6b69 5f47 6572         'wiki_Ger
+0001ba90: 6d61 6e79 273a 2072 6567 725f 7065 725f  many': regr_per_
+0001baa0: 7365 7269 6573 5f66 6373 745b 2777 696b  series_fcst['wik
+0001bab0: 695f 4765 726d 616e 7927 5d2e 7265 696e  i_Germany'].rein
+0001bac0: 6465 7828 0d0a 2020 2020 2020 2020 2020  dex(..          
+0001bad0: 2020 6461 7465 732c 2066 696c 6c5f 7661    dates, fill_va
+0001bae0: 6c75 653d 300d 0a20 2020 2020 2020 2029  lue=0..        )
+0001baf0: 0d0a 2020 2020 7d0d 0a20 2020 2070 7265  ..    }..    pre
+0001bb00: 6432 203d 206d 6f64 2e70 7265 6469 6374  d2 = mod.predict
+0001bb10: 280d 0a20 2020 2020 2020 2066 6f72 6563  (..        forec
+0001bb20: 6173 745f 6c65 6e67 7468 3d66 6f72 6563  ast_length=forec
+0001bb30: 6173 745f 6c65 6e67 7468 2c0d 0a20 2020  ast_length,..   
+0001bb40: 2020 2020 2069 6e63 6c75 6465 5f68 6973       include_his
+0001bb50: 746f 7279 3d54 7275 652c 0d0a 2020 2020  tory=True,..    
+0001bb60: 2020 2020 6e65 775f 6466 3d64 665f 6461      new_df=df_da
+0001bb70: 696c 795b 6466 5f74 7261 696e 2e63 6f6c  ily[df_train.col
+0001bb80: 756d 6e73 5d2c 0d0a 2020 2020 2020 2020  umns],..        
+0001bb90: 666c 6167 5f72 6567 7265 7373 6f72 733d  flag_regressors=
+0001bba0: 666c 6167 5f72 6567 7265 7373 6f72 5f66  flag_regressor_f
+0001bbb0: 6373 742e 7265 696e 6465 7828 6461 7465  cst.reindex(date
+0001bbc0: 732c 2066 696c 6c5f 7661 6c75 653d 3029  s, fill_value=0)
+0001bbd0: 2c0d 0a20 2020 2020 2020 2066 7574 7572  ,..        futur
+0001bbe0: 655f 7265 6772 6573 736f 723d 6661 6b65  e_regressor=fake
+0001bbf0: 5f72 6567 725f 6663 7374 2e72 6569 6e64  _regr_fcst.reind
+0001bc00: 6578 2864 6174 6573 2c20 6669 6c6c 5f76  ex(dates, fill_v
+0001bc10: 616c 7565 3d30 292c 0d0a 2020 2020 2020  alue=0),..      
+0001bc20: 2020 7265 6772 6573 736f 725f 7065 725f    regressor_per_
+0001bc30: 7365 7269 6573 3d72 6567 725f 7073 2c0d  series=regr_ps,.
+0001bc40: 0a20 2020 2029 0d0a 2020 2020 6d6f 642e  .    )..    mod.
+0001bc50: 706c 6f74 5f66 6f72 6563 6173 7428 7072  plot_forecast(pr
+0001bc60: 6564 322c 2061 6374 7561 6c73 3d64 665f  ed2, actuals=df_
+0001bc70: 6461 696c 792c 2073 6572 6965 733d 7365  daily, series=se
+0001bc80: 7269 6573 2c20 7374 6172 745f 6461 7465  ries, start_date
+0001bc90: 3d73 7461 7274 5f64 6174 6529 0d0a 2020  =start_date)..  
+0001bca0: 2020 6d6f 642e 7265 7475 726e 5f63 6f6d    mod.return_com
+0001bcb0: 706f 6e65 6e74 7328 290d 0a20 2020 2070  ponents()..    p
+0001bcc0: 7269 6e74 2863 5f70 6172 616d 735b 2774  rint(c_params['t
+0001bcd0: 7265 6e64 5f6d 6f64 656c 275d 290d 0a0d  rend_model'])...
+0001bce0: 0a23 204d 554c 5449 504c 4943 4154 4956  .# MULTIPLICATIV
+0001bcf0: 4520 5345 4153 4f4e 414c 4954 5920 414e  E SEASONALITY AN
+0001bd00: 4420 484f 4c49 4441 5953 0d0a 0d0a 2320  D HOLIDAYS....# 
+0001bd10: 6c6f 7720 6d65 6d6f 7279 206f 7074 696f  low memory optio
+0001bd20: 6e20 746f 2064 656c 6574 6520 7374 6f72  n to delete stor
+0001bd30: 6564 2064 6673 2061 6e64 2061 7272 6179  ed dfs and array
+0001bd40: 7320 6173 2073 6f6f 6e20 6173 2070 6f73  s as soon as pos
+0001bd50: 7369 626c 650d 0a0d 0a23 204d 616b 6520  sible....# Make 
+0001bd60: 7375 7265 2078 2066 6561 7475 7265 7320  sure x features 
+0001bd70: 6172 6520 616c 6c20 7363 616c 6564 0d0a  are all scaled..
+0001bd80: 2320 5265 6d6f 7665 2073 6561 736f 6e61  # Remove seasona
+0001bd90: 6c69 7479 2066 726f 6d20 7265 6772 6573  lity from regres
+0001bda0: 736f 7273 0d0a 0d0a 2320 7472 616e 7366  sors....# transf
+0001bdb0: 6572 206c 6561 726e 696e 670d 0a23 2067  er learning..# g
+0001bdc0: 7261 7068 6963 7320 2841 4d46 4d20 7761  raphics (AMFM wa
+0001bdd0: 7465 726d 6172 6b29 0d0a 2320 636f 6d70  termark)..# comp
+0001bde0: 6172 6520 6163 726f 7373 2070 6173 7420  are across past 
+0001bdf0: 666f 7265 6361 7374 730d 0a23 2073 7461  forecasts..# sta
+0001be00: 6269 6c69 7479 0d0a 2320 6d61 6b65 2069  bility..# make i
+0001be10: 7420 6d6f 7265 206d 6f64 756c 6172 2028  t more modular (
+0001be20: 7365 7061 7261 7465 2075 7361 626c 6520  separate usable 
+0001be30: 6675 6e63 7469 6f6e 7329 0d0a 0d0a 2320  functions)....# 
+0001be40: 4175 746f 6d61 7469 6f6e 0d0a 2320 616c  Automation..# al
+0001be50: 6c6f 7720 736f 6d65 2063 6f6e 6669 6720  low some config 
+0001be60: 696e 7075 7473 2c20 6f72 2061 7574 6f6d  inputs, or autom
+0001be70: 6174 6564 2066 6974 0d0a 2320 6f75 7470  ated fit..# outp
+0001be80: 7574 2074 6f20 7461 626c 650d 0a23 2063  ut to table..# c
+0001be90: 6f6d 7061 7265 2063 6f65 6666 6963 6965  ompare coefficie
+0001bea0: 6e74 7320 6368 616e 6765 206f 7665 7220  nts change over 
+0001beb0: 7469 6d65 2c20 6163 6375 7261 6379 206f  time, accuracy o
+0001bec0: 7665 7220 7469 6d65 0d0a 2320 636f 6d70  ver time..# comp
+0001bed0: 6172 696e 6720 6469 6666 6572 656e 7420  aring different 
+0001bee0: 736f 7572 6365 733f 2061 6e64 2f6f 7220  sources? and/or 
+0001bef0: 616c 6c6f 7769 6e67 206f 6e65 2066 6f72  allowing one for
+0001bf00: 6563 6173 7420 746f 2062 6520 7573 6564  ecast to be used
+0001bf10: 2061 7320 6120 7265 6772 6573 736f 7220   as a regressor 
+0001bf20: 666f 7220 616e 6f74 6865 720d 0a23 2077  for another..# w
+0001bf30: 6f75 6c64 2061 6c6c 6f77 2066 6f72 2065  ould allow for e
+0001bf40: 6172 6c69 6572 2064 6574 6563 7469 6f6e  arlier detection
+0001bf50: 206f 6620 6272 6f6b 656e 2063 6f6e 6e65   of broken conne
+0001bf60: 6374 696f 6e73 0d0a 0d0a 2222 220d 0a61  ctions...."""..a
+0001bf70: 7820 3d20 7072 6564 2e70 6c6f 7428 6466  x = pred.plot(df
+0001bf80: 5f64 6169 6c79 2069 6620 696e 636c 7564  _daily if includ
+0001bf90: 655f 6869 7374 6f72 7920 656c 7365 2064  e_history else d
+0001bfa0: 665f 7465 7374 2c20 7365 7269 6573 3d73  f_test, series=s
+0001bfb0: 6572 6965 732c 2076 6c69 6e65 3d64 665f  eries, vline=df_
+0001bfc0: 7465 7374 2e69 6e64 6578 5b30 5d2c 2073  test.index[0], s
+0001bfd0: 7461 7274 5f64 6174 653d 7374 6172 745f  tart_date=start_
+0001bfe0: 6461 7465 290d 0a68 616e 646c 6573 2c20  date)..handles, 
+0001bff0: 6c61 6265 6c73 203d 2061 782e 6765 745f  labels = ax.get_
+0001c000: 6c65 6765 6e64 5f68 616e 646c 6573 5f6c  legend_handles_l
+0001c010: 6162 656c 7328 290d 0a69 6620 6d6f 642e  abels()..if mod.
+0001c020: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+0001c030: 3a0d 0a20 2020 2069 6620 6d6f 642e 616e  :..    if mod.an
+0001c040: 6f6d 616c 795f 6465 7465 6374 6f72 2e6f  omaly_detector.o
+0001c050: 7574 7075 7420 3d3d 2022 756e 6976 6172  utput == "univar
+0001c060: 6961 7465 223a 0d0a 2020 2020 2020 2020  iate":..        
+0001c070: 695f 616e 6f6d 203d 206d 6f64 2e61 6e6f  i_anom = mod.ano
+0001c080: 6d61 6c79 5f64 6574 6563 746f 722e 616e  maly_detector.an
+0001c090: 6f6d 616c 6965 732e 696e 6465 785b 6d6f  omalies.index[mo
+0001c0a0: 642e 616e 6f6d 616c 795f 6465 7465 6374  d.anomaly_detect
+0001c0b0: 6f72 2e61 6e6f 6d61 6c69 6573 2e69 6c6f  or.anomalies.ilo
+0001c0c0: 635b 3a2c 2030 5d20 3d3d 202d 315d 0d0a  c[:, 0] == -1]..
+0001c0d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001c0e0: 2020 2073 6572 6965 735f 616e 6f6d 203d     series_anom =
+0001c0f0: 206d 6f64 2e61 6e6f 6d61 6c79 5f64 6574   mod.anomaly_det
+0001c100: 6563 746f 722e 616e 6f6d 616c 6965 735b  ector.anomalies[
+0001c110: 7365 7269 6573 5d0d 0a20 2020 2020 2020  series]..       
+0001c120: 2069 5f61 6e6f 6d20 3d20 7365 7269 6573   i_anom = series
+0001c130: 5f61 6e6f 6d5b 7365 7269 6573 5f61 6e6f  _anom[series_ano
+0001c140: 6d20 3d3d 202d 315d 2e69 6e64 6578 0d0a  m == -1].index..
+0001c150: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
+0001c160: 2069 5f61 6e6f 6d5b 695f 616e 6f6d 203e   i_anom[i_anom >
+0001c170: 3d20 7374 6172 745f 6461 7465 5d0d 0a20  = start_date].. 
+0001c180: 2020 2069 6620 6c65 6e28 695f 616e 6f6d     if len(i_anom
+0001c190: 2920 3e20 3020 616e 6420 6c65 6e28 695f  ) > 0 and len(i_
+0001c1a0: 616e 6f6d 2920 3c20 6c65 6e28 6466 5f64  anom) < len(df_d
+0001c1b0: 6169 6c79 2920 2a20 302e 353a 0d0a 2020  aily) * 0.5:..  
+0001c1c0: 2020 2020 2020 7363 6174 3120 3d20 6178        scat1 = ax
+0001c1d0: 2e73 6361 7474 6572 2869 5f61 6e6f 6d2e  .scatter(i_anom.
+0001c1e0: 746f 6c69 7374 2829 2c20 6466 5f64 6169  tolist(), df_dai
+0001c1f0: 6c79 2e6c 6f63 5b69 5f61 6e6f 6d2c 203a  ly.loc[i_anom, :
+0001c200: 5d5b 7365 7269 6573 5d2c 2063 3d22 6461  ][series], c="da
+0001c210: 726b 736c 6174 6562 6c75 6522 2c20 733d  rkslateblue", s=
 0001c220: 3132 2e30 290d 0a20 2020 2020 2020 2068  12.0)..        h
-0001c230: 616e 646c 6573 202b 3d20 5b73 6361 7433  andles += [scat3
+0001c230: 616e 646c 6573 202b 3d20 5b73 6361 7431  andles += [scat1
 0001c240: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
-0001c250: 7320 2b3d 205b 2274 7265 6e64 2061 6e6f  s += ["trend ano
-0001c260: 6d61 6c69 6573 225d 0d0a 6178 2e6c 6567  malies"]..ax.leg
-0001c270: 656e 6428 6861 6e64 6c65 732c 206c 6162  end(handles, lab
-0001c280: 656c 7329 0d0a 2222 220d 0a              els).."""..
+0001c250: 7320 2b3d 205b 2261 6e6f 6d61 6c69 6573  s += ["anomalies
+0001c260: 225d 0d0a 6966 206d 6f64 2e68 6f6c 6964  "]..if mod.holid
+0001c270: 6179 5f64 6574 6563 746f 723a 0d0a 2020  ay_detector:..  
+0001c280: 2020 695f 616e 6f6d 203d 206d 6f64 2e68    i_anom = mod.h
+0001c290: 6f6c 6964 6179 5f64 6574 6563 746f 722e  oliday_detector.
+0001c2a0: 6461 7465 735f 746f 5f68 6f6c 6964 6179  dates_to_holiday
+0001c2b0: 7328 6d6f 642e 6466 2e69 6e64 6578 2c20  s(mod.df.index, 
+0001c2c0: 7374 796c 653d 2273 6572 6965 735f 666c  style="series_fl
+0001c2d0: 6167 2229 5b73 6572 6965 735d 0d0a 2020  ag")[series]..  
+0001c2e0: 2020 695f 616e 6f6d 203d 2069 5f61 6e6f    i_anom = i_ano
+0001c2f0: 6d2e 696e 6465 785b 695f 616e 6f6d 203d  m.index[i_anom =
+0001c300: 3d20 315d 0d0a 2020 2020 6966 206c 656e  = 1]..    if len
+0001c310: 2869 5f61 6e6f 6d29 203e 2030 2061 6e64  (i_anom) > 0 and
+0001c320: 206c 656e 2869 5f61 6e6f 6d29 203c 206c   len(i_anom) < l
+0001c330: 656e 2864 665f 6461 696c 7929 202a 2030  en(df_daily) * 0
+0001c340: 2e35 3a0d 0a20 2020 2020 2020 2073 6361  .5:..        sca
+0001c350: 7432 203d 2061 782e 7363 6174 7465 7228  t2 = ax.scatter(
+0001c360: 695f 616e 6f6d 2e74 6f6c 6973 7428 292c  i_anom.tolist(),
+0001c370: 2064 665f 6461 696c 792e 6c6f 635b 695f   df_daily.loc[i_
+0001c380: 616e 6f6d 2c20 3a5d 5b73 6572 6965 735d  anom, :][series]
+0001c390: 2c20 633d 2264 6172 6b67 7265 656e 222c  , c="darkgreen",
+0001c3a0: 2073 3d31 322e 3029 0d0a 2020 2020 2020   s=12.0)..      
+0001c3b0: 2020 6861 6e64 6c65 7320 2b3d 205b 7363    handles += [sc
+0001c3c0: 6174 325d 0d0a 2020 2020 2020 2020 6c61  at2]..        la
+0001c3d0: 6265 6c73 202b 3d20 5b22 6465 7465 6374  bels += ["detect
+0001c3e0: 6564 2068 6f6c 6964 6179 7322 5d0d 0a69  ed holidays"]..i
+0001c3f0: 6620 6d6f 642e 7472 656e 645f 616e 6f6d  f mod.trend_anom
+0001c400: 616c 795f 6465 7465 6374 6f72 2069 7320  aly_detector is 
+0001c410: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2069  not None:..    i
+0001c420: 6620 6d6f 642e 7472 656e 645f 616e 6f6d  f mod.trend_anom
+0001c430: 616c 795f 6465 7465 6374 6f72 2e6f 7574  aly_detector.out
+0001c440: 7075 7420 3d3d 2022 756e 6976 6172 6961  put == "univaria
+0001c450: 7465 223a 0d0a 2020 2020 2020 2020 695f  te":..        i_
+0001c460: 616e 6f6d 203d 206d 6f64 2e74 7265 6e64  anom = mod.trend
+0001c470: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
+0001c480: 722e 616e 6f6d 616c 6965 732e 696e 6465  r.anomalies.inde
+0001c490: 785b 6d6f 642e 616e 6f6d 616c 795f 6465  x[mod.anomaly_de
+0001c4a0: 7465 6374 6f72 2e61 6e6f 6d61 6c69 6573  tector.anomalies
+0001c4b0: 2e69 6c6f 635b 3a2c 2030 5d20 3d3d 202d  .iloc[:, 0] == -
+0001c4c0: 315d 0d0a 2020 2020 656c 7365 3a0d 0a20  1]..    else:.. 
+0001c4d0: 2020 2020 2020 2073 6572 6965 735f 616e         series_an
+0001c4e0: 6f6d 203d 206d 6f64 2e74 7265 6e64 5f61  om = mod.trend_a
+0001c4f0: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
+0001c500: 616e 6f6d 616c 6965 735b 7365 7269 6573  anomalies[series
+0001c510: 5d0d 0a20 2020 2020 2020 2069 5f61 6e6f  ]..        i_ano
+0001c520: 6d20 3d20 7365 7269 6573 5f61 6e6f 6d5b  m = series_anom[
+0001c530: 7365 7269 6573 5f61 6e6f 6d20 3d3d 202d  series_anom == -
+0001c540: 315d 2e69 6e64 6578 0d0a 2020 2020 6966  1].index..    if
+0001c550: 2073 7461 7274 5f64 6174 6520 6973 206e   start_date is n
+0001c560: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0001c570: 2020 695f 616e 6f6d 203d 2069 5f61 6e6f    i_anom = i_ano
+0001c580: 6d5b 695f 616e 6f6d 203e 3d20 7374 6172  m[i_anom >= star
+0001c590: 745f 6461 7465 5d0d 0a20 2020 2069 6620  t_date]..    if 
+0001c5a0: 6c65 6e28 695f 616e 6f6d 2920 3e20 3020  len(i_anom) > 0 
+0001c5b0: 616e 6420 6c65 6e28 695f 616e 6f6d 2920  and len(i_anom) 
+0001c5c0: 3c20 6c65 6e28 6466 5f64 6169 6c79 2920  < len(df_daily) 
+0001c5d0: 2a20 302e 353a 0d0a 2020 2020 2020 2020  * 0.5:..        
+0001c5e0: 7363 6174 3320 3d20 6178 2e73 6361 7474  scat3 = ax.scatt
+0001c5f0: 6572 2869 5f61 6e6f 6d2e 746f 6c69 7374  er(i_anom.tolist
+0001c600: 2829 2c20 6466 5f64 6169 6c79 2e6c 6f63  (), df_daily.loc
+0001c610: 5b69 5f61 6e6f 6d5d 5b73 6572 6965 735d  [i_anom][series]
+0001c620: 2c20 633d 2273 6c61 7465 6772 6179 222c  , c="slategray",
+0001c630: 2073 3d31 322e 3029 0d0a 2020 2020 2020   s=12.0)..      
+0001c640: 2020 6861 6e64 6c65 7320 2b3d 205b 7363    handles += [sc
+0001c650: 6174 335d 0d0a 2020 2020 2020 2020 6c61  at3]..        la
+0001c660: 6265 6c73 202b 3d20 5b22 7472 656e 6420  bels += ["trend 
+0001c670: 616e 6f6d 616c 6965 7322 5d0d 0a61 782e  anomalies"]..ax.
+0001c680: 6c65 6765 6e64 2868 616e 646c 6573 2c20  legend(handles, 
+0001c690: 6c61 6265 6c73 290d 0a22 2222 0d0a       labels).."""..
```

### Comparing `autots-0.5.7/autots/models/dnn.py` & `autots-0.5.8/autots/models/dnn.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/ensemble.py` & `autots-0.5.8/autots/models/ensemble.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/gluonts.py` & `autots-0.5.8/autots/models/gluonts.py`

 * *Files 0% similar despite different names*

```diff
@@ -89,15 +89,15 @@
         """Train algorithm given data supplied.
 
         Args:
             df (pandas.DataFrame): Datetime Indexed
         """
         if not _has_gluonts:
             raise ImportError(
-                "GluonTS installation is incompatible with AutoTS. The numpy version is sometimes the issue."
+                "GluonTS installation is incompatible with AutoTS. The numpy version is sometimes the issue, try 1.23.1 {as of 06-2023}"
             )
 
         df = self.basic_profile(df)
 
         try:
             from mxnet.random import seed as mxnet_seed
```

### Comparing `autots-0.5.7/autots/models/greykite.py` & `autots-0.5.8/autots/models/greykite.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/matrix_var.py` & `autots-0.5.8/autots/models/matrix_var.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/mlensemble.py` & `autots-0.5.8/autots/models/mlensemble.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/model_list.py` & `autots-0.5.8/autots/models/model_list.py`

 * *Files 4% similar despite different names*

```diff
@@ -16,15 +16,15 @@
     'VECM',
     'DynamicFactor',
     'MotifSimulation',
     'WindowRegression',
     'VAR',
     'DatepartRegression',
     "UnivariateRegression",
-    "Greykite",
+    # "Greykite",
     'UnivariateMotif',
     'MultivariateMotif',
     'NVAR',
     'MultivariateRegression',
     'SectionalMotif',
     'Theta',
     'ARDL',
@@ -38,14 +38,15 @@
     'LATC',
     'KalmanStateSpace',
     'MetricMotif',
     'Cassandra',
     'SeasonalityMotif',
     'MLEnsemble',
 ]
+all_pragmatic = list((set(all_models) - set(['MLEnsemble', 'VARMAX', 'Greykite'])))
 # downweight slower models
 default = {
     'ConstantNaive': 1,
     'LastValueNaive': 1,
     'AverageValueNaive': 1,
     'GLS': 1,
     'SeasonalNaive': 1,
@@ -67,40 +68,14 @@
     'NVAR': 1,
     'Theta': 1,
     'ARDL': 1,
     'ARCH': 1,
     'MetricMotif': 1,
     # 'SeasonalityMotif': 1,
 }
-# so this opiniated and not fully updated always
-best = [
-    'LastValueNaive',
-    'AverageValueNaive',
-    'GLS',
-    'GLM',
-    'ETS',
-    'FBProphet',
-    'GluonTS',
-    'SeasonalNaive',
-    'UnobservedComponents',
-    'VECM',
-    # 'UnivariateRegression',
-    'MultivariateRegression',
-    'WindowRegression',
-    'VAR',
-    'DatepartRegression',
-    'UnivariateMotif',
-    'MultivariateMotif',
-    'NVAR',
-    'SectionalMotif',
-    'Theta',
-    'ARDL',
-    'ARCH',
-    'SeasonalityMotif',
-]
 # fastest models at any scale
 superfast = [
     'ConstantNaive',
     'LastValueNaive',
     'AverageValueNaive',
     'GLS',
     'SeasonalNaive',
@@ -144,14 +119,22 @@
     'Theta': 1,
     'ARDL': 1,
     'ARCH': 1,
 }
 # models that should be fast given many CPU cores
 fast_parallel = {**parallel, **fast}
 fast_parallel_no_arima = {i: fast_parallel[i] for i in fast_parallel if i != 'ARIMA'}
+# so this opiniated and not fully updated always
+best = list(
+    set(
+        list(fast_parallel_no_arima.keys())
+        + ['MultivariateRegression', 'GluonTS', 'TMF', 'PytorchForecasting']
+    )
+)
+
 # models that are explicitly not production ready
 experimental = [
     'MotifSimulation',
     'TensorflowSTS',
     'ComponentAnalysis',
     'TFPRegression',
 ]
@@ -345,12 +328,29 @@
     "slow": slow,
     "gpu": gpu,
     "regressor": regressor,
     "best": best,
     "motifs": motifs,
     "all_result_path": all_result_path,
     "regressions": regressions,
+    "all_pragmatic": all_pragmatic,
 }
 
 
 def auto_model_list(n_jobs, n_series, frequency):
     pass
+
+
+def model_list_to_dict(model_list):
+    """Convert various possibilities to dict."""
+    if model_list in list(model_lists.keys()):
+        model_list = model_lists[model_list]
+
+    if isinstance(model_list, dict):
+        model_prob = list(model_list.values())
+        model_list = [*model_list]
+    elif isinstance(model_list, list):
+        trs_len = len(model_list)
+        model_prob = [1 / trs_len] * trs_len
+    else:
+        raise ValueError("model_list type not recognized.")
+    return model_list, model_prob
```

### Comparing `autots-0.5.7/autots/models/prophet.py` & `autots-0.5.8/autots/models/prophet.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/pytorch.py` & `autots-0.5.8/autots/models/pytorch.py`

 * *Files 4% similar despite different names*

```diff
@@ -10,16 +10,24 @@
 import pandas as pd
 from autots.models.base import ModelObject, PredictionObject
 from autots.tools.probabilistic import Point_to_Probability
 from autots.tools.seasonal import date_part, seasonal_int
 
 try:
     # bewarned, pytorch-forecasting has useless error messages
-    import pytorch_lightning as pl
-    from pytorch_lightning.callbacks import EarlyStopping  # , LearningRateMonitor
+    import torch
+
+    try:
+        import lightning.pytorch as pl  # 2.0 way
+    except Exception:
+        import pytorch_lightning as pl
+    try:
+        from lightning.pytorch.callbacks.early_stopping import EarlyStopping  # 2.0
+    except Exception:
+        from pytorch_lightning.callbacks import EarlyStopping  # , LearningRateMonitor
     from pytorch_forecasting import (
         TimeSeriesDataSet,
         TemporalFusionTransformer,
         DeepAR,
         NHiTS,
         NBeats,
         DecoderMLP,
@@ -123,32 +131,37 @@
         if not pytorch_present:
             raise ImportError(
                 "pytorch, pytorch lighting, or pytorch-forecasting not present"
             )
 
         df = self.basic_profile(df)
         pl.seed_everything(self.random_seed)
+        df_int = df.copy()
 
         # over-engineered approach just in case this name is used by a series
-        if "range_datetime" not in df.columns:
+        if "range_datetime" not in df_int.columns:
             self.range_idx_name = "range_datetime"
         else:
             while self.range_idx_name is None:
                 temp_name = ''.join(
                     random.choice('0123456789ABCDEF') for i in range(14)
                 )
-                if temp_name not in df.columns:
+                if temp_name not in df_int.columns:
                     self.range_idx_name = temp_name
 
         # convert wide data back to long for this
-        df[self.range_idx_name] = pd.RangeIndex(start=0, stop=df.shape[0], step=1)
+        df_int[self.range_idx_name] = pd.RangeIndex(
+            start=0, stop=df_int.shape[0], step=1
+        )
         self._id_vars = [self.range_idx_name]
-        data = df.melt(id_vars=self._id_vars, var_name='series_id', value_name='value')
+        data = df_int.melt(
+            id_vars=self._id_vars, var_name='series_id', value_name='value'
+        )
         if self.datepart_method is not None:
-            dt_merge = df[self.range_idx_name].drop_duplicates()
+            dt_merge = df_int[self.range_idx_name].drop_duplicates()
             date_parts = date_part(
                 dt_merge.index,
                 method=self.datepart_method,
                 polynomial_degree=None,
             )
             dt_merge = dt_merge.to_frame().merge(
                 date_parts, left_index=True, right_index=True
@@ -174,14 +187,17 @@
             time_idx=self.range_idx_name,
             target="value",
             time_varying_unknown_reals=["value"],  # needed for DeepAR
             # weight="weight",
             group_ids=["series_id"],
             # static_categoricals=["series_id"],  # recommeded for DeepAR
             max_encoder_length=self.max_encoder_length,
+            min_encoder_length=self.max_encoder_length
+            if self.max_encoder_length < 90
+            else 7,
             max_prediction_length=self.forecast_length,
             target_normalizer=encoder,
             # static_categoricals=[ ... ],
             # static_reals=[ ... ],
             # time_varying_known_categoricals=self.date_part_cols,
             time_varying_known_reals=self.date_part_cols,
             # time_varying_unknown_categoricals=[ ... ],
@@ -215,48 +231,50 @@
         )
 
         # define trainer with early stopping
         if self.callbacks is None:
             self.callbacks = [
                 EarlyStopping(
                     monitor="val_loss",
-                    min_delta=1e-4,
-                    patience=1,
+                    min_delta=1e-5,
+                    patience=2,
                     verbose=False,
                     mode="min",
                 )
             ]
         # lr_logger = LearningRateMonitor()
         if is_available() and "accelerator" not in self.trainer_kwargs.keys():
             self.trainer = pl.Trainer(
                 max_epochs=self.max_epochs,
-                num_processes=self.n_jobs,  # don't think this will usually be used
+                # num_processes=self.n_jobs,  # don't think this will usually be used
                 # gradient_clip_val=0.1,
                 # limit_train_batches=30,
                 callbacks=self.callbacks,  # lr_logger,
                 logger=False,
-                checkpoint_callback=False,
+                # checkpoint_callback=False,
                 accelerator='gpu',
+                gradient_clip_val=0.05,  # necessary to be less than 0.1 to prevent a strange bug
                 devices=1,
                 **self.trainer_kwargs,
             )
         else:
             self.trainer = pl.Trainer(
                 max_epochs=self.max_epochs,
-                num_processes=self.n_jobs,  # don't think this will usually be used
+                # num_processes=self.n_jobs,  # don't think this will usually be used
                 # gradient_clip_val=0.1,
                 # limit_train_batches=30,
                 callbacks=self.callbacks,  # lr_logger,
+                gradient_clip_val=0.05,
                 logger=False,
-                checkpoint_callback=False,
+                # checkpoint_callback=False,
                 **self.trainer_kwargs,
             )
 
         # create the model
-        if self.model == "TemporalFusionTransformer":
+        if self.model in ['TFT', "TemporalFusionTransformer"]:
             self.tft = TemporalFusionTransformer.from_dataset(
                 training,
                 learning_rate=self.learning_rate,
                 hidden_size=self.hidden_size,
                 dropout=self.dropout,
                 lstm_layers=self.n_layers,
                 # attention_head_size=1,
@@ -268,26 +286,26 @@
             )
         elif self.model == "DeepAR":
             self.tft = DeepAR.from_dataset(
                 training,
                 learning_rate=self.learning_rate,
                 hidden_size=self.hidden_size,
                 dropout=self.dropout,
-                log_val_interval=1,
+                log_val_interval=0,
                 rnn_layers=self.n_layers,  # said to be important
                 # loss=MultivariateNormalDistributionLoss(rank=30),
                 **self.model_kwargs,
             )
         elif self.model == "NHiTS":
             self.tft = NHiTS.from_dataset(
                 training,
                 learning_rate=self.learning_rate,
                 hidden_size=self.hidden_size,
                 dropout=self.dropout,
-                n_layers=self.n_layers,
+                # n_layers=self.n_layers,  # temporarily broken in 1.0.0, maybe uncomment later
                 # weight_decay=1e-2,
                 # loss=MQF2DistributionLoss(prediction_length=max_prediction_length),
                 # backcast_loss_ratio=0.0,
                 output_size=len(self.quantiles),  # must be 1 for non-quantile losses
                 loss=QuantileLoss(quantiles=self.quantiles),
                 context_length=self.forecast_length * 2,
                 **self.model_kwargs,
@@ -323,15 +341,15 @@
                 f"Number of parameters in pytorch network: {self.tft.size()/1e3:.1f}k"
             )
 
         # fit the model
         self.trainer.fit(
             self.tft, train_dataloaders=train_dataloader, val_dataloaders=val_dataloader
         )
-        self.encoder_tail = df.tail(self.max_encoder_length)
+        self.encoder_tail = df_int.tail(self.max_encoder_length)
 
         self.fit_runtime = datetime.datetime.now() - self.startTime
         return self
 
     def predict(
         self,
         forecast_length: int = None,
@@ -371,66 +389,82 @@
             on=self.range_idx_name,
             how='outer',
         ).fillna(method='ffill')
         encoder_data.index = pd.DatetimeIndex(
             np.concatenate([self.encoder_tail.index, test_index], axis=None)
         )
         # combine encoder and decoder data
-        new_prediction_data = encoder_data.melt(
+        self.x_predict = encoder_data.melt(
             id_vars=self._id_vars, var_name='series_id', value_name='value'
         )
         if self.datepart_method is not None:
             dt_merge = encoder_data[self.range_idx_name].drop_duplicates()
             date_parts = date_part(
                 dt_merge.index,
                 method=self.datepart_method,
                 polynomial_degree=None,
             )
             dt_merge = dt_merge.to_frame().merge(
                 date_parts, left_index=True, right_index=True
             )
-            new_prediction_data = new_prediction_data.merge(
+            self.x_predict = self.x_predict.merge(
                 dt_merge.reset_index(drop=False), on=self.range_idx_name
             )
 
-        predictions, pred_idx = self.tft.predict(
-            new_prediction_data, mode='prediction', return_index=True
-        )
-        predictions_df = pd.DataFrame(
-            predictions.numpy().T, columns=pred_idx['series_id'], index=test_index
-        )
+        colz = self.column_names
+        try:
+            predictions_init = self.tft.predict(
+                self.x_predict, mode='prediction', return_index=True
+            )
+            self.predictions = predictions_init[0]
+            if not isinstance(self.predictions, torch.Tensor):
+                for x in predictions_init:
+                    if isinstance(x, torch.Tensor):
+                        self.predictions = x
+            for x in predictions_init:
+                if isinstance(x, pd.DataFrame):
+                    if "series_id" in x.columns:
+                        colz = x["series_id"]
+        except Exception:
+            self.predictions, pred_idx = self.tft.predict(
+                self.x_predict, mode='prediction', return_index=True
+            )
+            colz = pred_idx['series_id']
+        pred_num = self.predictions.numpy(force=True).T
+        predictions_df = pd.DataFrame(pred_num, columns=colz, index=test_index)[
+            self.column_names
+        ]
 
         if just_point_forecast:
             return predictions_df
-        self.result_windows = self.tft.predict(
-            new_prediction_data, mode="quantiles"
-        ).transpose(0, 2)
+        self.result_windows = self.tft.predict(self.x_predict, mode="quantiles")
+        self.result_windows = self.result_windows.transpose(0, 2)
         if self.result_windows.shape[2] > 1:
             c_int = (1.0 - self.prediction_interval) / 2
             # predictions_df = result.quantile(0.5, axis=2).numpy().T
             # taking a quantile of the quantiles given!
             lower_df = pd.DataFrame(
-                self.result_windows.quantile(c_int, axis=0).numpy(),
+                self.result_windows.quantile(c_int, axis=0).numpy(force=True),
                 index=test_index,
-                columns=self.column_names,
-            )
+                columns=colz,
+            )[self.column_names]
             upper_df = pd.DataFrame(
-                self.result_windows.quantile(1.0 - c_int, axis=0).numpy(),
+                self.result_windows.quantile(1.0 - c_int, axis=0).numpy(force=True),
                 index=test_index,
-                columns=self.column_names,
-            )
+                columns=colz,
+            )[self.column_names]
         else:
             # predictions_df = result.numpy()[:, :, 0].T
             upper_df, lower_df = Point_to_Probability(
                 self.encoder_tail,
                 predictions_df,
                 method='inferred_normal',
                 prediction_interval=self.prediction_interval,
             )
-        self.result_windows = self.result_windows.numpy()
+        self.result_windows = self.result_windows.numpy(force=True)
 
         predict_runtime = datetime.datetime.now() - predictStartTime
         prediction = PredictionObject(
             model_name=self.name,
             forecast_length=forecast_length,
             forecast_index=test_index,
             forecast_columns=predictions_df.columns,
@@ -444,31 +478,38 @@
         )
 
         return prediction
 
     def get_new_params(self, method: str = 'random'):
         """Return dict of new parameters for parameter tuning."""
         parameter_dict = {
-            "model": random.choice(
-                ["TemporalFusionTransformer", "DecoderMLP", 'DeepAR', "NHiTS", "NBeats"]
-            ),
-            "max_encoder_length": random.choice([7, 12, 24, 28, 60, 96]),
+            "model": random.choices(
+                [
+                    "TemporalFusionTransformer",
+                    "DecoderMLP",
+                    'DeepAR',
+                    "NHiTS",
+                    "NBeats",
+                ],
+                [0.3, 0.2, 0.3, 0.2, 0.2],
+            )[0],
+            "max_encoder_length": random.choice([7, 12, 24, 28, 60, 96, 364]),
             "datepart_method": random.choices(
                 [None, "recurring", "simple", "expanded", "simple_2"],
                 [0.8, 0.4, 0.3, 0.3, 0.3],
             )[0],
             "add_target_scales": random.choice([True, False]),
             "lags": random.choices(
                 [
                     {},
                     {"value": [seasonal_int(very_small=True)]},
                     {"value": [1, seasonal_int(very_small=True)]},
                     {"value": [1]},
                 ],
-                [0.9, 0.1, 0.1, 0.1],
+                [0.9, 0.05, 0.05, 0.5],
             )[
                 0
             ],  # {"value": [1, 7]}
             "target_normalizer": random.choices(
                 ["EncoderNormalizer", "TorchNormalizer", "GroupNormalizer"],
                 [0.5, 0.25, 0.25],
             )[0],
@@ -479,14 +520,18 @@
                 [8, 16, 32, 30, 64, 128, 256], [0.1, 0.1, 0.25, 0.2, 0.2, 0.1, 0.05]
             )[0],
             "n_layers": random.choices([1, 2, 3, 4], [0.14, 0.4, 0.3, 0.16])[0],
             "dropout": random.choice([0.0, 0.1, 0.2, 0.05]),
             "model_kwargs": {},
             "trainer_kwargs": {},
         }
+        if parameter_dict['model'] == "DeepAR":
+            parameter_dict["target_normalizer"] = "EncoderNormalizer"
+        elif parameter_dict['model'] == "NHiTS":
+            parameter_dict["add_target_scales"] = False
         return parameter_dict
 
     def get_params(self):
         """Return dict of current parameters."""
         return {
             "model": self.model,
             "max_encoder_length": self.max_encoder_length,
```

### Comparing `autots-0.5.7/autots/models/sklearn.py` & `autots-0.5.8/autots/models/sklearn.py`

 * *Files 1% similar despite different names*

```diff
@@ -551,14 +551,30 @@
     'Adaboost': 0.05,
     'SVM': 0.05,
     'KerasRNN': 0.05,
     'Transformer': 0.05,
     'ExtraTrees': 0.07,
     'RadiusNeighbors': 0.05,
 }
+gradient_boosting = {
+    'xgboost': 0.09,
+    'HistGradientBoost': 0.03,
+    'LightGBM': 0.09,
+    'LightGBMRegressorChain': 0.03,
+}
+# all tree based models
+tree_dict = {
+    'DecisionTree': 1,
+    'RandomForest': 1,
+    'ExtraTrees': 1,
+    'LightGBM': 1,
+    'HistGradientBoost': 1,
+    'xgboost': 1,
+    'XGBRegressor': 1,
+}
 # pre-optimized model templates
 xgparam3 = {
     "model": 'xgboost',
     "model_params": {
         "base_score": 0.5,
         "booster": 'gbtree',
         "colsample_bylevel": 0.541426,
@@ -655,20 +671,18 @@
         model_dict = {
             'KerasRNN': 0.05,
             'Transformer': 0.05,
             'MLP': 0.05,
         }
         method = "deep"
     elif method == "gradient_boosting":
-        model_dict = {
-            'xgboost': 0.09,
-            'HistGradientBoost': 0.03,
-            'LightGBM': 0.09,
-            'LightGBMRegressorChain': 0.03,
-        }
+        model_dict = gradient_boosting
+        method = "default"
+    elif method == "trees":
+        model_dict = tree_dict
         method = "default"
     """Generate new parameters for input to regressor."""
     model_list = list(model_dict.keys())
     model = random.choices(model_list, list(model_dict.values()), k=1)[0]
     if model in [
         'xgboost',
         'Adaboost',
@@ -690,15 +704,16 @@
                 "model": 'Adaboost',
                 "model_params": {
                     "n_estimators": random.choices([50, 100, 500], [0.7, 0.2, 0.1])[0],
                     "loss": random.choices(
                         ['linear', 'square', 'exponential'], [0.8, 0.01, 0.1]
                     )[0],
                     "estimator": random.choices(
-                        [None, 'LinReg', 'SVR'], [0.8, 0.1, 0.1]
+                        [None, 'LinReg', 'SVR'],
+                        [0.8, 0.1, 0.0],  # SVR slow and crash prone
                     )[0],
                     "learning_rate": random.choices([1, 0.5], [0.9, 0.1])[0],
                 },
             }
         elif model == 'xgboost':
             branch = random.choices(['p1', 'p2', 'random'], [0.1, 0.4, 0.5])[0]
             if branch == 'p1':
@@ -1949,24 +1964,24 @@
             if future_regressor is None:
                 raise ValueError(
                     "regression_type='User' but no future_regressor passed"
                 )
 
         y = df.to_numpy()
 
-        X = date_part(
+        self.X = date_part(
             df.index,
             method=self.datepart_method,
             polynomial_degree=self.polynomial_degree,
         )
         if self.regression_type in ['User', 'user']:
             # regr = future_regressor.copy()
             # regr.index = X.index
-            X = pd.concat([X, future_regressor], axis=1)
-        X.columns = [str(xc) for xc in X.columns]
+            self.X = pd.concat([self.X, future_regressor], axis=1)
+        self.X.columns = [str(xc) for xc in self.X.columns]
 
         multioutput = True
         if y.ndim < 2:
             multioutput = False
         elif y.shape[1] < 2:
             multioutput = False
             y = y.ravel()
@@ -1975,15 +1990,15 @@
             verbose=self.verbose,
             verbose_bool=self.verbose_bool,
             random_seed=self.random_seed,
             n_jobs=self.n_jobs,
             multioutput=multioutput,
         )
         self.df_train = df
-        self.model = self.model.fit(X.astype(float), y.astype(float))
+        self.model = self.model.fit(self.X.astype(float), y.astype(float))
         self.shape = df.shape
         return self
 
     def predict(
         self,
         forecast_length: int,
         future_regressor=None,
@@ -1998,25 +2013,27 @@
 
         Returns:
             Either a PredictionObject of forecasts and metadata, or
             if just_point_forecast == True, a dataframe of point forecasts
         """
         predictStartTime = datetime.datetime.now()
         index = self.create_forecast_index(forecast_length=forecast_length)
-        X = date_part(
+        self.X_pred = date_part(
             index, method=self.datepart_method, polynomial_degree=self.polynomial_degree
         )
         if self.regression_type in ['User', 'user']:
-            X = pd.concat([X, future_regressor], axis=1)
-            if X.shape[0] > index.shape[0]:
+            self.X_pred = pd.concat([self.X_pred, future_regressor], axis=1)
+            if self.X_pred.shape[0] > index.shape[0]:
                 raise ValueError("future_regressor and X index failed to align")
-        X.columns = [str(xc) for xc in X.columns]
+        self.X_pred.columns = [str(xc) for xc in self.X_pred.columns]
 
         forecast = pd.DataFrame(
-            self.model.predict(X.astype(float)), index=index, columns=self.column_names
+            self.model.predict(self.X_pred.astype(float)),
+            index=index,
+            columns=self.column_names,
         )
 
         if just_point_forecast:
             return forecast
         else:
             upper_forecast, lower_forecast = Point_to_Probability(
                 self.df_train,
@@ -2768,15 +2785,15 @@
         current_x = self.sktraindata.copy()
 
         # and this is ridiculously slow, nested loop
         for fcst_step in range(forecast_length):
             cur_regr = None
             if self.regression_type is not None:
                 cur_regr = base_regr.reindex(current_x.index)
-            x_dat = pd.concat(
+            self.X_pred = pd.concat(
                 [
                     rolling_x_regressor_regressor(
                         current_x[x_col].to_frame(),
                         mean_rolling_periods=self.mean_rolling_periods,
                         macd_periods=self.macd_periods,
                         std_rolling_periods=self.std_rolling_periods,
                         max_rolling_periods=self.max_rolling_periods,
@@ -2796,25 +2813,25 @@
                         future_regressor=cur_regr,
                         cointegration=self.cointegration,
                         cointegration_lag=self.cointegration_lag,
                     ).tail(1)
                     for x_col in current_x.columns
                 ]
             ).to_numpy()
-            rfPred = self.model.predict(x_dat)
+            rfPred = self.model.predict(self.X_pred)
             pred_clean = pd.DataFrame(
                 rfPred, index=current_x.columns, columns=[index[fcst_step]]
             ).transpose()
             forecast = pd.concat([forecast, pred_clean])
             if self.probabilistic:
-                rfPred_upper = self.model_upper.predict(x_dat)
+                rfPred_upper = self.model_upper.predict(self.X_pred)
                 pred_upper = pd.DataFrame(
                     rfPred_upper, index=current_x.columns, columns=[index[fcst_step]]
                 ).transpose()
-                rfPred_lower = self.model_lower.predict(x_dat)
+                rfPred_lower = self.model_lower.predict(self.X_pred)
                 pred_lower = pd.DataFrame(
                     rfPred_lower, index=current_x.columns, columns=[index[fcst_step]]
                 ).transpose()
                 upper_forecast = pd.concat([upper_forecast, pred_upper])
                 lower_forecast = pd.concat([lower_forecast, pred_lower])
             current_x = pd.concat(
                 [
```

### Comparing `autots-0.5.7/autots/models/statsmodels.py` & `autots-0.5.8/autots/models/statsmodels.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/models/tfp.py` & `autots-0.5.8/autots/models/tfp.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/templates/general.py` & `autots-0.5.8/autots/templates/general.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/anomaly_utils.py` & `autots-0.5.8/autots/tools/anomaly_utils.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/calendar.py` & `autots-0.5.8/autots/tools/calendar.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/cointegration.py` & `autots-0.5.8/autots/tools/cointegration.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/cpu_count.py` & `autots-0.5.8/autots/tools/cpu_count.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/fast_kalman.py` & `autots-0.5.8/autots/tools/fast_kalman.py`

 * *Files 1% similar despite different names*

```diff
@@ -243,18 +243,23 @@
         n_states = state_transition.shape[-2]  # Allow different transitions
 
         process_noise = ensure_matrix(process_noise, n_states)
         observation_model = ensure_matrix(observation_model)
         n_obs = observation_model.shape[-2]
         observation_noise = ensure_matrix(observation_noise, n_obs)
 
-        assert state_transition.shape[-2:] == (n_states, n_states)
-        assert process_noise.shape[-2:] == (n_states, n_states)
-        assert observation_model.shape[-2:] == (n_obs, n_states)
-        assert observation_noise.shape[-2:] == (n_obs, n_obs)
+        try:
+            assert state_transition.shape[-2:] == (n_states, n_states)
+            assert process_noise.shape[-2:] == (n_states, n_states)
+            assert observation_model.shape[-2:] == (n_obs, n_states)
+            assert observation_noise.shape[-2:] == (n_obs, n_obs)
+        except Exception as e:
+            raise ValueError(
+                f"dimension mismatch: n_states: {n_states}, n_obs: {n_obs}"
+            ) from e
 
         self.state_transition = state_transition
         self.process_noise = process_noise
         self.observation_model = observation_model
         self.observation_noise = observation_noise
 
     def predict_next(self, m, P):
```

### Comparing `autots-0.5.7/autots/tools/hierarchial.py` & `autots-0.5.8/autots/tools/hierarchial.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/holiday.py` & `autots-0.5.8/autots/tools/holiday.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/impute.py` & `autots-0.5.8/autots/tools/impute.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/lunar.py` & `autots-0.5.8/autots/tools/lunar.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/percentile.py` & `autots-0.5.8/autots/tools/percentile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/probabilistic.py` & `autots-0.5.8/autots/tools/probabilistic.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/profile.py` & `autots-0.5.8/autots/tools/profile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/regressor.py` & `autots-0.5.8/autots/tools/regressor.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/seasonal.py` & `autots-0.5.8/autots/tools/seasonal.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/shaping.py` & `autots-0.5.8/autots/tools/shaping.py`

 * *Files 0% similar despite different names*

```diff
@@ -372,15 +372,17 @@
     """
     assert forecast_length > 0, "forecast_length must be greater than 0"
 
     if (forecast_length * min_allowed_train_percent) > int(
         (df.shape[0]) - forecast_length
     ):
         raise ValueError(
-            "forecast_length is too large for training data, alter min_allowed_train_percent to override"
+            """forecast_length is too large for training data, alter min_allowed_train_percent to override.
+            This error is also often caused by errors in inputing of or preshaping the data.
+            """
         )
 
     train = df.head((df.shape[0]) - forecast_length)
     test = df.tail(forecast_length)
 
     # not failing on the rational that it effects all models, and therefore all metrics equally
     if (verbose > 0) and ((train.isnull().sum(axis=0) / train.shape[0]).max() > 0.9):
```

### Comparing `autots-0.5.7/autots/tools/thresholding.py` & `autots-0.5.8/autots/tools/thresholding.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/autots/tools/transform.py` & `autots-0.5.8/autots/tools/transform.py`

 * *Files 1% similar despite different names*

```diff
@@ -2791,14 +2791,15 @@
         use_islamic_holidays=True,
         use_hebrew_holidays=True,
         remove_excess_anomalies=True,
         impact=None,
         regression_params=None,
         n_jobs: int = 1,
         output="multivariate",  # really can only be this for preprocessing
+        verbose: int = 1,
     ):
         """Detect anomalies, then mark as holidays (events, festivals, etc) any that reoccur to a calendar.
 
         Args:
             anomaly_detector_params (dict): anomaly detection params passed to detector class
             threshold (float): percent of date occurrences that must be anomalous (0 - 1)
             splash_threshold (float): None, or % required, avg of nearest 2 neighbors to point
@@ -2823,14 +2824,15 @@
         self.remove_excess_anomalies = remove_excess_anomalies
         self.fillna = anomaly_detector_params.get("fillna", None)
         self.impact = impact
         self.regression_params = regression_params
         self.n_jobs = n_jobs
         self.holiday_count = 0
         self.df_cols = None
+        self.verbose = verbose
 
     def dates_to_holidays(self, dates, style="flag", holiday_impacts=False):
         """
         dates (pd.DatetimeIndex): list of dates
         style (str): option for how to return information
             "long" - return date, name, series for all holidays in a long style dataframe
             "impact" - returns dates, series with values of sum of impacts (if given) or joined string of holiday names
@@ -2854,15 +2856,16 @@
             hebrew_holidays=self.hebrew_holidays,
         )
 
     def fit(self, df):
         """Run holiday detection. Input wide-style pandas time series."""
         self.anomaly_model.fit(df)
         if np.min(self.anomaly_model.anomalies.values) != -1:
-            print("HolidayTransformer: no anomalies detected.")
+            if self.verbose > 1:
+                print("HolidayTransformer: no anomalies detected.")
         (
             self.day_holidays,
             self.wkdom_holidays,
             self.wkdeom_holidays,
             self.lunar_holidays,
             self.lunar_weekday,
             self.islamic_holidays,
@@ -3218,21 +3221,15 @@
             )[0]
         else:
             em_iter = random.choices([None, 10, 30], [0.9, 0.4, 0.1])[0]
         params = random.choices(
             # the same model can sometimes be defined in various matrix forms
             [
                 # floats are phi
-                {
-                    'model_name': 'local linear trend',
-                    'state_transition': [[1, 1], [0, 1]],
-                    'process_noise': [[0.1, 0.0], [0.0, 0.01]],
-                    'observation_model': [[1, 0]],
-                    'observation_noise': random.choice([0.25, 0.5, 1.0, 0.05]),
-                },
+                'ets_aan',
                 {
                     'model_name': 'local linear stochastic seasonal dummy',
                     'state_transition': [
                         [1, 0, 0, 0],
                         [0, -1, -1, -1],
                         [0, 1, 0, 0],
                         [0, 0, 1, 0],
@@ -3325,36 +3322,104 @@
                     'model_name': 'spline',
                     'state_transition': [[2, -1], [1, 0]],
                     'process_noise': [[1, 0], [0, 0]],
                     'observation_model': [[1, 0]],
                     'observation_noise': 1.0,
                 },
                 12,
+                "dynamic_linear",
             ],
-            [0.1, 0.1, 0.1, 0.05, 0.05, 0.1, 0.1, 0.1, 0.1],
+            [0.1, 0.1, 0.1, 0.05, 0.05, 0.1, 0.1, 0.1, 0.1, 0.1],
         )[0]
         if params in [364] and method not in ['deep']:
             params = 7
         if params == "random":
             st, procnois, obsmod, obsnois = random_state_space()
             params = {
                 'model_name': 'randomly generated',
                 'state_transition': st.tolist(),
                 'process_noise': procnois.tolist(),
                 'observation_model': obsmod.tolist(),
                 'observation_noise': obsnois,
             }
+        elif params == "dynamic_linear":
+            choices = [
+                0.0,
+                0.1,
+                0.2,
+                0.3,
+                0.4,
+                0.5,
+                0.6,
+                0.7,
+                0.8,
+                0.9,
+                1.0,
+                1.1,
+                1.2,
+                1.3,
+                1.4,
+                1.5,
+            ]
+            params = {
+                'model_name': 'dynamic linear',
+                'state_transition': [
+                    [1, 1, 0, 0],
+                    [0, 1, 0, 0],
+                    [0, 0, random.choice(choices), 1],
+                    [0, 0, random.choice(choices), 0],
+                ],
+                'process_noise': [
+                    [random.choice(choices), 0, 0, 0],
+                    [0, random.choice(choices), 0, 0],
+                    [0, 0, random.choice(choices), 0],
+                    [0, 0, 0, 0],
+                ],
+                'observation_model': [[1, 0, 1, 0]],
+                'observation_noise': 0.25,
+                'em_iter': 10,
+            }
+        elif params == "ets_aan":
+            choices = [
+                0.0,
+                0.01,
+                0.1,
+                0.2,
+                0.3,
+                0.4,
+                0.5,
+                0.6,
+                0.7,
+                0.8,
+                0.9,
+                1.0,
+                1.1,
+                1.2,
+                1.3,
+                1.4,
+                1.5,
+            ]
+            params = {
+                'model_name': 'local_linear_trend_ets_aan',
+                'state_transition': [[1, 1], [0, 1]],
+                'process_noise': [
+                    [random.choice(choices), 0.0],
+                    [0.0, random.choice(choices)],
+                ],
+                'observation_model': [[1, 0]],
+                'observation_noise': random.choice([0.25, 0.5, 1.0, 0.05]),
+            }
         elif isinstance(params, int):
             state_transition = np.zeros((params + 1, params + 1))
             state_transition[0, 0] = 1
             state_transition[1, 1:-1] = [-1.0] * (params - 1)
             state_transition[2:, 1:-1] = np.eye(params - 1)
             observation_model = [[1, 1] + [0] * (params - 1)]
-            level_noise = 0.2 / random.choice([1, 5, 10])
-            season_noise = 1e-3
+            level_noise = 0.2 / random.choice([0.2, 0.5, 1, 5, 10, 200])
+            season_noise = random.choice([1e-4, 1e-3, 1e-2, 1e-1])
             process_noise_cov = (
                 np.diag([level_noise, season_noise] + [0] * (params - 1)) ** 2
             )
             params = {
                 'model_name': f'local linear hidden state with seasonal {params}',
                 'state_transition': state_transition.tolist(),
                 'process_noise': process_noise_cov.tolist(),
@@ -3784,15 +3849,22 @@
             window (int): passed through to rolling mean fill technique
 
         Returns:
             pandas.DataFrame
         """
         # so much faster not to try to fill NaN if there aren't any NaN
         if isinstance(df, pd.DataFrame):
-            self.nan_flag = np.isnan(np.min(df.to_numpy()))
+            # attempting to find a bug, zero size array to min
+            try:
+                self.nan_flag = np.isnan(np.min(df.to_numpy()))
+            except Exception as e:
+                self.nan_flag = True
+                print(repr(e))
+                print(df)
+                print(df.shape)
         else:
             self.nan_flag = np.isnan(np.min(np.array(df)))
         if self.nan_flag:
             return FillNA(df, method=self.fillna, window=window)
         else:
             return df
```

### Comparing `autots-0.5.7/autots/tools/window_functions.py` & `autots-0.5.8/autots/tools/window_functions.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/docs/conf.py` & `autots-0.5.8/docs/conf.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,15 +21,15 @@
 copyright = u'%s, Colin Catlin' % date.today().year
 author = 'Colin Catlin'
 
 # The full version, including alpha/beta/rc tags
 # import AutoTS
 # from  AutoTS import __version__
 # release = __version__
-release = "0.5.7"
+release = "0.5.8"
 
 # -- General configuration ---------------------------------------------------
 
 # Add any Sphinx extension module names here, as strings. They can be
 # extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
 # ones.
 # Add napoleon to the extensions list
```

### Comparing `autots-0.5.7/pyproject.toml` & `autots-0.5.8/pyproject.toml`

 * *Files 0% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 [build-system]
 requires = ["setuptools>=61.0"]
 build-backend = "setuptools.build_meta"
 
 [project]
 name = "autots"
-version = "0.5.7"
+version = "0.5.8"
 authors = [
   { name="Colin Catlin", email="colin.catlin@gmail.com" },
 ]
 description = "Automated Time Series Forecasting"
 readme = "README.md"
 requires-python = ">=3.6"
 license = {text = "MIT License"}
```

### Comparing `autots-0.5.7/setup.py` & `autots-0.5.8/setup.py`

 * *Files 10% similar despite different names*

```diff
@@ -28,15 +28,15 @@
 }
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setuptools.setup(
     name="AutoTS",
-    version="0.5.7",
+    version="0.5.8",
     author="Colin Catlin",
     author_email="colin.catlin@syllepsis.live",
     description="Automated Time Series Forecasting",
     long_description=long_description,
     long_description_content_type="text/markdown",
     url="https://github.com/winedarksea/AutoTS",
     packages=setuptools.find_packages(),
```

### Comparing `autots-0.5.7/tests/test_anomalies.py` & `autots-0.5.8/tests/test_anomalies.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_autots.py` & `autots-0.5.8/tests/test_autots.py`

 * *Files 1% similar despite different names*

```diff
@@ -198,15 +198,15 @@
             initial_template='Random',
             models_to_validate=models_to_validate,
             max_per_model_class=None,
             n_jobs=n_jobs,
             model_interrupt=True,
             drop_most_recent=1,
             verbose=verbose,
-            random_seed=1234,
+            random_seed=1918,
         )
         model = model.fit(
             df,
             date_col='datetime' if long else None,
             value_col='value' if long else None,
             id_col='series_id' if long else None,
         )
@@ -403,16 +403,18 @@
         df = load_daily(long=False).iloc[:, 0:5]
         models = [
             'SectionalMotif', 'MultivariateMotif', 'AverageValueNaive',
             'NVAR', "LastValueNaive", 'Theta', 'FBProphet', 'SeasonalNaive',
             'GLM', 'ETS', "ConstantNaive", 'WindowRegression',
             'DatepartRegression', 'MultivariateRegression',
             'Cassandra', 'MetricMotif', 'SeasonalityMotif', 'KalmanStateSpace',
-            'ARDL', 'UnivariateMotif', 'VAR',
+            'ARDL', 'UnivariateMotif', 'VAR', 'MAR', 'TMF', 'RRVAR', 'VECM',
         ]
+        # models that for whatever reason arne't consistent across test sessions
+        run_only_no_score = ['FBProphet', 'RRVAR', "TMF"]
 
         timings = {}
         forecasts = {}
         upper_forecasts = {}
         lower_forecasts = {}
         # load the comparison source
         with open("./tests/model_forecasts.json", "r") as file:
@@ -465,35 +467,36 @@
             except Exception as e:
                 raise ValueError(f"model {x} failed with {repr(e)}")
 
         print(sum(timings.values()))
 
         pass_probabilistic = ['FBProphet']  # not yet reproducible in upper/lower with seed
         for x in models:
-            with self.subTest(i=x):
-                res = (forecasts2[x].round(2) == forecasts[x].round(2)).all().all()
-                if x not in pass_probabilistic:
-                    res_u = (upper_forecasts2[x].round(2) == upper_forecasts[x].round(2)).all().all()
-                    res_l = (lower_forecasts2[x].round(2) == lower_forecasts[x].round(2)).all().all()
-                else:
-                    res_u = True
-                    res_l = True
-                self.assertTrue(
-                    res,
-                    f"Model '{x}' forecasts diverged from sample forecasts."
-                )
-                self.assertTrue(
-                    res_u,
-                    f"Model '{x}' upper forecasts diverged from sample forecasts."
-                )
-                self.assertTrue(
-                    res_l,
-                    f"Model '{x}' lower forecasts diverged from sample forecasts."
-                )
-                print(f"{res & res_u & res_l} model '{x}' ran successfully in {round(timings2[x], 4)} (bench: {round(timings[x], 4)})")
+            if x not in run_only_no_score:
+                with self.subTest(i=x):
+                    res = (forecasts2[x].round(2) == forecasts[x].round(2)).all().all()
+                    if x not in pass_probabilistic:
+                        res_u = (upper_forecasts2[x].round(2) == upper_forecasts[x].round(2)).all().all()
+                        res_l = (lower_forecasts2[x].round(2) == lower_forecasts[x].round(2)).all().all()
+                    else:
+                        res_u = True
+                        res_l = True
+                    self.assertTrue(
+                        res,
+                        f"Model '{x}' forecasts diverged from sample forecasts."
+                    )
+                    self.assertTrue(
+                        res_u,
+                        f"Model '{x}' upper forecasts diverged from sample forecasts."
+                    )
+                    self.assertTrue(
+                        res_l,
+                        f"Model '{x}' lower forecasts diverged from sample forecasts."
+                    )
+                    print(f"{res & res_u & res_l} model '{x}' ran successfully in {round(timings2[x], 4)} (bench: {round(timings[x], 4)})")
 
         """
         for x in models:
             forecasts[x].index = forecasts[x].index.strftime("%Y-%m-%d")
             forecasts[x] = forecasts[x].reset_index(drop=False).to_dict(orient="list")
             upper_forecasts[x].index = upper_forecasts[x].index.strftime("%Y-%m-%d")
             upper_forecasts[x] = upper_forecasts[x].reset_index(drop=False).to_dict(orient="list")
```

### Comparing `autots-0.5.7/tests/test_calendar_holiday.py` & `autots-0.5.8/tests/test_calendar_holiday.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_cassandra.py` & `autots-0.5.8/tests/test_cassandra.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_event_forecasting.py` & `autots-0.5.8/tests/test_event_forecasting.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_impute.py` & `autots-0.5.8/tests/test_impute.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_metrics.py` & `autots-0.5.8/tests/test_metrics.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_percentile.py` & `autots-0.5.8/tests/test_percentile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.7/tests/test_regressor.py` & `autots-0.5.8/tests/test_regressor.py`

 * *Files identical despite different names*

